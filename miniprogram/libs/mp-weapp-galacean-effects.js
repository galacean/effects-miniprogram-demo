"use strict";function t(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(r){if("default"!==r&&!(r in t)){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}}))})),Object.freeze(t)}function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var r={},i={};Object.defineProperty(i,"__esModule",{value:!0}),i.platform=void 0,i.platform={getSystemInfoSync:function(){return{pixelRatio:1,system:"",platform:"",language:"",screenWidth:1,screenHeight:1,windowWidth:1,windowHeight:1}},createCanvas:function(){return{addEventListener:function(t,e,r){},removeEventListener:function(t,e){},dispatchEvent:function(t){},width:0,height:0}},createOffscreenCanvas:function(t){return{addEventListener:function(t,e,r){},removeEventListener:function(t,e){},dispatchEvent:function(t){},width:0,height:0}},createImage:function(){},createSelectorQuery:function(){},request:function(t){},downloadFile:function(t){},createVideoContext:function(t){},startDeviceMotionListening:function(t){},stopDeviceMotionListening:function(){},onDeviceMotionChange:function(t){},offDeviceMotionChange:function(t){}};var n=i;n.platform.createCanvas=wx.createCanvas,n.platform.createImage=wx.createImage,n.platform.createOffscreenCanvas=wx.createOffscreenCanvas,n.platform.createSelectorQuery=wx.createSelectorQuery,n.platform.getSystemInfoSync=wx.getSystemInfoSync,n.platform.request=wx.request,n.platform.createVideoContext=wx.createVideoContext,n.platform.downloadFile=wx.downloadFile,n.platform.startDeviceMotionListening=wx.startDeviceMotionListening,n.platform.stopDeviceMotionListening=wx.stopDeviceMotionListening,n.platform.onDeviceMotionChange=wx.onDeviceMotionChange,n.platform.offDeviceMotionChange=wx.offDeviceMotionChange;var o={},s={},a={},u={},c={},h={},l={},f={};Object.defineProperty(f,"__esModule",{value:!0}),f.screen=void 0;var p=i.platform.getSystemInfoSync(),d=p.screenWidth,m=p.screenHeight,v=p.windowWidth,y=p.windowHeight;f.screen={width:d,height:m,availWidth:v,availHeight:y,availLeft:0,availTop:0};var g={};Object.defineProperty(g,"__esModule",{value:!0}),g.noop=void 0,g.noop=function(){};var _=function(){return _=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},_.apply(this,arguments)};Object.defineProperty(l,"__esModule",{value:!0}),l.classList=l.scrollRegion=l.offsetRegion=l.clientRegion=l.style=l.parentNode=void 0;var E=f,x=u,T=g,b=E.screen.availWidth,A=E.screen.availHeight;l.parentNode=function(t,e){var r,i;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return x.document.documentElement}:function(){return x.document.body},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r})),"parentElement"in t||(i=0===e?function(){return null}:1===e?function(){return x.document.documentElement}:function(){return x.document.body},Object.defineProperty(t,"parentElement",{enumerable:!0,get:i}))},l.style=function(t){var e;t.style=_(_({},null!==(e=t.style)&&void 0!==e?e:{}),{top:"0px",left:"0px",width:b+"px",height:A+"px",margin:"0px",padding:"0px"})},l.clientRegion=function(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=b,t.clientHeight=A),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:t.top||0,left:t.left||0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})},l.offsetRegion=function(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=b,t.offsetHeight=A)},l.scrollRegion=function(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=b,t.scrollHeight=A)},l.classList=function(t){t.classList=[],t.classList.add=T.noop,t.classList.remove=T.noop,t.classList.contains=T.noop,t.classList.toggle=T.noop};var R={},S={},C={};Object.defineProperty(C,"__esModule",{value:!0}),C.EventTarget=void 0;var O=new WeakMap,M=function(){function t(){O.set(this,{})}return t.prototype.addEventListener=function(t,e,r){void 0===r&&(r={});var i=O.get(this);i||(i={}),i[t]||(i[t]=[]),i[t].push(e),O.set(this,i),r.capture,r.once,r.passive},t.prototype.removeEventListener=function(t,e,r){var i=O.get(this);if(i){var n=i[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}},t.prototype.dispatchEvent=function(t){var e=O.get(this)[t.type];if(e)for(var r=0;r<e.length;r++)e[r](t)},t}();C.EventTarget=M;var P,I=(P=function(t,e){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},P(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(S,"__esModule",{value:!0}),S.Node=void 0;var w=function(t){function e(){var e=t.call(this)||this;return e.childNodes=[],e}return I(e,t),e.prototype.appendChild=function(t){this.childNodes.push(t)},e.prototype.cloneNode=function(){var t=Object.create(this);return Object.assign(t,this),t},e.prototype.removeChild=function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null},e}(C.EventTarget);S.Node=w;var L=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(R,"__esModule",{value:!0}),R.Element=void 0;var F=function(t){function e(){var e=t.call(this)||this;return e.className="",e.children=[],e}return L(e,t),e.prototype.setAttribute=function(t,e){this[t]=e},e.prototype.getAttribute=function(t){return this[t]},e.prototype.setAttributeNS=function(t,e){this[t]=e},e.prototype.getAttributeNS=function(t){return this[t]},e}(S.Node);R.Element=F;var N=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),D=Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]},V=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},U=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&D(e,t,r);return V(e,t),e};Object.defineProperty(h,"__esModule",{value:!0}),h.HTMLElement=void 0;var B=U(l),k=g,z=function(t){function e(e,r){void 0===e&&(e="");var i=t.call(this)||this;return i.className="",i.children=[],i.focus=k.noop,i.blur=k.noop,i.insertBefore=k.noop,i.appendChild=k.noop,i.removeChild=k.noop,i.remove=k.noop,i.innerHTML="",i.tagName=e.toUpperCase(),B.parentNode(i,r),B.style(i),B.classList(i),B.clientRegion(i),B.offsetRegion(i),B.scrollRegion(i),i}return N(e,t),e}(R.Element);h.HTMLElement=z,Object.defineProperty(z,Symbol.hasInstance,{value:function(t){return"BODY"===(null==t?void 0:t.tagName)}});var G=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(c,"__esModule",{value:!0}),c.Body=void 0;var X=u,H=function(t){function e(){return t.call(this,"body",0)||this}return G(e,t),e.prototype.addEventListener=function(t,e,r){void 0===r&&(r={}),X.document.addEventListener(t,e,r)},e.prototype.removeEventListener=function(t,e){X.document.removeEventListener(t,e)},e.prototype.dispatchEvent=function(t){X.document.dispatchEvent(t)},e}(h.HTMLElement);c.Body=H;var j={},Y={},W=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Y,"__esModule",{value:!0}),Y.HTMLMediaElement=void 0;var Z=function(t){function e(e){return t.call(this,e)||this}return W(e,t),e.prototype.addTextTrack=function(){},e.prototype.captureStream=function(){},e.prototype.fastSeek=function(){},e.prototype.load=function(){},e.prototype.pause=function(){},e.prototype.play=function(){},e}(h.HTMLElement);Y.HTMLMediaElement=Z;var q=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(j,"__esModule",{value:!0}),j.HTMLVideoElement=void 0;var K=function(t){function e(){return t.call(this,"video")||this}return q(e,t),e}(Y.HTMLMediaElement);j.HTMLVideoElement=K;var Q={},J={},$=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(J,"__esModule",{value:!0}),J.HTMLAudioElement=J.HTMLCanvasElement=J.HTMLImageElement=void 0;var tt=h,et=Y,rt=function(t){function e(){return t.call(this,"img")||this}return $(e,t),e}(tt.HTMLElement);J.HTMLImageElement=rt,Object.defineProperty(rt,Symbol.hasInstance,{value:function(t){return"IMG"===(null==t?void 0:t.tagName)||(null==t?void 0:t.crossOrigin)}});var it=function(t){function e(){return t.call(this,"canvas")||this}return $(e,t),e}(tt.HTMLElement);J.HTMLCanvasElement=it;var nt=function(t){function e(){return t.call(this,"audio")||this}return $(e,t),e}(et.HTMLMediaElement);J.HTMLAudioElement=nt;var ot={},st=Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]},at=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},ut=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&st(e,t,r);return at(e,t),e},ct=function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?n(t.value):function(t){return t instanceof r?t:new r((function(e){e(t)}))}(t.value).then(s,a)}u((i=i.apply(t,e||[])).next())}))},ht=function(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(ot,"__esModule",{value:!0}),ot.isMiniGame=ot.getCanvas=ot.registerOffscreenCanvas=ot.registerCanvas=void 0;var lt=i,ft=u,pt=ut(l),dt={},mt=!1;function vt(t,e){return"tagName"in t||(t.tagName="CANVAS"),t.type="canvas",t.width=2*t.width,t.height=2*t.height,pt.parentNode(t,null!=e?e:0),pt.style(t),pt.classList(t),pt.offsetRegion(t),t.focus=function(){},t.blur=function(){},t.addEventListener=function(t,e,r){void 0===r&&(r={}),ft.document.addEventListener(t,e,r)},t.removeEventListener=function(t,e){ft.document.removeEventListener(t,e)},t.dispatchEvent=function(t){ft.document.dispatchEvent(t)},t}function yt(t){return ct(this,void 0,void 0,(function(){return ht(this,(function(e){return[2,new Promise((function(e,r){lt.platform.createSelectorQuery().select(t).node().select(t).boundingClientRect().exec((function(i){try{var n=i[0].node,o=i[1];n?(n.getBoundingClientRect=function(){return o},e(n)):r("create canvas fail, canvas is ".concat(n))}catch(e){r("Cannot find canvas by id: ".concat(t,", ").concat(e))}}))}))]}))}))}ot.registerCanvas=function(){return ct(this,arguments,void 0,(function(t){var e,r,i,n,o,s;return void 0===t&&(t={}),ht(this,(function(a){switch(a.label){case 0:return e=t.id,r=void 0===e?"J-canvas":e,i=t.isMiniGame,n=void 0!==i&&i,o=t.elementLevel,s=void 0===o?0:o,"string"!=typeof r?[3,4]:n?(dt=lt.platform.createCanvas(),[3,3]):[3,1];case 1:return[4,yt(r)];case 2:dt=a.sent(),a.label=3;case 3:return[3,5];case 4:(dt=r).id=r,a.label=5;case 5:return vt(dt,s),mt=n,[2,dt]}}))}))},ot.registerOffscreenCanvas=vt,ot.getCanvas=function(){return dt},ot.isMiniGame=function(){return mt};var gt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Q,"__esModule",{value:!0}),Q.Image=void 0;var _t=i,Et=ot,xt=function(t){function e(){var r,i,n=t.call(this)||this;if((0,Et.isMiniGame)())n.image=_t.platform.createImage();else{var o=(0,Et.getCanvas)();n.image=null!==(i=null===(r=o.createImage)||void 0===r?void 0:r.call(o))&&void 0!==i?i:{}}return n.image.constructor=e,n.image}return gt(e,t),e}(J.HTMLImageElement);Q.Image=xt,function(t){var e=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.document=void 0;var r=i,n=c,o=h,s=j,a=Q,u=ot,l=function(r){function i(){return r.call(this,"html",0)||this}return e(i,r),i.prototype.addEventListener=function(e,r,i){void 0===i&&(i={}),t.document.addEventListener(e,r,i)},i.prototype.removeEventListener=function(e,r){t.document.removeEventListener(e,r)},i.prototype.dispatchEvent=function(e){t.document.dispatchEvent(e)},i}(o.HTMLElement),f={};t.document={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:null,createElement:function(e){if("canvas"===(e=e.toLowerCase())){if((0,u.isMiniGame)())return(i=r.platform.createCanvas()).addEventListener=function(e,r,i){void 0===i&&(i={}),t.document.addEventListener(e,r,i)},i.removeEventListener=function(e,r){t.document.removeEventListener(e,r)},i.dispatchEvent=function(e){t.document.dispatchEvent(e)},i;var i=r.platform.createOffscreenCanvas({type:"2d"});return(0,u.registerOffscreenCanvas)(i),i}return"img"===e?new a.Image:"video"===e?new s.HTMLVideoElement:new o.HTMLElement(e)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){var e=(0,u.getCanvas)();return t===e.id?e:null},getElementsByTagName:function(e){return"head"===(e=e.toLowerCase())?[t.document.head]:"body"===e?[t.document.body]:"canvas"===e?[(0,u.getCanvas)()]:[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(e){return"head"===e?[t.document.head]:"body"===e?[t.document.body]:"canvas"===e?[(0,u.getCanvas)()]:[]},querySelector:function(e){var r=(0,u.getCanvas)();return"head"===e?t.document.head:"body"===e?t.document.body:"canvas"===e||e==="#".concat(r.id)?r:null},querySelectorAll:function(e){return"head"===e?[t.document.head]:"body"===e?[t.document.body]:"canvas"===e?[(0,u.getCanvas)()]:[]},addEventListener:function(t,e,r){f[t]||(f[t]=[]),f[t].push(e)},removeEventListener:function(t,e){var r=f[t];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===e){r.splice(i,1);break}},dispatchEvent:function(t){var e=t.type,r=f[e];if(r)for(var i=0;i<r.length;i++)r[i](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)}},t.document.documentElement=new l,t.document.head=new o.HTMLElement("head"),t.document.body=new n.Body}(u);var Tt={};Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.Event=void 0;var bt=function(t){this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=t,this.timeStamp=Date.now()};Tt.Event=bt;var At=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(a,"__esModule",{value:!0}),a.dispatchTouchCancel=a.dispatchTouchEnd=a.dispatchTouchMove=a.dispatchTouchStart=void 0;var Rt=u,St=ot,Ct=function(t){function e(e){var r=t.call(this,e)||this;return r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=(0,St.getCanvas)(),r.currentTarget=(0,St.getCanvas)(),r}return At(e,t),e}(Tt.Event);function Ot(t){var e=t||{},r=e.x,i=void 0===r?0:r,n=e.y,o=void 0===n?0:n,s=e.clientX,a=void 0===s?0:s,u=e.clientY,c=void 0===u?0:u;Object.keys(t).includes("x")?(t.pageX=t.clientX=i,t.pageY=t.clientY=o):(t.x=a,t.y=c),t.target||(t.target=(0,St.getCanvas)())}function Mt(t){return function(e){var r=new Ct(t);r.changedTouches=e.changedTouches||e.touches,r.touches=e.touches,r.targetTouches=Array.prototype.slice.call(e.touches),r.timeStamp=e.timeStamp,r.changedTouches.forEach((function(t){return Ot(t)})),r.touches.forEach((function(t){return Ot(t)})),r.targetTouches.forEach((function(t){return Ot(t)})),Rt.document.dispatchEvent(r)}}var Pt=Mt("touchstart");a.dispatchTouchStart=Pt;var It=Mt("touchmove");a.dispatchTouchMove=It;var wt=Mt("touchend");a.dispatchTouchEnd=wt;var Lt=Mt("touchcancel");a.dispatchTouchCancel=Lt;var Ft={},Nt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.dispatchPointerCancel=Ft.dispatchPointerLeave=Ft.dispatchPointerUp=Ft.dispatchPointerMove=Ft.dispatchPointerDown=void 0;var Dt=ot,Vt=u,Ut=function(t){function e(e){var r=t.call(this,e)||this;return r.target=(0,Dt.getCanvas)(),r.currentTarget=(0,Dt.getCanvas)(),r}return Nt(e,t),e}(Tt.Event),Bt=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],kt=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function zt(t,e){for(var r=new Ut(t),i=0;i<Bt.length;i++){var n=Bt[i];r[n]=e[n]||kt[i]}return r.type=t,r.target=(0,Dt.getCanvas)(),r.currentTarget=(0,Dt.getCanvas)(),r.buttons=function(t){var e=0;"touchstart"!==t&&"touchmove"!==t&&"pointerdown"!==t&&"pointermove"!==t||(e=1);return e}(t),r.which=r.buttons,r.pointerId=(e.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(e.radiusX||.5),r.height=2*(e.radiusY||.5),r.pressure=e.force||.5,r.isPrimary=function(t){return Gt===t.identifier}(e),r.pointerType="touch",r.offsetX=e.pageX||e.x,r.offsetY=e.pageY||e.y,r}var Gt=null;function Xt(t){null===Gt&&(Gt=t.identifier)}function Ht(t){Gt===t.identifier&&(Gt=null)}function jt(t){return function(e){for(var r=e.changedTouches||e.touches,i=0;i<r.length;i++){var n=r[i];switch(t){case"pointerdown":0===i&&Xt(n),Vt.document.dispatchEvent(zt(t,n));break;case"pointermove":case"pointerup":Vt.document.dispatchEvent(zt(t,n));break;case"pointerleave":case"pointercancel":Ht(n),Vt.document.dispatchEvent(zt(t,n))}}}}var Yt=jt("pointerdown");Ft.dispatchPointerDown=Yt;var Wt=jt("pointermove");Ft.dispatchPointerMove=Wt;var Zt=jt("pointerup");Ft.dispatchPointerUp=Zt;var qt=jt("pointerleave");Ft.dispatchPointerLeave=qt;var Kt=jt("pointercancel");Ft.dispatchPointerCancel=Kt;var Qt={};Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.dispatchMouseUp=Qt.dispatchMouseMove=Qt.dispatchMouseDown=void 0;var Jt=u;function $t(t){return function(e){e.type=t,Jt.document.dispatchEvent(e)}}var te=$t("mousedown");Qt.dispatchMouseDown=te;var ee=$t("mousemove");Qt.dispatchMouseMove=ee;var re=$t("mouseup");Qt.dispatchMouseUp=re,function(t){var e=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),r=this&&this.__exportStar||function(t,r){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(r,i)||e(r,t,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(a,t),r(Ft,t),r(Qt,t)}(s);var ie={};Object.defineProperty(ie,"__esModule",{value:!0}),ie.Accelerometer=void 0;var ne=i,oe=u,se=function(){function t(){}return t.prototype.handleDeviceMotionChange=function(t){oe.document.dispatchEvent({alpha:t.alpha,gamma:t.gamma,beta:-t.beta,type:"deviceorientation"})},t.prototype.startWatch=function(t){var e=this;void 0===t&&(t="ui"),ne.platform.startDeviceMotionListening({interval:t,success:function(){ne.platform.onDeviceMotionChange(e.handleDeviceMotionChange)}})},t.prototype.stopWatch=function(){ne.platform.offDeviceMotionChange(this.handleDeviceMotionChange)},t}();ie.Accelerometer=se;var ae={},ue=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ae,"__esModule",{value:!0}),ae.btoa=ae.atob=void 0;var ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",he=function(t){function e(e){var r=t.call(this,e)||this;return r.message=e,r.name="InvalidCharacterError",r}return ue(e,t),e}(Error);ae.atob=function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new he("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",i=0,n=void 0,o=void 0,s=0;o=e.charAt(s++);~o&&(n=i%4?64*n+o:o,i++%4)?r+=String.fromCharCode(255&n>>(-2*i&6)):0)o=ce.indexOf(o);return r},ae.btoa=function(t){for(var e,r,i,n,o="",s=0,a=(t=String(t)).length%3;s<t.length;){if((r=t.charCodeAt(s++))>255||(i=t.charCodeAt(s++))>255||(n=t.charCodeAt(s++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");o+=ce.charAt((e=r<<16|i<<8|n)>>18&63)+ce.charAt(e>>12&63)+ce.charAt(e>>6&63)+ce.charAt(63&e)}return a?o.slice(0,a-3)+"===".substring(a):o};var le={};Object.defineProperty(le,"__esModule",{value:!0}),le.Blob=void 0;var fe=function(){function t(t,e){void 0===e&&(e="image/png"),this.buffers=t,this.type=e}return t.prototype.arraybuffer=function(){return Promise.resolve(this.buffers[0])},t.prototype.stream=function(){throw"not implemented"},t.prototype.text=function(){throw"not implemented"},t.prototype.slice=function(t,e,r){throw"not implemented"},t}();le.Blob=fe;var pe={};Object.defineProperty(pe,"__esModule",{value:!0}),pe.devicePixelRatio=void 0;var de=i;pe.devicePixelRatio=de.platform.getSystemInfoSync().pixelRatio;var me={};Object.defineProperty(me,"__esModule",{value:!0}),me.ImageData=void 0;var ve=function(){function t(){var t=arguments.length;if(2==t){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this.w=arguments[0],this.h=arguments[1],void(this.d=new Uint8ClampedArray(this.w*this.h*4))}else 3==t&&"object"==typeof arguments[0]&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this.d=arguments[0],this.w=arguments[1],this.h=arguments[2]);throw new Error("ImageData: params error")}return Object.defineProperty(t.prototype,"width",{get:function(){return this.w},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this.d},enumerable:!1,configurable:!0}),t}();me.ImageData=ve;var ye={};Object.defineProperty(ye,"__esModule",{value:!0}),ye.location=void 0,ye.location={href:""};var ge={};Object.defineProperty(ge,"__esModule",{value:!0}),ge.navigator=void 0;var _e=i.platform.getSystemInfoSync(),Ee=_e.platform,xe=_e.language,Te=Ee.toLowerCase().includes("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",be="Mozilla/5.0 (".concat(Te,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(xe);ge.navigator={platform:Ee,language:xe,appVersion:"5.0 (".concat(Te,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:be};var Ae={};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae._OffscreenCanvas=void 0;var Re=i,Se=ot,Ce=function(t,e){var r;return void 0===t&&(t=0),void 0===e&&(e=0),(0,Se.isMiniGame)()?((r=Re.platform.createCanvas()).width=t,r.height=e):r=Re.platform.createOffscreenCanvas({width:t,height:e}),r};Ae._OffscreenCanvas=Ce;var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.performance=void 0;var Me=function(){function t(){}return t.now=function(){return Date.now()},t.clearMarks=function(){},t.clearMeasures=function(){},t.clearResourceTimings=function(){},t.getEntries=function(){},t.getEntriesByName=function(){},t.getEntriesByType=function(){},t.mark=function(){},t.measure=function(){},t.setResourceTimingBufferSize=function(){},t.toJSON=function(){},t.eventCounts=0,t.timeOrigin=0,t}();Oe.performance=Me;var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.cancelAnimationFrame=Pe.requestAnimationFrame=void 0;var Ie=ot,we=0;Pe.requestAnimationFrame=function(t){var e=(0,Ie.getCanvas)();return e.requestAnimationFrame?e.requestAnimationFrame(t):function(t){var e=Date.now(),r=Math.max(we+23,e);return setTimeout((function(){t(we=r)}),r-e)}(t)},Pe.cancelAnimationFrame=function(t){var e=(0,Ie.getCanvas)();return e.cancelAnimationFrame?e.cancelAnimationFrame(t):clearTimeout(t)};var Le={};Object.defineProperty(Le,"__esModule",{value:!0}),Le.TextDecoder=void 0;var Fe=function(){function t(){}return t.prototype.decode=function(t){for(var e=t instanceof ArrayBuffer?new Uint8Array(t):t,r="",i=0,n=e.length;i<n;i++)r+=String.fromCharCode(e[i]);try{return decodeURIComponent(encodeURIComponent(r))}catch(t){return r}},t}();Le.TextDecoder=Fe;var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.URL=void 0;var De=ae,Ve=function(){function t(t,e){void 0===e&&(e=""),0!=t.indexOf("http://")&&0!=t.indexOf("https://")?(e=e.substring(0,e.lastIndexOf("/")+1),t=t.startsWith("./")?t.substring(2):t,this.href=e+t):this.href=t}return t.createObjectURL=function(t){var e=t.buffers[0],r="object"==typeof t.type?t.type.type:t.type,i=function(t){for(var e="",r=new Uint8Array(t),i=r.byteLength,n=0;n<i;n++)e+=String.fromCharCode(r[n]);return(0,De.btoa)(e)}(e);return"data:".concat(r,";base64,")+i},t.revokeObjectURL=function(){},t}();Ne.URL=Ve;var Ue={},Be={};Object.defineProperty(Be,"__esModule",{value:!0}),Be.isInstanceOf=void 0;var ke="web"===("undefined"!=typeof my?my.renderTarget:void 0)&&"function"!=typeof getApp;Be.isInstanceOf=function(t,e){var r=t instanceof e;return!(!ke||!function(t){if("function"==typeof t&&"string"==typeof t.name){var e=void 0;switch(t.name){case"Object":e=Object;break;case"Array":e=Array;break;case"String":e=String;break;case"Number":e=Number;break;case"Date":e=Date;break;case"Function":e=Function;break;case"Boolean":e=Boolean;break;case"ArrayBuffer":e="undefined"!=typeof ArrayBuffer?ArrayBuffer:void 0;break;case"Promise":e="undefined"!=typeof Promise?Promise:void 0}return e===t}return!1}(e)||Object.prototype.toString.call(t)!=="[object "+e.name+"]")||r};var ze=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.XMLHttpRequest=void 0;var Ge=Be,Xe=i,He=C,je=new WeakMap,Ye=new WeakMap,We=new WeakMap,Ze={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function qe(t,e){void 0===e&&(e={}),e.target=e.target||this,"function"==typeof this["on".concat(t)]&&this["on".concat(t)].call(this,e)}function Ke(t,e){void 0===e&&(e={}),this.readyState=t,e.readyState=t,qe.call(this,"readystatechange",e)}var Qe=function(t){function e(){var e=t.call(this)||this;return e.runtime=Xe.platform.getSystemInfoSync().platform,e.onabort=null,e.onerror=null,e.onload=null,e.onloadstart=null,e.onprogress=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null,e.readyState=0,e.response=null,e.responseText=null,e.responseType="text",e.dataType="string",e.responseXML=null,e.status=0,e.statusText="",e.upload={},e.withCredentials=!1,je.set(e,{"content-type":"application/x-www-form-urlencoded"}),Ye.set(e,{}),e}return ze(e,t),e.prototype.abort=function(){var t=We.get(this);t&&t.abort()},e.prototype.getAllResponseHeaders=function(){var t=Ye.get(this);return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")},e.prototype.getResponseHeader=function(t){return Ye.get(this)[t]},e.prototype.open=function(t,r){this._method=t,this._url=r,Ke.call(this,e.OPENED)},e.prototype.overrideMimeType=function(){},e.prototype.send=function(t){var r=this;if(void 0===t&&(t=""),this.readyState!==e.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");var i=this._url,n=je.get(this),o=this.responseType,s=this.dataType;Ze[o]&&!n["content-type"]&&(n["content-type"]=Ze[o]);var a=function(t){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(t)}(i),u=void 0;"arraybuffer"===o?s="arrayBuffer":u="utf8","json"===o&&(s="json",o="text"),delete this.response,this.response=null;var c=!1,h=function(t){var i=t.data,n=t.statusCode,o=t.header;if(!c){if(c=!0,n=void 0===n?200:n,"string"!=typeof i&&!(0,Ge.isInstanceOf)(i,ArrayBuffer)&&"json"!==s)try{i=JSON.stringify(i)}catch(t){}r.status=n,o&&Ye.set(r,o),qe.call(r,"loadstart"),Ke.call(r,e.HEADERS_RECEIVED),Ke.call(r,e.LOADING),r.response=i,(0,Ge.isInstanceOf)(i,ArrayBuffer)?Object.defineProperty(r,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):r.responseText=i,Ke.call(r,e.DONE),qe.call(r,"load"),qe.call(r,"loadend")}},l=function(t){var e=t.message||t.errorMessage;c||(c=!0,-1!==e.indexOf("abort")?qe.call(r,"abort"):qe.call(r,"error",{message:e}),qe.call(r,"loadend"),a&&console.warn(e))};if(a){var f=Xe.platform.getFileSystemManager(),p={filePath:i,success:h,fail:l};return u&&(p.encoding=u),void f.readFile(p)}var d="arraybuffer"===o&&"ios"===this.runtime&&e.useFetchPatch;Xe.platform.request({data:t,url:i,method:this._method.toUpperCase(),header:n,dataType:s,responseType:o,enableCache:!1,success:h,fail:l}),d&&setTimeout((function(){Xe.platform.request({data:t,url:i,method:this._method,header:n,dataType:s,responseType:o,enableCache:!0,success:h,fail:l})}),e.fetchPatchDelay)},e.prototype.setRequestHeader=function(t,e){var r=je.get(this);r[t]=e,je.set(this,r)},e.prototype.addEventListener=function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(t){void 0===t&&(t={}),t.target=t.target||r,e.call(r,t)})},e.prototype.removeEventListener=function(t,e){this["on"+t]===e&&(this["on"+t]=null)},e}(He.EventTarget);Ue.XMLHttpRequest=Qe,Qe.UNSEND=0,Qe.OPENED=1,Qe.HEADERS_RECEIVED=2,Qe.LOADING=3,Qe.DONE=4,Qe.useFetchPatch=!1,Qe.fetchPatchDelay=200;var Je={};Object.defineProperty(Je,"__esModule",{value:!0}),Je.WebGLRenderingContext=void 0,Je.WebGLRenderingContext={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444};var $e={};Object.defineProperty($e,"__esModule",{value:!0}),$e.WebGL2RenderingContext=void 0,$e.WebGL2RenderingContext={};var tr={},er=function(t){null==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,t.constructor==Array?this.init_by_array(t,t.length):this.init_seed(t)};er.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},er.prototype.init_by_array=function(t,e){var r,i,n;for(this.init_seed(19650218),r=1,i=0,n=this.N>e?this.N:e;n;n--){var o=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1664525*((4294901760&o)>>>16)<<16)+1664525*(65535&o))+t[i]+i,this.mt[r]>>>=0,i++,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1),i>=e&&(i=0)}for(n=this.N-1;n;n--){o=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1566083941*((4294901760&o)>>>16)<<16)+1566083941*(65535&o))-r,this.mt[r]>>>=0,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1)}this.mt[0]=2147483648},er.prototype.random_int=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_seed(5489),r=0;r<this.N-this.M;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^t>>>1^e[1&t];for(;r<this.N-1;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},er.prototype.random_int31=function(){return this.random_int()>>>1},er.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},er.prototype.random=function(){return this.random_int()*(1/4294967296)},er.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},er.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var rr=new er(Math.random()*Number.MAX_SAFE_INTEGER),ir=function(t){var e=t.length;for(;e--;)t[e]=Math.floor(256*rr.random());return t};var nr=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(tr,"__esModule",{value:!0}),tr.crypto=void 0;var or=nr(ir);tr.crypto={getRandomValues:or.default},function(t){var e=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),r=this&&this.__exportStar||function(t,r){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(r,i)||e(r,t,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(s,t),r(i,t),r(ie,t),r(ae,t),r(le,t),r(c,t),r(J,t),r(pe,t),r(u,t),r(R,t),r(Tt,t),r(C,t),r(h,t),r(Y,t),r(j,t),r(Q,t),r(me,t),r(ye,t),r(ge,t),r(Ae,t),r(Oe,t),r(ot,t),r(S,t),r(Pe,t),r(f,t),r(Le,t),r(Ne,t),r(Ue,t),r(Je,t),r($e,t),r(tr,t)}(o),function(t){var e=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),r=this&&this.__exportStar||function(t,r){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(r,i)||e(r,t,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.window=void 0;var i=o;t.window={innerWidth:i.screen.availWidth,innerHeight:i.screen.availHeight,setTimeout:setTimeout,clearTimeout:clearTimeout,atob:i.atob,btoa:i.btoa,devicePixelRatio:i.devicePixelRatio,document:i.document,navigator:i.navigator,location:i.location,screen:i.screen,Blob:i.Blob,Event:i.Event,EventTarget:i.EventTarget,Node:i.Node,Element:i.Element,HTMLElement:i.HTMLElement,HTMLCanvasElement:i.HTMLCanvasElement,HTMLImageElement:i.HTMLImageElement,HTMLMediaElement:i.HTMLMediaElement,HTMLAudioElement:i.HTMLAudioElement,HTMLVideoElement:i.HTMLVideoElement,Image:i.Image,ImageData:i.ImageData,requestAnimationFrame:i.requestAnimationFrame,cancelAnimationFrame:i.cancelAnimationFrame,XMLHttpRequest:i.XMLHttpRequest,performance:i.performance,URL:i.URL,WebGLRenderingContext:i.WebGLRenderingContext,WebGL2RenderingContext:i.WebGL2RenderingContext,TextDecoder:i.TextDecoder,addEventListener:function(t,e,r){void 0===r&&(r={}),i.document.addEventListener(t,e,r)},removeEventListener:function(t,e){i.document.removeEventListener(t,e)},dispatchEvent:function(t){i.document.dispatchEvent(t)}},r(o,t)}(r);var sr,ar=t({__proto__:null,default:e(r)},[r]);function ur(t,e,r,i,n,o,s){try{var a=t[o](s),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(i,n)}function cr(t){return function(){var e=this,r=arguments;return new Promise((function(i,n){var o=t.apply(e,r);function s(t){ur(o,i,n,s,a,"next",t)}function a(t){ur(o,i,n,s,a,"throw",t)}s(void 0)}))}}function hr(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):hr(t,e)}function lr(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function fr(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,r,s):n(e,r))||s);return o>3&&s&&Object.defineProperty(e,r,s),s}function pr(t,e){var r,i,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}"function"==typeof SuppressedError&&SuppressedError;var dr=new Uint8Array(16);function mr(){if(!sr&&!(sr=void 0!==r.crypto&&r.crypto.getRandomValues&&r.crypto.getRandomValues.bind(r.crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return sr(dr)}for(var vr=[],yr=0;yr<256;++yr)vr.push((yr+256).toString(16).slice(1));var gr,_r={randomUUID:void 0!==r.crypto&&r.crypto.randomUUID&&r.crypto.randomUUID.bind(r.crypto)};function Er(t,e,r){if(_r.randomUUID&&!e&&!t)return _r.randomUUID();var i=(t=t||{}).random||(t.rng||mr)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){r=r||0;for(var n=0;n<16;++n)e[r+n]=i[n];return e}return function(t,e){return void 0===e&&(e=0),vr[t[e+0]]+vr[t[e+1]]+vr[t[e+2]]+vr[t[e+3]]+"-"+vr[t[e+4]]+vr[t[e+5]]+"-"+vr[t[e+6]]+vr[t[e+7]]+"-"+vr[t[e+8]]+vr[t[e+9]]+"-"+vr[t[e+10]]+vr[t[e+11]]+vr[t[e+12]]+vr[t[e+13]]+vr[t[e+14]]+vr[t[e+15]]}(i)}function xr(t,e){return t.includes(e)||t.push(e),t}function Tr(t,e){var r=t.indexOf(e);return r>-1&&t.splice(r,1),t}function br(t,e,r,i){if(void 0===i&&(i=1),t.buffer.byteLength<t.BYTES_PER_ELEMENT*e){var n=Math.ceil(e*i);Number.isNaN(r)||(n=Math.min(n,r));var o=new ArrayBuffer(t.BYTES_PER_ELEMENT*n),s=new t.constructor(o);return s.set(t),s}return t}function Ar(t,e){var r=[0,0,0,0];if(Zr(t)){t=t.replace(/[\s\t\r\n]/g,"");var i=/rgba?\(([.\d]+),([.\d]+),([.\d]+),?([.\d]+)?\)/.exec(t);if(i){var n=+i[4];r=[+i[1],+i[2],+i[3],isNaN(n)?255:255*n]}else/^#[a-f\d]{3}$/i.test(t)?r=[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),255]:(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))&&(r=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),255]||[0,0,0,255])}else hr(t,Array)&&(r=[t[0],t[1],t[2],isNaN(t[3])?255:t[3]]);if(e)for(var o=0;o<4;o++)r[o]/=255;return r}function Rr(t,e,r){if(t.length){for(var i,n=1;n<=t.length-1;n++){var o=t[n-1],s=t[n];if(o.stop<=e&&e<=s.stop){i=Cr(o.color,s.color,(e-o.stop)/(s.stop-o.stop));break}}return i||(i=t[t.length-1].color),r?i.map((function(t){return t/255})):i}return[0,0,0,0]}function Sr(t){var e=[];if(hr(t,Array)?t.forEach((function(t){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4];e.push({stop:Or(r),color:[i,n,o,s]})})):Object.keys(t).forEach((function(r){var i=Ar(t[r]);e.push({stop:Or(r),color:i})})),(e=e.sort((function(t,e){return t.stop-e.stop}))).length){0!==e[0].stop&&e.unshift({stop:0,color:e[0].color.slice()});var r=e[e.length-1];1!==r.stop&&e.push({stop:1,color:r.color.slice()})}return e}function Cr(t,e,r,i){var n=[],o=1-r;if(i)for(var s=0;s<4;s++)n[s]=t[s]*o+e[s]*r;else{for(var a=0;a<3;a++)n[a]=Math.round(Math.sqrt(t[a]*t[a]*o+e[a]*e[a]*r));n[3]=Math.round(t[3]*o+e[3]*r)}return n}function Or(t){var e=/^(-)?([\d+.]+)%$/.exec(t);return e?+e[2]/100*(e[1]?-1:1):+t}function Mr(){if("object"==typeof r.screen&&"object"==typeof r.document){var t=Math.max(r.document.documentElement.clientWidth,r.window.innerWidth||0),e=r.screen.width/t;return Math.min(2*e,2)}return 1}function Pr(){return!!r.navigator.platform&&/iPad|iPhone|iPod/.test(r.navigator.platform)}function Ir(){return/\b[Aa]ndroid\b/.test(r.navigator.userAgent)}function wr(){return Ir()||/\b(iPad|iPhone|iPod)\b/.test(r.navigator.userAgent)}function Lr(){var t;return"undefined"!=typeof my&&"web"===(null==(t=my)?void 0:t.renderTarget)}function Fr(){return"miniprogram"===r.window.__wxjs_environment}function Nr(t){Zr(t)&&(t=Ar(t));for(var e=t,r={width:1,height:1,data:new Uint8Array(4)},i=r.data,n=0;n<4;n++)i[n]=e[n];return r}function Dr(t){var e=128,r={width:e,height:1,data:new Uint8Array(512)},i=r.data,n=Sr(t);if(n.length){i.set(n[0].color,0);for(var o=1;o<127;o++){for(var s=o/e,a=void 0,u=void 0,c=0;c<n.length&&(a=n[c],u=n[c+1],!(a.stop<=s&&u.stop>s));c++);var h=Cr(a.color,u.color,(s-a.stop)/(u.stop-a.stop));i.set(h,4*o)}i.set(n[n.length-1].color,508)}return r}function Vr(t,e){void 0===e&&(e=2);var r=t.length;if(r<=1||1===e)return t;if(r<=30){for(var i=1;i<r;i++)Br(t,i,e);return t}return kr(t,e)}function Ur(t,e,r){return void 0===r&&(r=2),t.includes(e)?t:(t.push(e),1===t.length||1!==r&&Br(t,t.length-1,r),t)}function Br(t,e,r){var i=t[e];if(2!==r)for(;e>=1&&t[e-1].priority<i.priority&&(t[e]=t[e-1],0!=--e););else for(;e>=1&&t[e-1].priority>i.priority&&(t[e]=t[e-1],0!=--e););t[e]=i}function kr(t,e,r,i){if(void 0===r&&(r=0),void 0===i&&(i=t.length-1),r>=i)return t;for(var n,o=t[r],s=r,a=i;s<a;){if(2===e){for(;t[a].priority>o.priority&&a>=s;)a--;for(;t[s].priority<=o.priority&&s<a;)s++}else{for(;t[a].priority<o.priority&&a>=s;)a--;for(;t[s].priority>=o.priority&&s<a;)s++}var u;u=[t[a],t[s]],t[s]=u[0],t[a]=u[1]}return n=[t[s],t[r]],t[r]=n[0],t[s]=n[1],kr(t,e,r,s-1),kr(t,e,a+1,i),t}function zr(t,e){if(void 0===e&&(e="item doesn't exist"),null==t)throw new Error(e)}function Gr(t){return/^[^\d.][\w-]*$/.test(t)}exports.OrderType=void 0,(gr=exports.OrderType||(exports.OrderType={}))[gr.none=1]="none",gr[gr.ascending=2]="ascending",gr[gr.descending=3]="descending";var Xr;function Hr(t){return["%c[Galacean Effects]","color: #AA0100",""+t]}var jr,Yr={error:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n;(n=console).error.apply(n,[].concat(Hr(t),[r])),null==Xr||Xr("error",t,r)},info:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n;(n=console).debug.apply(n,[].concat(Hr(t))),null==Xr||Xr("info",t,r)},warn:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n;(n=console).warn.apply(n,[].concat(Hr(t))),null==Xr||Xr("warn",t,r)},register:function(t){t&&Kr(t)&&(Xr=t)}};function Wr(){}function Zr(t){return"string"==typeof t}exports.DestroyOptions=void 0,(jr=exports.DestroyOptions||(exports.DestroyOptions={}))[jr.destroy=0]="destroy",jr[jr.keep=1]="keep",jr[jr.force=0]="force";var qr=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function Kr(t){return"[object Function]"===Object.prototype.toString.call(t)}function Qr(t){return"[object Object]"===Object.prototype.toString.call(t)}function Jr(t){var e;return"object"==typeof t&&null!==t&&"CANVAS"===(null==(e=t.tagName)?void 0:e.toUpperCase())}function $r(t,e){return t+Math.random()*(e-t)}function ti(){throw new Error("Destroyed item cannot be used again.")}function ei(){return Er().replace(/-/g,"")}function ri(t,e,i){void 0===e&&(e="base64File"),void 0===i&&(i="");for(var n=t.split(",")[1]||t,o=r.atob(n),s=[],a=0;a<o.length;a+=512){for(var u=o.slice(a,a+512),c=new Array(u.length),h=0;h<u.length;h++)c[h]=u.charCodeAt(h);var l=new Uint8Array(c);s.push(l)}var f=new r.Blob(s,{type:i});return new File([f],e,{type:i})}function ii(t,e){e.forEach((function(e){Object.getOwnPropertyNames(e.prototype).forEach((function(r){var i=Object.getOwnPropertyDescriptor(e.prototype,r);if(!i)throw new Error("Cannot find property descriptor of class "+e);Object.defineProperty(t.prototype,r,i)}))}))}var ni={},oi=[],si={};function ai(t,e,r,i){si[t]&&Yr.error("Duplicate registration for plugin "+t+"."),si[t]=r,ni[t]=e,i&&xr(oi,t)}var ui=function(){function t(t){var e={},r=[],i=function(t){var i=ni[t];r.includes(i)||(r.push(i),e[t]=i)};oi.forEach(i),t.forEach(i),this.plugins=Object.keys(e).map((function(t){var e=ni[t];if(!e)throw new Error("The plugin '"+t+"' not found."+function(t){var e=ci[t];return e?"\n请按如下命令进行操作（Please follow the commands below to proceed）：\n1、使用 npm 安装插件（Install Plugin）：npm i "+e+"@latest --save\n2、导入插件（Import Plugin）：import '"+e+"'":""}(t));var r=new e;return r.name=t,r})).sort((function(t,e){return t.order-e.order}))}var e=t.prototype;return e.initializeComposition=function(t,e){this.plugins.forEach((function(r){return r.onCompositionConstructed(t,e)}))},e.destroyComposition=function(t){this.plugins.forEach((function(e){return e.onCompositionDestroyed(t)}))},e.resetComposition=function(t,e){this.plugins.forEach((function(r){return r.onCompositionReset(t,e)}))},e.processRawJSON=function(t,e){var r=this;return cr((function(){return pr(this,(function(i){return[2,r.callStatic("processRawJSON",t,e)]}))}))()},e.processAssets=function(t,e){var r=this;return cr((function(){return pr(this,(function(i){return[2,r.callStatic("processAssets",t,e)]}))}))()},e.precompile=function(t,e,r){var i=this;return cr((function(){return pr(this,(function(n){return[2,i.callStatic("precompile",t,e,r)]}))}))()},e.loadResources=function(t,e){var r=this;return cr((function(){return pr(this,(function(i){return[2,r.callStatic("prepareResource",t,e)]}))}))()},e.callStatic=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n=this;return cr((function(){var e,i,o,s,a,u,c;return pr(this,(function(h){for(e=[],i=n.plugins,o=0;o<i.length;o++)s=i[o],a=ni[s.name],t in a&&e.push(Promise.resolve(null==(c=a[t])?void 0:(u=c).call.apply(u,[].concat([a],r))));return[2,Promise.all(e)]}))}))()},t}(),ci={"alipay-downgrade":"@galacean/effects-plugin-alipay-downgrade",downgrade:"@galacean/effects-plugin-downgrade","editor-gizmo":"@galacean/effects-plugin-editor-gizmo",model:"@galacean/effects-plugin-model",video:"@galacean/effects-plugin-multimedia",audio:"@galacean/effects-plugin-multimedia","orientation-transformer":"@galacean/effects-plugin-orientation-transformer",richtext:"@galacean/effects-plugin-rich-text",spine:"@galacean/effects-plugin-spine"};var hi,li,fi,pi,di,mi,vi,yi,gi,_i,Ei,xi,Ti,bi=function(){function t(){this.order=100,this.name=""}var e=t.prototype;return e.onCompositionConstructed=function(t,e){},e.onCompositionItemLifeBegin=function(t,e){},e.onCompositionItemLifeEnd=function(t,e){},e.onCompositionItemRemoved=function(t,e){},e.onCompositionReset=function(t,e){},e.onCompositionWillReset=function(t,e){},e.onCompositionDestroyed=function(t){},e.onCompositionUpdate=function(t,e){},e.prepareRenderFrame=function(t,e){return!1},e.postProcessFrame=function(t,e){},t.precompile=function(t,e){return Promise.resolve()},t}();function Ai(t,e){return Ai=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ai(t,e)}function Ri(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ai(t,e)}!function(t){t.S="S",t.APlus="A+",t.A="A",t.BPlus="B+",t.B="B"}(hi||(hi={})),function(t){t[t.ALPHA=0]="ALPHA",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.BRIGHTNESS=3]="BRIGHTNESS",t[t.SUBTRACTION=4]="SUBTRACTION",t[t.STRONG_LIGHT=5]="STRONG_LIGHT",t[t.WEAK_LIGHT=6]="WEAK_LIGHT",t[t.SUPERPOSITION=7]="SUPERPOSITION"}(li||(li={})),function(t){t[t.DOUBLE=1032]="DOUBLE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK"}(fi||(fi={})),function(t){t[t.NONE=0]="NONE",t[t.MASK=1]="MASK",t[t.OBSCURED=2]="OBSCURED",t[t.REVERSE_OBSCURED=3]="REVERSE_OBSCURED"}(pi||(pi={})),function(t){t[t.NONE=0]="NONE",t[t.SPHERE=1]="SPHERE",t[t.CONE=2]="CONE",t[t.HEMISPHERE=3]="HEMISPHERE",t[t.CIRCLE=4]="CIRCLE",t[t.DONUT=5]="DONUT",t[t.RECTANGLE=6]="RECTANGLE",t[t.RECTANGLE_EDGE=7]="RECTANGLE_EDGE",t[t.EDGE=8]="EDGE",t[t.TEXTURE=9]="TEXTURE"}(di||(di={})),function(t){t[t.GYROSCOPE=0]="GYROSCOPE",t[t.SPINE=1]="SPINE"}(mi||(mi={})),function(t){t[t.CLICK=0]="CLICK",t[t.MESSAGE=1]="MESSAGE",t[t.DRAG=2]="DRAG"}(vi||(vi={})),function(t){t[t.NONE=0]="NONE",t[t.NOTIFY=1]="NOTIFY",t[t.RESUME_PLAYER=2]="RESUME_PLAYER",t[t.REMOVE=3]="REMOVE",t[t.PAUSE=4]="PAUSE"}(yi||(yi={})),function(t){t.base="0",t.sprite="1",t.particle="2",t.null="3",t.interact="4",t.plugin="5",t.camera="6",t.composition="7",t.spine="spine",t.mesh="mesh",t.tree="tree",t.text="text",t.light="light",t.skybox="skybox",t.effect="effect",t.shape="shape",t.postProcessVolume="postProcessVolume",t.node="node",t.video="video",t.audio="audio",t.richtext="richtext"}(gi||(gi={})),function(t){t[t.BILLBOARD=0]="BILLBOARD",t[t.MESH=1]="MESH",t[t.VERTICAL_BILLBOARD=2]="VERTICAL_BILLBOARD",t[t.HORIZONTAL_BILLBOARD=3]="HORIZONTAL_BILLBOARD"}(_i||(_i={})),function(t){t[t.PARTICLE_ORIGIN_CENTER=0]="PARTICLE_ORIGIN_CENTER",t[t.PARTICLE_ORIGIN_LEFT_TOP=1]="PARTICLE_ORIGIN_LEFT_TOP",t[t.PARTICLE_ORIGIN_LEFT_CENTER=2]="PARTICLE_ORIGIN_LEFT_CENTER",t[t.PARTICLE_ORIGIN_LEFT_BOTTOM=3]="PARTICLE_ORIGIN_LEFT_BOTTOM",t[t.PARTICLE_ORIGIN_CENTER_TOP=4]="PARTICLE_ORIGIN_CENTER_TOP",t[t.PARTICLE_ORIGIN_CENTER_BOTTOM=5]="PARTICLE_ORIGIN_CENTER_BOTTOM",t[t.PARTICLE_ORIGIN_RIGHT_TOP=6]="PARTICLE_ORIGIN_RIGHT_TOP",t[t.PARTICLE_ORIGIN_RIGHT_CENTER=7]="PARTICLE_ORIGIN_RIGHT_CENTER",t[t.PARTICLE_ORIGIN_RIGHT_BOTTOM=8]="PARTICLE_ORIGIN_RIGHT_BOTTOM"}(Ei||(Ei={})),function(t){t.Opaque="Opaque",t.Transparent="Transparent"}(xi||(xi={})),function(t){t.Both="Both",t.Back="Back",t.Front="Front"}(Ti||(Ti={}));var Si,Ci,Oi,Mi,Pi,Ii,wi,Li,Fi,Ni,Di,Vi,Ui,Bi,ki,zi,Gi,Xi;!function(t){t[t.portrait=1]="portrait",t[t.landscape=0]="landscape"}(Si||(Si={})),function(t){t[t.CONSTANT=0]="CONSTANT",t[t.CONSTANT_VEC2=1]="CONSTANT_VEC2",t[t.CONSTANT_VEC3=2]="CONSTANT_VEC3",t[t.CONSTANT_VEC4=3]="CONSTANT_VEC4",t[t.RANDOM=4]="RANDOM",t[t.LINE=5]="LINE",t[t.CURVE=6]="CURVE",t[t.BEZIER_PATH=7]="BEZIER_PATH",t[t.RGBA_COLOR=8]="RGBA_COLOR",t[t.GRADIENT_COLOR=9]="GRADIENT_COLOR",t[t.SHAPE_POINTS=10]="SHAPE_POINTS",t[t.SHAPE_SPLITS=11]="SHAPE_SPLITS",t[t.LINEAR_PATH=12]="LINEAR_PATH",t[t.COLORS=13]="COLORS",t[t.BINARY=20]="BINARY",t[t.BEZIER_CURVE=21]="BEZIER_CURVE",t[t.BEZIER_CURVE_PATH=22]="BEZIER_CURVE_PATH",t[t.BEZIER_CURVE_QUAT=23]="BEZIER_CURVE_QUAT",t[t.COLOR_CURVE=24]="COLOR_CURVE",t[t.VECTOR4_CURVE=25]="VECTOR4_CURVE"}(Ci||(Ci={})),function(t){t[t.AUTO=0]="AUTO",t[t.EASE=1]="EASE",t[t.EASE_IN=2]="EASE_IN",t[t.EASE_OUT=3]="EASE_OUT",t[t.LINE=4]="LINE",t[t.HOLD=5]="HOLD",t[t.LINE_OUT=6]="LINE_OUT"}(Oi||(Oi={})),function(t){t[t.destroy=0]="destroy",t[t.restart=5]="restart",t[t.forward=2]="forward",t[t.freeze=4]="freeze"}(Mi||(Mi={})),function(t){t[t.destroyChildren=6]="destroyChildren"}(Pi||(Pi={})),function(t){t[t.none=0]="none",t[t.removeParticle=1]="removeParticle"}(Ii||(Ii={})),function(t){t[t.RANDOM=0]="RANDOM",t[t.UNIDIRECTIONAL_CYCLE=1]="UNIDIRECTIONAL_CYCLE",t[t.BIDIRECTIONAL_CYCLE=2]="BIDIRECTIONAL_CYCLE",t[t.UNIFORM_BURST=3]="UNIFORM_BURST"}(wi||(wi={})),function(t){t.point="point",t.spot="spot",t.directional="directional",t.ambient="ambient"}(Li||(Li={})),function(t){t[t.box=2]="box",t[t.sphere=3]="sphere"}(Fi||(Fi={})),function(t){t.orthographic="orthographic",t.perspective="perspective"}(Ni||(Ni={})),function(t){t.unlit="unlit",t.pbr="pbr",t.hair="hair"}(Di||(Di={})),function(t){t[t.opaque=100]="opaque",t[t.masked=101]="masked",t[t.translucent=102]="translucent",t[t.additive=103]="additive"}(Vi||(Vi={})),function(t){t.none="none",t.uv="uv",t.normal="normal",t.basecolor="basecolor",t.alpha="alpha",t.metallic="metallic",t.roughness="roughness",t.ao="ao",t.emissive="emissive",t.diffuse="diffuse"}(Ui||(Ui={})),function(t){t[t.display=0]="display",t[t.clip=1]="clip",t[t.ellipsis=2]="ellipsis"}(Bi||(Bi={})),function(t){t[t.top=0]="top",t[t.middle=1]="middle",t[t.bottom=2]="bottom"}(ki||(ki={})),function(t){t[t.left=0]="left",t[t.middle=1]="middle",t[t.right=2]="right"}(zi||(zi={})),function(t){t.normal="normal",t.bold="bold",t.lighter="lighter"}(Gi||(Gi={})),function(t){t.normal="normal",t.italic="italic",t.oblique="oblique"}(Xi||(Xi={}));var Hi,ji,Yi,Wi,Zi,qi,Ki,Qi,Ji,$i,tn={WhiteTexture:"whitetexture00000000000000000000",TransparentTexture:"transparenttexture00000000000000000000",PBRShader:"pbr00000000000000000000000000000",UnlitShader:"unlit000000000000000000000000000"};!function(t){t[t.Custom=0]="Custom",t[t.Rectangle=1]="Rectangle",t[t.Ellipse=2]="Ellipse",t[t.Polygon=3]="Polygon",t[t.Star=4]="Star"}(Hi||(Hi={})),ji||(ji={}),Yi||(Yi={}),function(t){t.video="video",t.image="image"}(Wi||(Wi={})),function(t){t.video="video",t.audio="audio"}(Zi||(Zi={})),function(t){t.VFXItemData="VFXItemData",t.EffectComponent="EffectComponent",t.Material="Material",t.Shader="Shader",t.SpriteComponent="SpriteComponent",t.ParticleSystem="ParticleSystem",t.InteractComponent="InteractComponent",t.CameraController="CameraController",t.PostProcessVolume="PostProcessVolume",t.Geometry="Geometry",t.Texture="Texture",t.Image="Image",t.AnimationClip="AnimationClip",t.TextComponent="TextComponent",t.BinaryAsset="BinaryAsset",t.TrackAsset="TrackAsset",t.TimelineAsset="TimelineAsset",t.ObjectBindingTrack="ObjectBindingTrack",t.TransformTrack="TransformTrack",t.SpriteColorTrack="SpriteColorTrack",t.ActivationTrack="ActivationTrack",t.SubCompositionTrack="SubCompositionTrack",t.FloatPropertyTrack="FloatPropertyTrack",t.ColorPropertyTrack="ColorPropertyTrack",t.Vector4PropertyTrack="Vector4PropertyTrack",t.TransformPlayableAsset="TransformPlayableAsset",t.SpriteColorPlayableAsset="SpriteColorPlayableAsset",t.ActivationPlayableAsset="ActivationPlayableAsset",t.SubCompositionPlayableAsset="SubCompositionPlayableAsset",t.FloatPropertyPlayableAsset="FloatPropertyPlayableAsset",t.ColorPropertyPlayableAsset="ColorPropertyPlayableAsset",t.MeshComponent="MeshComponent",t.SkyboxComponent="SkyboxComponent",t.LightComponent="LightComponent",t.CameraComponent="CameraComponent",t.ModelPluginComponent="ModelPluginComponent",t.TreeComponent="TreeComponent",t.AnimationComponent="AnimationComponent",t.SpineComponent="SpineComponent",t.VideoComponent="VideoComponent",t.AudioComponent="AudioComponent",t.RichTextComponent="RichTextComponent",t.OrientationComponent="OrientationComponent",t.ShapeComponent="ShapeComponent",t.TimelineClip="TimelineClip"}(qi||(qi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ki||(Ki={})),function(t){t[t.Float16=0]="Float16",t[t.Float32=1]="Float32",t[t.Int8=2]="Int8",t[t.Int16=3]="Int16",t[t.Int32=4]="Int32",t[t.UInt8=5]="UInt8",t[t.UInt16=6]="UInt16",t[t.UInt32=7]="UInt32"}(Qi||(Qi={})),function(t){t[t.None=-1]="None",t[t.UInt8=0]="UInt8",t[t.UInt16=1]="UInt16",t[t.UInt32=2]="UInt32"}(Ji||(Ji={})),function(t){t.Position="POSITION",t.Uv="TEXCOORD0",t.Uv2="TEXCOORD1",t.Normal="NORMAL",t.Tangent="TANGENT",t.Color="COLOR",t.Joints="JOINTS",t.Weights="WEIGHTS",t.PositionBS0="POSITION_BS0",t.PositionBS1="POSITION_BS1",t.PositionBS2="POSITION_BS2",t.PositionBS3="POSITION_BS3",t.PositionBS4="POSITION_BS4",t.PositionBS5="POSITION_BS5",t.PositionBS6="POSITION_BS6",t.PositionBS7="POSITION_BS7",t.NormalBS0="NORMAL_BS0",t.NormalBS1="NORMAL_BS1",t.NormalBS2="NORMAL_BS2",t.NormalBS3="NORMAL_BS3",t.TangentBS0="TANGENT_BS0",t.TangentBS1="TANGENT_BS1",t.TangentBS2="TANGENT_BS2",t.TangentBS3="TANGENT_BS3"}($i||($i={}));var en=Object.freeze({__proto__:null,get RenderLevel(){return hi},get BlendingMode(){return li},get SideMode(){return fi},get MaskMode(){return pi},get ParticleEmitterShapeType(){return di},get PluginType(){return mi},get InteractType(){return vi},get InteractBehavior(){return yi},get ItemType(){return gi},get RenderMode(){return _i},get ParticleOrigin(){return Ei},get RenderType(){return xi},get RenderFace(){return Ti},get CameraClipMode(){return Si},END_BEHAVIOR_DESTROY:0,END_BEHAVIOR_PAUSE:1,END_BEHAVIOR_FORWARD:2,END_BEHAVIOR_PAUSE_AND_DESTROY:3,END_BEHAVIOR_FREEZE:4,END_BEHAVIOR_RESTART:5,END_BEHAVIOR_DESTROY_CHILDREN:6,CAMERA_CLIP_MODE_VERTICAL:1,CAMERA_CLIP_MODE_NORMAL:0,MESSAGE_ITEM_PHRASE_BEGIN:2,MESSAGE_ITEM_PHRASE_END:1,get ValueType(){return Ci},get BezierKeyframeType(){return Oi},get EndBehavior(){return Mi},get ParentItemEndBehavior(){return Pi},get ParticleInteractionBehavior(){return Ii},get ShapeArcMode(){return wi},get LightType(){return Li},get ModelBoundingType(){return Fi},get CameraType(){return Ni},get MaterialType(){return Di},get MaterialBlending(){return Vi},get RenderMode3D(){return Ui},get TextOverflow(){return Bi},get TextBaseline(){return ki},get TextAlignment(){return zi},get TextWeight(){return Gi},get FontStyle(){return Xi},BuiltinObjectGUID:tn,get ShapePrimitiveType(){return Hi},get ShapeConnectType(){return ji},get ShapePointType(){return Yi},get BackgroundType(){return Wi},get MultimediaType(){return Zi},get DataType(){return qi},get GeometryType(){return Ki},get VertexFormatType(){return Qi},get IndexFormatType(){return Ji},get VertexBufferSemantic(){return $i}});function rn(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nn(t,e,r){return e&&rn(t.prototype,e),r&&rn(t,r),t}var on=new Map,sn=new Map,an={};function un(t){return function(e,r){an[t]&&console.warn("Class "+t+" is already registered."),an[t]=e}}function cn(t,e){return function(t,e){return function(r,i){var n=function(t){var e=t.constructor;on.get(e)||on.set(e,{});return on.get(e)}(r);n&&(n[i]||(n[i]={type:t,sourceName:e}))}}(t,e)}function hn(t){var e=t.constructor;if(sn.get(e))return sn.get(e);var r={};sn.set(e,r);for(var i=t,n=e;n;){var o=on.get(n);for(var s in o)r[s]=o[s];var a=Object.getPrototypeOf(i);if((n=Object.getPrototypeOf(a).constructor)===Object)break;i=a}return r}var ln=function(){function t(t){this.engine=t,this.guid=ei(),this.taggedProperties={},this.engine.addInstance(this)}var e=t.prototype;return e.getInstanceId=function(){return this.guid},e.setInstanceId=function(t){this.engine.removeInstance(this.guid),this.guid=t,this.engine.addInstance(this)},e.toData=function(){},e.fromData=function(t){t.id&&this.setInstanceId(t.id)},e.dispose=function(){},t.is=function(e){return hr(e,t)&&"guid"in e},t}(),fn=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).isAwakeCalled=!1,e.isStartCalled=!1,e.isEnableCalled=!1,e._enabled=!0,e}Ri(e,t);var r=e.prototype;return r.onAwake=function(){},r.onEnable=function(){},r.onDisable=function(){},r.onStart=function(){},r.onUpdate=function(t){},r.onLateUpdate=function(t){},r.onDestroy=function(){},r.enable=function(){this.item.composition&&(this.item.composition.sceneTicking.addComponent(this),this.isEnableCalled=!0),this.onEnable()},r.disable=function(){this.onDisable(),this.item.composition&&(this.isEnableCalled=!1,this.item.composition.sceneTicking.removeComponent(this))},r.setVFXItem=function(t){this.item=t,t.isDuringPlay&&(this.isAwakeCalled||(this.onAwake(),this.isAwakeCalled=!0),t.isActive&&this.enabled&&(this.start(),this.enable()))},r.fromData=function(e){t.prototype.fromData.call(this,e),e.item&&(this.item=e.item)},r.dispose=function(){this.isEnableCalled&&this.disable(),this.isAwakeCalled&&(this.isAwakeCalled=!1,this.onDestroy()),this.item&&Tr(this.item.components,this)},r.start=function(){this.isStartCalled||(this.isStartCalled=!0,this.onStart())},nn(e,[{key:"transform",get:function(){return this.item.transform}},{key:"isActiveAndEnabled",get:function(){return this.item.isActive&&this.enabled}},{key:"enabled",get:function(){return this._enabled},set:function(t){this.enabled!==t&&(this._enabled=t,t?this.isActiveAndEnabled&&(this.enable(),this.isStartCalled||(this.onStart(),this.isStartCalled=!0)):this.isEnableCalled&&this.disable())}}]),e}(ln);fr([cn()],fn.prototype,"_enabled",void 0);var pn=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.setVFXItem=function(e){t.prototype.setVFXItem.call(this,e)},r.dispose=function(){t.prototype.dispose.call(this)},e}(fn),dn=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).materials=[],e._priority=0,e}Ri(e,t);var r=e.prototype;return r.render=function(t){},r.setVFXItem=function(e){t.prototype.setVFXItem.call(this,e),this.item.rendererComponents.push(this)},r.onEnable=function(){var t;null==(t=this.item.composition)||t.renderFrame.addMeshToDefaultRenderPass(this)},r.onDisable=function(){var t;null==(t=this.item.composition)||t.renderFrame.removeMeshFromDefaultRenderPass(this)},r.fromData=function(e){t.prototype.fromData.call(this,e)},r.toData=function(){t.prototype.toData.call(this)},r.dispose=function(){this.item&&Tr(this.item.rendererComponents,this),t.prototype.dispose.call(this)},nn(e,[{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"material",get:function(){return this.materials[0]},set:function(t){0===this.materials.length?this.materials.push(t):this.materials[0]=t}}]),e}(fn);fr([cn()],dn.prototype,"materials",void 0),fr([cn()],dn.prototype,"_priority",void 0);var mn=2*Math.PI,vn=Math.PI/180,yn=180/Math.PI,gn=1e-6;function _n(t,e){return Math.abs(t-e)<gn||t===1/0&&e===1/0||t===-1/0&&e===-1/0}var En=function(t,e,r){return(1-r)*t+r*e};function xn(t,e,r){var i=isNaN(e)?-1/0:e,n=isNaN(r)?1/0:r,o=Math.min(i,n),s=Math.max(i,n);return Math.min(Math.max(t,o),s)}var Tn=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.setZero=function(){return this.x=0,this.y=0,this},e.setFromNumber=function(t){return this.x=t,this.y=t,this},e.setFromArray=function(t,e){var r,i;return void 0===e&&(e=0),this.x=null!=(r=t[e])?r:0,this.y=null!=(i=t[e+1])?i:0,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},e.clone=function(){return new t(this.x,this.y)},e.setElement=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:console.error("index is out of range: "+t)}return this},e.getElement=function(t){switch(t){case 0:return this.x;case 1:return this.y;default:console.error("index is out of range: "+t)}return 0},e.add=function(t){return"number"==typeof t?(this.x+=t,this.y+=t):hr(t,Array)?(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},e.subtract=function(t){return"number"==typeof t?(this.x-=t,this.y-=t):hr(t,Array)?(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},e.subtractVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},e.multiply=function(t){return"number"==typeof t?(this.x*=t,this.y*=t):hr(t,Array)?(this.x*=t[0],this.y*=t[1]):(this.x*=t.x,this.y*=t.y),this},e.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this},e.divide=function(t){return"number"==typeof t?(this.x/=t,this.y/=t):hr(t,Array)?(this.x/=t[0],this.y/=t[1]):(this.x/=t.x,this.y/=t.y),this},e.scale=function(t){return this.x*=t,this.y*=t,this},e.sum=function(){return this.x+this.y},e.min=function(t){return"number"==typeof t?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y)),this},e.max=function(t){return"number"==typeof t?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y)),this},e.clamp=function(t,e){return this.max(t).min(e)},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.normalize=function(){return this.divide(this.length()||1)},e.setLength=function(t){return this.normalize().multiply(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},e.lerpVectors=function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this},e.dot=function(t){return this.x*t.x+this.y*t.y},e.cross=function(t){return this.x*t.y-this.y*t.x},e.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)},e.distanceSquared=function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},e.equals=function(t){return this.x===t.x&&this.y===t.y},e.isZero=function(){var t=gn,e=this.x,r=this.y;return Math.abs(e)<=t&&Math.abs(r)<=t},e.toArray=function(){return[this.x,this.y]},e.fill=function(t,e){void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this},t.fromNumber=function(e){return(new t).setFromNumber(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t}();Tn.ONE=new Tn(1,1),Tn.ZERO=new Tn(0,0);var bn=function(){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.x=t,this.y=e,this.z=r}var e=t.prototype;return e.set=function(t,e,r){return this.x=t,this.y=e,this.z=r,this},e.setZero=function(){return this.x=0,this.y=0,this.z=0,this},e.setFromNumber=function(t){return this.x=t,this.y=t,this.z=t,this},e.setFromArray=function(t,e){var r,i,n;return void 0===e&&(e=0),this.x=null!=(r=t[e])?r:0,this.y=null!=(i=t[e+1])?i:0,this.z=null!=(n=t[e+2])?n:0,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.clone=function(){return new t(this.x,this.y,this.z)},e.setElement=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:console.error("index is out of range: "+t)}return this},e.getElement=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:console.error("index is out of range: "+t)}return 0},e.add=function(t){return"number"==typeof t?(this.x+=t,this.y+=t,this.z+=t):hr(t,Array)?(this.x+=t[0],this.y+=t[1],this.z+=t[2]):(this.x+=t.x,this.y+=t.y,this.z+=t.z),this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},e.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},e.subtract=function(t){return"number"==typeof t?(this.x-=t,this.y-=t,this.z-=t):hr(t,Array)?(this.x-=t[0],this.y-=t[1],this.z-=t[2]):(this.x-=t.x,this.y-=t.y,this.z-=t.z),this},e.subtractVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},e.multiply=function(t){return"number"==typeof t?(this.x*=t,this.y*=t,this.z*=t):hr(t,Array)?(this.x*=t[0],this.y*=t[1],this.z*=t[2]):(this.x*=t.x,this.y*=t.y,this.z*=t.z),this},e.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},e.divide=function(t){return"number"==typeof t?(this.x/=t,this.y/=t,this.z/=t):hr(t,Array)?(this.x/=t[0],this.y/=t[1],this.z/=t[2]):(this.x/=t.x,this.y/=t.y,this.z/=t.z),this},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.sum=function(){return this.x+this.y+this.z},e.min=function(t){return"number"==typeof t?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t),this.z=Math.min(this.z,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z)),this},e.max=function(t){return"number"==typeof t?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),this.z=Math.max(this.z,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z)),this},e.clamp=function(t,e){return this.max(t).min(e)},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},e.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.normalize=function(){return this.divide(this.length()||1)},e.setLength=function(t){return this.normalize().multiply(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},e.lerpVectors=function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.cross=function(t){return this.crossVectors(this,t)},e.crossVectors=function(t,e){var r=t.x,i=t.y,n=t.z,o=e.x,s=e.y,a=e.z;return this.x=i*a-n*s,this.y=n*o-r*a,this.z=r*s-i*o,this},e.reflect=function(t){return this.subtract(t.clone().multiply(2*this.dot(t)))},e.distance=function(t){return Math.sqrt(this.distanceSquared(t))},e.distanceSquared=function(t){var e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},e.isZero=function(){var t=gn,e=this,r=e.x,i=e.y,n=e.z;return Math.abs(r)<=t&&Math.abs(i)<=t&&Math.abs(n)<=t},e.toArray=function(){return[this.x,this.y,this.z]},e.toVector2=function(){return new Tn(this.x,this.y)},e.fill=function(t,e){void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this},e.applyEuler=function(t,e){return t.rotateVector3(this,e)},e.applyQuaternion=function(t,e){return t.rotateVector3(this,e)},e.applyMatrix=function(t,e){return t.transformPoint(this,e)},e.applyNormalMatrix=function(t,e){return t.transformNormal(this,e)},e.applyProjectionMatrix=function(t,e){return t.projectPoint(this,e)},t.fromNumber=function(e){return(new t).setFromNumber(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t}();bn.X=new bn(1,0,0),bn.Y=new bn(0,1,0),bn.Z=new bn(0,0,1),bn.ONE=new bn(1,1,1),bn.ZERO=new bn(0,0,0);var An=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=r,this.w=i}var e=t.prototype;return e.set=function(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this},e.setZero=function(){return this.x=0,this.y=0,this.z=0,this.w=0,this},e.setFromNumber=function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},e.setFromArray=function(t,e){var r,i,n,o;return void 0===e&&(e=0),this.x=null!=(r=t[e])?r:0,this.y=null!=(i=t[e+1])?i:0,this.z=null!=(n=t[e+2])?n:0,this.w=null!=(o=t[e+3])?o:0,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.clone=function(){return new t(this.x,this.y,this.z,this.w)},e.setElement=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:console.error("index is out of range: "+t)}return this},e.getElement=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:console.error("index is out of range: "+t)}return 0},e.add=function(t){return"number"==typeof t?(this.x+=t,this.y+=t,this.z+=t,this.w+=t):hr(t,Array)?(this.x+=t[0],this.y+=t[1],this.z+=t[2],this.w+=t[3]):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w),this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},e.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},e.subtract=function(t){return"number"==typeof t?(this.x-=t,this.y-=t,this.z-=t,this.w-=t):hr(t,Array)?(this.x-=t[0],this.y-=t[1],this.z-=t[2],this.w-=t[3]):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w),this},e.subtractVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},e.multiply=function(t){return"number"==typeof t?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):hr(t,Array)?(this.x*=t[0],this.y*=t[1],this.z*=t[2],this.w*=t[3]):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w),this},e.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this},e.divide=function(t){return"number"==typeof t?(this.x/=t,this.y/=t,this.z/=t,this.w/=t):hr(t,Array)?(this.x/=t[0],this.y/=t[1],this.z/=t[2],this.w/=t[3]):(this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w),this},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.sum=function(){return this.x+this.y+this.z+this.w},e.min=function(t){return"number"==typeof t?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t),this.z=Math.min(this.z,t),this.w=Math.min(this.w,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w)),this},e.max=function(t){return"number"==typeof t?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),this.z=Math.max(this.z,t),this.w=Math.max(this.w,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w)),this},e.clamp=function(t,e){return this.max(t).min(e)},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},e.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.normalize=function(){return this.divide(this.length()||1)},e.setLength=function(t){return this.normalize().multiply(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},e.lerpVectors=function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this.w=t.w+(e.w-t.w)*r,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},e.isZero=function(){var t=gn,e=this,r=e.x,i=e.y,n=e.z,o=e.w;return Math.abs(r)<=t&&Math.abs(i)<=t&&Math.abs(n)<=t&&Math.abs(o)<=t},e.toArray=function(){return[this.x,this.y,this.z,this.w]},e.toVector3=function(){return new bn(this.x,this.y,this.z)},e.fill=function(t,e){void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},e.applyMatrix=function(t,e){return t.transformVector4(this,e)},t.fromNumber=function(e){return(new t).setFromNumber(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t}();An.ONE=new An(1,1,1,1),An.ZERO=new An(0,0,0,0);var Rn=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).meshCollider=new Au,e.getHitTestParams=function(t){var r=e.transform.getWorldMatrix();e.meshCollider.setGeometry(e.geometry,r);var i=e.meshCollider.getBoundingBoxData();if(i)return{type:i.type,triangles:i.area}},e}Ri(e,t);var r=e.prototype;return r.render=function(t){t.renderingData.currentFrame.globalUniforms&&t.setGlobalMatrix("effects_ObjectToWorld",this.transform.getWorldMatrix()),t.drawGeometry(this.geometry,this.material)},r.getBoundingBox=function(){var t=this.transform.getWorldMatrix();return this.meshCollider.setGeometry(this.geometry,t),this.meshCollider.getBoundingBox()},e}(dn);function Sn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}fr([cn()],Rn.prototype,"geometry",void 0),exports.EffectComponent=function(t){function e(e){var r;return(r=t.call(this,e)||this).name="EffectComponent",r}Ri(e,t);var r=e.prototype;return r.onStart=function(){this.item.getHitTestParams=this.getHitTestParams},r.onUpdate=function(t){var e,r=this.item.time,i=null!=(e=this.material.getVector4("_Time"))?e:new An;this.material.setVector4("_Time",i.set(r/20,r,2*r,3*r))},r.fromData=function(e){t.prototype.fromData.call(this,e),this.material=this.materials[0]},e}(Rn),exports.EffectComponent=fr([un(qi.EffectComponent)],exports.EffectComponent),exports.PostProcessVolume=function(t){function e(e){var r;return(r=t.call(this,e)||this).bloom={threshold:0,intensity:0,active:!1},r.vignette={intensity:0,smoothness:0,roundness:0,active:!1},r.tonemapping={active:!1},r.colorAdjustments={brightness:0,saturation:0,contrast:0,active:!1},r}return Ri(e,t),e.prototype.onStart=function(){var t=this.item.composition;t&&(t.renderFrame.globalVolume=this)},e}(pn),fr([cn()],exports.PostProcessVolume.prototype,"bloom",void 0),fr([cn()],exports.PostProcessVolume.prototype,"vignette",void 0),fr([cn()],exports.PostProcessVolume.prototype,"tonemapping",void 0),fr([cn()],exports.PostProcessVolume.prototype,"colorAdjustments",void 0),exports.PostProcessVolume=fr([un(qi.PostProcessVolume)],exports.PostProcessVolume);var Cn=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1),this.x=t,this.y=e,this.z=r,this.w=i}var e=t.prototype;return e.set=function(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this},e.setFromEuler=function(t){return t.toQuaternion(this),this},e.setFromAxisAngle=function(e,r){var i=r/2,n=Math.sin(i),o=t.tempVec0;return o.copyFrom(e).normalize(),this.x=o.x*n,this.y=o.y*n,this.z=o.z*n,this.w=Math.cos(i),this},e.setFromVector4=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.setFromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},e.setFromRotationMatrix=function(t){var e=t.elements,r=e[0],i=e[4],n=e[8],o=e[1],s=e[5],a=e[9],u=e[2],c=e[6],h=e[10],l=r+s+h;if(l>0){var f=.5/Math.sqrt(l+1);this.w=.25/f,this.x=(c-a)*f,this.y=(n-u)*f,this.z=(o-i)*f}else if(r>s&&r>h){var p=2*Math.sqrt(1+r-s-h);this.w=(c-a)/p,this.x=.25*p,this.y=(i+o)/p,this.z=(n+u)/p,this.negate()}else if(s>h){var d=2*Math.sqrt(1+s-r-h);this.w=(n-u)/d,this.x=(i+o)/d,this.y=.25*d,this.z=(a+c)/d,this.negate()}else{var m=2*Math.sqrt(1+h-r-s);this.w=(o-i)/m,this.x=(n+u)/m,this.y=(a+c)/m,this.z=.25*m,this.negate()}return this},e.setFromUnitVectors=function(t,e){var r=t.dot(e)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this.x=-t.y,this.y=t.x,this.z=0,this.w=r):(this.x=0,this.y=-t.z,this.z=t.y,this.w=r)):(this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this.w=r),this.normalize()},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.clone=function(){return new t(this.x,this.y,this.z,this.w)},e.angleTo=function(t){return 2*Math.acos(Math.abs(xn(this.dot(t),-1,1)))},e.rotateTowards=function(t,e){var r=this.angleTo(t);if(0===r)return this;var i=Math.min(1,e/r);return this.slerp(t,i),this},e.identity=function(){return this.set(0,0,0,1)},e.invert=function(){return this.conjugate()},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},e.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.normalize=function(){var t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},e.multiply=function(t){return this.multiplyQuaternions(this,t)},e.premultiply=function(t){return this.multiplyQuaternions(t,this)},e.multiplyQuaternions=function(t,e){var r=t.x,i=t.y,n=t.z,o=t.w,s=e.x,a=e.y,u=e.z,c=e.w;return this.x=r*c+o*s+i*u-n*a,this.y=i*c+o*a+n*s-r*u,this.z=n*c+o*u+r*a-i*s,this.w=o*c-r*s-i*a-n*u,this},e.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copyFrom(t);var r=this,i=r.x,n=r.y,o=r.z,s=r.w,a=s*t.w+i*t.x+n*t.y+o*t.z;if(a<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copyFrom(t),a>=1)return this.w=s,this.x=i,this.y=n,this.z=o,this;var u=1-a*a;if(u<=Number.EPSILON){var c=1-e;return this.w=c*s+e*this.w,this.x=c*i+e*this.x,this.y=c*n+e*this.y,this.z=c*o+e*this.z,this.normalize(),this}var h=Math.sqrt(u),l=Math.atan2(h,a),f=Math.sin((1-e)*l)/h,p=Math.sin(e*l)/h;return this.w=s*f+this.w*p,this.x=i*f+this.x*p,this.y=n*f+this.y*p,this.z=o*f+this.z*p,this},e.slerpQuaternions=function(t,e,r){this.copyFrom(t).slerp(e,r)},e.rotateVector3=function(t,e){var r=this,i=r.x,n=r.y,o=r.z,s=r.w,a=t.x,u=t.y,c=t.z,h=s*a+n*c-o*u,l=s*u+o*a-i*c,f=s*c+i*u-n*a,p=-i*a-n*u-o*c,d=null!=e?e:t;return d.x=h*s+p*-i+l*-o-f*-n,d.y=l*s+p*-n+f*-i-h*-o,d.z=f*s+p*-o+h*-n-l*-i,d},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},e.toArray=function(){return[this.x,this.y,this.z,this.w]},e.toVector4=function(t){return t.set(this.x,this.y,this.z,this.w)},e.toEuler=function(t){return t.setFromQuaternion(this)},e.toMatrix4=function(t){return t.compose(bn.ZERO,this,bn.ONE)},t.fromEuler=function(e){return(new t).setFromEuler(e)},t.fromAxisAngle=function(e,r){return(new t).setFromAxisAngle(e,r)},t.fromVector4=function(e){return(new t).setFromVector4(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t.fromRotationMatrix=function(e){return(new t).setFromRotationMatrix(e)},t.fromUnitVectors=function(e,r){return(new t).setFromUnitVectors(e,r)},t}();Cn.tempVec0=new bn;var On,Mn,Pn=function(){function t(t,e,r,i,n,o,s,a,u,c,h,l,f,p,d,m){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=1),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=0),void 0===c&&(c=0),void 0===h&&(h=1),void 0===l&&(l=0),void 0===f&&(f=0),void 0===p&&(p=0),void 0===d&&(d=0),void 0===m&&(m=1),this.elements=[t,e,r,i,n,o,s,a,u,c,h,l,f,p,d,m]}var e=t.prototype;return e.set=function(t,e,r,i,n,o,s,a,u,c,h,l,f,p,d,m){var v=this.elements;return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=n,v[5]=o,v[6]=s,v[7]=a,v[8]=u,v[9]=c,v[10]=h,v[11]=l,v[12]=f,v[13]=p,v[14]=d,v[15]=m,this},e.setFromRowMajorData=function(t,e,r,i,n,o,s,a,u,c,h,l,f,p,d,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=r,v[12]=i,v[1]=n,v[5]=o,v[9]=s,v[13]=a,v[2]=u,v[6]=c,v[10]=h,v[14]=l,v[3]=f,v[7]=p,v[11]=d,v[15]=m,this},e.setFromColumnVectors=function(t,e,r,i){return this.set(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,r.x,r.y,r.z,r.w,i.x,i.y,i.z,i.w)},e.setFromMatrix3=function(t){var e=t.elements;return this.set(e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1),this},e.setFromArray=function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[e+r];return this},e.setFromScale=function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)},e.setFromTranslation=function(t,e,r){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1)},e.setFromRotationX=function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,r,0,0,-r,e,0,0,0,0,1)},e.setFromRotationY=function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1)},e.setFromRotationZ=function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,r,0,0,-r,e,0,0,0,0,1,0,0,0,0,1)},e.setFromRotationAxis=function(e,r){var i=t.tempVec0;i.copyFrom(e).normalize();var n=Math.cos(r),o=Math.sin(r),s=1-n,a=i.x,u=i.y,c=i.z,h=s*a,l=s*u;return this.set(h*a+n,h*u+o*c,h*c-o*u,0,h*u-o*c,l*u+n,l*c+o*a,0,h*c+o*u,l*c-o*a,s*c*c+n,0,0,0,0,1)},e.setFromEuler=function(t){return t.toMatrix4(this),this},e.setFromQuaternion=function(t){return this.compose(bn.ZERO,t,bn.ONE)},e.setFromShear=function(t,e,r){return this.set(1,t,t,0,e,1,e,0,r,r,1,0,0,0,0,1)},e.setFromBasis=function(t,e,r){return this.set(t.x,t.y,t.z,0,e.x,e.y,e.z,0,r.x,r.y,r.z,0,0,0,0,1)},e.setZero=function(){for(var t=0;t<16;t++)this.elements[t]=0;return this},e.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},e.isIdentity=function(){var t=this.elements;return 1===t[0]&&0===t[4]&&0===t[8]&&0===t[12]&&0===t[1]&&1===t[5]&&0===t[9]&&0===t[13]&&0===t[2]&&0===t[6]&&1===t[10]&&0===t[14]&&0===t[3]&&0===t[7]&&0===t[11]&&1===t[15]},e.clone=function(){var e=this.elements;return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},e.copyFrom=function(t){return this.elements=[].concat(t.elements),this},e.getColumnVector=function(t,e){return e.set(this.elements[4*t],this.elements[4*t+1],this.elements[4*t+2],this.elements[4*t+3])},e.lookAt=function(e,r,i){var n=t.tempVec0,o=t.tempVec1,s=t.tempVec2;s.subtractVectors(e,r),s.normalize(),n.crossVectors(i,s),n.normalize(),o.crossVectors(s,n);var a=this.elements;return a[0]=n.x,a[1]=o.x,a[2]=s.x,a[3]=0,a[4]=n.y,a[5]=o.y,a[6]=s.y,a[7]=0,a[8]=n.z,a[9]=o.z,a[10]=s.z,a[11]=0,a[12]=-n.dot(e),a[13]=-o.dot(e),a[14]=-s.dot(e),a[15]=1,this},e.addScaledMatrix=function(t,e){for(var r=this.elements,i=t.elements,n=0;n<16;n++)r[n]+=i[n]*e;return this},e.multiply=function(t){if("number"==typeof t){for(var e=0;e<16;e++)this.elements[e]*=t;return this}return this.multiplyMatrices(this,t)},e.premultiply=function(t){return this.multiplyMatrices(t,this)},e.multiplyMatrices=function(t,e){var r=t.elements,i=e.elements,n=this.elements,o=r[0],s=r[4],a=r[8],u=r[12],c=r[1],h=r[5],l=r[9],f=r[13],p=r[2],d=r[6],m=r[10],v=r[14],y=r[3],g=r[7],_=r[11],E=r[15],x=i[0],T=i[4],b=i[8],A=i[12],R=i[1],S=i[5],C=i[9],O=i[13],M=i[2],P=i[6],I=i[10],w=i[14],L=i[3],F=i[7],N=i[11],D=i[15];return n[0]=o*x+s*R+a*M+u*L,n[4]=o*T+s*S+a*P+u*F,n[8]=o*b+s*C+a*I+u*N,n[12]=o*A+s*O+a*w+u*D,n[1]=c*x+h*R+l*M+f*L,n[5]=c*T+h*S+l*P+f*F,n[9]=c*b+h*C+l*I+f*N,n[13]=c*A+h*O+l*w+f*D,n[2]=p*x+d*R+m*M+v*L,n[6]=p*T+d*S+m*P+v*F,n[10]=p*b+d*C+m*I+v*N,n[14]=p*A+d*O+m*w+v*D,n[3]=y*x+g*R+_*M+E*L,n[7]=y*T+g*S+_*P+E*F,n[11]=y*b+g*C+_*I+E*N,n[15]=y*A+g*O+_*w+E*D,this},e.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},e.determinant=function(){var t=this.elements,e=t[0],r=t[4],i=t[8],n=t[12],o=t[1],s=t[5],a=t[9],u=t[13],c=t[2],h=t[6],l=t[10],f=t[14];return t[3]*(+n*a*h-i*u*h-n*s*l+r*u*l+i*s*f-r*a*f)+t[7]*(+e*a*f-e*u*l+n*o*l-i*o*f+i*u*c-n*a*c)+t[11]*(+e*u*h-e*s*f-n*o*h+r*o*f+n*s*c-r*u*c)+t[15]*(-i*s*c-e*a*h+e*s*l+i*o*h-r*o*l+r*a*c)},e.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},e.invert=function(){var t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],s=t[5],a=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],p=t[12],d=t[13],m=t[14],v=t[15],y=h*m*u-d*l*u+d*a*f-s*m*f-h*a*v+s*l*v,g=p*l*u-c*m*u-p*a*f+o*m*f+c*a*v-o*l*v,_=c*d*u-p*h*u+p*s*f-o*d*f-c*s*v+o*h*v,E=p*h*a-c*d*a-p*s*l+o*d*l+c*s*m-o*h*m,x=e*y+r*g+i*_+n*E;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var T=1/x;return t[0]=y*T,t[1]=(d*l*n-h*m*n-d*i*f+r*m*f+h*i*v-r*l*v)*T,t[2]=(s*m*n-d*a*n+d*i*u-r*m*u-s*i*v+r*a*v)*T,t[3]=(h*a*n-s*l*n-h*i*u+r*l*u+s*i*f-r*a*f)*T,t[4]=g*T,t[5]=(c*m*n-p*l*n+p*i*f-e*m*f-c*i*v+e*l*v)*T,t[6]=(p*a*n-o*m*n-p*i*u+e*m*u+o*i*v-e*a*v)*T,t[7]=(o*l*n-c*a*n+c*i*u-e*l*u-o*i*f+e*a*f)*T,t[8]=_*T,t[9]=(p*h*n-c*d*n-p*r*f+e*d*f+c*r*v-e*h*v)*T,t[10]=(o*d*n-p*s*n+p*r*u-e*d*u-o*r*v+e*s*v)*T,t[11]=(c*s*n-o*h*n-c*r*u+e*h*u+o*r*f-e*s*f)*T,t[12]=E*T,t[13]=(c*d*i-p*h*i+p*r*l-e*d*l-c*r*m+e*h*m)*T,t[14]=(p*s*i-o*d*i-p*r*a+e*d*a+o*r*m-e*s*m)*T,t[15]=(o*h*i-c*s*i+c*r*a-e*h*a-o*r*l+e*s*l)*T,this},e.extractBasis=function(t,e,r){var i=this.elements;return t.set(i[0],i[1],i[2]),e.set(i[4],i[5],i[6]),r.set(i[8],i[9],i[10]),this},e.compose=function(t,e,r,i){void 0===i&&(i=bn.ZERO);var n=this.elements,o=e.x,s=e.y,a=e.z,u=e.w,c=-i.x,h=-i.y,l=-i.z,f=o+o,p=s+s,d=a+a,m=o*f,v=o*p,y=o*d,g=s*p,_=s*d,E=a*d,x=u*f,T=u*p,b=u*d,A=r.x,R=r.y,S=r.z;return n[0]=(1-(g+E))*A,n[1]=(v+b)*A,n[2]=(y-T)*A,n[3]=0,n[4]=(v-b)*R,n[5]=(1-(m+E))*R,n[6]=(_+x)*R,n[7]=0,n[8]=(y+T)*S,n[9]=(_-x)*S,n[10]=(1-(m+g))*S,n[11]=0,n[12]=c*n[0]+h*n[4]+l*n[8]-c+t.x,n[13]=c*n[1]+h*n[5]+l*n[9]-h+t.y,n[14]=c*n[2]+h*n[6]+l*n[10]-l+t.z,this},e.decompose=function(e,r,i){var n=t.tempVec0,o=this.elements,s=n.set(o[0],o[1],o[2]).length(),a=n.set(o[4],o[5],o[6]).length(),u=n.set(o[8],o[9],o[10]).length();this.determinant()<0&&(s=-s),e.x=o[12],e.y=o[13],e.z=o[14];var c=t.tempMat0;c.copyFrom(this);var h=1/s,l=1/a,f=1/u;return c.elements[0]*=h,c.elements[1]*=h,c.elements[2]*=h,c.elements[4]*=l,c.elements[5]*=l,c.elements[6]*=l,c.elements[8]*=f,c.elements[9]*=f,c.elements[10]*=f,r.setFromRotationMatrix(c),i.x=s,i.y=a,i.z=u,this},e.getTranslation=function(t){var e=this.elements;return t.set(e[12],e[13],e[14])},e.getScale=function(t){var e=this.elements;return t.set(Math.hypot(e[0],e[1],e[2]),Math.hypot(e[4],e[5],e[6]),Math.hypot(e[8],e[9],e[10]))},e.getTransform=function(){var t=new bn,e=new Cn,r=new bn;return this.decompose(t,e,r),{translation:t,rotation:e,scale:r}},e.orthographic=function(t,e,r,i,n,o){var s=1/(e-t),a=1/(r-i),u=1/(o-n),c=-(e+t)*s,h=-(r+i)*a,l=-(o+n)*u;s*=2,a*=2,u*=-2;var f=this.elements;return f[0]=s,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=a,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=u,f[11]=0,f[12]=c,f[13]=h,f[14]=l,f[15]=1,this},e.perspective=function(t,e,r,i,n){var o=1/Math.tan(.5*t),s=1/(r-i),a=this.elements;return a[0]=n?o:o/e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n?o*e:o,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(i+r)*s,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*i*r*s,a[15]=0,null!==i&&i!==1/0||(a[10]=-1,a[14]=-2*r),this},e.projectPoint=function(t,e){var r=t.x,i=t.y,n=t.z,o=this.elements,s=null!=e?e:t;s.x=o[0]*r+o[4]*i+o[8]*n+o[12],s.y=o[1]*r+o[5]*i+o[9]*n+o[13],s.z=o[2]*r+o[6]*i+o[10]*n+o[14];var a=o[3]*r+o[7]*i+o[11]*n+o[15];return s.multiply(1/a)},e.transformPoint=function(t,e){var r=t.x,i=t.y,n=t.z,o=this.elements,s=null!=e?e:t;return s.x=o[0]*r+o[4]*i+o[8]*n+o[12],s.y=o[1]*r+o[5]*i+o[9]*n+o[13],s.z=o[2]*r+o[6]*i+o[10]*n+o[14],s},e.transformNormal=function(t,e){var r=t.x,i=t.y,n=t.z,o=this.elements,s=null!=e?e:t;return s.x=o[0]*r+o[4]*i+o[8]*n,s.y=o[1]*r+o[5]*i+o[9]*n,s.z=o[2]*r+o[6]*i+o[10]*n,s.normalize()},e.transformVector4=function(t,e){var r=t.x,i=t.y,n=t.z,o=t.w,s=this.elements,a=null!=e?e:t;return a.x=s[0]*r+s[4]*i+s[8]*n+s[12]*o,a.y=s[1]*r+s[5]*i+s[9]*n+s[13]*o,a.z=s[2]*r+s[6]*i+s[10]*n+s[14]*o,a.w=s[3]*r+s[7]*i+s[11]*n+s[15]*o,a},e.equals=function(t){for(var e=this.elements,r=t.elements,i=0;i<16;i++)if(!_n(e[i],r[i]))return!1;return!0},e.toArray=function(){return[].concat(this.elements)},e.fill=function(t,e){void 0===e&&(e=0);var r=this.elements;t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15]},t.fromIdentity=function(){return new t(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.fromLookAt=function(e,r,i){return(new t).lookAt(e,r,i)},t.fromPerspective=function(e,r,i,n,o){return(new t).perspective(e,r,i,n,o)},t.fromColumnVectors=function(e,r,i,n){return(new t).setFromColumnVectors(e,r,i,n)},t.fromMatrix3=function(e){return(new t).setFromMatrix3(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t.fromScale=function(e,r,i){return(new t).setFromScale(e,r,i)},t.fromTranslation=function(e,r,i){return(new t).setFromTranslation(e,r,i)},t.fromRotationX=function(e){return(new t).setFromRotationX(e)},t.fromRotationY=function(e){return(new t).setFromRotationY(e)},t.fromRotationZ=function(e){return(new t).setFromRotationZ(e)},t.fromRotationAxis=function(e,r){return(new t).setFromRotationAxis(e,r)},t.fromEuler=function(e){return(new t).setFromEuler(e)},t.fromQuaternion=function(e){return(new t).setFromQuaternion(e)},t.fromShear=function(e,r,i){return(new t).setFromShear(e,r,i)},t.fromBasis=function(e,r,i){return(new t).setFromBasis(e,r,i)},t.fromRowMajorData=function(e,r,i,n,o,s,a,u,c,h,l,f,p,d,m,v){return new t(e,o,c,p,r,s,h,d,i,a,l,m,n,u,f,v)},t}();function In(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function wn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return In(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?In(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}Pn.IDENTITY=new Pn(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),Pn.ZERO=new Pn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),Pn.tempVec0=new bn,Pn.tempVec1=new bn,Pn.tempVec2=new bn,Pn.tempMat0=new Pn,exports.ShaderCompileResultStatus=void 0,(On=exports.ShaderCompileResultStatus||(exports.ShaderCompileResultStatus={}))[On.noShader=0]="noShader",On[On.success=1]="success",On[On.fail=2]="fail",On[On.compiling=3]="compiling",exports.GLSLVersion=void 0,(Mn=exports.GLSLVersion||(exports.GLSLVersion={})).GLSL1="100",Mn.GLSL3="300 es";var Ln=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).source=r,i}return Ri(e,t),e}(ln);exports.Shader=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.createVariant=function(t){var e=[];if(t)for(var r,i=wn(Object.keys(t));!(r=i()).done;){var n=r.value;e.push([n,t[n]])}var o=this.engine.getShaderLibrary().createShader(this.shaderData,e);return o.shader=this,o},r.fromData=function(e){t.prototype.fromData.call(this,e),this.shaderData=e},e}(ln),exports.Shader=fr([un(qi.Shader)],exports.Shader);var Fn="effects-internal-copy",Nn="effects-internal-copy-mesh",Dn="\nprecision highp float;\nattribute vec2 aPos;\nvarying vec2 vTex;\nvoid main(){\n    gl_Position = vec4(aPos,0.,1.0);\n    vTex = (aPos + vec2(1.0))/2.;\n}",Vn="precision mediump float;\nvarying vec2 vTex;\n\n#ifdef DEPTH_TEXTURE\nuniform sampler2D uDepth;\n#extension GL_EXT_frag_depth : enable\n#endif\nvoid main(){\n    #ifdef DEPTH_TEXTURE\n    gl_FragDepthEXT = texture2D(uDepth,vTex).r;\n    #endif\n}\n";function Un(t,e){return{name:Fn,vertex:Dn,fragment:Vn,glslVersion:2===t?exports.GLSLVersion.GLSL3:exports.GLSLVersion.GLSL1,macros:[["DEPTH_TEXTURE",!!e]],cacheId:Nn+ +e}}function Bn(t,e,r){var i;if(void 0===e&&(e="webgl"),"webgl2"===e&&((i=t.getContext("webgl2",r))||console.debug("WebGL2 context retrieval failed, falling back to WebGL context.")),i&&"webgl"!==e||(i=t.getContext("webgl",r)),!i)throw new Error("This browser does not support WebGL or the WebGL version is incorrect. Please check your WebGL version.");return i}function kn(t){var e=t.getExtension("EXT_disjoint_timer_query_webgl2");if(e){var i=t.createQuery(),n=cr((function(){return pr(this,(function(o){return[2,new Promise((function(o,s){if(i){var a=t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),u=t.getParameter(e.GPU_DISJOINT_EXT);if(a&&!u){var c=t.getQueryParameter(i,t.QUERY_RESULT);o(c/1e3/1e3)}(a||u)&&(t.deleteQuery(i),i=null),null!==a&&i&&r.window.setTimeout((function(){n().then(o).catch}),1)}}))]}))}));if(!i)return;return{begin:function(){i&&t.beginQuery(e.TIME_ELAPSED_EXT,i)},end:function(){t.endQuery(e.TIME_ELAPSED_EXT)},getTime:n}}}var zn,Gn,Xn,Hn=[],jn={};function Yn(){"function"==typeof r.WebGL2RenderingContext?Zn(r.WebGL2RenderingContext):void 0!==r.WebGLRenderingContext?(Zn(r.WebGLRenderingContext),Zn(r.WebGLRenderingContext.prototype)):Hn.push("iOS16 lockdown mode, WebGL Constants not in global"),Hn.length||"HALF_FLOAT"in jn||(jn.HALF_FLOAT=5131)}function Wn(t){return void 0!==r.WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name}function Zn(t){for(var e in t)/^[A-Z_]/.test(e)&&(jn[e]=t[e])}function qn(t){switch(t){case Qi.Float32:return r.WebGLRenderingContext.FLOAT;case Qi.Int16:return r.WebGLRenderingContext.SHORT;case Qi.Int8:return r.WebGLRenderingContext.BYTE;case Qi.UInt16:return r.WebGLRenderingContext.UNSIGNED_SHORT;case Qi.UInt8:return r.WebGLRenderingContext.UNSIGNED_BYTE;default:return r.WebGLRenderingContext.FLOAT}}function Kn(t){switch(t){case li.ALPHA:case li.ADD:case li.SUBTRACTION:case li.STRONG_LIGHT:case li.WEAK_LIGHT:return 1;case li.SUPERPOSITION:return 2;case li.BRIGHTNESS:return 3;case li.MULTIPLY:return 0;default:return 1}}function Qn(t,e){switch(e){case void 0:case li.ALPHA:t.blendFunction=[jn.ONE,jn.ONE_MINUS_SRC_ALPHA,jn.ONE,jn.ONE_MINUS_SRC_ALPHA];break;case li.ADD:t.blendFunction=[jn.ONE,jn.ONE,jn.ONE,jn.ONE];break;case li.SUBTRACTION:t.blendFunction=[jn.ONE,jn.ONE,jn.ZERO,jn.ONE],t.blendEquation=[jn.FUNC_REVERSE_SUBTRACT,jn.FUNC_REVERSE_SUBTRACT];break;case li.SUPERPOSITION:t.blendFunction=[jn.ONE,jn.ONE,jn.ONE,jn.ONE];break;case li.MULTIPLY:t.blendFunction=[jn.DST_COLOR,jn.ONE_MINUS_SRC_ALPHA,jn.DST_COLOR,jn.ONE_MINUS_SRC_ALPHA];break;case li.BRIGHTNESS:t.blendFunction=[jn.ONE,jn.ONE_MINUS_SRC_ALPHA,jn.ONE,jn.ONE_MINUS_SRC_ALPHA];break;case li.STRONG_LIGHT:t.blendFunction=[jn.DST_COLOR,jn.DST_ALPHA,jn.ZERO,jn.ONE];break;case li.WEAK_LIGHT:t.blendFunction=[jn.DST_COLOR,jn.ZERO,jn.ZERO,jn.ONE];break;default:console.warn("BlendMode "+e+" not in specification, please set blend params separately.")}}function Jn(t,e){e===fi.DOUBLE?t.culling=!1:(t.culling=!0,t.frontFace=jn.CW,t.cullFace=e===fi.BACK?jn.BACK:jn.FRONT)}function $n(t,e){switch(e){case void 0:t.stencilTest=!1;break;case pi.MASK:t.stencilTest=!0,t.stencilFunc=[jn.ALWAYS,jn.ALWAYS],t.stencilOpZPass=[jn.REPLACE,jn.REPLACE];break;case pi.OBSCURED:t.stencilTest=!0,t.stencilFunc=[jn.EQUAL,jn.EQUAL];break;case pi.REVERSE_OBSCURED:t.stencilTest=!0,t.stencilFunc=[jn.NOTEQUAL,jn.NOTEQUAL];break;case pi.NONE:t.stencilTest=!1;break;default:console.warn("MaskMode "+e+" not in specification, please set stencil params seperately.")}}function to(){return to=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},to.apply(this,arguments)}Hn.length||Yn(),exports.ShaderType=void 0,(zn=exports.ShaderType||(exports.ShaderType={}))[zn.vertex=0]="vertex",zn[zn.fragment=1]="fragment",exports.TextureLoadAction=void 0,(Gn=exports.TextureLoadAction||(exports.TextureLoadAction={}))[Gn.whatever=0]="whatever",Gn[Gn.clear=2]="clear",exports.TextureSourceType=void 0,(Xn=exports.TextureSourceType||(exports.TextureSourceType={}))[Xn.none=0]="none",Xn[Xn.data=1]="data",Xn[Xn.image=2]="image",Xn[Xn.compressed=3]="compressed",Xn[Xn.video=4]="video",Xn[Xn.canvas=5]="canvas",Xn[Xn.framebuffer=6]="framebuffer",Xn[Xn.mipmaps=7]="mipmaps";var eo=function(){function t(){this.callbacks={}}var e=t.prototype;return e.downloadJSON=function(t,e,r){this.download(t,"json",e,r)},e.downloadBinary=function(t,e,r){this.download(t,"arraybuffer",e,r)},e.downloadBlob=function(t,e,r){this.download(t,"blob",e,r)},e.download=function(t,e,i,n){var o=this;if(void 0===e&&(e="json"),!this.start(t,i,n)){var s=new r.XMLHttpRequest,a=function(){o.finish(t,s.status,s.response)};s.responseType=e,s.addEventListener("load",(function(){200==s.status||0==s.status?o.finish(t,200,s.response):a()})),s.addEventListener("error",a),s.open("GET",t,!0),s.send()}},e.start=function(t,e,r){var i=this.callbacks[t];try{if(i)return!0;this.callbacks[t]=i=[]}finally{i.push(e,r)}},e.finish=function(t,e,r){var i=this.callbacks[t];delete this.callbacks[t];for(var n=200==e||0==e?[r]:[e,r],o=n.length-1,s=i.length;o<s;o+=2)i[o].apply(null,n)},t}(),ro=!1,io=!1;function no(t,e){return oo.apply(this,arguments)}function oo(){return(oo=cr((function(t,e){return pr(this,(function(r){switch(r.label){case 0:return!ro&&e?[3,2]:[4,uo(t)];case 1:return[2,{image:r.sent(),url:t}];case 2:return r.trys.push([2,4,,6]),[4,uo(e)];case 3:return[2,{image:r.sent(),url:e}];case 4:return r.sent(),ro=!0,[4,uo(t)];case 5:return[2,{image:r.sent(),url:t}];case 6:return[2]}}))}))).apply(this,arguments)}function so(t,e){return ao.apply(this,arguments)}function ao(){return(ao=cr((function(t,e){return pr(this,(function(r){switch(r.label){case 0:return!io&&e?[3,2]:[4,uo(t)];case 1:return[2,{image:r.sent(),url:t}];case 2:return r.trys.push([2,4,,6]),[4,uo(e)];case 3:return[2,{image:r.sent(),url:e}];case 4:return r.sent(),io=!0,[4,uo(t)];case 5:return[2,{image:r.sent(),url:t}];case 6:return[2]}}))}))).apply(this,arguments)}function uo(t){return co.apply(this,arguments)}function co(){return co=cr((function(t){var e,i;return pr(this,(function(n){if(e="",hr(t,r.HTMLImageElement)){if(t.complete)return[2,t];e=t.src}else hr(t,r.Blob)?(e=r.URL.createObjectURL(t),i=!0):"string"==typeof t&&(e=t);if(!e)throw new Error("Invalid url type: "+JSON.stringify(t)+".");return[2,new Promise((function(t,n){var o=new r.Image;/^data:/.test(e)||(o.crossOrigin="*"),o.onload=function(){return o.onload=null,i&&r.URL.revokeObjectURL(e),t(o)},o.onerror=function(t){return o.onerror=null,i&&r.URL.revokeObjectURL(e),n("Load image fail: "+e+", reason: "+JSON.stringify(t))},o.src=e}))]}))})),co.apply(this,arguments)}function ho(t){return lo.apply(this,arguments)}function lo(){return lo=cr((function(t){return pr(this,(function(e){return[2,new Promise((function(e,r){(new eo).downloadBinary(t,e,(function(e,i){r("Couldn't load bins "+t+": status "+e+", "+i)}))}))]}))})),lo.apply(this,arguments)}function fo(){return fo=cr((function(t){return pr(this,(function(e){return[2,new Promise((function(e,r){(new eo).downloadBlob(t,e,(function(e,i){r("Couldn't load blob "+t+": status "+e+", "+i)}))}))]}))})),fo.apply(this,arguments)}function po(t){return mo.apply(this,arguments)}function mo(){return mo=cr((function(t){var e;return pr(this,(function(i){return e=r.document.createElement("video"),"string"==typeof t?e.src=t:e.srcObject=t,e.crossOrigin="anonymous",e.muted=!0,Ir()&&e.setAttribute("renderer","standard"),e.setAttribute("playsinline","playsinline"),[2,new Promise((function(t,r){var i=e.play();i?i.then((function(){return t(e)})):e.addEventListener("loadeddata",(function r(){t(e),e.removeEventListener("loadeddata",r)}),!0),e.addEventListener("error",(function(t){r("Load video fail.")}))}))]}))})),mo.apply(this,arguments)}function vo(t,e){return yo.apply(this,arguments)}function yo(){return yo=cr((function(t,e){return pr(this,(function(r){switch(r.label){case 0:if(!Array.isArray(t))return[3,5];r.label=1;case 1:return r.trys.push([1,3,,5]),[4,e(t[0])];case 2:return[2,r.sent()];case 3:return r.sent(),[4,e(t[1])];case 4:return[2,r.sent()];case 5:return[2,e(t)]}}))})),yo.apply(this,arguments)}function go(t,e,r){return _o.apply(this,arguments)}function _o(){return(_o=cr((function(t,e,r,i){var n,o,s,a,u,c,h,l,f;return pr(this,(function(p){switch(p.label){case 0:return void 0===i&&(i=[]),34067!==t.target?[3,2]:(n=t.mipmaps,o=t.target,s=n.map((function(t){return Promise.all(t.map((function(t){return t.id?r[t.id]:Eo(t,e)})))})),[4,Promise.all(s)]);case 1:return a=p.sent(),[2,to({keepImageSource:!1},t,{mipmaps:a,sourceFrom:{target:o,type:exports.TextureSourceType.mipmaps}})];case 2:return u=t.mipmaps,c=t.target,h=u.map((function(t){return Eo(t,e)})),[4,Promise.all(h)];case 3:return l=p.sent(),f=i[u[0][1][0]].url,[2,to({keepImageSource:!1},t,{mipmaps:l,sourceType:exports.TextureSourceType.mipmaps,sourceFrom:{target:c,bin:f,type:exports.TextureSourceType.mipmaps,mipmaps:u.map((function(t){return[t[1][1],t[1][2]]}))}})];case 4:return[2]}}))}))).apply(this,arguments)}function Eo(t,e){return xo.apply(this,arguments)}function xo(){return xo=cr((function(t,e){var i,n,o,s,a;return pr(this,(function(u){if(i=t[1],n=i[0],o=i[1],s=i[2],!(a=e[n]))throw new Error("Invalid bin pointer: "+JSON.stringify(t)+".");return[2,uo(new r.Blob([new Uint8Array(a,o,s)]))]}))})),xo.apply(this,arguments)}var To=1,bo=function(t){function e(e){var r;return(r=t.call(this,e)||this).destroyed=!1,r.id="Tex"+To++,r}Ri(e,t);var r=e.prototype;return r.getWidth=function(){return this.width||0},r.getHeight=function(){return this.height||0},r.uploadCurrentVideoFrame=function(){},r.offloadData=function(){},r.reloadData=function(){},r.initialize=function(){},r.assembleOptions=function(t){var e=t.target,r=void 0===e?jn.TEXTURE_2D:e,i=t.format,n=void 0===i?jn.RGBA:i;return t.sourceType||(t.sourceType="image"in t?exports.TextureSourceType.image:"data"in t?exports.TextureSourceType.data:"video"in t?exports.TextureSourceType.video:0),to({minFilter:jn.NEAREST,magFilter:jn.NEAREST,wrapS:jn.CLAMP_TO_EDGE,wrapT:jn.CLAMP_TO_EDGE,target:r,format:jn.RGBA,internalFormat:n,type:jn.UNSIGNED_BYTE},t)},e.fromImage=function(t,r,i){return cr((function(){var n,o;return pr(this,(function(s){switch(s.label){case 0:return[4,uo(t)];case 1:return n=s.sent(),(o=e.create(r,to({sourceType:exports.TextureSourceType.image,image:n,target:jn.TEXTURE_2D,id:ei(),flipY:!0},i))).initialize(),[2,o]}}))}))()},e.fromVideo=function(t,r,i){return cr((function(){var n,o;return pr(this,(function(s){switch(s.label){case 0:return[4,po(t)];case 1:return n=s.sent(),(o=e.create(r,to({sourceType:exports.TextureSourceType.video,video:n,id:ei(),flipY:!0},i))).initialize(),[2,o]}}))}))()},nn(e,[{key:"isDestroyed",get:function(){return this.destroyed}}]),e}(ln);function Ao(t,e,r,i){var n,o,s=e.length/r/i;return o=n=4===s||0===s?jn.RGBA:3===s?jn.RGB:2===s?jn.LUMINANCE_ALPHA:jn.LUMINANCE,bo.createWithData(t,{data:e,width:r,height:i},{type:jn.HALF_FLOAT,format:n,internalFormat:o,wrapS:jn.CLAMP_TO_EDGE,wrapT:jn.CLAMP_TO_EDGE})}var Ro={type:jn.UNSIGNED_BYTE,format:jn.RGBA,internalFormat:jn.RGBA,wrapS:jn.MIRRORED_REPEAT,wrapT:jn.MIRRORED_REPEAT,minFilter:jn.NEAREST,magFilter:jn.NEAREST};function So(t){return bo.create(t,to({id:tn.WhiteTexture,data:{width:1,height:1,data:new Uint8Array([255,255,255,255])},sourceType:exports.TextureSourceType.data},Ro))}function Co(t){return bo.create(t,to({id:tn.TransparentTexture,data:{width:1,height:1,data:new Uint8Array([0,0,0,0])},sourceType:exports.TextureSourceType.data},Ro))}var Oo=function(){function t(t,e,r){void 0===r&&(r=0),this.arrayBuffer=t,this.baseOffset=r;var i=new Uint8Array(this.arrayBuffer,this.baseOffset,12);if(171!==i[0]||75!==i[1]||84!==i[2]||88!==i[3]||32!==i[4]||49!==i[5]||49!==i[6]||187!==i[7]||13!==i[8]||10!==i[9]||26!==i[10]||10!==i[11])throw new Error("Texture missing KTX identifier.");var n=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(this.arrayBuffer,this.baseOffset+12,13*n),s=67305985===o.getUint32(0,!0);this.glType=o.getUint32(1*n,s),this.glTypeSize=o.getUint32(2*n,s),this.glFormat=o.getUint32(3*n,s),this.glInternalFormat=o.getUint32(4*n,s),this.glBaseInternalFormat=o.getUint32(5*n,s),this.pixelWidth=o.getUint32(6*n,s),this.pixelHeight=o.getUint32(7*n,s),this.pixelDepth=o.getUint32(8*n,s),this.numberOfArrayElements=o.getUint32(9*n,s),this.numberOfFaces=o.getUint32(10*n,s),this.numberOfMipmapLevels=o.getUint32(11*n,s),this.bytesOfKeyValueData=o.getUint32(12*n,s),this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===e?0===this.glType?this.loadType=0:this.loadType=2:Yr.warn("Number of faces expected "+e+", but found "+this.numberOfFaces+"."):Yr.warn("Texture arrays not currently supported."):Yr.warn("Only 2D textures currently supported.")}return t.prototype.mipmaps=function(t){for(var e=[],r=64+this.bytesOfKeyValueData,i=this.pixelWidth,n=this.pixelHeight,o=t?this.numberOfMipmapLevels:1,s=0;s<o;s++){for(var a=new Int32Array(this.arrayBuffer,this.baseOffset+r,1)[0],u=0;u<this.numberOfFaces;u++){var c=new Uint8Array(this.arrayBuffer,this.baseOffset+r+4,a);e.push({data:c,width:i,height:n}),r+=a+4,r+=3-(a+3)%4}i=Math.max(1,.5*i),n=Math.max(1,.5*n)}return e},t}();function Mo(t){var e=new Oo(t,1),r=e.numberOfMipmapLevels,i=e.pixelWidth,n=e.pixelHeight,o=e.glType,s=e.numberOfFaces,a=e.glInternalFormat,u=e.glFormat,c=r>=Math.floor(Math.log2(Math.max(i,n))+1);return{sourceType:exports.TextureSourceType.compressed,type:o,target:6===s?jn.TEXTURE_CUBE_MAP:jn.TEXTURE_2D,internalFormat:a,format:u,mipmaps:e.mipmaps(c)}}var Po,Io=function(){function t(){this.reloadPending={}}var e=t.prototype;return e.reload=function(t){var e=this;return cr((function(){var r,i;return pr(this,(function(n){switch(n.label){case 0:return r=t.id,e.reloadPending[r]?[2]:t.sourceFrom?(e.reloadPending[r]=!0,[4,e.loadSource(t.sourceFrom)]):[3,2];case 1:return i=n.sent(),t.updateSource(i),e.reloadPending[r]=!1,[3,3];case 2:throw new Error("No source from.");case 3:return[2]}}))}))()},e.canOffloadTexture=function(t){if(t){var e=t.type;if(e===exports.TextureSourceType.compressed||e===exports.TextureSourceType.image){var r=t.target,i=t.map,n=t.url;return r===jn.TEXTURE_CUBE_MAP?"object"==typeof i&&!!i:Zr(n)&&n.length>0}if(e===exports.TextureSourceType.mipmaps){var o=t.bin,s=t.mipmaps,a=t.target,u=t.maps,c=t.urls;return o?s.length>0:a===jn.TEXTURE_CUBE_MAP?u.every((function(t){return"object"==typeof t&&t})):c.every((function(t){return Zr(t)&&t.length>0}))}}return!1},e.loadSource=function(t,e){var r=this;return cr((function(){var i,n,o,s,a,u,c,h,l,f,p,d,m,v,y,g,_;return pr(this,(function(E){switch(E.label){case 0:return i=t.type,n=t.target,o=t.map,s=t.url,a=t.bin,u=t.mipmaps,c=t.urls,h=t.maps,n!==jn.TEXTURE_CUBE_MAP||i===exports.TextureSourceType.mipmaps?[3,2]:[4,r.loadCubeMap(o)];case 1:return l=E.sent(),[2,to({},e,{cube:l,target:jn.TEXTURE_CUBE_MAP,sourceType:exports.TextureSourceType.image,sourceFrom:{type:exports.TextureSourceType.image,map:to({},o),target:jn.TEXTURE_CUBE_MAP}})];case 2:return i!==exports.TextureSourceType.image?[3,4]:[4,uo(s)];case 3:return f=E.sent(),[2,to({},e,{image:f,sourceType:exports.TextureSourceType.image,sourceFrom:{type:i,url:s,target:jn.TEXTURE_2D}})];case 4:return i!==exports.TextureSourceType.video?[3,6]:[4,po(s)];case 5:return p=E.sent(),[2,to({},e,{video:p,sourceType:exports.TextureSourceType.video})];case 6:return i!==exports.TextureSourceType.compressed?[3,8]:[4,ho(s)];case 7:return[2,to({},Mo(E.sent()),e,{sourceFrom:{url:s,type:exports.TextureSourceType.compressed}})];case 8:return i!==exports.TextureSourceType.mipmaps?[3,17]:a?[4,ho(a)]:[3,13];case 9:return d=E.sent(),m=null!=n?n:jn.TEXTURE_2D,v=m===jn.TEXTURE_2D?u.slice():u.map((function(t){return t.slice()})),n!==jn.TEXTURE_CUBE_MAP?[3,11]:[4,Promise.all(u.map((function(t){return r.loadMipmapImages(t,d)})))];case 10:return y=E.sent(),[3,12];case 11:y=r.loadMipmapImages(u,d),E.label=12;case 12:return[2,to({},e,{mipmaps:y,target:m,sourceType:exports.TextureSourceType.mipmaps,sourceFrom:{bin:a,mipmaps:v,target:m,type:exports.TextureSourceType.mipmaps}})];case 13:return n!==jn.TEXTURE_2D&&n?[3,15]:[4,Promise.all(c.map((function(t){return uo(t)})))];case 14:return g=E.sent(),[2,to({},e,{mipmaps:g,target:jn.TEXTURE_2D,sourceType:exports.TextureSourceType.mipmaps,sourceFrom:{type:i,urls:c.slice(),target:jn.TEXTURE_2D}})];case 15:return n!==jn.TEXTURE_CUBE_MAP?[3,17]:[4,Promise.all(h.map((function(t){return r.loadCubeMap(t)})))];case 16:return _=E.sent(),[2,to({},e,{mipmaps:_,target:jn.TEXTURE_CUBE_MAP,sourceType:exports.TextureSourceType.mipmaps,sourceFrom:{type:i,maps:h.map((function(t){return to({},t)})),target:jn.TEXTURE_CUBE_MAP}})];case 17:throw new Error("Invalid resource type: "+i+".")}}))}))()},e.loadMipmapImages=function(t,e){return cr((function(){return pr(this,(function(i){return[2,Promise.all(t.map((function(t){return uo(new r.Blob([new Uint8Array(e,t[0],t[1])]))})))]}))}))()},e.loadCubeMap=function(t){return cr((function(){return pr(this,(function(e){return[2,Promise.all(t.map((function(t){return uo(t)})))]}))}))()},t}();function wo(){return Po||(Po=new Io),Po}var Lo,Fo=function(){function t(t){this.destroyed=!1;var e=t.name,r=void 0===e?"defaultDataBlock":e;this.name=r}var e=t.prototype;return e.setUniformValues=function(t){var e=this;Object.keys(t).forEach((function(r){e.setUniformValue(r,t[r])}))},e.invalidAllFlags=function(){},e.updateUniformSubData=function(t,e,r){},t}();function No(t){return"object"==typeof t&&t&&void 0===t.length&&hr(t,bo)}exports.MaterialRenderType=void 0,(Lo=exports.MaterialRenderType||(exports.MaterialRenderType={}))[Lo.normal=0]="normal",Lo[Lo.transformFeedback=1]="transformFeedback";var Do,Vo,Uo=1,Bo=function(t){function e(e,r){var i;if((i=t.call(this,e)||this).stringTags={},i.enabledMacros={},i.destroyed=!1,i.initialized=!1,i.shaderDirty=!0,r){var n=r.name,o=void 0===n?"Material"+Uo++:n,s=r.renderType,a=void 0===s?0:s,u=r.shader,c=r.uniformSemantics;i.name=o,i.renderType=a,i.shaderSource=u,i.props=r,i.uniformSemantics=to({},c)}else i.name="Material"+Uo++,i.renderType=0;return i}Ri(e,t);var r=e.prototype;return r.initialize=function(){},r.createShaderVariant=function(){},r.use=function(t,e){},nn(e,[{key:"shader",get:function(){return this._shader},set:function(t){this._shader!==t&&(this._shader=t,this.shaderDirty=!0)}},{key:"mainTexture",get:function(){return this.getTexture("_MainTex")},set:function(t){this.setTexture("_MainTex",t)}},{key:"color",get:function(){return this.getColor("_Color")},set:function(t){this.setColor("_Color",t)}},{key:"blending",set:function(t){}},{key:"blendFunction",set:function(t){}},{key:"blendEquation",set:function(t){}},{key:"depthTest",set:function(t){}},{key:"depthMask",set:function(t){}},{key:"stencilTest",set:function(t){}},{key:"stencilRef",set:function(t){}},{key:"stencilFunc",set:function(t){}},{key:"stencilOpZPass",set:function(t){}},{key:"culling",set:function(t){}},{key:"frontFace",set:function(t){}},{key:"cullFace",set:function(t){}},{key:"blendColor",set:function(t){}},{key:"depthRange",set:function(t){}},{key:"depthFunc",set:function(t){}},{key:"polygonOffsetFill",set:function(t){}},{key:"polygonOffset",set:function(t){}},{key:"sampleAlphaToCoverage",set:function(t){}},{key:"colorMask",set:function(t){}},{key:"stencilMask",set:function(t){}},{key:"stencilOpFail",set:function(t){}},{key:"stencilOpZFail",set:function(t){}}]),e}(ln),ko={format:jn.RGBA,type:jn.UNSIGNED_BYTE,minFilter:jn.LINEAR,magFilter:jn.LINEAR,wrapS:jn.CLAMP_TO_EDGE,wrapT:jn.CLAMP_TO_EDGE},zo=Symbol("dispose"),Go=function(){function t(t){this.textureCache={},this.textureRef={},this.engine=t}var e=t.prototype;return e.requestColorAttachmentTexture=function(t){var e=this,r=t.width,i=t.height,n=t.name,o={sourceType:exports.TextureSourceType.framebuffer,data:{width:r,height:i},name:n},s=[n];Object.getOwnPropertyNames(ko).forEach((function(e){var r,i=null!=(r=t[e])?r:ko[e];o[e]=i,s.push(e,i)}));var a=s.join(":"),u=this.textureCache[a];if(u)this.textureRef[a]++;else{var c=this.engine;zr(c),u=bo.create(c,o),this.textureCache[a]=u,this.textureRef[a]=1,u[zo]=u.dispose,u.dispose=function(){return e.removeTexture(a)}}return u},e.removeTexture=function(t){var e=this.textureRef[t];if(e<=1){e<0&&console.error("Ref count < 0.");var r=this.textureCache[t];r&&(r[zo](),r.dispose=r[zo]),delete this.textureCache[t],delete this.textureRef[t]}else this.textureRef[t]=e-1},e.dispose=function(){var t=this;Object.keys(this.textureCache).forEach((function(e){var r=t.textureCache[e];r[zo](),r.dispose=r[zo]})),this.textureCache={},this.textureRef={},this.engine=void 0},t}(),Xo=function(){function t(t){void 0===t&&(t={}),this.semantics=to({},t)}var e=t.prototype;return e.toObject=function(){return to({},this.semantics)},e.setSemantic=function(t,e){void 0===e?delete this.semantics[t]:this.semantics[t]=e},e.getSemanticValue=function(t,e){var r=this.semantics[t];return Kr(r)?r(e):r},e.hasSemanticValue=function(t){return t in this.semantics},e.dispose=function(){var t=this;Object.keys(this.semantics).forEach((function(e){delete t.semantics[e]}))},t}(),Ho=((Do={})[jn.FLOAT]=Float32Array.BYTES_PER_ELEMENT,Do[jn.INT]=Int32Array.BYTES_PER_ELEMENT,Do[jn.SHORT]=Int16Array.BYTES_PER_ELEMENT,Do[jn.BYTE]=Int8Array.BYTES_PER_ELEMENT,Do),jo=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.initialize=function(){},r.flush=function(){},e}(ln);function Yo(t){return t===jn.INT?new Int32Array(0):t===jn.SHORT?new Int16Array(0):new Float32Array(0)}!function(t){t[t.XYZ=0]="XYZ",t[t.XZY=1]="XZY",t[t.YXZ=2]="YXZ",t[t.YZX=3]="YZX",t[t.ZXY=4]="ZXY",t[t.ZYX=5]="ZYX"}(Vo||(Vo={}));var Wo=function(){function t(e,r,i,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=t.DEFAULT_ORDER),this.x=e,this.y=r,this.z=i,this.order=n}var e=t.prototype;return e.set=function(t,e,r,i){return void 0===i&&(i=this.order),this.x=t,this.y=e,this.z=r,this.order=i,this},e.setZero=function(t){return void 0===t&&(t=this.order),this.set(0,0,0,t)},e.setFromRotationMatrix4=function(t,e){void 0===e&&(e=this.order);var r=t.elements,i=r[0],n=r[4],o=r[8],s=r[1],a=r[5],u=r[9],c=r[2],h=r[6],l=r[10];switch(e){case Vo.XYZ:this.y=Math.asin(xn(o,-1,1)),Math.abs(o)<.9999999?(this.x=Math.atan2(-u,l),this.z=Math.atan2(-n,i)):(this.x=Math.atan2(h,a),this.z=0);break;case Vo.YXZ:this.x=Math.asin(-xn(u,-1,1)),Math.abs(u)<.9999999?(this.y=Math.atan2(o,l),this.z=Math.atan2(s,a)):(this.y=Math.atan2(-c,i),this.z=0);break;case Vo.ZXY:this.x=Math.asin(xn(h,-1,1)),Math.abs(h)<.9999999?(this.y=Math.atan2(-c,l),this.z=Math.atan2(-n,a)):(this.y=0,this.z=Math.atan2(s,i));break;case Vo.ZYX:this.y=Math.asin(-xn(c,-1,1)),Math.abs(c)<.9999999?(this.x=Math.atan2(h,l),this.z=Math.atan2(s,i)):(this.x=0,this.z=Math.atan2(-n,a));break;case Vo.YZX:this.z=Math.asin(xn(s,-1,1)),Math.abs(s)<.9999999?(this.x=Math.atan2(-u,a),this.y=Math.atan2(-c,i)):(this.x=0,this.y=Math.atan2(o,l));break;case Vo.XZY:this.z=Math.asin(-xn(n,-1,1)),Math.abs(n)<.9999999?(this.x=Math.atan2(h,a),this.y=Math.atan2(o,i)):(this.x=Math.atan2(-u,l),this.y=0);break;default:console.error("setFromRotationMatrix: unknown order: "+e)}return this.x*=yn,this.y*=yn,this.z*=yn,this.order=e,this},e.setFromQuaternion=function(e,r){void 0===r&&(r=this.order);var i=t.tempMat0;return i.setFromQuaternion(e),this.setFromRotationMatrix4(i,r)},e.setFromVector3=function(t,e){return void 0===e&&(e=this.order),this.set(t.x,t.y,t.z,e)},e.setFromArray=function(t,e,r){var i,n,o,s;return void 0===e&&(e=0),void 0===r&&(r=this.order),this.x=null!=(i=t[e])?i:0,this.y=null!=(n=t[e+1])?n:0,this.z=null!=(o=t[e+2])?o:0,this.order=null!=(s=t[e+3])?s:r,this},e.clone=function(){return new t(this.x,this.y,this.z,this.order)},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this},e.add=function(t){return this.order!=t.order?(console.error("add euler with different order"),this):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},e.addEulers=function(t,e){return t.order!=e.order?(console.error("add euler with different order"),this):(this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.order=t.order,this)},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.reorder=function(t){var e=new Cn;return e.setFromEuler(this),this.setFromQuaternion(e,t)},e.rotateVector3=function(e,r){return t.tempQuat0.setFromEuler(this).rotateVector3(e,r)},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order},e.toVector3=function(t){return t.set(this.x,this.y,this.z)},e.toArray=function(){return[this.x,this.y,this.z]},e.toQuaternion=function(t){var e=this,r=e.x,i=e.y,n=e.z,o=e.order,s=Math.cos(r*vn*.5),a=Math.cos(i*vn*.5),u=Math.cos(n*vn*.5),c=Math.sin(r*vn*.5),h=Math.sin(i*vn*.5),l=Math.sin(n*vn*.5);switch(o){case Vo.XYZ:t.set(c*a*u+s*h*l,s*h*u-c*a*l,s*a*l+c*h*u,s*a*u-c*h*l);break;case Vo.YXZ:t.set(c*a*u+s*h*l,s*h*u-c*a*l,s*a*l-c*h*u,s*a*u+c*h*l);break;case Vo.ZXY:t.set(c*a*u-s*h*l,s*h*u+c*a*l,s*a*l+c*h*u,s*a*u-c*h*l);break;case Vo.ZYX:t.set(c*a*u-s*h*l,s*h*u+c*a*l,s*a*l-c*h*u,s*a*u+c*h*l);break;case Vo.YZX:t.set(c*a*u+s*h*l,s*h*u+c*a*l,s*a*l-c*h*u,s*a*u-c*h*l);break;case Vo.XZY:t.set(c*a*u-s*h*l,s*h*u-c*a*l,s*a*l+c*h*u,s*a*u+c*h*l);break;default:console.error("unknown euler order: "+o)}return t},e.toMatrix4=function(t){var e=t.elements,r=this,i=r.x,n=r.y,o=r.z,s=r.order,a=Math.cos(i*vn),u=Math.sin(i*vn),c=Math.cos(n*vn),h=Math.sin(n*vn),l=Math.cos(o*vn),f=Math.sin(o*vn);if(s===Vo.XYZ){var p=a*l,d=a*f,m=u*l,v=u*f;e[0]=c*l,e[4]=-c*f,e[8]=h,e[1]=d+m*h,e[5]=p-v*h,e[9]=-u*c,e[2]=v-p*h,e[6]=m+d*h,e[10]=a*c}else if(s===Vo.YXZ){var y=c*l,g=c*f,_=h*l,E=h*f;e[0]=y+E*u,e[4]=_*u-g,e[8]=a*h,e[1]=a*f,e[5]=a*l,e[9]=-u,e[2]=g*u-_,e[6]=E+y*u,e[10]=a*c}else if(s===Vo.ZXY){var x=c*l,T=c*f,b=h*l,A=h*f;e[0]=x-A*u,e[4]=-a*f,e[8]=b+T*u,e[1]=T+b*u,e[5]=a*l,e[9]=A-x*u,e[2]=-a*h,e[6]=u,e[10]=a*c}else if(s===Vo.ZYX){var R=a*l,S=a*f,C=u*l,O=u*f;e[0]=c*l,e[4]=C*h-S,e[8]=R*h+O,e[1]=c*f,e[5]=O*h+R,e[9]=S*h-C,e[2]=-h,e[6]=u*c,e[10]=a*c}else if(s===Vo.YZX){var M=a*c,P=a*h,I=u*c,w=u*h;e[0]=c*l,e[4]=w-M*f,e[8]=I*f+P,e[1]=f,e[5]=a*l,e[9]=-u*l,e[2]=-h*l,e[6]=P*f+I,e[10]=M-w*f}else if(s===Vo.XZY){var L=a*c,F=a*h,N=u*c,D=u*h;e[0]=c*l,e[4]=-f,e[8]=h*l,e[1]=L*f+D,e[5]=a*l,e[9]=F*f-N,e[2]=N*f-F,e[6]=u*l,e[10]=D*f+L}else console.error("toMatrix4: Invalid order "+s);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t},t.fromRotationMatrix4=function(e,r){return void 0===r&&(r=t.DEFAULT_ORDER),(new t).setFromRotationMatrix4(e,r)},t.fromQuaternion=function(e,r){return void 0===r&&(r=t.DEFAULT_ORDER),(new t).setFromQuaternion(e,r)},t.fromVector3=function(e,r){return void 0===r&&(r=t.DEFAULT_ORDER),(new t).setFromVector3(e,r)},t.fromArray=function(e,r,i){return void 0===r&&(r=0),void 0===i&&(i=t.DEFAULT_ORDER),(new t).setFromArray(e,r,i)},t}();Wo.DEFAULT_ORDER=Vo.ZYX,Wo.tempQuat0=new Cn,Wo.tempMat0=new Pn;var Zo=function(){function t(t,e,r,i,n,o,s,a,u){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=1),this.elements=[t,e,r,i,n,o,s,a,u]}var e=t.prototype;return e.set=function(t,e,r,i,n,o,s,a,u){var c=this.elements;return c[0]=t,c[3]=i,c[6]=s,c[1]=e,c[4]=n,c[7]=a,c[2]=r,c[5]=o,c[8]=u,this},e.setFromRowMajorData=function(t,e,r,i,n,o,s,a,u){var c=this.elements;return c[0]=t,c[3]=e,c[6]=r,c[1]=i,c[4]=n,c[7]=o,c[2]=s,c[5]=a,c[8]=u,this},e.setFromColumnVectors=function(t,e,r){return this.set(t.x,t.y,t.z,e.x,e.y,e.z,r.x,r.y,r.z)},e.setFromMatrix4=function(t){var e=t.elements;return this.set(e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10])},e.setFromArray=function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[e+r];return this},e.setFromQuaternion=function(t){var e=t.x,r=t.y,i=t.z,n=t.w,o=e+e,s=r+r,a=i+i,u=e*o,c=e*s,h=e*a,l=r*s,f=r*a,p=i*a,d=n*o,m=n*s,v=n*a,y=this.elements;return y[0]=1-(l+p),y[1]=c+v,y[2]=h-m,y[3]=c-v,y[4]=1-(u+p),y[5]=f+d,y[6]=h+m,y[7]=f-d,y[8]=1-(u+l),this},e.setZero=function(){for(var t=0;t<9;t++)this.elements[t]=0;return this},e.identity=function(){return this.set(1,0,0,0,1,0,0,0,1)},e.clone=function(){var e=this.elements;return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},e.copyFrom=function(t){return this.elements=[].concat(t.elements),this},e.getColumnVector=function(t,e){return e.set(this.elements[3*t],this.elements[3*t+1],this.elements[3*t+2])},e.scale=function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},e.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),i=this.elements,n=i[0],o=i[3],s=i[6],a=i[1],u=i[4],c=i[7];return i[0]=e*n+r*a,i[3]=e*o+r*u,i[6]=e*s+r*c,i[1]=-r*n+e*a,i[4]=-r*o+e*u,i[7]=-r*s+e*c,this},e.translate=function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},e.multiply=function(t){if("number"==typeof t){for(var e=0;e<9;e++)this.elements[e]*=t;return this}return this.multiplyMatrices(this,t)},e.premultiply=function(t){return this.multiplyMatrices(t,this)},e.multiplyMatrices=function(t,e){var r=t.elements,i=e.elements,n=this.elements,o=r[0],s=r[3],a=r[6],u=r[1],c=r[4],h=r[7],l=r[2],f=r[5],p=r[8],d=i[0],m=i[3],v=i[6],y=i[1],g=i[4],_=i[7],E=i[2],x=i[5],T=i[8];return n[0]=o*d+s*y+a*E,n[3]=o*m+s*g+a*x,n[6]=o*v+s*_+a*T,n[1]=u*d+c*y+h*E,n[4]=u*m+c*g+h*x,n[7]=u*v+c*_+h*T,n[2]=l*d+f*y+p*E,n[5]=l*m+f*g+p*x,n[8]=l*v+f*_+p*T,this},e.determinant=function(){var t=this.elements,e=t[0],r=t[3],i=t[6],n=t[1],o=t[4],s=t[7],a=t[2],u=t[5],c=t[8];return e*(o*c-u*s)+n*(u*i-r*c)+a*(r*s-o*i)},e.invert=function(){var t=this.elements,e=t[0],r=t[3],i=t[6],n=t[1],o=t[4],s=t[7],a=t[2],u=t[5],c=t[8],h=c*o-u*s,l=u*i-c*r,f=s*r-o*i,p=e*h+n*l+a*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var d=1/p;return t[0]=h*d,t[1]=(a*s-c*n)*d,t[2]=(u*n-a*o)*d,t[3]=l*d,t[4]=(c*e-a*i)*d,t[5]=(a*r-u*e)*d,t[6]=f*d,t[7]=(n*i-s*e)*d,t[8]=(o*e-n*r)*d,this},e.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},e.transformPoint=function(t,e){var r=t.x,i=t.y,n=t.z,o=this.elements,s=null!=e?e:t;return s.x=o[0]*r+o[3]*i+o[6]*n,s.y=o[1]*r+o[4]*i+o[7]*n,s.z=o[2]*r+o[5]*i+o[8]*n,s},e.transformNormal=function(t,e){return this.transformPoint(t,e).normalize()},e.equals=function(t){for(var e=this.elements,r=t.elements,i=0;i<9;i++)if(!_n(e[i],r[i]))return!1;return!0},e.toArray=function(){return[].concat(this.elements)},e.fill=function(t,e){void 0===e&&(e=0);var r=this.elements;t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8]},t.fromIdentity=function(){return new t(1,0,0,0,1,0,0,0,1)},t.fromColumnVectors=function(e,r,i){return(new t).setFromColumnVectors(e,r,i)},t.fromMatrix4=function(e){return(new t).setFromMatrix4(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t.fromQuaternion=function(e){return(new t).setFromQuaternion(e)},t.fromRowMajorData=function(e,r,i,n,o,s,a,u,c){return new t(e,n,a,r,o,u,i,s,c)},t}(),qo=function(){function t(t,e){void 0===t&&(t=bn.ZERO),void 0===e&&(e=bn.X),this.origin=new bn,this.direction=new bn,this.origin.copyFrom(t),this.direction.copyFrom(e).normalize()}var e=t.prototype;return e.set=function(t,e){return this.origin.copyFrom(t),this.direction.copyFrom(e).normalize(),this},e.clone=function(){return new t(this.origin,this.direction)},e.copyFrom=function(t){return this.set(t.origin,t.direction)},e.recast=function(e){return this.origin.copyFrom(this.at(e,t.tempVec0)),this},e.at=function(t,e){var r=e||new bn;return r.copyFrom(this.origin),r.addScaledVector(this.direction,t)},e.equals=function(t){return this.origin.equals(t.origin)&&this.direction.equals(t.direction)},e.applyMatrix=function(t){return this.origin.applyProjectionMatrix(t),this.direction.applyNormalMatrix(t),this},e.intersectBox=function(t,e){var r,i,n,o,s,a,u=this.origin,c=u.x,h=u.y,l=u.z,f=this.direction,p=f.x,d=f.y,m=f.z,v=t.min,y=v.x,g=v.y,_=v.z,E=t.max,x=E.x,T=E.y,b=E.z,A=1/p,R=1/d,S=1/m;if(A>=0?(r=(y-c)*A,i=(x-c)*A):(r=(x-c)*A,i=(y-c)*A),R>=0?(n=(g-h)*R,o=(T-h)*R):(n=(T-h)*R,o=(g-h)*R),!(r>o||n>i||((n>r||r!=r)&&(r=n),(o<i||i!=i)&&(i=o),(n>r||r!=r)&&(r=n),(o<i||i!=i)&&(i=o),S>=0?(s=(_-l)*S,a=(b-l)*S):(s=(b-l)*S,a=(_-l)*S),r>a||s>i||((s>r||r!=r)&&(r=s),(a<i||i!=i)&&(i=a),i<0))))return r>=0?this.at(r,e):this.at(i,e)},e.intersectPlane=function(t,e){var r=t.normal,i=t.distance,n=r.dot(this.direction);if(0===n)return 0===r.dot(this.origin)+i?(e||new bn).copyFrom(this.origin):void 0;var o=-(this.origin.dot(r)+i)/n;return o>=0?this.at(o,e):void 0},e.intersectSphere=function(e,r){var i=e.center,n=t.tempVec0.subtractVectors(i,this.origin),o=n.dot(this.direction),s=n.dot(n)-o*o,a=e.radius*e.radius;if(!(s>a)){var u=Math.sqrt(a-s),c=o-u,h=o+u;if(!(h<0))return c>=0?this.at(c,r):this.at(h,r)}},e.intersectTriangle=function(e,r,i){var n,o=e.p0,s=e.p1,a=e.p2,u=t.tempVec0.subtractVectors(s,o),c=t.tempVec1.subtractVectors(a,o),h=t.tempVec2.subtractVectors(this.origin,o),l=t.tempVec3.crossVectors(u,c),f=this.direction.dot(l);if(f>0){if(i)return;n=1}else{if(!(f<0))return;n=-1,f=-f}c.crossVectors(h,c);var p=n*this.direction.dot(c);if(!(p<0)){u.cross(h);var d=n*this.direction.dot(u);if(!(d<0||p+d>f)){var m=-n*h.dot(l);if(!(m<0))return this.at(m/f,r)}}},t}();qo.tempVec0=new bn,qo.tempVec1=new bn,qo.tempVec2=new bn,qo.tempVec3=new bn;var Ko=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),this.r=t,this.g=e,this.b=r,this.a=i}var e=t.prototype;return e.set=function(t,e,r,i){return this.r=t,this.g=e,this.b=r,this.a=i,this},e.setZero=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this},e.setFromNumber=function(t){return this.r=t,this.g=t,this.b=t,this.a=t,this},e.setFromVector4=function(t){return this.r=t.x,this.g=t.y,this.b=t.z,this.a=t.w,this},e.setFromArray=function(t,e){var r,i,n,o;return void 0===e&&(e=0),this.r=null!=(r=t[e])?r:0,this.g=null!=(i=t[e+1])?i:0,this.b=null!=(n=t[e+2])?n:0,this.a=null!=(o=t[e+3])?o:0,this},e.setFromHSV=function(t,e,r,i){void 0===i&&(i=1);var n=r*e,o=t/60,s=n*(1-Math.abs(o%2-1)),a=0,u=0,c=0;o>=0&&o<=1?(a=n,u=s):o>=1&&o<=2?(a=s,u=n):o>=2&&o<=3?(u=n,c=s):o>=3&&o<=4?(u=s,c=n):o>=4&&o<=5?(a=s,c=n):o>=5&&o<=6&&(a=n,c=s);var h=r-n;return this.set(a+h,u+h,c+h,i)},e.setFromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return this;var e=parseInt(t.substring(1,3),16)/255,r=parseInt(t.substring(3,5),16)/255,i=parseInt(t.substring(5,7),16)/255,n=9===t.length?parseInt(t.substring(7,9),16)/255:1;return this.set(e,r,i,n)},e.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},e.clone=function(){return new t(this.r,this.g,this.b,this.a)},e.setElement=function(t,e){switch(t){case 0:this.r=e;break;case 1:this.g=e;break;case 2:this.b=e;break;case 3:this.a=e;break;default:console.error("index is out of range: "+t)}return this},e.getElement=function(t){switch(t){case 0:return this.r;case 1:return this.g;case 2:return this.b;case 3:return this.a;default:console.error("index is out of range: "+t)}return 0},e.add=function(t){return"number"==typeof t?(this.r+=t,this.g+=t,this.b+=t,this.a+=t):hr(t,Array)?(this.r+=t[0],this.g+=t[1],this.b+=t[2],this.a+=t[3]):(this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a),this},e.subtract=function(t){return"number"==typeof t?(this.r-=t,this.g-=t,this.b-=t,this.a-=t):hr(t,Array)?(this.r-=t[0],this.g-=t[1],this.b-=t[2],this.a-=t[3]):(this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a),this},e.multiply=function(t){return"number"==typeof t?(this.r*=t,this.g*=t,this.b*=t,this.a*=t):hr(t,Array)?(this.r*=t[0],this.g*=t[1],this.b*=t[2],this.a*=t[3]):(this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a),this},e.divide=function(t){return"number"==typeof t?(this.r/=t,this.g/=t,this.b/=t,this.a/=t):hr(t,Array)?(this.r/=t[0],this.g/=t[1],this.b/=t[2],this.a/=t[3]):(this.r/=t.r,this.g/=t.g,this.b/=t.b,this.a/=t.a),this},e.scale=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},e.min=function(t){return"number"==typeof t?(this.r=Math.min(this.r,t),this.g=Math.min(this.g,t),this.b=Math.min(this.b,t),this.a=Math.min(this.a,t)):(this.r=Math.min(this.r,t.r),this.g=Math.min(this.g,t.g),this.b=Math.min(this.b,t.b),this.a=Math.min(this.a,t.a)),this},e.max=function(t){return"number"==typeof t?(this.r=Math.max(this.r,t),this.g=Math.max(this.g,t),this.b=Math.max(this.b,t),this.a=Math.max(this.a,t)):(this.r=Math.max(this.r,t.r),this.g=Math.max(this.g,t.g),this.b=Math.max(this.b,t.b),this.a=Math.max(this.a,t.a)),this},e.clamp=function(t,e){return this.max(t).min(e)},e.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this.a+=(t.a-this.a)*e,this},e.luminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.equals=function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a},e.toLinear=function(){return this.r=t.gammaToLinear(this.r),this.g=t.gammaToLinear(this.g),this.b=t.gammaToLinear(this.b),this},e.toGamma=function(){return this.r=t.linearToGamma(this.r),this.g=t.linearToGamma(this.g),this.b=t.linearToGamma(this.b),this},e.toArray=function(){return[this.r,this.g,this.b,this.a]},e.toVector4=function(){return new An(this.r,this.g,this.b,this.a)},e.toHSV=function(){var e=this,r=e.r,i=e.g,n=e.b,o=e.a,s=Math.max(r,i,n),a=Math.min(r,i,n),u=s-a,c=0,h=0;return 0!==s&&(h=u/s),s!=a&&(s==r?(c=(i-n)/u,i<n&&(c+=6)):s==i?c=(n-r)/u+2:s==n&&(c=(r-i)/u+4),c*=60),new t(c,h,s,o)},e.toHexString=function(e){void 0===e&&(e=!0);var r=t.ToHex(Math.round(255*this.r)),i=t.ToHex(Math.round(255*this.g)),n=t.ToHex(Math.round(255*this.b)),o=t.ToHex(Math.round(255*this.a));return e?"#"+r+i+n+o:"#"+r+i+n},e.fill=function(t,e){void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t[e+3]=this.a},t.fromNumber=function(e){return(new t).setFromNumber(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t.fromHexString=function(e){return(new t).setFromHexString(e)},t.fromHSV=function(e,r,i,n){return void 0===n&&(n=1),(new t).setFromHSV(e,r,i,n)},t.gammaToLinear=function(t){return t<=0?0:t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},t.linearToGamma=function(t){return t<=0?0:t<.0031308?12.92*t:t<1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},t.ToHex=function(t){var e=t.toString(16);return t<=15?("0"+e).toUpperCase():e.toUpperCase()},t}();Ko.BLACK=new Ko(0,0,0,1),Ko.BLUE=new Ko(0,0,1,1),Ko.CLEAR=new Ko(0,0,0,0),Ko.CYAN=new Ko(0,1,1,1),Ko.GRAY=new Ko(.5,.5,.5,1),Ko.GREEN=new Ko(0,1,0,1),Ko.MAGENTA=new Ko(1,0,1,1),Ko.RED=new Ko(1,0,0,1),Ko.WHITE=new Ko(1,1,1,1),Ko.YELLOW=new Ko(1,.92,.016,1);var Qo,Jo,$o=function(){function t(t,e){void 0===t&&(t=new bn(1/0,1/0,1/0)),void 0===e&&(e=new bn(-1/0,-1/0,-1/0)),this.min=t.clone(),this.max=e.clone()}var e=t.prototype;return e.set=function(t,e){return this.min.copyFrom(t),this.max.copyFrom(e),this},e.setFromArray=function(t){for(var e=Number(1/0),r=Number(1/0),i=Number(1/0),n=-1/0,o=-1/0,s=-1/0,a=0,u=t.length;a<u;a+=3){var c=t[a],h=t[a+1],l=t[a+2];c<e&&(e=c),h<r&&(r=h),l<i&&(i=l),c>n&&(n=c),h>o&&(o=h),l>s&&(s=l)}return this.min.set(e,r,i),this.max.set(n,o,s),this},e.setFromPoints=function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},e.setFromCenterAndSize=function(t,e){var r=e.clone().multiply(.5);return this.min.copyFrom(t).subtract(r),this.max.copyFrom(t).add(r),this},e.setFromObject=function(t){return this.makeEmpty(),this.expandByObject(t)},e.clone=function(){return(new t).copyFrom(this)},e.copyFrom=function(t){return this.min.copyFrom(t.min),this.max.copyFrom(t.max),this},e.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=Number(1/0),this.max.x=this.max.y=this.max.z=-1/0,this},e.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},e.getCenter=function(t){return void 0===t&&(t=new bn),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiply(.5)},e.getSize=function(t){return void 0===t&&(t=new bn),this.isEmpty()?t.set(0,0,0):t.subtractVectors(this.max,this.min)},e.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},e.expandByVector=function(t){return this.min.subtract(t),this.max.add(t),this},e.expandByScalar=function(t){return this.min.add(-t),this.max.add(t),this},e.expandByBox=function(t){return this.min.min(t.min),this.max.max(t.max),this},e.expandByObject=function(e){e.updateWorldMatrix(!1,!1);var r=e.geometry;if(void 0!==r){null===r.boundingBox&&r.computeBoundingBox();var i=new t;i.copyFrom(r.boundingBox),i.applyMatrix4(e.matrixWorld),this.union(i)}for(var n=e.children,o=0,s=n.length;o<s;o++)this.expandByObject(n[o]);return this},e.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},e.containsBox=function(t){return this.min.x<=t.min.x&&this.max.x>=t.max.x&&this.min.y<=t.min.y&&this.max.y>=t.max.y&&this.min.z<=t.min.z&&this.max.z>=t.max.z},e.getParameter=function(t,e){return void 0===e&&(e=new bn),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},e.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},e.intersectsSphere=function(t){var e=new bn;return this.clampPoint(t.center,e),e.distanceSquared(t.center)<=t.radius*t.radius},e.clampPoint=function(t,e){return void 0===e&&(e=new bn),e.copyFrom(t).clamp(this.min,this.max)},e.distanceToPoint=function(t){return t.clone().clamp(this.min,this.max).subtract(t).length()},e.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},e.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},e.applyMatrix4=function(t,e){if(void 0===e&&(e=new bn),this.isEmpty())return this;var r=this.getOBBPoints(t,e);return this.setFromPoints(r),this},e.getOBBPoints=function(t,e){if(void 0===e&&(e=new bn),this.isEmpty())return[];var r=[];return r[0]=new bn(this.min.x,this.min.y,this.min.z),r[1]=new bn(this.min.x,this.min.y,this.max.z),r[2]=new bn(this.min.x,this.max.y,this.min.z),r[3]=new bn(this.min.x,this.max.y,this.max.z),r[4]=new bn(this.max.x,this.min.y,this.min.z),r[5]=new bn(this.max.x,this.min.y,this.max.z),r[6]=new bn(this.max.x,this.max.y,this.min.z),r[7]=new bn(this.max.x,this.max.y,this.max.z),r.forEach((function(r){r.subtract(e),r.applyMatrix(t),r.add(e)})),r},e.getBoundingSphere=function(t){this.getCenter(t.center);var e=new bn;return t.radius=.5*this.getSize(e).length(),t},e.translate=function(t){return this.min.add(t),this.max.add(t),this},e.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},t}(),ts=function(){function t(t,e){void 0===t&&(t=bn.ZERO),void 0===e&&(e=-1),this.center=t.clone(),this.radius=e}var e=t.prototype;return e.set=function(t,e){return this.center.copyFrom(t),this.radius=e,this},e.setFromPoints=function(t,e){var r=this.center;if(void 0!==e){r.copyFrom(e);for(var i=0,n=0;n<t.length;n++)i=Math.max(i,r.distanceSquared(t[n]));this.radius=Math.sqrt(i)}else{var o=(new $o).setFromPoints(t);o.getCenter(r),this.radius=o.getSize().length()/2}return this},e.copyFrom=function(t){return this.center.copyFrom(t.center),this.radius=t.radius,this},e.isEmpty=function(){return this.radius<0},e.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},e.containsPoint=function(t){return t.distanceSquared(this.center)<=this.radius*this.radius},e.distanceToPoint=function(t){return t.distance(this.center)-this.radius},e.intersectsSphere=function(t){var e=this.radius+t.radius;return t.center.distanceSquared(this.center)<=e*e},e.intersectsBox=function(t){return t.intersectsSphere(this)},e.clampPoint=function(t,e){var r=this.center.distanceSquared(t);return void 0===e&&(e=new bn),e.copyFrom(t),r>this.radius*this.radius&&(e.subtract(this.center).normalize(),e.multiply(this.radius).add(this.center)),e},e.getBoundingBox=function(t){return void 0===t&&(t=new $o),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},e.applyMatrix4=function(t){var e=t.elements,r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10],o=Math.sqrt(Math.max(r,i,n));return this.center.applyMatrix(t),this.radius=this.radius*o,this},e.translate=function(t){return this.center.add(t),this},e.expandByPoint=function(t){var e=(new bn).subtractVectors(t,this.center),r=e.lengthSquared();if(r>this.radius*this.radius){var i=Math.sqrt(r),n=.5*(i-this.radius);this.center.add(e.multiply(n/i)),this.radius+=n}return this},e.union=function(t){var e=new bn,r=new bn;return r.subtractVectors(t.center,this.center).normalize().multiply(t.radius),this.expandByPoint(e.copyFrom(t.center).add(r)),this.expandByPoint(e.copyFrom(t.center).subtract(r)),this},e.intersect=function(t){var e=(new bn).subtractVectors(this.center,t.center),r=e.length();return r>this.radius+t.radius?this.makeEmpty():(this.center=this.center.add(e.normalize().multiply(r/2)),this.radius=this.radius+t.radius-r,this)},e.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius},e.clone=function(){return(new t).copyFrom(this)},t}(),es=Object.freeze({__proto__:null,get EulerOrder(){return Vo},Euler:Wo,Quaternion:Cn,Vector2:Tn,Vector3:bn,Vector4:An,Matrix3:Zo,Matrix4:Pn,Ray:qo,PI2:mn,DEG2RAD:vn,RAD2DEG:yn,NumberEpsilon:gn,isZero:function(t){return isNaN(t)||Math.abs(t)<gn},isEqual:_n,damp:function(t,e,r,i){return En(t,e,1-Math.exp(-r*i))},lerp:En,degToRad:function(t){return t*vn},radToDeg:function(t){return t*yn},clamp:xn,Color:Ko,Box3:$o,Sphere:ts}),rs=1,is=function(t){function e(e,r){var i;if((i=t.call(this,e)||this).destroyed=!1,i.visible=!0,r){var n=r.material,o=r.geometry,s=r.name,a=void 0===s?"<unnamed>":s,u=r.priority,c=void 0===u?0:u,h=r.worldMatrix,l=void 0===h?Pn.fromIdentity():h;i.id="Mesh"+rs++,i.name=a,i.geometry=o,i.material=n,i.priority=c,i.worldMatrix=l}else i.id="Mesh"+rs++,i.name="<unnamed>",i.worldMatrix=Pn.fromIdentity(),i._priority=0;return i}Ri(e,t);var r=e.prototype;return r.setVisible=function(t){this.visible=t},r.getVisible=function(){return this.visible},r.render=function(t){this.isDestroyed||this.getVisible()&&(t.renderingData.currentFrame.globalUniforms&&t.setGlobalMatrix("effects_ObjectToWorld",this.worldMatrix),t.drawGeometry(this.geometry,this.material))},r.firstGeometry=function(){return this.geometry},r.setMaterial=function(t,e){e!==exports.DestroyOptions.keep&&this.material.dispose(e),this.material=t},r.restore=function(){},r.dispose=function(t){if(!this.destroyed){(null==t?void 0:t.geometries)!==exports.DestroyOptions.keep&&this.geometry.dispose();var e=null==t?void 0:t.material;e!==exports.DestroyOptions.keep&&this.material.dispose(e),this.destroyed=!0,void 0!==this.engine&&(this.engine.removeMesh(this),this.engine=void 0)}},nn(e,[{key:"isDestroyed",get:function(){return this.destroyed}}]),e}(dn),ns=1e3;exports.RenderPassAttachmentStorageType=void 0,(Qo=exports.RenderPassAttachmentStorageType||(exports.RenderPassAttachmentStorageType={}))[Qo.none=0]="none",Qo[Qo.color=1]="color",Qo[Qo.stencil_8_opaque=2]="stencil_8_opaque",Qo[Qo.depth_16_opaque=3]="depth_16_opaque",Qo[Qo.depth_stencil_opaque=4]="depth_stencil_opaque",Qo[Qo.depth_16_texture=5]="depth_16_texture",Qo[Qo.depth_24_stencil_8_texture=6]="depth_24_stencil_8_texture",exports.TextureStoreAction=void 0,(Jo=exports.TextureStoreAction||(exports.TextureStoreAction={}))[Jo.store=0]="store",Jo[Jo.clear=2]="clear";var os,ss=function(){function t(t,e){if(this.destroyed=!1,e){var r=e.texture,i=e.size;if(hr(r,bo))this.texture=r,this.externalTexture=!0;else if(r){var n=r.wrapT,o=r.wrapS,s=r.minFilter,a=r.magFilter,u=r.internalFormat,c=r.format,h=void 0===c?jn.RGBA:c,l=r.type,f=void 0===l?jn.UNSIGNED_BYTE:l;this.externalTexture=!1,this.textureOptions={size:i,format:h,type:f,internalFormat:u||h,wrapT:n,wrapS:o,minFilter:s,magFilter:a,name:e.name},this.texture=bo.create(t,to({},this.textureOptions,{sourceType:exports.TextureSourceType.framebuffer,data:{width:i[0],height:i[1]}}))}}}return t.prototype.dispose=function(){this.destroyed||(this.texture.dispose(),this.destroyed=!0)},nn(t,[{key:"isDestroyed",get:function(){return this.destroyed}},{key:"storageType",get:function(){return 1}},{key:"size",get:function(){var t=this.texture;return t?[t.getWidth(),t.getHeight()]:[0,0]}},{key:"width",get:function(){return this.texture.getWidth()||0}},{key:"height",get:function(){return this.texture.getHeight()||0}}]),t}();exports.RenderPassDestroyAttachmentType=void 0,(os=exports.RenderPassDestroyAttachmentType||(exports.RenderPassDestroyAttachmentType={}))[os.force=0]="force",os[os.keep=1]="keep",os[os.keepExternal=2]="keepExternal",os[os.destroy=0]="destroy";var as=1,us=function(){function t(t,e){this.attachments=[],this.destroyed=!1,this.initialized=!1;var r=e.name,i=void 0===r?"RenderPass_"+as++:r,n=e.clearAction,o=e.semantics,s=e.depthStencilAttachment,a=e.storeAction,u=e.priority,c=void 0===u?0:u,h=e.meshOrder,l=void 0===h?exports.OrderType.ascending:h,f=e.meshes,p=void 0===f?[]:f,d=e.delegate,m=void 0===d?{}:d;this.name=i,this.renderer=t,this.priority=c,this.meshOrder=l,this.meshes=Vr(p.slice(),this.meshOrder),this.depthStencilType=(null==s?void 0:s.storageType)||0,this.clearAction=to({},n),this.storeAction=to({colorAction:0,depthAction:0,stencilAction:0},a),this.semantics=new Xo(o),this.options=e,this.delegate=m,this.setViewportOptions(e)}var e=t.prototype;return e.addMesh=function(t){Ur(this.meshes,t,this.meshOrder)},e.removeMesh=function(t){Tr(this.meshes,t)},e.setMeshes=function(t){var e;return this.meshes.length=0,(e=this.meshes).splice.apply(e,[].concat([0,0],t)),Vr(this.meshes,this.meshOrder),this.meshes},e.getInitAttachments=function(){return this.attachments.length>0?this.attachments:this.options.attachments},e.configure=function(t){if(this.framebuffer)t.setFramebuffer(this.framebuffer);else{var e=this.getViewport(),r=e[0],i=e[1],n=e[2],o=e[3];t.setViewport(r,i,n,o)}},e.execute=function(t){t.clear(this.clearAction),t.renderMeshes(this.meshes),t.clear(this.storeAction)},e.frameCleanup=function(t){},e.resetColorAttachments=function(t){var e=this;if(t.length||this.resetAttachments({attachments:[]}),this.attachments.length){var r=t.map((function(t){return t.updateSource({sourceType:exports.TextureSourceType.framebuffer}),new ss(e.renderer.engine,{texture:t})}));this.attachments.forEach((function(t){return!t.externalTexture&&t.dispose()})),this.attachments=r,this.framebuffer&&(this.framebuffer.bind(),this.framebuffer.resetColorTextures(t.map((function(t){return t}))))}else this.resetAttachments({attachments:t.map((function(t){return{texture:t}}))})},e.resetAttachments=function(t){this.options=t,this.setViewportOptions(t),this.renderer&&this._resetAttachments()},e.setViewportOptions=function(t){if(t.viewport){if(this.isCustomViewport=!0,this.viewportScale=1,this.customViewport=t.viewport.slice(0,4),this.framebuffer){var e=this.customViewport;this.framebuffer.isCustomViewport=!1,this.framebuffer.resize(e[0],e[1],e[2],e[3])}}else this.isCustomViewport=!1,this.viewportScale=t.viewportScale||1,this.framebuffer&&(this.framebuffer.isCustomViewport=!0,this.framebuffer.viewportScale=this.viewportScale)},e._resetAttachments=function(){var t,e,r=this,i=this.renderer,n=this.options;this.attachments.length&&(this.attachments.forEach((function(t){return!t.externalTexture&&t.dispose()})),this.attachments.length=0,null==(e=this.framebuffer)||e.dispose({depthStencilAttachment:2}),this.framebuffer=null);var o=this.viewportScale,s=this.isCustomViewport?this.customViewport:[0,0,i.getWidth()*o,i.getHeight()*o],a=[s[2],s[3]],u=this.name;if(null==(t=n.attachments)?void 0:t.length){var c=n.attachments.map((function(t,e){var i;return new ss(r.renderer.engine,to({size:a,name:(null==(i=t.texture)?void 0:i.name)||u+"##color_"+e},t))}));this.attachments=c;var h=Xs.create({storeAction:this.storeAction,name:u,viewport:s,viewportScale:this.viewportScale,isCustomViewport:this.isCustomViewport,attachments:c.map((function(t){return t.texture})),depthStencilAttachment:n.depthStencilAttachment||{storageType:0}},i);h.bind(),h.unbind(),this.framebuffer=h}else this.attachments.length=0},e.getViewport=function(){var t,e=(null==(t=this.framebuffer)?void 0:t.viewport)||this.customViewport;if(e)return e;var r=this.renderer,i=this.viewportScale;return r?[0,0,r.getWidth()*i,r.getHeight()*i]:[0,0,0,0]},e.getDepthAttachment=function(){var t=this.framebuffer;if(t){var e=t.getDepthTexture(),r=e?this.getDepthTexture(e,t.externalStorage):void 0;return{storageType:t.depthStencilStorageType,storage:t.depthStorage,texture:r}}},e.getStencilAttachment=function(){var t=this.framebuffer;if(t){var e=t.getStencilTexture(),r=e?this.getDepthTexture(e,t.externalStorage):void 0;return{storageType:t.depthStencilStorageType,storage:t.stencilStorage,texture:r}}},e.getDepthTexture=function(t,e){if(!this.depthTexture){var r,i=null==(r=this.options.depthStencilAttachment)?void 0:r.texture,n=t===i?i:t;return e||(this.depthTexture=n),n}return this.depthTexture},e.getStencilTexture=function(t,e){if(!this.stencilTexture){var r,i=null==(r=this.options.depthStencilAttachment)?void 0:r.texture,n=t===i?i:t;return e||(this.stencilTexture=n),n}return this.stencilTexture},e.initialize=function(t){return this.initialized||(this._resetAttachments(),this.initialized=!0),this},e.dispose=function(t){if(!this.destroyed){var e=(null==t?void 0:t.meshes)||void 0;e!==exports.DestroyOptions.keep&&this.meshes.forEach((function(t){t.dispose(e)})),this.meshes.length=0;var r=(null==t?void 0:t.colorAttachment)?t.colorAttachment:0;this.attachments.forEach((function(t){t.externalTexture&&2===r||1===r||t.dispose()})),this.attachments.length=0,(null==t?void 0:t.semantics)!==exports.DestroyOptions.keep&&this.semantics.dispose(),this.destroyed=!0;var i,n,o=(null==t?void 0:t.depthStencilAttachment)?t.depthStencilAttachment:0,s=this.framebuffer;if(s)if(s.dispose({depthStencilAttachment:o}),!(s.externalStorage&&2===o||1===o))null==(i=this.stencilTexture)||i.dispose(),null==(n=this.depthTexture)||n.dispose();this.options=this.renderer=null,this.initialize=ti}},nn(t,[{key:"isDestroyed",get:function(){return this.destroyed}},{key:"viewport",get:function(){return this.getViewport()}},{key:"stencilAttachment",get:function(){return this.getStencilAttachment()}},{key:"depthAttachment",get:function(){return this.getDepthAttachment()}}]),t}(),cs="#version 100\nprecision highp float;vec4 blendColor(vec4 color,vec4 vc,float mode){vec4 ret=color*vc;float alpha=ret.a;if(mode==1.){ret.rgb*=alpha;}else if(mode==2.){ret.rgb*=alpha;ret.a=dot(ret.rgb,vec3(0.33333333));}else if(mode==3.){alpha=color.r*alpha;ret=vec4(vc.rgb*alpha,alpha);}return ret;}varying vec4 vColor;varying vec4 vTexCoord;varying highp vec2 vParams;uniform vec3 uFrameColor;void main(){gl_FragColor=vec4(uFrameColor.xyz,1.0);}",hs="precision highp float;attribute vec2 atlasOffset;attribute vec3 aPos;varying vec2 vTexCoord;varying vec3 vParams;varying vec4 vColor;uniform vec2 _Size;uniform vec3 _Scale;uniform vec4 _Color;uniform vec4 _TexParams;uniform vec4 _TexOffset;uniform mat4 effects_MatrixVP;uniform mat4 effects_ObjectToWorld;uniform mat4 effects_MatrixV;\n#ifdef ENV_EDITOR\nuniform vec4 uEditorTransform;\n#endif\nvoid main(){vec4 texParams=_TexParams;vTexCoord=vec2(atlasOffset.xy*_TexOffset.zw+_TexOffset.xy);vColor=_Color;vParams=vec3(0.0,texParams.y,texParams.x);if(texParams.z==1.0){vec4 pos=vec4(aPos.xy*_Size,aPos.z,1.0);gl_Position=effects_MatrixVP*effects_ObjectToWorld*pos;}else{mat4 view=effects_MatrixV;vec3 camRight=vec3(view[0][0],view[1][0],view[2][0]);vec3 camUp=vec3(view[0][1],view[1][1],view[2][1]);vec3 worldPosition=vec3(effects_ObjectToWorld*vec4(0.0,0.0,0.0,1.0));vec3 vertexPosition=worldPosition+camRight*aPos.x*_Size.x*_Scale.x+camUp*aPos.y*_Size.y*_Scale.y;gl_Position=effects_MatrixVP*vec4(vertexPosition,1.0);}\n#ifdef ENV_EDITOR\ngl_Position=vec4(gl_Position.xy*uEditorTransform.xy+uEditorTransform.zw*gl_Position.w,gl_Position.zw);\n#endif\n}",ls="precision highp float;varying vec4 vColor;varying vec2 vTexCoord;varying vec3 vParams;uniform sampler2D _MainTex;vec4 blendColor(vec4 color,vec4 vc,float mode){vec4 ret=color*vc;float alpha=ret.a;if(mode==1.){ret.rgb*=alpha;}else if(mode==2.){ret.rgb*=alpha;ret.a=dot(ret.rgb,vec3(0.33333333));}else if(mode==3.){alpha=color.r*alpha;ret=vec4(vc.rgb*alpha,alpha);}return ret;}void main(){vec4 color=vec4(0.);vec4 texColor=texture2D(_MainTex,vTexCoord.xy);color=blendColor(texColor,vColor,floor(0.5+vParams.y));\n#ifdef ALPHA_CLIP\nif(vParams.z==0.&&color.a<0.04){discard;}\n#endif\ncolor.a=clamp(color.a,0.0,1.0);gl_FragColor=color;}",fs="#version 100\nprecision mediump float;vec4 blendColor(vec4 color,vec4 vc,float mode){vec4 ret=color*vc;float alpha=ret.a;if(mode==1.){ret.rgb*=alpha;}else if(mode==2.){ret.rgb*=alpha;ret.a=dot(ret.rgb,vec3(0.33333333));}else if(mode==3.){alpha=color.r*alpha;ret=vec4(vc.rgb*alpha,alpha);}return ret;}\n#define PATICLE_SHADER 1\nvarying float vLife;varying vec2 vTexCoord;varying vec4 vColor;uniform vec3 emissionColor;uniform float emissionIntensity;uniform sampler2D uMaskTex;uniform vec4 uColorParams;uniform vec2 uTexOffset;\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\n#ifdef USE_SPRITE\nvarying vec4 vTexCoordBlend;\n#endif\nvarying float vSeed;\n#ifdef PREVIEW_BORDER\nuniform vec4 uPreviewColor;\n#endif\n#ifdef USE_SPRITE\nvec4 getTextureColor(sampler2D tex,vec2 texCoord){if(vTexCoordBlend.w>0.){return mix(texture2D(tex,texCoord),texture2D(tex,vTexCoordBlend.xy+texCoord),vTexCoordBlend.z);}return texture2D(tex,texCoord);}\n#else\n#define getTextureColor texture2D\n#endif\n#ifndef WEBGL2\n#define round(a) floor(0.5+a)\n#endif\n#ifdef PREVIEW_BORDER\nvoid main(){gl_FragColor=uPreviewColor;}\n#else\nvoid main(){vec4 color=vec4(1.0);vec4 tempColor=vColor;vec2 texOffset=uTexOffset;if(vLife<0.){discard;}if(uColorParams.x>0.0){color=getTextureColor(uMaskTex,vTexCoord);}\n#ifdef COLOR_OVER_LIFETIME\n#ifndef ENABLE_VERTEX_TEXTURE\ntempColor*=texture2D(uColorOverLifetime,vec2(vLife,0.));\n#endif\n#endif\ncolor=blendColor(color,tempColor,round(uColorParams.y));if(color.a<=0.01&&uColorParams.w>0.){float _at=texture2D(uMaskTex,vTexCoord+texOffset).a+texture2D(uMaskTex,vTexCoord+texOffset*-1.).a;if(_at<=0.02){discard;}}vec3 emission=emissionColor*pow(2.0,emissionIntensity);color=vec4(pow(pow(color.rgb,vec3(2.2))+emission,vec3(1.0/2.2)),color.a);gl_FragColor=color;}\n#endif\n",ps="#version 100\nprecision mediump float;\n#define SHADER_VERTEX 1\n#define PATICLE_SHADER 1\n#ifdef SHADER_VERTEX\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n#define CURVE_VALUE_ARRAY uVCurveValues\n#define CURVE_VALUE_COUNT VERT_CURVE_VALUE_COUNT\n#define FRAG_CURVE_VALUE_COUNT 0\n#else\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n#define CURVE_VALUE_ARRAY uFCurveValues\n#define CURVE_VALUE_COUNT FRAG_CURVE_VALUE_COUNT\n#define VERT_CURVE_VALUE_COUNT 0\n#endif\n#if CURVE_VALUE_COUNT > 0\n#if LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n#endif\n#else\n#define lookup_curve(i) vec4(0.)\n#endif\n#ifdef WEBGL2\n#define ITR_END (count + 1)\n#else\n#define ITR_END MAX_C\n#endif\n#define NONE_CONST_INDEX 1\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#endif\n#ifdef SHADER_VERTEX\n#define MAX_C VERT_MAX_KEY_FRAME_COUNT\n#else\n#define MAX_C FRAG_MAX_KEY_FRAME_COUNT\n#endif\nmat4 cubicBezierMatrix=mat4(1.0,-3.0,3.0,-1.0,0.0,3.0,-6.0,3.0,0.0,0.0,3.0,-3.0,0.0,0.0,0.0,1.0);float cubicBezier(float t,float y1,float y2,float y3,float y4){vec4 tVec=vec4(1.0,t,t*t,t*t*t);vec4 yVec=vec4(y1,y2,y3,y4);vec4 result=tVec*cubicBezierMatrix*yVec;return result.x+result.y+result.z+result.w;}float binarySearchT(float x,float x1,float x2,float x3,float x4){float left=0.0;float right=1.0;float mid=0.0;float computedX;for(int i=0;i<8;i++){mid=(left+right)*0.5;computedX=cubicBezier(mid,x1,x2,x3,x4);if(abs(computedX-x)<0.0001){break;}else if(computedX>x){right=mid;}else{left=mid;}}return mid;}float valueFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);for(int i=0;i<ITR_END;i+=2){if(i>=count){break;}vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return k0.y;}if(i==int(frameCount-2.)&&time>=k1.x){return k1.y;}if(time>=k0.x&&time<=k1.x){float t=(time-k0.x)/(k1.x-k0.x);float nt=binarySearchT(time,k0.x,k0.z,k1.z,k1.x);return cubicBezier(nt,k0.y,k0.w,k1.w,k1.y);}}}float evaluteLineSeg(float t,vec2 p0,vec2 p1){return p0.y+(p1.y-p0.y)*(t-p0.x)/(p1.x-p0.x);}float valueFromLineSegs(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);int end=start+count;for(int i=0;i<ITR_END;i++){if(i>count){return lookup_curve(i).w;}vec4 seg=lookup_curve(i+start);vec2 p0=seg.xy;vec2 p1=seg.zw;if(time>=p0.x&&time<=p1.x){return evaluteLineSeg(time,p0,p1);}vec2 p2=lookup_curve(i+start+1).xy;if(time>p1.x&&time<=p2.x){return evaluteLineSeg(time,p1,p2);}}return lookup_curve(0).y;}float getValueFromTime(float time,vec4 value){float type=value.x;if(type==0.){return value.y;}if(type==1.){return mix(value.y,value.z,time/value.w);}if(type==3.){return valueFromLineSegs(time,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed);}if(type==5.){return valueFromBezierCurveFrames(time,value.z,value.w);}return 0.;}float calculateMovement(float t,vec2 p1,vec2 p2,vec2 p3,vec2 p4){float movement=0.0;float h=(t-p1.x)*0.05;for(int i=0;i<=20;i++){float t=float(i)*h;float nt=binarySearchT(t,p1.x,p2.x,p3.x,p4.x);float y=cubicBezier(nt,p1.y,p2.y,p3.y,p4.y);float weight=(i==0||i==20)? 1.0 :(mod(float(i),2.)!=0.)? 4.0 : 2.0;movement+=weight*y;}movement*=h/3.;return movement;}float integrateFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i+=2){vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return ret;}vec2 p1=vec2(k0.x,k0.y);vec2 p2=vec2(k0.z,k0.w);vec2 p3=vec2(k1.z,k1.w);vec2 p4=vec2(k1.x,k1.y);if(time>=k1.x){ret+=calculateMovement(k1.x,p1,p2,p3,p4);}if(time>=k0.x&&time<k1.x){return ret+calculateMovement(time,p1,p2,p3,p4);}}return ret;}float integrateByTimeLineSeg(float t,vec2 p0,vec2 p1){float t0=p0.x;float t1=p1.x;float y0=p0.y;float y1=p1.y;vec4 tSqr=vec4(t,t,t0,t0);tSqr=tSqr*tSqr;vec4 a=vec4(2.*t,3.,-t0,3.)*tSqr;float t1y0=t1*y0;vec4 b=vec4(y0-y1,t0*y1-t1y0,2.*y0+y1,t1y0);float r=dot(a,b);return r/(t0-t1)*0.16666667;}float integrateLineSeg(float time,vec2 p0,vec2 p1){float h=time-p0.x;float y0=p0.y;return(y0+y0+(p1.y-y0)*h/(p1.x-p0.x))*h/2.;}float integrateFromLineSeg(float time,float frameStart,float frameCount){if(time==0.){return 0.;}int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i++){if(i>count){return ret;}vec4 ks=lookup_curve(i+start);vec2 k0=ks.xy;vec2 k1=ks.zw;if(time>k0.x&&time<=k1.x){return ret+integrateLineSeg(time,k0,k1);}ret+=integrateLineSeg(k1.x,k0,k1);vec2 k2=lookup_curve(i+start+1).xy;if(time>k1.x&&time<=k2.x){return ret+integrateLineSeg(time,k1,k2);}ret+=integrateLineSeg(k2.x,k1,k2);}return ret;}float integrateByTimeFromLineSeg(float time,float frameStart,float frameCount){if(time==0.){return 0.;}int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i++){if(i>count){return ret;}vec4 ks=lookup_curve(i+start);vec2 k0=ks.xy;vec2 k1=ks.zw;if(time>k0.x&&time<=k1.x){return ret+integrateByTimeLineSeg(time,k0,k1);}ret+=integrateByTimeLineSeg(k1.x,k0,k1);vec2 k2=lookup_curve(i+start+1).xy;if(time>k1.x&&time<=k2.x){return ret+integrateByTimeLineSeg(time,k1,k2);}ret+=integrateByTimeLineSeg(k2.x,k1,k2);}return ret;}float getIntegrateFromTime0(float t1,vec4 value){float type=value.x;if(type==0.){return value.y*t1;}if(type==1.){vec2 p0=vec2(0.,value.y);vec2 p1=vec2(value.w,value.z);return integrateLineSeg(t1,p0,p1);}if(type==3.){return integrateFromLineSeg(t1,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed)*t1;}if(type==5.){return integrateFromBezierCurveFrames(t1,value.z,value.w);}return 0.;}float getIntegrateByTimeFromTime(float t0,float t1,vec4 value){float type=value.x;if(type==0.){return value.y*(t1*t1-t0*t0)/2.;}else if(type==1.){vec2 p0=vec2(0.,value.y);vec2 p1=vec2(value.w,value.z);return integrateByTimeLineSeg(t1,p0,p1)-integrateByTimeLineSeg(t0,p0,p1);}if(type==3.){return integrateByTimeFromLineSeg(t1,value.y,value.z)-integrateByTimeFromLineSeg(t0,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed)*(t1*t1-t0*t0)/2.;}if(type==5.){return integrateFromBezierCurveFrames(t1,value.z,value.w)-integrateFromBezierCurveFrames(t0,value.z,value.w);}return 0.;}const float d2r=3.141592653589793/180.;attribute vec3 aPos;attribute vec4 aOffset;attribute vec4 aColor;attribute vec3 aDirX;attribute vec3 aDirY;attribute vec3 aTranslation;attribute vec3 aRotation0;attribute vec3 aRotation1;attribute vec3 aRotation2;attribute vec3 aLinearMove;\n#ifdef USE_SPRITE\nattribute vec3 aSprite;uniform vec4 uSprite;struct UVDetail{vec2 uv0;vec3 uv1;};UVDetail getSpriteUV(vec2 uv,float lifeTime);varying vec4 vTexCoordBlend;\n#endif\n#ifdef FINAL_TARGET\nuniform vec3 uFinalTarget;uniform vec4 uForceCurve;\n#endif\nuniform mat4 effects_ObjectToWorld;uniform mat4 effects_MatrixV;uniform mat4 effects_MatrixVP;uniform vec4 uParams;uniform vec4 uOpacityOverLifetimeValue;\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\nuniform vec4 uOrbXByLifetimeValue;uniform vec4 uOrbYByLifetimeValue;uniform vec4 uOrbZByLifetimeValue;uniform vec3 uOrbCenter;uniform vec4 uSizeByLifetimeValue;\n#ifdef SIZE_Y_BY_LIFE\nuniform vec4 uSizeYByLifetimeValue;\n#endif\nvarying float vLife;varying vec4 vColor;varying vec2 vTexCoord;\n#ifdef ENV_EDITOR\nuniform vec4 uEditorTransform;\n#endif\nvec3 calOrbitalMov(float _life,float _dur){vec3 orb=vec3(0.0);\n#ifdef AS_ORBITAL_MOVEMENT\n#define FUNC(a) getValueFromTime(_life,a)\n#else\n#define FUNC(a) getIntegrateFromTime0(_life,a) * _dur\n#endif\n#if ORB_VEL_X\norb.x=FUNC(uOrbXByLifetimeValue);\n#endif\n#if ORB_VEL_Y\norb.y=FUNC(uOrbYByLifetimeValue);\n#endif\n#if ORB_VEL_Z\norb.z=FUNC(uOrbZByLifetimeValue);\n#endif\n#undef FUNC\nreturn orb;}mat3 mat3FromRotation(vec3 rotation){vec3 sinR=sin(rotation*d2r);vec3 cosR=cos(rotation*d2r);return mat3(cosR.z,-sinR.z,0.,sinR.z,cosR.z,0.,0.,0.,1.)*mat3(cosR.y,0.,sinR.y,0.,1.,0.,-sinR.y,0,cosR.y)*mat3(1.,0.,0.,0,cosR.x,-sinR.x,0.,sinR.x,cosR.x);}\n#ifdef USE_SPRITE\nUVDetail getSpriteUV(vec2 uv,float lifeTime){float t=fract(clamp((lifeTime-aSprite.x)/aSprite.y,0.0,1.)*aSprite.z);float frame=uSprite.z*t;float frameIndex=max(ceil(frame)-1.,0.);float row=floor((frameIndex+0.1)/uSprite.x);float col=frameIndex-row*uSprite.x;vec2 retUV=(vec2(col,row)+uv)/uSprite.xy;UVDetail ret;if(uSprite.w>0.){float blend=frame-frameIndex;float frameIndex1=min(ceil(frame),uSprite.z-1.);float row1=floor((frameIndex1+0.1)/uSprite.x);float col1=frameIndex1-row1*uSprite.x;vec2 coord=(vec2(col1,row1)+uv)/uSprite.xy-retUV;ret.uv1=vec3(coord.x,1.-coord.y,blend);}ret.uv0=vec2(retUV.x,1.-retUV.y);return ret;}\n#endif\nvoid main(){float time=uParams.x-aOffset.z;float dur=aOffset.w;if(time<0.||time>dur){gl_Position=vec4(-3.,-3.,-3.,1.);}else{float life=clamp(time/dur,0.0,1.0);vLife=life;\n#ifdef USE_SPRITE\nUVDetail uvD=getSpriteUV(aOffset.xy,time);vTexCoord=uvD.uv0;vTexCoordBlend=vec4(uvD.uv1,uSprite.w);\n#else\nvTexCoord=aOffset.xy;\n#endif\nvColor=aColor;\n#ifdef COLOR_OVER_LIFETIME\n#ifdef ENABLE_VERTEX_TEXTURE\nvColor*=texture2D(uColorOverLifetime,vec2(life,0.));\n#endif\n#endif\nvColor.a*=clamp(getValueFromTime(life,uOpacityOverLifetimeValue),0.,1.);vec3 size=vec3(vec2(getValueFromTime(life,uSizeByLifetimeValue)),1.0);\n#ifdef SIZE_Y_BY_LIFE\nsize.y=getValueFromTime(life,uSizeYByLifetimeValue);\n#endif\nmat3 aRotation=mat3(aRotation0,aRotation1,aRotation2);vec3 point=aRotation*(aDirX*size.x+aDirY*size.y);vec3 _pos=aPos+aTranslation;\n#if ORB_VEL_X + ORB_VEL_Y + ORB_VEL_Z\n_pos=mat3FromRotation(calOrbitalMov(life,dur))*(_pos-uOrbCenter);_pos+=uOrbCenter;\n#endif\n_pos.xyz+=aLinearMove;\n#ifdef FINAL_TARGET\nfloat force=getValueFromTime(life,uForceCurve);vec4 pos=vec4(mix(_pos,uFinalTarget,force),1.);\n#else\nvec4 pos=vec4(_pos,1.0);\n#endif\n#if RENDER_MODE == 1\npos.xyz+=point;pos=effects_ObjectToWorld*pos;\n#elif RENDER_MODE == 3\npos=effects_ObjectToWorld*pos;pos.xyz+=effects_MatrixV[0].xyz*point.x+effects_MatrixV[2].xyz*point.y;\n#elif RENDER_MODE == 2\npos=effects_ObjectToWorld*pos;pos.xy+=point.xy;\n#elif RENDER_MODE == 0\npos=effects_ObjectToWorld*pos;pos.xyz+=effects_MatrixV[0].xyz*point.x+effects_MatrixV[1].xyz*point.y;\n#endif\ngl_Position=effects_MatrixVP*pos;vSeed=aSeed;gl_PointSize=6.0;\n#ifdef ENV_EDITOR\ngl_Position=vec4(gl_Position.xy*uEditorTransform.xy+uEditorTransform.zw*gl_Position.w,gl_Position.zw);\n#endif\n}}",ds="#version 100\nprecision mediump float;\n#define SHADER_VERTEX 1\n#ifdef SHADER_VERTEX\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n#define CURVE_VALUE_ARRAY uVCurveValues\n#define CURVE_VALUE_COUNT VERT_CURVE_VALUE_COUNT\n#define FRAG_CURVE_VALUE_COUNT 0\n#else\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n#define CURVE_VALUE_ARRAY uFCurveValues\n#define CURVE_VALUE_COUNT FRAG_CURVE_VALUE_COUNT\n#define VERT_CURVE_VALUE_COUNT 0\n#endif\n#if CURVE_VALUE_COUNT > 0\n#if LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n#endif\n#else\n#define lookup_curve(i) vec4(0.)\n#endif\n#ifdef WEBGL2\n#define ITR_END (count + 1)\n#else\n#define ITR_END MAX_C\n#endif\n#define NONE_CONST_INDEX 1\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#endif\n#ifdef SHADER_VERTEX\n#define MAX_C VERT_MAX_KEY_FRAME_COUNT\n#else\n#define MAX_C FRAG_MAX_KEY_FRAME_COUNT\n#endif\nmat4 cubicBezierMatrix=mat4(1.0,-3.0,3.0,-1.0,0.0,3.0,-6.0,3.0,0.0,0.0,3.0,-3.0,0.0,0.0,0.0,1.0);float cubicBezier(float t,float y1,float y2,float y3,float y4){vec4 tVec=vec4(1.0,t,t*t,t*t*t);vec4 yVec=vec4(y1,y2,y3,y4);vec4 result=tVec*cubicBezierMatrix*yVec;return result.x+result.y+result.z+result.w;}float binarySearchT(float x,float x1,float x2,float x3,float x4){float left=0.0;float right=1.0;float mid=0.0;float computedX;for(int i=0;i<8;i++){mid=(left+right)*0.5;computedX=cubicBezier(mid,x1,x2,x3,x4);if(abs(computedX-x)<0.0001){break;}else if(computedX>x){right=mid;}else{left=mid;}}return mid;}float valueFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);for(int i=0;i<ITR_END;i+=2){if(i>=count){break;}vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return k0.y;}if(i==int(frameCount-2.)&&time>=k1.x){return k1.y;}if(time>=k0.x&&time<=k1.x){float t=(time-k0.x)/(k1.x-k0.x);float nt=binarySearchT(time,k0.x,k0.z,k1.z,k1.x);return cubicBezier(nt,k0.y,k0.w,k1.w,k1.y);}}}float evaluteLineSeg(float t,vec2 p0,vec2 p1){return p0.y+(p1.y-p0.y)*(t-p0.x)/(p1.x-p0.x);}float valueFromLineSegs(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);int end=start+count;for(int i=0;i<ITR_END;i++){if(i>count){return lookup_curve(i).w;}vec4 seg=lookup_curve(i+start);vec2 p0=seg.xy;vec2 p1=seg.zw;if(time>=p0.x&&time<=p1.x){return evaluteLineSeg(time,p0,p1);}vec2 p2=lookup_curve(i+start+1).xy;if(time>p1.x&&time<=p2.x){return evaluteLineSeg(time,p1,p2);}}return lookup_curve(0).y;}float getValueFromTime(float time,vec4 value){float type=value.x;if(type==0.){return value.y;}if(type==1.){return mix(value.y,value.z,time/value.w);}if(type==3.){return valueFromLineSegs(time,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed);}if(type==5.){return valueFromBezierCurveFrames(time,value.z,value.w);}return 0.;}attribute vec4 aPos;attribute vec3 aDir;attribute vec3 aInfo;attribute vec4 aColor;attribute float aTime;\n#ifdef ATTR_TRAIL_START\nattribute float aTrailStart;\n#else\nuniform float uTrailStart[64];attribute float aTrailStartIndex;\n#endif\nuniform mat4 effects_MatrixInvV;uniform mat4 effects_ObjectToWorld;uniform mat4 effects_MatrixVP;uniform vec4 uTextureMap;uniform float uTime;uniform vec4 uParams;uniform vec4 uColorParams;uniform vec4 uOpacityOverLifetimeValue;uniform vec4 uWidthOverTrail;\n#ifdef COLOR_OVER_TRAIL\nuniform sampler2D uColorOverTrail;\n#endif\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\nvarying float vLife;varying vec2 vTexCoord;varying vec4 vColor;\n#ifdef ENV_EDITOR\nuniform vec4 uEditorTransform;\n#endif\nvoid main(){vec4 _pa=effects_MatrixVP*vec4(aPos.xyz,1.);vec4 _pb=effects_MatrixVP*vec4(aPos.xyz+aDir,1.);vec2 dir=normalize(_pb.xy/_pb.w-_pa.xy/_pa.w);vec2 screen_xy=vec2(-dir.y,dir.x);vec4 pos=effects_ObjectToWorld*vec4(aPos.xyz,1.);\n#ifdef ATTR_TRAIL_START\nfloat ts=aTrailStart;\n#else\nfloat ts=uTrailStart[int(aTrailStartIndex)];\n#endif\nfloat trail=(ts-aInfo.y)/uParams.y;float width=aPos.w*getValueFromTime(trail,uWidthOverTrail)/max(abs(screen_xy.x),abs(screen_xy.y));pos.xyz+=(effects_MatrixInvV[0].xyz*screen_xy.x+effects_MatrixInvV[1].xyz*screen_xy.y)*width;float time=min((uTime-aTime)/aInfo.x,1.0);gl_Position=effects_MatrixVP*pos;vColor=aColor;\n#ifdef COLOR_OVER_LIFETIME\n#ifdef ENABLE_VERTEX_TEXTURE\nvColor*=texture2D(uColorOverLifetime,vec2(time,0.));\n#endif\n#endif\n#ifdef COLOR_OVER_TRAIL\nvColor*=texture2D(uColorOverTrail,vec2(trail,0.));\n#endif\nvColor.a*=clamp(getValueFromTime(time,uOpacityOverLifetimeValue),0.,1.);vLife=time;vTexCoord=uTextureMap.xy+vec2(trail,aInfo.z)*uTextureMap.zw;vSeed=aSeed;\n#ifdef ENV_EDITOR\ngl_Position=vec4(gl_Position.xy*uEditorTransform.xy+uEditorTransform.zw*gl_Position.w,gl_Position.zw);\n#endif\n}",ms="precision highp float;attribute vec2 aPos;varying vec2 uv;void main(){gl_Position=vec4(aPos,0.,1.0);uv=(aPos+vec2(1.0))/2.;}",vs="precision highp float;\n#define HALF_MAX 60000.0\n#define ACEScc_MIDGRAY 0.4135884\nvarying vec2 uv;uniform sampler2D _GaussianTex;uniform sampler2D _SceneTex;uniform float _BloomIntensity;uniform float _Brightness;uniform float _Saturation;uniform float _Contrast;uniform bool _UseBloom;uniform bool _UseToneMapping;uniform vec3 _VignetteColor;uniform vec2 _VignetteCenter;uniform float _VignetteIntensity;uniform float _VignetteSmoothness;uniform float _VignetteRoundness;mat3 LinearToACES=mat3(0.59719,0.07600,0.02840,0.35458,0.90834,0.13383,0.04823,0.01566,0.83777);mat3 ACESToLinear=mat3(1.60475,-0.10208,-0.00327,-0.53108,1.10813,-0.07276,-0.07367,-0.00605,1.07602);float log10(float x){return log(x)/log(10.0);}vec3 log10(vec3 v){return vec3(log10(v.x),log10(v.y),log10(v.z));}vec3 LinearToLogC(vec3 x){return 0.244161*log10(5.555556*x+0.047996)+0.386036;}vec3 LogCToLinear(vec3 x){return(pow(vec3(10.0),(x-0.386036)/0.244161)-0.047996)/5.555556;}vec3 rrt_and_odt_fit(vec3 col){vec3 a=col*(col+0.0245786)-0.000090537;vec3 b=col*(0.983729*col+0.4329510)+0.238081;return a/b;}vec3 ACESToneMapping(vec3 col){vec3 aces=LinearToACES*col;aces=rrt_and_odt_fit(aces);col=ACESToLinear*aces;return col;}vec3 LinearToSrgb(vec3 c){return mix(1.055*pow(c,vec3(1./2.4))-0.055,12.92*c,step(c,vec3(0.0031308)));}vec3 GammaCorrection(vec3 c){return pow(c,vec3(1.0/2.2));}vec3 ApplyVignette(vec3 inputColor,vec2 uv,vec2 center,float intensity,float roundness,float smoothness,vec3 color){vec2 dist=abs(uv-center)*intensity;dist.x*=roundness;float vfactor=pow(clamp((1.0-dot(dist,dist)),0.0,1.0),smoothness);return inputColor*mix(color,vec3(1.0),vfactor);}void main(){vec4 hdrColor=texture2D(_SceneTex,uv);hdrColor.rgb=pow(hdrColor.rgb,vec3(2.2));vec3 finalColor=hdrColor.rgb;if(_UseBloom){vec4 bloomColor=texture2D(_GaussianTex,uv);bloomColor.rgb*=_BloomIntensity;finalColor+=bloomColor.rgb;}if(_VignetteIntensity>0.0){finalColor=ApplyVignette(finalColor,uv,_VignetteCenter,_VignetteIntensity,_VignetteRoundness,_VignetteSmoothness,_VignetteColor);}finalColor=finalColor*_Brightness;vec3 colorLog=LinearToLogC(finalColor);colorLog=(colorLog-ACEScc_MIDGRAY)*_Contrast+ACEScc_MIDGRAY;finalColor=LogCToLinear(colorLog);finalColor=max(finalColor,0.0);float luminance=0.2125*finalColor.r+0.7154*finalColor.g+0.0721*finalColor.b;vec3 luminanceColor=vec3(luminance,luminance,luminance);finalColor=(finalColor-luminanceColor)*_Saturation+luminanceColor;finalColor=max(finalColor,0.0);if(_UseToneMapping){finalColor=max(vec3(0.0),ACESToneMapping(finalColor));}float alpha=min(hdrColor.a,1.0);gl_FragColor=vec4(clamp(GammaCorrection(finalColor),0.0,1.0),alpha);}",ys="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform vec2 _TextureSize;vec3 GaussH(sampler2D tex,vec2 uv){vec3 color=vec3(0.0);float offsets[9];offsets[0]=-4.0;offsets[1]=-3.0;offsets[2]=-2.0;offsets[3]=-1.0;offsets[4]=0.0;offsets[5]=1.0;offsets[6]=2.0;offsets[7]=3.0;offsets[8]=4.0;float weights[9];weights[0]=0.01621622;weights[1]=0.05405405;weights[2]=0.12162162;weights[3]=0.19459459;weights[4]=0.22702703;weights[5]=0.19459459;weights[6]=0.12162162;weights[7]=0.05405405;weights[8]=0.01621622;for(int i=0;i<9;i++){vec2 offset=vec2(offsets[i]*2.0*(1.0/_TextureSize.x),0);color+=texture2D(tex,uv+offset).rgb*weights[i];}return color;}void main(){vec3 color=GaussH(_MainTex,uv);gl_FragColor=vec4(color,1.0);}",gs="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform vec2 _TextureSize;vec3 GaussV(sampler2D tex,vec2 uv){vec3 color=vec3(0.0);float offsets[5];offsets[0]=-3.23076923;offsets[1]=-1.38461538;offsets[2]=0.0;offsets[3]=1.38461538;offsets[4]=3.23076923;float weights[5];weights[0]=0.07027027;weights[1]=0.31621622;weights[2]=0.22702703;weights[3]=0.31621622;weights[4]=0.07027027;for(int i=0;i<5;i++){vec2 offset=vec2(0,offsets[i]*(1.0/_TextureSize.y));color+=texture2D(tex,uv+offset).rgb*weights[i];}return color;}void main(){vec3 color=GaussV(_MainTex,uv);gl_FragColor=vec4(color,1.0);}",_s="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform sampler2D _GaussianDownTex;uniform vec2 _GaussianDownTextureSize;float GaussWeight2D(float x,float y,float sigma){float PI=3.14159265358;float E=2.71828182846;float sigma_2=pow(sigma,2.0);float a=-(x*x+y*y)/(2.0*sigma_2);return pow(E,a)/(2.0*PI*sigma_2);}vec3 GaussNxN(sampler2D tex,vec2 uv,vec2 stride,float sigma){vec3 color=vec3(0.,0.,0.);const int r=1;float weight=0.0;for(int i=-r;i<=r;i++){for(int j=-r;j<=r;j++){float w=GaussWeight2D(float(i),float(j),sigma);vec2 coord=uv+vec2(i,j)*stride;color+=texture2D(tex,coord).rgb*w;weight+=w;}}color/=weight;return color;}void main(){vec3 lowResColor=GaussNxN(_MainTex,uv,0.5/_GaussianDownTextureSize,1.0);vec3 highResColor=GaussNxN(_GaussianDownTex,uv,1.0/_GaussianDownTextureSize,1.0);vec3 color=mix(highResColor,lowResColor,0.7);gl_FragColor=vec4(color,1.0);}",Es="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform float _Threshold;void main(){vec4 mainTex=texture2D(_MainTex,uv);mainTex.rgb=pow(mainTex.rgb,vec3(2.2));float brightness=max(mainTex.r,max(mainTex.g,mainTex.b));float w=max(0.0,brightness-_Threshold)/max(brightness,0.00001);mainTex.rgb*=w;mainTex.rgb*=mainTex.a;gl_FragColor=vec4(mainTex.rgb,1.0);}",xs={},Ts=function(){function t(){}return t.registerInclude=function(t,e){xs[t]&&Yr.warn('The "'+t+'" shader include already exist.'),xs[t]=e},t.unRegisterInclude=function(t){delete xs[t]},t.unRegisterAllIncludes=function(){Object.keys(xs).forEach((function(e){t.unRegisterInclude(e)}))},t.genFinalShaderCode=function(e){var r=e.level,i=e.shaderType,n=e.shader,o=e.macros,s=e.removeVersion,a=t.genMacroString(r,o),u=t.genShaderVersion(r),c=t.parseIncludes(n),h=t.isVersion300(c);return c=t.removeWebGLVersion(c),2!==r||h||(c=t.convertTo300(c,i===exports.ShaderType.fragment)),s?a+c:u+a+c},t.convertTo300=function(e,r){if(e=(e=(e=e.replace(/\bvarying\b/g,r?"in":"out")).replace(/\btexture(2D|Cube)\b/g,"texture")).replace(/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,""),r){if(e=(e=(e=e.replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod")).replace(/\btexture(2D|Cube)GradEXT\b/g,"textureGrad")).replace(/\bgl_FragDepthEXT\b/g,"gl_FragDepth"),!t.has300Output(e))if(/\bgl_FragData\[.+?\]/g.test(e)){var i=(e=e.replace(/\bgl_FragColor\b/g,"gl_FragData[0]")).match(/\bgl_FragData\[.+?\]/g);i&&(e=t.replaceMRTShader(e,i))}else e=(e=e.replace(/void\s+?main\s*\(/g,"out vec4 glFragColor;\nvoid main(")).replace(/\bgl_FragColor\b/g,"glFragColor")}else e=e.replace(/\battribute\b/g,"in");return e},t.parseIncludes=function(t,e){var r;for(void 0===e&&(e=/#include <(.+)>/gm);null!==(r=e.exec(t));){var i=r[1],n=xs[i];if(void 0===n)throw new Error("Can't find include shader name "+i);t=t.replace(r[0],n)}return t},t.genMacroString=function(t,e,r){void 0===r&&(r=!0);var i=[],n="WEBGL"+t;return i.push("#ifndef "+n),i.push("#define "+n),i.push("#endif"),r&&i.push("#define GE_RUNTIME"),e&&e.length&&e.forEach((function(t){var e=t[0],r=t[1];!0===r?i.push("#define "+e):Number.isFinite(r)&&i.push("#define "+e+" "+r)})),i.length?i.join("\n")+"\n":""},t.genShaderVersion=function(t){return 1===t?"#version 100\n":"#version 300 es\n"},t.isVersion300=function(t){var e=t.match(/#version\s+\b\d{3}\b\s*(es)?/);return(e?e[0]:"").includes("300")},t.removeWebGLVersion=function(t){var e=t.match(/#version\s+\b\d{3}\b\s*(es)?/);return e?t.replace(e[0],""):t},t.has300Output=function(t){return/\bout\s+(?:\w+\s+)?(?:vec4)\s+(?:\w+)\s*;/.test(t)},t.replaceMRTShader=function(t,e){for(var r=new Set,i="",n=0;n<e.length;n++){var o=e[n].match(/\bgl_FragData\[(.+?)\]/);o&&r.add(o[1])}return r.forEach((function(t){i+="layout(location="+t+") out vec4 fragOutColor"+t+";\n"})),i+="void main(",t=(t=t.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1")).replace(/void\s+?main\s*\(/g,i)},t}(),bs=function(t){function e(e,r){var i,n=(i=t.call(this,e,r)||this).renderer.engine,o=jo.create(n,{mode:jn.TRIANGLE_STRIP,attributes:{aPos:{type:jn.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),s=Bo.create(n,{shader:{vertex:ms,fragment:Es,glslVersion:exports.GLSLVersion.GLSL1}});return s.blending=!1,s.depthTest=!1,s.culling=!1,i.screenMesh=is.create(n,{geometry:o,material:s,priority:0}),i.priority=5e3,i}Ri(e,t);var r=e.prototype;return r.configure=function(t){this.mainTexture=t.getFramebuffer().getColorTextures()[0],this.sceneTextureHandle.texture=this.mainTexture,t.setFramebuffer(this.framebuffer)},r.execute=function(t){var e,r,i;t.clear({colorAction:exports.TextureStoreAction.clear,depthAction:exports.TextureStoreAction.clear,stencilAction:exports.TextureStoreAction.clear}),this.screenMesh.material.setTexture("_MainTex",this.mainTexture);var n=null!=(i=null==(r=t.renderingData.currentFrame.globalVolume)||null==(e=r.bloom)?void 0:e.threshold)?i:1;this.screenMesh.material.setFloat("_Threshold",n),t.renderMeshes([this.screenMesh])},e}(us),As=function(t){function e(e,r,i){var n;(n=t.call(this,e,i)||this).type=r;var o=n.renderer.engine,s="PostProcess",a=jo.create(o,{name:s,mode:jn.TRIANGLE_STRIP,attributes:{aPos:{type:jn.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),u={vertex:ms,fragment:"H"==r?ys:gs,glslVersion:exports.GLSLVersion.GLSL1},c=Bo.create(o,{name:s,shader:u});return c.blending=!1,c.depthTest=!1,c.culling=!1,n.screenMesh=is.create(o,{name:s,geometry:a,material:c,priority:0}),n.priority=5e3,n}Ri(e,t);var r=e.prototype;return r.configure=function(t){this.mainTexture=t.getFramebuffer().getColorTextures()[0],t.setFramebuffer(this.framebuffer)},r.execute=function(t){t.clear({colorAction:exports.TextureStoreAction.clear,depthAction:exports.TextureStoreAction.clear,stencilAction:exports.TextureStoreAction.clear}),this.screenMesh.material.setTexture("_MainTex",this.mainTexture),this.screenMesh.material.setVector2("_TextureSize",Ps(this.mainTexture)),t.renderMeshes([this.screenMesh]),"V"===this.type&&(this.gaussianResult.texture=t.getFramebuffer().getColorTextures()[0])},e}(us),Rs=function(t){function e(e,r){var i,n="PostProcess",o=(i=t.call(this,e,r)||this).renderer.engine,s=jo.create(o,{name:n,mode:jn.TRIANGLE_STRIP,attributes:{aPos:{type:jn.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),a={vertex:ms,fragment:_s},u=Bo.create(o,{name:n,shader:a});return u.blending=!1,u.depthTest=!1,u.culling=!1,i.screenMesh=is.create(o,{name:n,geometry:s,material:u,priority:0}),i.priority=5e3,i}Ri(e,t);var r=e.prototype;return r.configure=function(t){this.mainTexture=t.getFramebuffer().getColorTextures()[0],t.setFramebuffer(this.framebuffer)},r.execute=function(t){t.clear({colorAction:exports.TextureStoreAction.clear,depthAction:exports.TextureStoreAction.clear,stencilAction:exports.TextureStoreAction.clear}),this.screenMesh.material.setTexture("_MainTex",this.mainTexture),this.screenMesh.material.setTexture("_GaussianDownTex",this.gaussianDownSampleResult.texture),this.screenMesh.material.setVector2("_GaussianDownTextureSize",Ps(this.gaussianDownSampleResult.texture)),t.renderMeshes([this.screenMesh])},e}(us),Ss=function(t){function e(e,r){var i,n="PostProcess",o=(i=t.call(this,e,{})||this).renderer.engine;i.sceneTextureHandle=r||new ss(o);var s=jo.create(o,{name:n,mode:jn.TRIANGLE_STRIP,attributes:{aPos:{type:jn.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),a=Bo.create(o,{name:n,shader:{vertex:ms,fragment:vs,glslVersion:exports.GLSLVersion.GLSL1}});return a.blending=!1,a.depthTest=!1,a.culling=!1,i.screenMesh=is.create(o,{name:n,geometry:s,material:a,priority:0}),i.priority=5e3,i}Ri(e,t);var r=e.prototype;return r.configure=function(t){this.mainTexture=t.getFramebuffer().getColorTextures()[0],this.sceneTextureHandle.texture||(this.sceneTextureHandle.texture=this.mainTexture),t.setFramebuffer(null)},r.execute=function(t){t.clear({colorAction:exports.TextureStoreAction.clear,depthAction:exports.TextureStoreAction.clear,stencilAction:exports.TextureStoreAction.clear});var e=t.renderingData.currentFrame.globalVolume,r=to({threshold:0,intensity:0,active:!1},null==e?void 0:e.bloom),i=to({intensity:0,smoothness:0,roundness:0,active:!1},null==e?void 0:e.vignette),n=to({brightness:0,saturation:0,contrast:0,active:!1},null==e?void 0:e.colorAdjustments),o=to({active:!1},null==e?void 0:e.tonemapping);this.screenMesh.material.setTexture("_SceneTex",this.sceneTextureHandle.texture),this.screenMesh.material.setFloat("_Brightness",Math.pow(2,n.brightness)),this.screenMesh.material.setFloat("_Saturation",.01*n.saturation+1),this.screenMesh.material.setFloat("_Contrast",.01*n.contrast+1),this.screenMesh.material.setInt("_UseBloom",Number(r.active)),r.active&&(this.screenMesh.material.setTexture("_GaussianTex",this.mainTexture),this.screenMesh.material.setFloat("_BloomIntensity",r.intensity)),i.intensity>0&&(this.screenMesh.material.setFloat("_VignetteIntensity",i.intensity),this.screenMesh.material.setFloat("_VignetteSmoothness",i.smoothness),this.screenMesh.material.setFloat("_VignetteRoundness",i.roundness),this.screenMesh.material.setVector2("_VignetteCenter",new Tn(.5,.5)),this.screenMesh.material.setVector3("_VignetteColor",new bn(0,0,0))),this.screenMesh.material.setInt("_UseToneMapping",Number(o.active)),t.renderMeshes([this.screenMesh])},e}(us),Cs="_effects_default_",Os=1,Ms=function(){function t(t){var e;this.renderQueue=[],this.destroyed=!1,this.renderPassInfoMap=new WeakMap;var r=t.camera,i=t.keepColorBuffer,n=t.renderer,o=t.editorTransform,s=void 0===o?[1,1,0,0]:o,a=t.globalVolume,u=t.postProcessingEnabled,c=void 0!==u&&u,h=t.clearAction,l=void 0===h?{colorAction:exports.TextureLoadAction.whatever,stencilAction:exports.TextureLoadAction.clear,depthAction:exports.TextureLoadAction.whatever}:h,f=n.engine;a&&(this.globalVolume=a),this.globalUniforms=new Ns;var p,d=[],m={};if(this.renderer=n,c){if(!this.renderer.engine.gpuCapability.detail.halfFloatTexture)throw new Error("Half float texture is not supported.");var v=jn.HALF_FLOAT;d=[{texture:{format:jn.RGBA,type:v,magFilter:jn.LINEAR,minFilter:jn.LINEAR}}],p={storageType:exports.RenderPassAttachmentStorageType.depth_stencil_opaque},m={colorAction:exports.TextureLoadAction.clear,stencilAction:exports.TextureLoadAction.clear,depthAction:exports.TextureLoadAction.clear}}this.drawObjectPass=new us(n,{name:Cs,priority:ns,meshOrder:exports.OrderType.ascending,depthStencilAttachment:p,attachments:d,clearAction:m});var y=[this.drawObjectPass];if(this.setRenderPasses(y),c){var g=new ss(f),_=[0,0,this.renderer.getWidth()/2,this.renderer.getHeight()/2],E=new Array(7),x=jn.HALF_FLOAT,T=new bs(n,{name:"BloomThresholdPass",attachments:[{texture:{format:jn.RGBA,type:x,minFilter:jn.LINEAR,magFilter:jn.LINEAR}}]});T.sceneTextureHandle=g,this.addRenderPass(T);for(var b=0;b<7;b++){E[b]=new ss(f);var A=new As(n,"H",{name:"GaussianDownPassH"+b,viewport:_,attachments:[{texture:{format:jn.RGBA,type:x,minFilter:jn.LINEAR,magFilter:jn.LINEAR}}]}),R=new As(n,"V",{name:"GaussianDownPassV"+b,viewport:_,attachments:[{texture:{format:jn.RGBA,type:x,minFilter:jn.LINEAR,magFilter:jn.LINEAR}}]});R.gaussianResult=E[b],this.addRenderPass(A),this.addRenderPass(R),_[2]/=2,_[3]/=2}_[2]*=4,_[3]*=4;for(var S=0;S<6;S++){var C=new Rs(n,{name:"GaussianUpPass"+S,viewport:_,attachments:[{texture:{format:jn.RGBA,type:x,minFilter:jn.LINEAR,magFilter:jn.LINEAR}}]});C.gaussianDownSampleResult=E[5-S],this.addRenderPass(C),_[2]*=2,_[3]*=2}var O=new Ss(n,g);this.addRenderPass(O)}this.semantics=new Xo(t.semantics),this.clearAction=l,this.name="RenderFrame"+Os++;var M=y[0];this.emptyTexture=So(f),this.transparentTexture=Co(f),this.camera=r,this.keepColorBuffer=i,this.renderPassInfoMap.set(M,{listStart:0,listEnd:0,renderPass:M,intermedia:!1}),this.editorTransform=An.fromArray(s),t.clearAction||this.resetClearActions(),this.passTextureCache=new Go(f);var P=f.gpuCapability,I=P.detail,w=Un(P.level,I.readableDepthStencilTextures&&I.writableFragDepth);null==(e=this.renderer.getShaderLibrary())||e.addShader(w)}var e=t.prototype;return e.addMeshToDefaultRenderPass=function(t){this.drawObjectPass.addMesh(t)},e.removeMeshFromDefaultRenderPass=function(t){this.drawObjectPass.removeMesh(t)},e.dispose=function(t){(null==t?void 0:t.semantics)!==exports.DestroyOptions.keep&&this.semantics.dispose();var e,r,i=(null==t?void 0:t.passes)?t.passes:void 0;(i!==exports.DestroyOptions.keep&&this._renderPasses.forEach((function(t){t.dispose(i)})),this.passTextureCache.dispose(),this._renderPasses.length=0,this.emptyTexture.dispose(),this.transparentTexture.dispose(),this.resource)&&(this.resource.color_a.dispose(),this.resource.color_b.dispose(),null==(r=this.resource.depthStencil)||null==(e=r.texture)||e.dispose(),this.resource.finalCopyRP.dispose(),this.resource.resRP.dispose(),this.resource=null);this.destroyed=!0},e.resetRenderPassDefaultAttachment=function(t,e){for(var r,i=this.resource,n=i.color_a,o=i.color_b,s=e;s<t.length;s++){var a,u,c=t[s],h=null==(a=c.attachments[0])?void 0:a.texture;if(h&&r===h){var l=h===n?o:n;c.resetColorAttachments([l])}(h=null==(u=c.attachments[0])?void 0:u.texture)&&(r=h)}},e.findMeshRenderPassIndex=function(t){var e=-1;return this.renderPasses.every((function(r,i){return!r.name.startsWith(Cs)||!r.meshes.includes(t)||(e=i,!1)})),e},e.addToRenderPass=function(t,e){var r=this.renderPassInfoMap.get(t),i=e.priority;r&&(0===t.meshes.length?r.listStart=r.listEnd=i:i<r.listStart?r.listStart=i:i>r.listEnd&&(r.listEnd=i),t.addMesh(e))},e.getRPAttachments=function(t,e){if(1===(null==t?void 0:t.length)){var r,i=t[0],n=i.texture,o=i.persistent,s=n.format,a=null!=(r=null==e?void 0:e.getInitAttachments())?r:[];if(s===jn.RGBA&&!o){var u=this.resource.color_a;return 0===a.length?[{texture:u}]:[{texture:a[0].texture===u?this.resource.color_b:u}]}}return t},e.resetClearActions=function(){var t=this.renderPasses.length>1?exports.TextureLoadAction.clear:exports.TextureLoadAction.whatever;this.clearAction.stencilAction=t,this.clearAction.depthAction=t,this.clearAction.colorAction=t,this.keepColorBuffer&&(this.clearAction.colorAction=exports.TextureLoadAction.whatever)},e.setRenderPasses=function(t){var e=this;void 0!==this.renderer&&t.forEach((function(t){return t.initialize(e.renderer)})),this._renderPasses=t.slice()},e.addRenderPass=function(t){void 0!==this.renderer&&t.initialize(this.renderer),this._renderPasses.push(t)},e.createResource=function(){var t=this.renderer.engine;if(!this.resource){var e,r=t.gpuCapability,i=r.detail,n=r.level,o=this.renderer.getWidth(),s=this.renderer.getHeight(),a=2===n?jn.LINEAR:jn.NEAREST,u=bo.create(t,{sourceType:exports.TextureSourceType.framebuffer,format:jn.RGBA,name:"frame_a",minFilter:a,magFilter:a}),c=bo.create(t,{sourceType:exports.TextureSourceType.framebuffer,format:jn.RGBA,data:{width:o,height:s},minFilter:a,magFilter:a,name:"frame_b"}),h=i.readableDepthStencilTextures&&i.writableFragDepth?exports.RenderPassAttachmentStorageType.depth_24_stencil_8_texture:exports.RenderPassAttachmentStorageType.depth_stencil_opaque,l=new us(this.renderer,{depthStencilAttachment:{storageType:h},attachments:[{texture:u}]}).initialize(this.renderer),f=new Fs(this.renderer,{name:"effects-final-copy",priority:1600,clearAction:{depthAction:exports.TextureLoadAction.clear,stencilAction:exports.TextureLoadAction.clear,colorAction:exports.TextureLoadAction.clear},meshOrder:exports.OrderType.ascending,meshes:[this.createCopyMesh({blend:!0,depthTexture:null==(e=l.getDepthAttachment())?void 0:e.texture})]});this.resource={color_a:l.attachments[0].texture,color_b:c,finalCopyRP:f,depthStencil:l.depthAttachment,resRP:l}}},e.createCopyMesh=function(t){var e,r=Fn,i=this.renderer.engine,n=jo.create(i,{name:r,mode:jn.TRIANGLE_STRIP,attributes:{aPos:{type:jn.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),o=Un(i.gpuCapability.level,!!(null==t?void 0:t.depthTexture));null==(e=this.renderer.getShaderLibrary())||e.addShader(o);var s=Bo.create(i,{uniformValues:{uDepth:null==t?void 0:t.depthTexture},name:r,shader:o});return s.blending=!1,s.depthTest=!1,s.culling=!1,(null==t?void 0:t.blend)&&(s.blending=!0,s.blendFunction=[jn.SRC_ALPHA,jn.ONE_MINUS_SRC_ALPHA,jn.SRC_ALPHA,jn.ONE_MINUS_SRC_ALPHA]),is.create(i,{name:r,geometry:n,material:s,priority:0})},e.removeRenderPass=function(t){Tr(this._renderPasses,t)},nn(t,[{key:"renderPasses",get:function(){return this._renderPasses.slice()}},{key:"isDestroyed",get:function(){return this.destroyed}}]),t}();function Ps(t){return t?new Tn(t.getWidth(),t.getHeight()):new Tn}var Is,ws,Ls,Fs=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.configure=function(t){var e=t.getFramebuffer();e&&(this.prePassTexture=e.getColorTextures()[0]),t.setFramebuffer(null)},r.execute=function(t){t.clear(this.clearAction),this.meshes[0].material.setTexture("uFilterSource",this.prePassTexture),this.meshes[0].material.setVector2("uFilterSourceSize",Ps(this.prePassTexture)),t.renderMeshes(this.meshes),this.storeAction&&t.clear(this.storeAction)},e}(us),Ns=function(){this.floats={},this.ints={},this.vector3s={},this.vector4s={},this.matrices={},this.samplers=[],this.uniforms=[]},Ds=function(){function t(t){this.size=[0,0],this.multiSample=1,this.destroyed=!1;var e=t.storageType,r=t.format,i=t.attachment;this.storageType=e,this.format=r,this.attachment=i}return nn(t,[{key:"isDestroyed",get:function(){return this.destroyed}}]),t}(),Vs="function"==typeof r.WebGL2RenderingContext,Us=function(){function t(t){this.setupCapability(t)}var e=t.prototype;return e.setupCapability=function(t){var e,i=Vs&&hr(t,r.WebGL2RenderingContext)?2:1,n=2===i,o=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),s=t.getExtension("WEBGL_depth_texture"),a=!!t.getExtension("OES_texture_half_float_linear"),u=!!t.getExtension("OES_texture_float_linear");this.level=i,this.type=n?"webgl2":"webgl",this.vaoExt=t.getExtension("OES_vertex_array_object"),this.glAsyncCompileExt=t.getExtension("KHR_parallel_shader_compile"),this.UNSIGNED_INT_24_8=t.UNSIGNED_INT_24_8,this.drawBufferExtension=t.getExtension("WEBGL_draw_buffers"),s&&(this.UNSIGNED_INT_24_8=s.UNSIGNED_INT_24_8_WEBGL),n&&!a&&(a=Bs(t,t.HALF_FLOAT)),n&&!u&&(u=Bs(t,t.FLOAT)),this.internalFormatDepth16=n?t.DEPTH_COMPONENT16:t.DEPTH_COMPONENT,this.internalFormatDepth24_stencil8=n?t.DEPTH24_STENCIL8:t.DEPTH_STENCIL;var c=n||t.getExtension("OES_texture_float")?t.FLOAT:0,h=n?r.WebGL2RenderingContext.HALF_FLOAT:(null==(e=t.getExtension("OES_texture_half_float"))?void 0:e.HALF_FLOAT_OES)||0,l={floatTexture:c,halfFloatTexture:h,maxSample:n?t.getParameter(t.MAX_SAMPLES):1,maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVertexTextures:t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),maxFragmentTextures:t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),floatColorAttachment:n?!!t.getExtension("EXT_color_buffer_float"):c>0&&!!t.getExtension("WEBGL_color_buffer_float"),halfFloatColorAttachment:n?!!t.getExtension("EXT_color_buffer_float"):h>0&&!!t.getExtension("EXT_color_buffer_half_float"),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxShaderTexCount:t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),compressedTexture:ks(t),halfFloatLinear:a,floatLinear:u,maxTextureAnisotropy:o?t.getParameter(o.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,shaderTextureLod:n||!!t.getExtension("EXT_shader_texture_lod"),instanceDraw:n||!!t.getExtension("ANGLE_instanced_arrays"),drawBuffers:n||!!this.drawBufferExtension,asyncShaderCompile:!!this.glAsyncCompileExt,intIndexElementBuffer:!!t.getExtension("OES_element_index_uint"),standardDerivatives:n||!!t.getExtension("OES_standard_derivatives"),readableDepthStencilTextures:n||!!s,writableFragDepth:n||!!t.getExtension("EXT_frag_depth")};this.detail=l,o&&(this.textureMaxAnisotropyExt=o.TEXTURE_MAX_ANISOTROPY_EXT)},e.framebufferTexture2D=function(t,e,r,i,n){var o=this.drawBufferExtension;if(1===this.level&&!o&&r>0)throw new Error("Draw multiple color buffers not available.");var s=o?o["COLOR_ATTACHMENT"+r+"_WEBGL"]:t["COLOR_ATTACHMENT"+r];s?t.framebufferTexture2D(e,s,i,n,0):console.error("Invalid color attachment index: "+r+".")},e.drawBuffers=function(t,e){var r=this.drawBufferExtension;if(1!==this.level||r){var i=e.map((function(e,i){return e?r?r["COLOR_ATTACHMENT"+i+"_WEBGL"]:t["COLOR_ATTACHMENT"+i]:t.NONE}));r?r.drawBuffersWEBGL(i):t.drawBuffers(i)}else if(e.length>1)throw new Error("Draw buffers not available.")},e.setTextureAnisotropic=function(t,e,r){var i=this.detail.maxTextureAnisotropy;i&&t.texParameterf(e,this.textureMaxAnisotropyExt,Math.min(i,r||4))},t}();function Bs(t,e){var r=t.createTexture(),i=!1;return t.getError(),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.R16F,1,1,0,t.RED,e,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.getError()||(i=!0),t.deleteTexture(r),i}function ks(t){return t.getExtension("WEBGL_compressed_texture_astc")?2:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc")?1:0}exports.COMPRESSED_TEXTURE=void 0,(Is=exports.COMPRESSED_TEXTURE||(exports.COMPRESSED_TEXTURE={}))[Is.NONE=0]="NONE",Is[Is.PVRTC=1]="PVRTC",Is[Is.ASTC=2]="ASTC",exports.FilterMode=void 0,(ws=exports.FilterMode||(exports.FilterMode={}))[ws.Nearest=0]="Nearest",ws[ws.Linear=1]="Linear",exports.RenderTextureFormat=void 0,(Ls=exports.RenderTextureFormat||(exports.RenderTextureFormat={}))[Ls.RGBA32=0]="RGBA32",Ls[Ls.RGBAHalf=1]="RGBAHalf";var zs,Gs,Xs=function(){function t(){}var e=t.prototype;return e.resize=function(t,e,r,i){},e.resetColorTextures=function(t){},e.unbind=function(){},e.bind=function(){},e.getDepthTexture=function(){},e.getStencilTexture=function(){},e.getColorTextures=function(){return[]},e.dispose=function(t){},nn(t,[{key:"stencilStorage",get:function(){}},{key:"depthStorage",get:function(){}}]),t}(),Hs=function(){function t(){}var e=t.prototype;return e.setGlobalFloat=function(t,e){},e.setGlobalInt=function(t,e){},e.setGlobalVector4=function(t,e){},e.setGlobalVector3=function(t,e){},e.setGlobalMatrix=function(t,e){},e.getFramebuffer=function(){return null},e.setFramebuffer=function(t){},e.setViewport=function(t,e,r,i){},e.resize=function(t,e){},e.clear=function(t){},e.getWidth=function(){return 0},e.getHeight=function(){return 0},e.addLostHandler=function(t){},e.addRestoreHandler=function(t){},e.lost=function(t){},e.restore=function(){},e.getShaderLibrary=function(){},e.renderRenderFrame=function(t){},e.renderMeshes=function(t){},e.drawGeometry=function(t,e,r){},e.getTemporaryRT=function(t,e,r,i,n,o){return null},e.dispose=function(t){},t}(),js=(zs=new Float32Array(1),Gs=new Int32Array(zs.buffer),function(t){zs[0]=t;var e=Gs[0],r=e>>16&32768,i=e>>12&2047,n=e>>23&255;return n<103?r:n>142?(r|=31744,r|=(255==n?0:1)&&8388607&e):n<113?r|=((i|=2048)>>114-n)+(i>>113-n&1):(r|=n-112<<10|i>>1,r+=1&i)}),Ys=function(){function t(t){if(Number.isInteger(t))this.data=new Uint16Array(t);else if(t&&"object"==typeof t&&Number.isInteger(t.length))for(var e=this.data=new Uint16Array(t.length),r=0;r<e.length;r++)e[r]=js(t[r])}return t.prototype.set=function(t,e){for(var r=0;r<t.length;r++)this.data[r+e]=js(t[r])},t}();var Ws,Zs=new Wo,qs=new Pn;function Ks(t,e,r,i,n,o,s){var a=t,u=i/n,c=i,h=e.speedOverLifetime;h&&(c=h.getIntegrateValue(0,i,n));var l=e.gravityModifier?e.gravityModifier.getIntegrateByTime(0,i):0;a.copyFrom(o),a.addScaledVector(s,c),a.addScaledVector(r,l);var f=e.linearVelOverLifetime||{},p=e.orbitalVelOverLifetime||{};if(p.enabled){var d=new bn;p.center&&d.setFromArray(p.center);var m=a.clone().subtract(d),v=p.asRotation,y=["x","y","z"].map((function(t){var e=p[t];return e?v?e.getValue(u):e.getIntegrateValue(0,i,n):0}));Zs.setFromArray(y).negate(),qs.setFromEuler(Zs);var g=qs.transformPoint(m);a.addVectors(d,g)}if(f.enabled){var _=f.asMovement,E=f.x,x=f.y,T=f.z;if(E){var b=_?E.getValue(u):E.getIntegrateValue(0,i,n);a.x=a.x+b}if(x){var A=_?x.getValue(u):x.getIntegrateValue(0,i,n);a.y=a.y+A}if(T){var R=_?T.getValue(u):T.getIntegrateValue(0,i,n);a.z=a.z+R}}return a}function Qs(t){return Array.isArray(t)?[t[0],t[1],t[2]]:[0,0,0]}function Js(t,e){for(var r=0,i=t.length;r<i;r++)t[r]=e;return t}function $s(t,e,r){if(e&&r)for(var i=0,n=e.length;i<n;i++)t[i]=e[i]*r[i];else if(e){if(t!==e)for(var o=0;o<e.length;o++)t[o]=e[o]}else if(r&&t!==r)for(var s=0;s<r.length;s++)t[s]=r[s];return t}var ta=((Ws={})[Ei.PARTICLE_ORIGIN_CENTER]=[0,0],Ws[Ei.PARTICLE_ORIGIN_CENTER_BOTTOM]=[0,-.5],Ws[Ei.PARTICLE_ORIGIN_CENTER_TOP]=[0,.5],Ws[Ei.PARTICLE_ORIGIN_LEFT_TOP]=[-.5,.5],Ws[Ei.PARTICLE_ORIGIN_LEFT_CENTER]=[-.5,0],Ws[Ei.PARTICLE_ORIGIN_LEFT_BOTTOM]=[-.5,-.5],Ws[Ei.PARTICLE_ORIGIN_RIGHT_CENTER]=[.5,0],Ws[Ei.PARTICLE_ORIGIN_RIGHT_BOTTOM]=[.5,-.5],Ws[Ei.PARTICLE_ORIGIN_RIGHT_TOP]=[.5,.5],Ws);function ea(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}function ra(t,e,r){var i=r.position,n=new bn(t,e,0),o=new bn;return r.getInverseViewProjectionMatrix().projectPoint(n,o),o.subtract(i),new qo(i,o)}function ia(t,e,r){var i=t.x,n=t.y,o=t.z,s=new bn(i-e,n+r,o),a=new bn(i-e,n-r,o),u=new bn(i+e,n-r,o),c=new bn(i+e,n+r,o);return[{p0:s,p1:a,p2:u},{p0:s.clone(),p1:u.clone(),p2:c}]}function na(t,e,r){return void 0===r&&(r=1e-6),Math.abs(t-e)<r}function oa(t,e){void 0===e&&(e=2);var r=Math.pow(10,e);return Math.floor(t*r)/r}var sa={getPointInCurve:function(t){t[0];var e=t[1],r=this.getPointIndexInCurve(t),i=r.xIndex,n=r.yIndex,o=e[i],s=e[n];return new Tn(o,s)},getPointIndexInCurve:function(t){var e=t[0],r=t[2],i=e===Oi.LINE||e===Oi.EASE_OUT?0:e===Oi.EASE_IN||e===Oi.EASE||e===Oi.HOLD&&r===Oi.EASE_IN?2:0;return{xIndex:i,yIndex:i+1}},isLeftSideEase:function(t){var e=t[0];t[1];var r=t[2];return!(e!==Oi.HOLD||!this.isKeyframeTypeLeftSideEase(r))||this.isKeyframeTypeLeftSideEase(e)},isRightSideEase:function(t){var e=t[0];t[1];var r=t[2];return!(e!==Oi.HOLD||!this.isKeyframeTypeRightSideEase(r))||this.isKeyframeTypeRightSideEase(e)},isKeyframeTypeLeftSideEase:function(t){return[Oi.EASE,Oi.EASE_IN,Oi.AUTO].includes(t)},isKeyframeTypeRightSideEase:function(t){return[Oi.EASE,Oi.EASE_OUT,Oi.AUTO].includes(t)},isHoldInKeyframe:function(t){var e=t[0];t[1];var r=t[2];return e===Oi.HOLD&&[Oi.HOLD,Oi.LINE_OUT,Oi.EASE_OUT].includes(r)},isHoldOutKeyframe:function(t){var e=t[0];t[1];var r=t[2];return e===Oi.HOLD&&[Oi.HOLD,Oi.LINE,Oi.EASE_IN].includes(r)}},aa=function(t,e){this.points=t,this.totalLength=e},ua={},ca={},ha=.1;function la(t,e){return 1-3*e+3*t}function fa(t,e){return 3*e-6*t}function pa(t){return 3*t}function da(t,e,r){return((la(e,r)*t+fa(e,r))*t+pa(e))*t}function ma(t,e,r){return 3*la(e,r)*t*t+2*fa(e,r)*t+pa(e)}var va=function(){function t(t,e,r,i){this.p1=t,this.p2=e,this.p3=r,this.p4=i,this.catching={lastPoint:0,lastAddedLength:0};var n=function(t,e,r,i){var n=oa(e.x-t.x,3)+"_"+oa(e.y-t.y,3)+"_"+oa(e.z-t.z,3)+"&"+oa(r.x-t.x,3)+"_"+oa(r.y-t.y,3)+"_"+oa(r.z-t.z,3)+"&"+oa(i.x-t.x,3)+"_"+oa(i.y-t.y,3)+"_"+oa(i.z-t.z,3);if(ca[n])return{data:ca[n],interval:t};for(var o=[],s=null,a=0,u=0,c=0;c<300;c+=1){var h=new bn,l=c/299;u=0,h.x=3*Math.pow(1-l,2)*l*(r.x-t.x)+3*(1-l)*Math.pow(l,2)*(i.x-t.x)+Math.pow(l,3)*(e.x-t.x),h.y=3*Math.pow(1-l,2)*l*(r.y-t.y)+3*(1-l)*Math.pow(l,2)*(i.y-t.y)+Math.pow(l,3)*(e.y-t.y),h.z=3*Math.pow(1-l,2)*l*(r.z-t.z)+3*(1-l)*Math.pow(l,2)*(i.z-t.z)+Math.pow(l,3)*(e.z-t.z),null!==s&&(u+=Math.pow(h.x-s.x,2),u+=Math.pow(h.y-s.y,2),u+=Math.pow(h.z-s.z,2)),s=h,a+=u=Math.sqrt(u),o[c]={partialLength:u,point:h}}var f=new aa(o,a);return ca[n]=f,{data:f,interval:new bn(t.x,t.y,t.z)}}(t,e,r,i),o=n.data,s=n.interval;this.lengthData=o,this.interval=s,this.totalLength=o.totalLength}return t.prototype.getPointInPercent=function(t){var e=this.lengthData;if(0===t)return e.points[0].point.clone().add(this.interval);if(na(1-t,0))return e.points[299].point.clone().add(this.interval);if(na(e.totalLength,0))return this.p1.clone();var r=new bn,i=oa(e.totalLength*t,4),n=this.catching.lastAddedLength,o=this.catching.lastPoint;if(na(n,i))return e.points[o].point.clone().add(this.interval);var s=!0,a=1;for(i<n&&(a=-1);s;){if(i>=n){if(299===o){r.x=e.points[o].point.x,r.y=e.points[o].point.y,r.z=e.points[o].point.z;break}if(i<n+e.points[o+1].partialLength){var u=(i-n)/e.points[o+1].partialLength;r.x=e.points[o].point.x+(e.points[o+1].point.x-e.points[o].point.x)*u,r.y=e.points[o].point.y+(e.points[o+1].point.y-e.points[o].point.y)*u,r.z=e.points[o].point.z+(e.points[o+1].point.z-e.points[o].point.z)*u;break}}a>0&&o<299?(o+=a,n+=oa(e.points[o].partialLength,5)):a<0&&o>0?(n-=oa(e.points[o].partialLength,5),o+=a):s=!1}return this.catching.lastPoint=o,this.catching.lastAddedLength=n,r.add(this.interval),r},t}(),ya=function(){function t(t,e,r,i){this.p1=t,this.p2=e,this.p3=r,this.p4=i,this.temp=new Cn,this.totalLength=0}return t.prototype.getPointInPercent=function(t){return 0===t?this.temp.copyFrom(this.p1):na(1-t,0)?this.temp.copyFrom(this.p2):(Ea.slerpFlat(this.temp,this.p1,this.p2,t),this.temp)},t}(),ga=function(){function t(t,e,r,i){this.mX1=t,this.mY1=e,this.mX2=r,this.mY2=i,this.precomputed=!1,this.mSampleValues=new Array(11)}var e=t.prototype;return e.precompute=function(){this.precomputed=!0,this.mX1===this.mY1&&this.mX2===this.mY2||this.calcSampleValues()},e.getValue=function(t){return this.mX1===this.mY1&&this.mX2===this.mY2?t:isNaN(this.mY1)||isNaN(this.mY2)?0:0===t||1===t?t:(this.precomputed||this.precompute(),da(this.getTForX(t),this.mY1,this.mY2))},e.calcSampleValues=function(){for(var t=0;t<11;++t)this.mSampleValues[t]=da(t*ha,this.mX1,this.mX2)},e.getTForX=function(t){for(var e=this.mSampleValues,r=0,i=1;10!==i&&e[i]<=t;++i)r+=ha;var n=r+(t-e[--i])/(e[i+1]-e[i])*ha,o=ma(n,this.mX1,this.mX2);return o>=.001?function(t,e,r,i){for(var n=0;n<4;++n){var o=ma(e,r,i);if(0===o)return e;e-=(da(e,r,i)-t)/o}return e}(t,n,this.mX1,this.mX2):0===o?n:function(t,e,r,i,n){var o,s,a=0;do{(o=da(s=e+(r-e)/2,i,n)-t)>0?r=s:e=s}while(Math.abs(o)>1e-7&&++a<10);return s}(t,r,r+ha,this.mX1,this.mX2)},t}();function _a(t,e){var r=function(t,e,r){var i=t[1],n=sa.isHoldOutKeyframe(t),o=sa.isHoldInKeyframe(e),s=!o&&sa.isRightSideEase(t),a=!n&&sa.isLeftSideEase(e);if(s&&!a&&!o){var u=new Tn(i[i.length-4],i[i.length-3]),c=new Tn(i[i.length-2],i[i.length-1]),h=sa.getPointInCurve(e),l=new Tn(h.x,h.y);return{type:"ease",p0:u,p1:c,p2:new Tn(l.x-(l.x-u.x)/10,l.y),p3:l}}if(!s&&a&&!n){var f=e[1],p=sa.getPointInCurve(t),d=new Tn(p.x,p.y),m=new Tn(f[0],f[1]),v=new Tn(f[2],f[3]);return{type:"ease",p0:d,p1:new Tn(d.x+(v.x-d.x)/10,d.y),p2:m,p3:v}}if(s&&a){var y=e[1];return{type:"ease",p0:new Tn(i[i.length-4],i[i.length-3]),p1:new Tn(i[i.length-2],i[i.length-1]),p2:new Tn(y[0],y[1]),p3:new Tn(y[2],y[3])}}var g=sa.getPointInCurve(t),_=sa.getPointInCurve(e);n?_.y=g.y:o&&(g.y=_.y);return r?{type:"ease",p0:g,p1:new Tn((_.x-g.x)/3+g.x,(_.y-g.y)/3+g.y),p2:new Tn((_.x-g.x)/3*2+g.x,(_.y-g.y)/3*2+g.y),p3:_,isHold:n||o,leftHoldLine:n,rightHoldLine:o}:{type:"line",p0:g,p1:_,isHold:n||o,leftHoldLine:n,rightHoldLine:o}}(t,e,!0),i=r.p0,n=r.p1,o=r.p2,s=r.p3;zr(o),zr(s);var a,u,c=s.x-i.x,h=s.y-i.y,l=oa((n.x-i.x)/c,5),f=oa((o.x-i.x)/c,5);na(h,0)?a=u=NaN:(a=oa((n.y-i.y)/h,5),u=oa((o.y-i.y)/h,5)),l<0&&(console.error("Invalid bezier points, x1 < 0",i,n,o,s),l=0),f<0&&(console.error("Invalid bezier points, x2 < 0",i,n,o,s),f=0),l>1&&(console.error("Invalid bezier points, x1 >= 1",i,n,o,s),l=1),f>1&&(console.error("Invalid bezier points, x2 >= 1",i,n,o,s),f=1);var p,d=("bez_"+l+"_"+a+"_"+f+"_"+u).replace(/\./g,"p");return ua[d]?p=ua[d]:(p=new ga(l,a,f,u),ua[d]=p),{points:[i,n,o,s],timeInterval:c,valueInterval:h,curve:p}}var Ea=function(){function t(){}return t.slerpFlat=function(t,e,r,i){var n=e.x,o=e.y,s=e.z,a=e.w,u=r.x,c=r.y,h=r.z,l=r.w;if(0===i)return t.x=n,t.y=o,t.z=s,void(t.w=a);if(1===i)return t.x=u,t.y=c,t.z=h,void(t.w=l);if(a!==l||n!==u||o!==c||s!==h){var f=1-i,p=n*u+o*c+s*h+a*l,d=p>=0?1:-1,m=1-p*p;if(m>Number.EPSILON){var v=Math.sqrt(m),y=Math.atan2(v,p*d);f=Math.sin(f*y)/v,i=Math.sin(i*y)/v}var g=i*d;if(n=n*f+u*g,o=o*f+c*g,s=s*f+h*g,a=a*f+l*g,f===1-i){var _=1/Math.sqrt(n*n+o*o+s*s+a*a);n*=_,o*=_,s*=_,a*=_}}t.x=n,t.y=o,t.z=s,t.w=a},t}(),xa="not_implement",Ta=function(){function t(t){this.onCreate(t)}var e=t.prototype;return e.onCreate=function(t){throw new Error(xa)},e.getIntegrateValue=function(t,e,r){throw new Error(xa)},e.getIntegrateByTime=function(t,e){throw new Error(xa)},e.getValue=function(t){throw new Error(xa)},e.getMaxTime=function(){throw new Error(xa)},e.toUniform=function(t){throw new Error(xa)},e.map=function(t){throw new Error(xa)},e.scaleXCoord=function(t){return this},e.toData=function(){throw new Error(xa)},t.getAllData=function(t,e){for(var r=new(e?Ys:Float32Array)(4*t.index),i=0,n=0,o=t.curves;i<o.length;i++){var s=o[i].toData();r.set(s,n),n+=s.length}return e?r.data:r},t}(),ba=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.value=t},r.getIntegrateValue=function(t,e,r){return this.value*(e-t)},r.getIntegrateByTime=function(t,e){return.5*this.value*(e*e-t*t)},r.getValue=function(t){return this.value},r.toUniform=function(){return new Float32Array([0,this.value,0,0])},r.map=function(t){var e=this.value;return this.value=t(e),this},r.getMaxTime=function(){return 0},e}(Ta),Aa=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.items=t},r.getValue=function(t){var e=this.items;return e[Math.floor(Math.random()*e.length)]},r.map=function(t){return this.items=this.items.map(t),this},e}(Ta),Ra=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.min=t[0],this.max=t[1]},r.getValue=function(t,e){var r=null!=e?e:Math.random();return this.min+r*(this.max-this.min)},r.getIntegrateValue=function(t,e,r){var i=null!=r?r:1;return(this.min+i*(this.max-this.min))*(e-t)},r.toUniform=function(){return new Float32Array([4,this.min,this.max,0])},r.map=function(t){return this.min=t(this.min),this.max=t(this.max),this},e}(Ta),Sa=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.min=t[0],this.max=t[1]},r.getValue=function(t){for(var e=this.min,r=this.max,i=[],n=0;n<e.length;n++){var o=Math.random();i[n]=e[n]*(1-o)+r[n]*o}return i},r.map=function(t){return this.min=this.min.map(t),this.max=this.max.map(t),this},e}(Ta),Ca=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.min=t[0],this.max=t[1],this.xCoord=1},r.getValue=function(t){return t/=this.xCoord,this.min*(1-t)+this.max*t},r.toUniform=function(){return new Float32Array([1,this.min,this.max,this.xCoord])},r.getIntegrateValue=function(t,e,r){void 0===r&&(r=1);var i=this.min,n=this.max,o=this.xCoord*r;return((i+e/o*(n-i)+i)*e-(i+t/o*(n-i)+i)*t)/2},r.getIntegrateByTime=function(t,e){return Na(e,0,this.xCoord,this.min,this.max)-Na(t,0,this.xCoord,this.min,this.max)},r.map=function(t){return this.min=t(this.min),this.max=t(this.max),this},r.scaleXCoord=function(t){return this.xCoord=t,this},e}(Ta),Oa=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.stops=Sr(t)},r.getStops=function(){return this.stops},r.getValue=function(t){for(var e=this.stops,r=e.length-1,i=0;i<r;i++){var n=e[i],o=e[i+1];if(n.stop<=t&&o.stop>t){var s=(t-n.stop)/(o.stop-n.stop);return Cr(n.color,o.color,s,!0)}}return e[r].color.slice()},e}(Ta),Ma=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.keys=t.map((function(t){return t.slice?t.slice(0,2):[t.time,t.value]})).sort((function(t,e){return t[0]-e[0]}));var e=this.keys[this.keys.length-1];e[0]<1&&this.keys.push([1,e[1]]);var r=this.keys[0];r[0]>0&&this.keys.unshift([0,r[1]]),this.isLineSeg=!0},r.getValue=function(t){var e=this.keys;if(t<e[0][0])return e[0][1];for(var r=e.length-1,i=0;i<r;i++){var n=e[i],o=e[i+1],s=n[0],a=o[0];if(t>=s&&t<=a){var u=(t-s)/(a-s),c=n[1];return c+u*(o[1]-c)}}return e[r][1]},r.getIntegrateValue=function(t,e,r){return void 0===r&&(r=1),(this.integrate(e,!1)-this.integrate(t,!1))*r},r.getIntegrateByTime=function(t,e){return this.integrate(e,!0)-this.integrate(t,!0)},r.integrate=function(t,e){var r=this.keys;if(t<=r[0][0])return 0;for(var i=0,n=r.length-1,o=e?Na:Fa,s=0;s<n;s++){var a=r[s],u=r[s+1],c=a[0],h=u[0];if(t>c&&t<=h)return i+o(t,c,h,a[1],u[1]);i+=o(h,c,h,a[1],u[1])}return i},r.toData=function(){for(var t=this.keys,e=new Float32Array(4*Math.ceil(t.length/2)),r=0,i=0;r<t.length;r++,i+=2)e.set(t[r],i);return e.set(t[t.length-1],e.length-2),e},r.toUniform=function(t){var e=t.index,r=this.keys,i=Math.ceil(r.length/2);return t.lineSegCount+=i,t.curves.push(this),t.index+=i,t.max=Math.max(t.max,i),new Float32Array([3,e,i,0])},r.map=function(t){return this.keys.forEach((function(e){return e[1]=t(e[1])})),this},r.scaleXCoord=function(t){return this.keys.forEach((function(e){return e[0]=t*e[0]})),this},e}(Ta),Pa=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){var e=t;this.curveMap={},this.keys=[];for(var r=0;r<e.length-1;r++){var i=_a(e[r],e[r+1]),n=i.points,o=i.curve,s=i.timeInterval,a=i.valueInterval,u=n[0],c=n[n.length-1];this.keys.push([].concat(u.toArray(),n[1].toArray())),this.keys.push([].concat(c.toArray(),n[2].toArray())),this.curveMap[u.x+"&"+c.x]={points:n,timeInterval:s,valueInterval:a,curve:o,timeStart:Number(u.x),timeEnd:Number(c.x)}}this.keyTimeData=Object.keys(this.curveMap)},r.getValue=function(t){var e=0,r=this.keyTimeData,i=this.curveMap[r[0]].timeStart,n=this.curveMap[r[r.length-1]].timeEnd;if(t<=i)return this.getCurveValue(r[0],i);if(t>=n)return this.getCurveValue(r[r.length-1],n);for(var o=0;o<r.length;o++){var s=this.curveMap[r[o]].timeStart,a=this.curveMap[r[o]].timeEnd;if(t>=Number(s)&&t<Number(a)){e=this.getCurveValue(r[o],t);break}}return e},r.getIntegrateValue=function(t,e,r){void 0===r&&(r=1);var i=(e-t)/r,n=0,o=Object.keys(this.curveMap);if(i<=this.curveMap[o[0]].timeStart)return 0;for(var s=0;s<o.length;s++){var a=this.curveMap[o[s]].timeStart,u=this.curveMap[o[s]].timeEnd;if(i>=Number(u)&&(n+=r*this.getCurveIntegrateValue(o[s],Number(u))),i>=Number(a)&&i<Number(u)){n+=r*this.getCurveIntegrateValue(o[s],i);break}}return n},r.getIntegrateByTime=function(t,e){return this.getIntegrateValue(0,e)-this.getIntegrateValue(0,t)},r.getCurveIntegrateValue=function(t,e){for(var r=this.curveMap[t],i=r.points[0],n=r.timeInterval,o=r.valueInterval,s=0,a=(e-i.x)/20,u=0;u<=20;u++){var c=u*a/n,h=i.y+o*r.curve.getValue(c);s+=0===u||20===u?h:u%2==1?4*h:2*h}return s*=a/3},r.getCurveValue=function(t,e){var r=this.curveMap[t],i=r.points[0],n=r.timeInterval,o=r.valueInterval,s=(e-i.x)/n,a=r.curve.getValue(s);return i.y+o*a},r.toUniform=function(t){var e=t.index,r=this.keys.length;return t.curves.push(this),t.index=e+r,t.max=Math.max(t.max,r),t.curveCount+=r,new Float32Array([5,e+1/r,e,r])},r.toData=function(){for(var t=this.keys,e=new Float32Array(4*t.length),r=0,i=0;r<t.length;r++,i+=4)e.set(t[r],i);return e},r.getMaxTime=function(){var t=this.keyTimeData;return this.curveMap[t[t.length-1]].timeEnd},e}(Ta),Ia=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.keys=t[0],this.values=t[1]},r.getValue=function(t){for(var e=this.keys,r=this.values,i=0;i<e.length-1;i++){var n=e[i],o=e[i+1];if(n[0]<=t&&o[0]>=t){var s=o[1]-n[1],a=void 0;if(0===s)a=(t-n[0])/(o[0]-n[0]);else a=(Da(t,n,o)-n[1])/s;return this.calculateVec(i,a)}}return t<=e[0][0]?r[0].slice():r[r.length-1].slice()},r.calculateVec=function(t,e){for(var r=this.values[t],i=this.values[t+1],n=[0,0,0],o=0;o<r.length;o++)n[o]=r[o]*(1-e)+i[o]*e;return n},e}(Ta),wa=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){var e=t[0],r=t[1],i=t[2];if(this.curveSegments={},i.length){for(var n=0;n<e.length-1;n++){var o=e[n],s=e[n+1],a=new bn(r[n][0],r[n][1],r[n][2]),u=new bn(r[n+1][0],r[n+1][1],r[n+1][2]),c=new bn(i[2*n][0],i[2*n][1],i[2*n][2]),h=new bn(i[2*n+1][0],i[2*n+1][1],i[2*n+1][2]),l=_a(o,s),f=l.points,p=l.curve,d=l.timeInterval,m=l.valueInterval,v=f[0],y=f[f.length-1],g=new va(a,u,c,h);this.curveSegments[v.x+"&"+y.x]={points:f,timeInterval:d,valueInterval:m,easingCurve:p,pathCurve:g,timeStart:Number(v.x),timeEnd:Number(y.x)}}this.keyTimeData=Object.keys(this.curveSegments)}},r.getValue=function(t){var e=oa(t,5),r=0,i=new bn,n=this.keyTimeData;if(!n.length)return i;var o=this.curveSegments[n[0]].timeStart,s=this.curveSegments[n[n.length-1]].timeEnd;if(e<=o)return i=this.curveSegments[n[0]].pathCurve.getPointInPercent(0);if(e>=s)return i=this.curveSegments[n[n.length-1]].pathCurve.getPointInPercent(1);for(var a=0;a<n.length;a++){var u=this.curveSegments[n[a]].timeStart,c=this.curveSegments[n[a]].timeEnd;if(e>=Number(u)&&e<Number(c)){var h=this.curveSegments[n[a]].pathCurve;r=this.getPercValue(n[a],e),i=h.getPointInPercent(r)}}return i},r.getPercValue=function(t,e){var r=this.curveSegments[t],i=r.points[0],n=r.timeInterval,o=oa((e-i.x)/n,4);return xn(r.easingCurve.getValue(o),0,1)},r.getMaxTime=function(){var t=this.keyTimeData;return this.curveSegments[t[t.length-1]].timeEnd},e}(Ta),La=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){var e=t[0],r=t[1],i=t[2];if(this.curveSegments={},i.length)for(var n=0;n<e.length-1;n++){var o=e[n],s=e[n+1],a=Cn.fromArray(r[n]),u=Cn.fromArray(r[n+1]),c=Cn.fromArray(i[2*n]),h=Cn.fromArray(i[2*n+1]),l=_a(o,s),f=l.points,p=l.curve,d=l.timeInterval,m=l.valueInterval,v=f[0],y=f[f.length-1],g=new ya(a,u,c,h);this.curveSegments[v.x+"&"+y.x]={points:f,timeInterval:d,valueInterval:m,easingCurve:p,pathCurve:g}}},r.getValue=function(t){var e=0,r=oa(t,5),i=Object.keys(this.curveSegments),n=Number(i[0].split("&")[0]),o=Number(i[i.length-1].split("&")[1]);if(r<=n)return this.curveSegments[i[0]].pathCurve.getPointInPercent(0);if(r>=o)return this.curveSegments[i[i.length-1]].pathCurve.getPointInPercent(1);for(var s=0;s<i.length;s++){var a=i[s].split("&"),u=a[0],c=a[1];if(r>=Number(u)&&r<Number(c)){var h=this.curveSegments[i[s]].pathCurve;return e=this.getPercValue(i[s],r),h.getPointInPercent(e)}}return this.curveSegments[i[0]].pathCurve.getPointInPercent(0)},r.getPercValue=function(t,e){var r=this.curveSegments[t],i=r.points[0],n=r.timeInterval,o=oa((e-i.x)/n,4);return xn(r.easingCurve.getValue(o),0,1)},r.getMaxTime=function(){var t=Object.keys(this.curveSegments);return Number(t[t.length-1].split("&")[1])},e}(Ta);function Fa(t,e,r,i,n){var o=t-e;return(i+i+(n-i)*o/(r-e))*o/2}function Na(t,e,r,i,n){var o=t*t,s=e*e;return(2*(o*t)*(i-n)+3*o*(e*n-r*i)-s*e*(2*i+n)+3*s*r*i)/(6*(e-r))}function Da(t,e,r){var i=r[0]-e[0],n=e[3]*i,o=r[2]*i,s=(t-e[0])/i,a=s*s,u=a*s,c=u-2*a+s,h=u-a,l=-2*u+3*a;return(2*u-3*a+1)*e[1]+c*n+h*o+l*r[1]}function Va(t,e){if(e){var r=e[0],i=e[1];if(r===Ci.CURVE){t.curves.push(i);var n=i.length;i[0][0]>0&&n++,i[i.length-1][0]<1&&n++,t.index+=n,t.max=Math.max(t.max,n),t.curveCount+=n}else if(r===Ci.LINE){var o=i.length;if(2===o&&0===i[0][0]&&1===i[1][0])return;i[0][0]>0&&o++,i[i.length-1][0]<1&&o++;var s=Math.ceil(o/2);t.lineSegCount+=s,t.curves.push(i),t.index+=s,t.max=Math.max(t.max,s)}else if(r===Ci.BEZIER_CURVE){var a=i.length-1;t.index+=2*a,t.curves.push(i),t.max=Math.max(t.max,2*a),t.curveCount+=2*a}}}function Ua(){return{curves:[],index:0,max:0,lineSegCount:0,curveCount:0}}function Ba(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ba=function(){return!!t})()}function ka(t,e,r){return ka=Ba()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);var n=new(Function.bind.apply(t,i));return r&&Ai(n,r.prototype),n},ka.apply(null,arguments)}var za,Ga=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=new An,e}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.xCurve=Ya(t[0]),this.yCurve=Ya(t[1]),this.zCurve=Ya(t[2]),this.wCurve=Ya(t[3])},r.getValue=function(t){var e=this.xCurve.getValue(t),r=this.yCurve.getValue(t),i=this.zCurve.getValue(t),n=this.wCurve.getValue(t);return this.value.set(e,r,i,n),this.value},e}(Ta),Xa="editor",Ha={"Item duration can't be less than 0":"https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#AOnQS","ValueType: 21/22 is not supported":"https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#smO1b"},ja=((za={})[Ci.RANDOM]=function(t){return hr(t[0],Array)?new Sa(t):new Ra(t)},za[Ci.CONSTANT]=function(t){return new ba(t)},za[Ci.CONSTANT_VEC2]=function(t){return new ba(t)},za[Ci.CONSTANT_VEC3]=function(t){return new ba(t)},za[Ci.CONSTANT_VEC4]=function(t){return new ba(t)},za[Ci.RGBA_COLOR]=function(t){return new ba(t)},za[Ci.COLORS]=function(t){return new Aa(t.map((function(t){return Ar(t,!1)})))},za[Ci.LINE]=function(t){return 2===t.length&&0===t[0][0]&&1===t[1][0]?new Ca([t[0][1],t[1][1]]):new Ma(t)},za[Ci.GRADIENT_COLOR]=function(t){return new Oa(t)},za[Ci.LINEAR_PATH]=function(t){return new Ia(t)},za[Ci.BEZIER_CURVE]=function(t){return 1===t.length?new ba(t[0][1][1]):new Pa(t)},za[Ci.BEZIER_CURVE_PATH]=function(t){return 1===t[0].length?new ba(ka(bn,[].concat(t[1][0]))):new wa(t)},za[Ci.BEZIER_CURVE_QUAT]=function(t){return 1===t[0].length?new ba(ka(Cn,[].concat(t[1][0]))):new La(t)},za[Ci.COLOR_CURVE]=function(t){return new Wa(t)},za[Ci.VECTOR4_CURVE]=function(t){return new Ga(t)},za);function Ya(t){if(!t||!isNaN(+t))return new ba(t||0);if(hr(t,Ta))return t;if(Kr(ja[t[0]]))return ja[t[0]](t[1]);throw new Error("ValueType: "+t[0]+" is not supported, see "+Ha["ValueType: 21/22 is not supported"]+".")}var Wa=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=new Ko,e}Ri(e,t);var r=e.prototype;return r.onCreate=function(t){this.rCurve=Ya(t[0]),this.gCurve=Ya(t[1]),this.bCurve=Ya(t[2]),this.aCurve=Ya(t[3])},r.getValue=function(t){var e=this.rCurve.getValue(t),r=this.gCurve.getValue(t),i=this.bCurve.getValue(t),n=this.aCurve.getValue(t);return this.value.set(e,r,i,n),this.value},e}(Ta),Za=function(t){function e(e){var r;(r=t.call(this,e)||this).cachePrefix="-",r.color=[1,1,1,1],r.visible=!0,r.isManualTimeSet=!1,r.frameAnimationTime=0,r.getHitTestParams=function(t){var e=r.interaction;if(t||e){var i,n=r.getBoundingBox();if(n)return{behavior:(null==(i=r.interaction)?void 0:i.behavior)||0,type:n.type,triangles:n.area,backfaceCulling:r.renderer.side===fi.FRONT}}},r.renderer={renderMode:_i.MESH,blending:li.ALPHA,texture:r.engine.emptyTexture,occlusion:!1,transparentOcclusion:!1,side:fi.DOUBLE,mask:0,maskMode:pi.NONE,order:0},r.emptyTexture=r.engine.emptyTexture,r.renderInfo=qa(Sn(r));var i=r.createMaterial(r.renderInfo,2);return r.worldMatrix=Pn.fromIdentity(),r.material=i,r.material.setVector4("_Color",(new An).setFromArray([1,1,1,1])),r.material.setVector4("_TexOffset",(new An).setFromArray([0,0,1,1])),r}Ri(e,t);var r=e.prototype;return r.setVisible=function(t){this.visible=t},r.getVisible=function(){return this.visible},r.setColor=function(t){this.color=t,this.material.setVector4("_Color",(new An).setFromArray(t))},r.setTexture=function(t){this.renderer.texture=t,this.material.setTexture("_MainTex",t)},r.setAnimationTime=function(t){this.frameAnimationTime=t,this.isManualTimeSet=!0},r.render=function(t){if(this.getVisible()){var e=this.material,r=this.geometry;t.renderingData.currentFrame.globalUniforms&&t.setGlobalMatrix("effects_ObjectToWorld",this.transform.getWorldMatrix()),this.material.setVector2("_Size",this.transform.size),this.renderer.renderMode!==_i.BILLBOARD&&this.renderer.renderMode!==_i.VERTICAL_BILLBOARD&&this.renderer.renderMode!==_i.HORIZONTAL_BILLBOARD||this.material.setVector3("_Scale",this.transform.scale),t.drawGeometry(r,e)}},r.onStart=function(){this.item.getHitTestParams=this.getHitTestParams},r.onDestroy=function(){this.item&&this.item.composition&&this.item.composition.destroyTextures(this.getTextures())},r.getItemInitData=function(){this.geoData=this.getItemGeometryData();var t=this.geoData,e=t.index,r=t.atlasOffset,i=e.length,n=this.wireframe?new Uint8Array([0,1,1,3,2,3,2,0]):new e.constructor(i);if(!this.wireframe)for(var o=0;o<i;o++)n[o]=0+e[o];return{atlasOffset:r,index:n}},r.setItem=function(){var t=this.renderer.texture;t&&xr([],t),t=this.renderer.texture;var e=this.getItemInitData(),r=this.renderer,i=this.material.getVector4("_TexParams");i&&(i.x=r.occlusion?+r.transparentOcclusion:1,i.y=+this.preMultiAlpha,i.z=r.renderMode,0===i.x?this.material.enableMacro("ALPHA_CLIP"):this.material.disableMacro("ALPHA_CLIP"));var n={atlasOffset:new Float32Array(e.atlasOffset.length),index:new Uint16Array(e.index.length)};n.atlasOffset.set(e.atlasOffset),n.index.set(e.index);var o=this.material,s=this.geometry,a=n.index;s.setIndexData(a),s.setAttributeData("atlasOffset",n.atlasOffset),s.setDrawCount(e.index.length),o.setTexture("_MainTex",t)},r.getItemGeometryData=function(){var t=this.renderer;if(t.shape){for(var e=t.shape,r=e.index,i=void 0===r?[]:r,n=e.aPoint,o=void 0===n?[]:n,s=new Float32Array(o),a=[],u=[],c=0;c<s.length;c+=6)u.push(o[c+2],o[c+3]),a.push(s[c],s[c+1],0);return this.geometry.setAttributeData("aPos",new Float32Array(a)),{index:i,atlasOffset:u}}return this.geometry.setAttributeData("aPos",new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0])),{index:[0,1,2,2,1,3],atlasOffset:[0,1,0,0,1,1,1,0]}},r.createGeometry=function(t){return jo.create(this.engine,{attributes:{aPos:{type:jn.FLOAT,size:3,data:new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0])},atlasOffset:{size:2,offset:0,releasable:!0,type:jn.FLOAT,data:new Float32Array(0)}},indices:{data:new Uint16Array(0),releasable:!0},mode:t,maxVertex:4})},r.createMaterial=function(t,e){var r=t.side,i=t.occlusion,n=t.blending,o=t.maskMode,s=t.mask,a={shader:Ou(t,e,1)};this.preMultiAlpha=Kn(n);var u=Bo.create(this.engine,a),c={side:r,blending:!0,blendMode:n,mask:s,maskMode:o,depthTest:!0,depthMask:i};return u.blending=c.blending,u.stencilRef=void 0!==c.mask?[c.mask,c.mask]:void 0,u.depthTest=c.depthTest,u.depthMask=c.depthMask,Qn(u,c.blendMode),$n(u,c.maskMode),Jn(u,c.side),u.shader.shaderData.properties='_MainTex("_MainTex",2D) = "white" {}',u.hasUniform("_Color")||u.setVector4("_Color",new An(0,0,0,1)),u.hasUniform("_TexOffset")||u.setVector4("_TexOffset",new An),u.hasUniform("_TexParams")||u.setVector4("_TexParams",new An),u},r.getTextures=function(){var t=[],e=this.renderer.texture;return e&&t.push(e),t},r.getBoundingBox=function(){if(this.item){var t=this.transform.getWorldMatrix(),e=ia(bn.ZERO,.5*this.transform.size.x,.5*this.transform.size.y);return e.forEach((function(e){t.transformPoint(e.p0),t.transformPoint(e.p1),t.transformPoint(e.p2)})),{type:exports.HitTestType.triangle,area:e}}},e}(dn);function qa(t){var e=t.renderer,r=e.blending,i=e.side,n=e.occlusion,o=e.mask,s=e.maskMode,a=e.order,u=+r,c=t.cachePrefix||"-";return{side:i,occlusion:n,blending:r,mask:o,maskMode:s,cachePrefix:c,cacheId:c+"."+ +i+"+"+ +n+"+"+u+"+"+a+"+"+s+"."+o}}var Ka=function(){},Qa="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ja={exports:{}};!function(t){var e;function r(t,e){return t.b===e.b&&t.a===e.a}function i(t,e){return t.b<e.b||t.b===e.b&&t.a<=e.a}function n(t,e,r){var i=e.b-t.b,n=r.b-e.b;return 0<i+n?i<n?e.a-t.a+i/(i+n)*(t.a-r.a):e.a-r.a+n/(i+n)*(r.a-t.a):0}function o(t,e,r){var i=e.b-t.b,n=r.b-e.b;return 0<i+n?(e.a-r.a)*i+(e.a-t.a)*n:0}function s(t,e){return t.a<e.a||t.a===e.a&&t.b<=e.b}function a(t,e,r){var i=e.a-t.a,n=r.a-e.a;return 0<i+n?i<n?e.b-t.b+i/(i+n)*(t.b-r.b):e.b-r.b+n/(i+n)*(r.b-t.b):0}function u(t,e,r){var i=e.a-t.a,n=r.a-e.a;return 0<i+n?(e.b-r.b)*i+(e.b-t.b)*n:0}function c(t){return i(t.b.a,t.a)}function h(t){return i(t.a,t.b.a)}function l(t,e,r,i){return(t=0>t?0:t)<=(r=0>r?0:r)?0===r?(e+i)/2:e+t/(t+r)*(i-e):i+r/(t+r)*(e-i)}function f(t){var e=y(t.b);return _(e,t.c),_(e.b,t.c),E(e,t.a),e}function p(t,e){var r=!1,i=!1;t!==e&&(e.a!==t.a&&(i=!0,T(e.a,t.a)),e.d!==t.d&&(r=!0,b(e.d,t.d)),g(e,t),i||(_(e,t.a),t.a.c=t),r||(E(e,t.d),t.d.a=t))}function d(t){var e=t.b,r=!1;t.d!==t.b.d&&(r=!0,b(t.d,t.b.d)),t.c===t?T(t.a,null):(t.b.d.a=$(t),t.a.c=t.c,g(t,$(t)),r||E(t,t.d)),e.c===e?(T(e.a,null),b(e.d,null)):(t.d.a=$(e),e.a.c=e.c,g(e,$(e))),x(t)}function m(t){var e=y(t),r=e.b;return g(e,t.e),e.a=t.b.a,_(r,e.a),e.d=r.d=t.d,e=e.b,g(t.b,$(t.b)),g(t.b,e),t.b.a=e.a,e.b.a.c=e.b,e.b.d=t.b.d,e.f=t.f,e.b.f=t.b.f,e}function v(t,e){var r=!1,i=y(t),n=i.b;return e.d!==t.d&&(r=!0,b(e.d,t.d)),g(i,t.e),g(n,e),i.a=t.b.a,n.a=e.a,i.d=n.d=t.d,t.d.a=n,r||E(i,t.d),i}function y(t){var e=new J,r=new J,i=t.b.h;return r.h=i,i.b.h=e,e.h=t,t.b.h=r,e.b=r,e.c=e,e.e=r,r.b=e,r.c=r,r.e=e}function g(t,e){var r=t.c,i=e.c;r.b.e=e,i.b.e=t,t.c=i,e.c=r}function _(t,e){var r=e.f,i=new et(e,r);r.e=i,e.f=i,r=i.c=t;do{r.a=i,r=r.c}while(r!==t)}function E(t,e){var r=e.d,i=new Q(e,r);r.b=i,e.d=i,i.a=t,i.c=e.c,r=t;do{r.d=i,r=r.e}while(r!==t)}function x(t){var e=t.h;t=t.b.h,e.b.h=t,t.b.h=e}function T(t,e){var r=t.c,i=r;do{i.a=e,i=i.c}while(i!==r);r=t.f,(i=t.e).f=r,r.e=i}function b(t,e){var r=t.a,i=r;do{i.d=e,i=i.e}while(i!==r);r=t.d,(i=t.b).d=r,r.b=i}function A(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e}var R=4e150;function S(t,e){t.f+=e.f,t.b.f+=e.b.f}function C(t,e,r){return t=t.a,e=e.a,r=r.a,e.b.a===t?r.b.a===t?i(e.a,r.a)?0>=o(r.b.a,e.a,r.a):0<=o(e.b.a,r.a,e.a):0>=o(r.b.a,t,r.a):r.b.a===t?0<=o(e.b.a,t,e.a):(e=n(e.b.a,t,e.a))>=(t=n(r.b.a,t,r.a))}function O(t){t.a.i=null;var e=t.e;e.a.c=e.c,e.c.a=e.a,t.e=null}function M(t,e){d(t.a),t.c=!1,t.a=e,e.i=t}function P(t){var e=t.a.a;do{t=pt(t)}while(t.a.a===e);return t.c&&(M(t,e=v(ft(t).a.b,t.a.e)),t=pt(t)),t}function I(t,e,r){var i=new lt;return i.a=r,i.e=j(t.f,e.e,i),r.i=i}function w(t,e){switch(t.s){case 100130:return!!(1&e);case 100131:return 0!==e;case 100132:return 0<e;case 100133:return 0>e;case 100134:return 2<=e||-2>=e}return!1}function L(t){var e=t.a,r=e.d;r.c=t.d,r.a=e,O(t)}function F(t,e,r){for(t=e,e=e.a;t!==r;){t.c=!1;var i=ft(t),n=i.a;if(n.a!==e.a){if(!i.c){L(t);break}M(i,n=v(e.c.b,n.b))}e.c!==n&&(p($(n),n),p(e,n)),L(t),e=i.a,t=i}return e}function N(t,e,r,i,n,o){var s=!0;do{I(t,e,r.b),r=r.c}while(r!==i);for(null===n&&(n=ft(e).a.b.c);(r=(i=ft(e)).a.b).a===n.a;)r.c!==n&&(p($(r),r),p($(n),r)),i.f=e.f-r.f,i.d=w(t,i.f),e.b=!0,!s&&B(t,e)&&(S(r,n),O(e),d(n)),s=!1,e=i,n=r;e.b=!0,o&&z(t,e)}function D(t,e,r,i,n){var o=[e.g[0],e.g[1],e.g[2]];e.d=null,e.d=t.o&&t.o(o,r,i,t.c)||null,null===e.d&&(n?t.n||(K(t,100156),t.n=!0):e.d=r[0])}function V(t,e,r){var i=[null,null,null,null];i[0]=e.a.d,i[1]=r.a.d,D(t,e.a,i,[.5,.5,0,0],!1),p(e,r)}function U(t,e,r,i,n){var o=Math.abs(e.b-t.b)+Math.abs(e.a-t.a),s=Math.abs(r.b-t.b)+Math.abs(r.a-t.a),a=n+1;i[n]=.5*s/(o+s),i[a]=.5*o/(o+s),t.g[0]+=i[n]*e.g[0]+i[a]*r.g[0],t.g[1]+=i[n]*e.g[1]+i[a]*r.g[1],t.g[2]+=i[n]*e.g[2]+i[a]*r.g[2]}function B(t,e){var n=ft(e),s=e.a,a=n.a;if(i(s.a,a.a)){if(0<o(a.b.a,s.a,a.a))return!1;if(r(s.a,a.a)){if(s.a!==a.a){n=t.e;var u=s.a.h;if(0<=u){var c=(n=n.b).d,h=n.e,l=n.c,f=l[u];c[f]=c[n.a],l[c[f]]=f,f<=--n.a&&(1>=f||i(h[c[f>>1]],h[c[f]])?ct(n,f):ht(n,f)),h[u]=null,l[u]=n.b,n.b=u}else for(n.c[-(u+1)]=null;0<n.a&&null===n.c[n.d[n.a-1]];)--n.a;V(t,$(a),s)}}else m(a.b),p(s,$(a)),e.b=n.b=!0}else{if(0>o(s.b.a,a.a,s.a))return!1;pt(e).b=e.b=!0,m(s.b),p($(a),s)}return!0}function k(t,e){var c=ft(e),h=e.a,f=c.a,d=h.a,v=f.a,y=h.b.a,g=f.b.a,_=new et;if(o(y,t.a,d),o(g,t.a,v),d===v||Math.min(d.a,y.a)>Math.max(v.a,g.a))return!1;if(i(d,v)){if(0<o(g,d,v))return!1}else if(0>o(y,v,d))return!1;var E,x,T=y,b=d,A=g,R=v;if(i(T,b)||(E=T,T=b,b=E),i(A,R)||(E=A,A=R,R=E),i(T,A)||(E=T,T=A,A=E,E=b,b=R,R=E),i(A,b)?i(b,R)?(0>(E=n(T,A,b))+(x=n(A,b,R))&&(E=-E,x=-x),_.b=l(E,A.b,x,b.b)):(0>(E=o(T,A,b))+(x=-o(T,R,b))&&(E=-E,x=-x),_.b=l(E,A.b,x,R.b)):_.b=(A.b+b.b)/2,s(T,b)||(E=T,T=b,b=E),s(A,R)||(E=A,A=R,R=E),s(T,A)||(E=T,T=A,A=E,E=b,b=R,R=E),s(A,b)?s(b,R)?(0>(E=a(T,A,b))+(x=a(A,b,R))&&(E=-E,x=-x),_.a=l(E,A.a,x,b.a)):(0>(E=u(T,A,b))+(x=-u(T,R,b))&&(E=-E,x=-x),_.a=l(E,A.a,x,R.a)):_.a=(A.a+b.a)/2,i(_,t.a)&&(_.b=t.a.b,_.a=t.a.a),T=i(d,v)?d:v,i(T,_)&&(_.b=T.b,_.a=T.a),r(_,d)||r(_,v))return B(t,e),!1;if(!r(y,t.a)&&0<=o(y,t.a,_)||!r(g,t.a)&&0>=o(g,t.a,_)){if(g===t.a)return m(h.b),p(f.b,h),h=ft(e=P(e)).a,F(t,ft(e),c),N(t,e,$(h),h,h,!0),!0;if(y===t.a){m(f.b),p(h.e,$(f)),v=(d=c=e).a.b.a;do{d=pt(d)}while(d.a.b.a===v);return d=ft(e=d).a.b.c,c.a=$(f),N(t,e,(f=F(t,c,null)).c,h.b.c,d,!0),!0}return 0<=o(y,t.a,_)&&(pt(e).b=e.b=!0,m(h.b),h.a.b=t.a.b,h.a.a=t.a.a),0>=o(g,t.a,_)&&(e.b=c.b=!0,m(f.b),f.a.b=t.a.b,f.a.a=t.a.a),!1}return m(h.b),m(f.b),p($(f),h),h.a.b=_.b,h.a.a=_.a,h.a.h=it(t.e,h.a),h=h.a,f=[0,0,0,0],_=[d.d,y.d,v.d,g.d],h.g[0]=h.g[1]=h.g[2]=0,U(h,d,y,f,0),U(h,v,g,f,2),D(t,h,_,f,!0),pt(e).b=e.b=c.b=!0,!1}function z(t,e){for(var r=ft(e);;){for(;r.b;)e=r,r=ft(r);if(!e.b&&(r=e,null===(e=pt(e))||!e.b))break;e.b=!1;var n,s=e.a,a=r.a;if(n=s.b.a!==a.b.a)t:{var u=ft(n=e),c=n.a,h=u.a,l=void 0;if(i(c.b.a,h.b.a)){if(0>o(c.b.a,h.b.a,c.a)){n=!1;break t}pt(n).b=n.b=!0,l=m(c),p(h.b,l),l.d.c=n.d}else{if(0<o(h.b.a,c.b.a,h.a)){n=!1;break t}n.b=u.b=!0,l=m(h),p(c.e,h.b),l.b.d.c=n.d}n=!0}if(n&&(r.c?(O(r),d(a),a=(r=ft(e)).a):e.c&&(O(e),d(s),s=(e=pt(r)).a)),s.a!==a.a)if(s.b.a===a.b.a||e.c||r.c||s.b.a!==t.a&&a.b.a!==t.a)B(t,e);else if(k(t,e))break;s.a===a.a&&s.b.a===a.b.a&&(S(a,s),O(e),d(s),e=pt(r))}}function G(t,e){t.a=e;for(var n=e.c;null===n.i;)if((n=n.c)===e.c){n=t;var s=e;(c=new lt).a=s.c.b;var a=(l=n.f).a;do{a=a.a}while(null!==a.b&&!l.c(l.b,c,a.b));var u=ft(l=a.b),c=l.a;a=u.a;if(0===o(c.b.a,s,c.a))r((c=l.a).a,s)||r(c.b.a,s)||(m(c.b),l.c&&(d(c.c),l.c=!1),p(s.c,c),G(n,s));else{var h=i(a.b.a,c.b.a)?l:u;u=void 0;l.d||h.c?(u=h===l?v(s.c.b,c.e):v(a.b.c.b,s.c).b,h.c?M(h,u):(c=n,(l=I(n,l,u)).f=pt(l).f+l.a.f,l.d=w(c,l.f)),G(n,s)):N(n,l,s.c,s.c,null,!0)}return}if(l=(c=ft(n=P(n.i))).a,(c=F(t,c,null)).c===l){c=(l=c).c,a=ft(n),u=n.a,h=a.a;var l,f=!1;u.b.a!==h.b.a&&k(t,n),r(u.a,t.a)&&(p($(c),u),c=ft(n=P(n)).a,F(t,ft(n),a),f=!0),r(h.a,t.a)&&(p(l,$(h)),l=F(t,a,null),f=!0),f?N(t,n,l.c,c,c,!0):(s=i(h.a,u.a)?$(h):u,N(t,n,s=v(l.c.b,s),s.c,s.c,!1),s.b.i.c=!0,z(t,n))}else N(t,n,c.c,l,l,!0)}function X(t,e){var r=new lt,i=f(t.b);i.a.b=R,i.a.a=e,i.b.a.b=-R,i.b.a.a=e,t.a=i.b.a,r.a=i,r.f=0,r.d=!1,r.c=!1,r.h=!0,r.b=!1,i=j(i=t.f,i.a,r),r.e=i}function H(t){this.a=new Y,this.b=t,this.c=C}function j(t,e,r){do{e=e.c}while(null!==e.b&&!t.c(t.b,e.b,r));return t=new Y(r,e.a,e),e.a.c=t,e.a=t}function Y(t,e,r){this.b=t||null,this.a=e||this,this.c=r||this}function W(){this.d=Z,this.p=this.b=this.q=null,this.j=[0,0,0],this.s=100130,this.n=!1,this.o=this.a=this.e=this.f=null,this.m=!1,this.c=this.r=this.i=this.k=this.l=this.h=null}var Z=0;function q(t,e){if(t.d!==e)for(;t.d!==e;)if(t.d<e)switch(t.d){case Z:K(t,100151),t.u(null);break;case 1:K(t,100152),t.t()}else switch(t.d){case 2:K(t,100154),t.v();break;case 1:K(t,100153),t.w()}}function K(t,e){t.p&&t.p(e,t.c)}function Q(t,e){this.b=t||this,this.d=e||this,this.a=null,this.c=!1}function J(){this.h=this,this.i=this.d=this.a=this.e=this.c=this.b=null,this.f=0}function $(t){return t.b.e}function tt(){this.c=new et,this.a=new Q,this.b=new J,this.d=new J,this.b.b=this.d,this.d.b=this.b}function et(t,e){this.e=t||this,this.f=e||this,this.d=this.c=null,this.g=[0,0,0],this.h=this.a=this.b=0}function rt(){this.c=[],this.d=null,this.a=0,this.e=!1,this.b=new ot}function it(t,e){if(t.e){var r,i=t.b,n=++i.a;return 2*n>i.f&&(i.f*=2,i.c=st(i.c,i.f+1)),0===i.b?r=n:(r=i.b,i.b=i.c[i.b]),i.e[r]=e,i.c[r]=n,i.d[n]=r,i.h&&ht(i,n),r}return i=t.a++,t.c[i]=e,-(i+1)}function nt(t){if(0===t.a)return ut(t.b);var e=t.c[t.d[t.a-1]];if(0!==t.b.a&&i(at(t.b),e))return ut(t.b);do{--t.a}while(0<t.a&&null===t.c[t.d[t.a-1]]);return e}function ot(){this.d=st([0],33),this.e=[null,null],this.c=[0,0],this.a=0,this.f=32,this.b=0,this.h=!1,this.d[1]=1}function st(t,e){for(var r=Array(e),i=0;i<t.length;i++)r[i]=t[i];for(;i<e;i++)r[i]=0;return r}function at(t){return t.e[t.d[1]]}function ut(t){var e=t.d,r=t.e,i=t.c,n=e[1],o=r[n];return 0<t.a&&(e[1]=e[t.a],i[e[1]]=1,r[n]=null,i[n]=t.b,t.b=n,0<--t.a&&ct(t,1)),o}function ct(t,e){for(var r=t.d,n=t.e,o=t.c,s=e,a=r[s];;){var u=s<<1;u<t.a&&i(n[r[u+1]],n[r[u]])&&(u+=1);var c=r[u];if(u>t.a||i(n[a],n[c])){r[s]=a,o[a]=s;break}r[s]=c,o[c]=s,s=u}}function ht(t,e){for(var r=t.d,n=t.e,o=t.c,s=e,a=r[s];;){var u=s>>1,c=r[u];if(0===u||i(n[c],n[a])){r[s]=a,o[a]=s;break}r[s]=c,o[c]=s,s=u}}function lt(){this.e=this.a=null,this.f=0,this.c=this.b=this.h=this.d=!1}function ft(t){return t.e.c.b}function pt(t){return t.e.a.b}(e=W.prototype).x=function(){q(this,Z)},e.B=function(t,e){switch(t){case 100142:return;case 100140:switch(e){case 100130:case 100131:case 100132:case 100133:case 100134:return void(this.s=e)}break;case 100141:return void(this.m=!!e);default:return void K(this,100900)}K(this,100901)},e.y=function(t){switch(t){case 100142:return 0;case 100140:return this.s;case 100141:return this.m;default:K(this,100900)}return!1},e.A=function(t,e,r){this.j[0]=t,this.j[1]=e,this.j[2]=r},e.z=function(t,e){var r=e||null;switch(t){case 100100:case 100106:this.h=r;break;case 100104:case 100110:this.l=r;break;case 100101:case 100107:this.k=r;break;case 100102:case 100108:this.i=r;break;case 100103:case 100109:this.p=r;break;case 100105:case 100111:this.o=r;break;case 100112:this.r=r;break;default:K(this,100900)}},e.C=function(t,e){var r=!1,i=[0,0,0];q(this,2);for(var n=0;3>n;++n){var o=t[n];-1e150>o&&(o=-1e150,r=!0),1e150<o&&(o=1e150,r=!0),i[n]=o}r&&K(this,100155),null===(r=this.q)?p(r=f(this.b),r.b):(m(r),r=r.e),r.a.d=e,r.a.g[0]=i[0],r.a.g[1]=i[1],r.a.g[2]=i[2],r.f=1,r.b.f=-1,this.q=r},e.u=function(t){q(this,Z),this.d=1,this.b=new tt,this.c=t},e.t=function(){q(this,1),this.d=2,this.q=null},e.v=function(){q(this,2),this.d=1},e.w=function(){q(this,1),this.d=Z;var t=!1,e=[l=this.j[0],n=this.j[1],a=this.j[2]];if(0===l&&0===n&&0===a){for(var n=[-2e150,-2e150,-2e150],s=[2e150,2e150,2e150],a=[],u=[],l=(t=this.b.c).e;l!==t;l=l.e)for(var f=0;3>f;++f){var p=l.g[f];p<s[f]&&(s[f]=p,u[f]=l),p>n[f]&&(n[f]=p,a[f]=l)}if(l=0,n[1]-s[1]>n[0]-s[0]&&(l=1),n[2]-s[2]>n[l]-s[l]&&(l=2),s[l]>=n[l])e[0]=0,e[1]=0,e[2]=1;else{for(n=0,s=u[l],a=a[l],u=[0,0,0],s=[s.g[0]-a.g[0],s.g[1]-a.g[1],s.g[2]-a.g[2]],f=[0,0,0],l=t.e;l!==t;l=l.e)f[0]=l.g[0]-a.g[0],f[1]=l.g[1]-a.g[1],f[2]=l.g[2]-a.g[2],u[0]=s[1]*f[2]-s[2]*f[1],u[1]=s[2]*f[0]-s[0]*f[2],u[2]=s[0]*f[1]-s[1]*f[0],(p=u[0]*u[0]+u[1]*u[1]+u[2]*u[2])>n&&(n=p,e[0]=u[0],e[1]=u[1],e[2]=u[2]);0>=n&&(e[0]=e[1]=e[2]=0,e[A(s)]=1)}t=!0}for(u=A(e),l=this.b.c,n=(u+1)%3,a=(u+2)%3,u=0<e[u]?1:-1,e=l.e;e!==l;e=e.e)e.b=e.g[n],e.a=u*e.g[a];if(t){for(e=0,l=(t=this.b.a).b;l!==t;l=l.b)if(!(0>=(n=l.a).f))do{e+=(n.a.b-n.b.a.b)*(n.a.a+n.b.a.a),n=n.e}while(n!==l.a);if(0>e)for(t=(e=this.b.c).e;t!==e;t=t.e)t.a=-t.a}for(this.n=!1,l=(e=this.b.b).h;l!==e;l=t)t=l.h,n=l.e,r(l.a,l.b.a)&&l.e.e!==l&&(V(this,n,l),d(l),n=(l=n).e),n.e===l&&(n!==l&&(n!==t&&n!==t.b||(t=t.h),d(n)),l!==t&&l!==t.b||(t=t.h),d(l));for(this.e=e=new rt,l=(t=this.b.c).e;l!==t;l=l.e)l.h=it(e,l);for(function(t){t.d=[];for(var e=0;e<t.a;e++)t.d[e]=e;t.d.sort(function(t){return function(e,r){return i(t[e],t[r])?1:-1}}(t.c)),t.e=!0,function(t){for(var e=t.a;1<=e;--e)ct(t,e);t.h=!0}(t.b)}(e),this.f=new H(this),X(this,-R),X(this,R);null!==(e=nt(this.e));){for(;;){t:if(l=this.e,0===l.a)t=at(l.b);else if(t=l.c[l.d[l.a-1]],0!==l.b.a&&(l=at(l.b),i(l,t))){t=l;break t}if(null===t||!r(t,e))break;t=nt(this.e),V(this,e.c,t.c)}G(this,e)}for(this.a=this.f.a.a.b.a.a,e=0;null!==(t=this.f.a.a.b);)t.h||++e,O(t);for(this.f=null,(e=this.e).b=null,e.d=null,this.e=e.c=null,l=(e=this.b).a.b;l!==e.a;l=t)t=l.b,(l=l.a).e.e===l&&(S(l.c,l),d(l));if(!this.n){if(e=this.b,this.m)for(l=e.b.h;l!==e.b;l=t)t=l.h,l.b.d.c!==l.d.c?l.f=l.d.c?1:-1:d(l);else for(l=e.a.b;l!==e.a;l=t)if(t=l.b,l.c){for(l=l.a;i(l.b.a,l.a);l=l.c.b);for(;i(l.a,l.b.a);l=l.e);for(n=l.c.b,a=void 0;l.e!==n;)if(i(l.b.a,n.a)){for(;n.e!==l&&(c(n.e)||0>=o(n.a,n.b.a,n.e.b.a));)n=(a=v(n.e,n)).b;n=n.c.b}else{for(;n.e!==l&&(h(l.c.b)||0<=o(l.b.a,l.a,l.c.b.a));)l=(a=v(l,l.c.b)).b;l=l.e}for(;n.e.e!==l;)n=(a=v(n.e,n)).b}if(this.h||this.i||this.k||this.l)if(this.m){for(t=(e=this.b).a.b;t!==e.a;t=t.b)if(t.c){this.h&&this.h(2,this.c),l=t.a;do{this.k&&this.k(l.a.d,this.c),l=l.e}while(l!==t.a);this.i&&this.i(this.c)}}else{for(e=this.b,t=!!this.l,l=!1,n=-1,a=e.a.d;a!==e.a;a=a.d)if(a.c){l||(this.h&&this.h(4,this.c),l=!0),u=a.a;do{t&&(n!==(s=u.b.d.c?0:1)&&(n=s,this.l&&this.l(!!n,this.c))),this.k&&this.k(u.a.d,this.c),u=u.e}while(u!==a.a)}l&&this.i&&this.i(this.c)}if(this.r){for(l=(e=this.b).a.b;l!==e.a;l=t)if(t=l.b,!l.c){a=(n=l.a).e,u=void 0;do{a=(u=a).e,u.d=null,null===u.b.d&&(u.c===u?T(u.a,null):(u.a.c=u.c,g(u,$(u))),(s=u.b).c===s?T(s.a,null):(s.a.c=s.c,g(s,$(s))),x(u))}while(u!==n);n=l.d,(l=l.b).d=n,n.b=l}return this.r(this.b),void(this.c=this.b=null)}}this.b=this.c=null},Qa.libtess={GluTesselator:W,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901,GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111}},W.prototype.gluDeleteTess=W.prototype.x,W.prototype.gluTessProperty=W.prototype.B,W.prototype.gluGetTessProperty=W.prototype.y,W.prototype.gluTessNormal=W.prototype.A,W.prototype.gluTessCallback=W.prototype.z,W.prototype.gluTessVertex=W.prototype.C,W.prototype.gluTessBeginPolygon=W.prototype.u,W.prototype.gluTessBeginContour=W.prototype.t,W.prototype.gluTessEndContour=W.prototype.v,W.prototype.gluTessEndPolygon=W.prototype.w,t.exports=Qa.libtess}(Ja);var $a=function(){var t=new Ja.exports.GluTesselator;return t.gluTessCallback(Ja.exports.gluEnum.GLU_TESS_VERTEX_DATA,(function(t,e){e[e.length]=t[0],e[e.length]=t[1]})),t.gluTessCallback(Ja.exports.gluEnum.GLU_TESS_BEGIN,(function(t){t!==Ja.exports.primitiveType.GL_TRIANGLES&&console.info("expected TRIANGLES but got type: "+t)})),t.gluTessCallback(Ja.exports.gluEnum.GLU_TESS_ERROR,(function(t){console.error("error callback, error number: "+t)})),t.gluTessCallback(Ja.exports.gluEnum.GLU_TESS_COMBINE,(function(t,e,r){return[t[0],t[1],t[2]]})),t.gluTessCallback(Ja.exports.gluEnum.GLU_TESS_EDGE_FLAG,(function(t){})),t}();function tu(t){$a.gluTessNormal(0,0,1);var e=[];$a.gluTessBeginPolygon(e);for(var r=0;r<t.length;r++){$a.gluTessBeginContour();for(var i=t[r],n=0;n<i.length;n+=2){var o=[i[n],i[n+1],0];$a.gluTessVertex(o,o)}$a.gluTessEndContour()}return $a.gluTessEndPolygon(),e}var eu=function(t){function e(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var n;(n=t.call(this)||this).points=[],n.closePath=!1;var o=Array.isArray(r[0])?r[0]:r;if("number"!=typeof o[0]){for(var s=[],a=0,u=o.length;a<u;a++)s.push(o[a].x,o[a].y);o=s}return n.points=o,n.closePath=!0,n}Ri(e,t);var r=e.prototype;return r.clone=function(){var t=new e(this.points.slice());return t.closePath=this.closePath,t},r.contains=function(t,e){for(var r=!1,i=this.points.length/2,n=0,o=i-1;n<i;o=n++){var s=this.points[2*n],a=this.points[2*n+1],u=this.points[2*o],c=this.points[2*o+1];a>e!=c>e&&t<(e-a)/(c-a)*(u-s)+s&&(r=!r)}return r},r.copyFrom=function(t){return this.points=t.points.slice(),this.closePath=t.closePath,this},r.copyTo=function(t){return t.copyFrom(this),t},r.getX=function(){return this.points[this.points.length-2]},r.getY=function(){return this.points[this.points.length-1]},r.build=function(t){for(var e=0;e<this.points.length;e++)t[e]=this.points[e]},r.triangulate=function(t,e,r,i,n){for(var o=tu([t]),s=0;s<o.length;s++)e[r+s]=o[s];for(var a=o.length/2,u=0;u<a;u++)i[n+u]=u},nn(e,[{key:"lastX",get:function(){return this.points[this.points.length-2]}},{key:"lastY",get:function(){return this.points[this.points.length-1]}}]),e}(Ka),ru=1.1920929e-7;function iu(t,e,r,i,n,o,s,a,u,c){var h=(1-Math.min(.99,Math.max(0,null!=c?c:.5)))/5;return function(t,e,r,i,n,o,s,a,u,c){nu(t,e,r,i,n,o,s,a,u,c,0),u.push(s,a)}(e,r,i,n,o,s,a,u,t,h*=h),t}function nu(t,e,r,i,n,o,s,a,u,c,h){if(!(h>8)){var l=(t+r)/2,f=(e+i)/2,p=(r+n)/2,d=(i+o)/2,m=(n+s)/2,v=(o+a)/2,y=(l+p)/2,g=(f+d)/2,_=(p+m)/2,E=(d+v)/2,x=(y+_)/2,T=(g+E)/2;if(h>0){var b=s-t,A=a-e,R=Math.abs((r-s)*A-(i-a)*b),S=Math.abs((n-s)*A-(o-a)*b);if(R>ru&&S>ru){if((R+S)*(R+S)<=c*(b*b+A*A))return void u.push(x,T)}else if(R>ru){if(R*R<=c*(b*b+A*A))return void u.push(x,T)}else if(S>ru){if(S*S<=c*(b*b+A*A))return void u.push(x,T)}else if((b=x-(t+s)/2)*b+(A=T-(e+a)/2)*A<=c)return void u.push(x,T)}nu(t,e,l,f,y,g,x,T,u,c,h+1),nu(x,T,_,E,m,v,s,a,u,c,h+1)}}var ou,su=function(t){function e(e,r,i,n){var o;return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),(o=t.call(this)||this).type="ellipse",o.x=e,o.y=r,o.halfWidth=i,o.halfHeight=n,o}Ri(e,t);var r=e.prototype;return r.clone=function(){return new e(this.x,this.y,this.halfWidth,this.halfHeight)},r.contains=function(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;var r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return(r*=r)+(i*=i)<=1},r.strokeContains=function(t,e,r){var i=this.halfWidth,n=this.halfHeight;if(i<=0||n<=0)return!1;var o=r/2,s=i-o,a=n-o,u=i+o,c=n+o,h=t-this.x,l=e-this.y;return h*h/(s*s)+l*l/(a*a)>1&&h*h/(u*u)+l*l/(c*c)<=1},r.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this},r.copyTo=function(t){return t.copyFrom(this),t},r.getX=function(){return this.x},r.getY=function(){return this.y},r.build=function(t){var e=this.x,r=this.y,i=this.halfWidth,n=this.halfHeight;if(!(i>=0&&n>=0))return t;var o=Math.ceil(5*Math.sqrt(i+n)),s=8*o+0+0;if(0===s)return t;if(0===o)return t[0]=t[6]=e+0,t[1]=t[3]=r+0,t[2]=t[4]=e-0,t[5]=t[7]=r-0,t;var a=0,u=4*o+0+2,c=u,h=s,l=0+i,f=0,p=e+l,d=e-l,m=r+f;t[a++]=p,t[a++]=m,t[--u]=m,t[--u]=d;for(var v=1;v<o;v++){var y=Math.PI/2*(v/o),g=0+Math.cos(y)*i,_=0+Math.sin(y)*n,E=e+g,x=e-g,T=r+_,b=r-_;t[a++]=E,t[a++]=T,t[--u]=T,t[--u]=x,t[c++]=x,t[c++]=b,t[--h]=b,t[--h]=E}p=e+(l=0),d=e-l,m=r+(f=0+n);var A=r-f;return t[a++]=p,t[a++]=m,t[--h]=A,t[--h]=p,t},r.triangulate=function(t,e,r,i,n){if(0!==t.length){for(var o=0,s=0,a=0;a<t.length;a+=2)o+=t[a],s+=t[a+1];o/=t.length/2,s/=t.length/2;var u=r;e[2*u]=o,e[2*u+1]=s;for(var c=u++,h=0;h<t.length;h+=2)e[2*u]=t[h],e[2*u+1]=t[h+1],h>0&&(i[n++]=u,i[n++]=c,i[n++]=u-1),u++;i[n++]=c+1,i[n++]=c,i[n++]=u-1}},e}(Ka);!function(t){t[t.Star=0]="Star",t[t.Polygon=1]="Polygon"}(ou||(ou={}));var au,uu=function(t){function e(e,r,i,n,o,s){var a;return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),(a=t.call(this)||this).pointCount=e,a.outerRadius=r,a.innerRadius=i,a.outerRoundness=n,a.innerRoundness=o,a.starType=s,a.v=[],a.in=[],a.out=[],a}Ri(e,t);var r=e.prototype;return r.clone=function(){return new e(this.pointCount,this.outerRadius,this.innerRadius,this.outerRoundness,this.innerRoundness,this.starType)},r.copyFrom=function(t){this.pointCount=t.pointCount,this.outerRadius=t.outerRadius,this.innerRadius=t.innerRadius,this.outerRoundness=t.outerRoundness,this.innerRoundness=t.innerRoundness,this.starType=t.starType},r.copyTo=function(t){t.copyFrom(this)},r.build=function(t){switch(this.starType){case 0:this.buildStarPath();break;case 1:this.buildPolygonPath()}for(var e=0;e<this.v.length-2;e+=2)iu(t,this.v[e],this.v[e+1],this.out[e],this.out[e+1],this.in[e+2],this.in[e+3],this.v[e+2],this.v[e+3],1);var r=this.v.length-1;iu(t,this.v[r-1],this.v[r],this.out[r-1],this.out[r],this.in[0],this.in[1],this.v[0],this.v[1],1)},r.triangulate=function(t,e,r,i,n){for(var o=tu([t]),s=0;s<o.length;s++)e[r+s]=o[s];for(var a=o.length/2,u=0;u<a;u++)i[n+u]=u},r.buildStarPath=function(){this.v=[],this.in=[],this.out=[];var t,e,r,i,n=2*Math.floor(this.pointCount),o=2*Math.PI/n,s=!0,a=this.outerRadius,u=this.innerRadius,c=this.outerRoundness/100,h=this.innerRoundness/100,l=2*Math.PI*a/(2*n),f=2*Math.PI*u/(2*n),p=-Math.PI/2;for(t=0;t<n;t++){r=s?c:h,i=s?l:f;var d=(e=s?a:u)*Math.cos(p),m=e*Math.sin(p),v=0===d&&0===m?0:m/Math.sqrt(d*d+m*m),y=0===d&&0===m?0:-d/Math.sqrt(d*d+m*m),g=2*t;this.v[g]=d,this.v[g+1]=m,this.in[g]=d+v*i*r*1,this.in[g+1]=m+y*i*r*1,this.out[g]=d-v*i*r*1,this.out[g+1]=m-y*i*r*1,s=!s,p+=1*o}},r.buildPolygonPath=function(){this.v=[],this.in=[],this.out=[];var t,e=Math.floor(this.pointCount),r=2*Math.PI/e,i=this.outerRadius,n=this.outerRoundness/100,o=2*Math.PI*i/(4*e),s=.5*-Math.PI;for(t=0;t<e;t++){var a=i*Math.cos(s),u=i*Math.sin(s),c=0===a&&0===u?0:u/Math.sqrt(a*a+u*u),h=0===a&&0===u?0:-a/Math.sqrt(a*a+u*u),l=2*t;this.v[l]=a,this.v[l+1]=u,this.in[l]=a+c*o*n*1,this.in[l+1]=u+h*o*n*1,this.out[l]=a-c*o*n*1,this.out[l+1]=u-h*o*n*1,s+=1*r}},e}(Ka),cu=function(t){function e(e,r,i,n){var o;return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),(o=t.call(this)||this).x=Number(e),o.y=Number(r),o.width=Number(i),o.height=Number(n),o}Ri(e,t);var r=e.prototype;return r.isEmpty=function(){return this.left===this.right||this.top===this.bottom},r.clone=function(){return new e(this.x,this.y,this.width,this.height)},r.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},r.copyTo=function(t){return t.copyFrom(this),t},r.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},r.strokeContains=function(t,e,r){var i=this.width,n=this.height;if(i<=0||n<=0)return!1;var o=this.x,s=this.y;return t>=o-r/2&&t<=o+i+r/2&&e>=s-r/2&&e<=s+n+r/2&&!(t>o+r/2&&t<o+i-r/2&&e>s+r/2&&e<s+n-r/2)},r.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},r.fit=function(t){var e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),i=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=i,this.height=Math.max(n-i,0),this},r.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var r=Math.ceil((this.x+this.width-e)*t)/t,i=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=i-this.y,this},r.enlarge=function(t){var e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),i=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=i,this.height=n-i,this},r.getBounds=function(t){return(t=t||new e).copyFrom(this),t},r.getX=function(){return this.x},r.getY=function(){return this.y},r.build=function(t){var e=this.x,r=this.y,i=this.width,n=this.height;return i>=0&&n>=0?(t[0]=e,t[1]=r,t[2]=e+i,t[3]=r,t[4]=e+i,t[5]=r+n,t[6]=e,t[7]=r+n,t):t},r.triangulate=function(t,e,r,i,n){var o=0;e[(r*=2)+o]=t[0],e[r+o+1]=t[1],e[r+(o+=2)]=t[2],e[r+o+1]=t[3],e[r+(o+=2)]=t[6],e[r+o+1]=t[7],e[r+(o+=2)]=t[4],e[r+o+1]=t[5],o+=2;var s=r/2;i[n++]=s,i[n++]=s+1,i[n++]=s+2,i[n++]=s+1,i[n++]=s+3,i[n++]=s+2},nn(e,[{key:"left",get:function(){return this.x}},{key:"right",get:function(){return this.x+this.width}},{key:"top",get:function(){return this.y}},{key:"bottom",get:function(){return this.y+this.height}}],[{key:"EMPTY",get:function(){return new e(0,0,0,0)}}]),e}(Ka),hu=function(){function t(t){this.graphicsPath=t,this.currentPoly=null,this.shapePrimitives=[]}var e=t.prototype;return e.buildPath=function(){this.currentPoly=null,this.shapePrimitives.length=0;for(var t,e=wn(this.graphicsPath.instructions);!(t=e()).done;){var r=t.value,i=r.action,n=r.data;switch(i){case"bezierCurveTo":this.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case"moveTo":this.moveTo(n[0],n[1]);break;case"ellipse":this.ellipse(n[0],n[1],n[2],n[3],n[4]);break;case"polyStar":this.polyStar(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case"rect":this.rect(n[0],n[1],n[2],n[3],n[4])}}this.endPoly()},e.bezierCurveTo=function(t,e,r,i,n,o,s){this.ensurePoly();var a=this.currentPoly;return iu(a.points,a.lastX,a.lastY,t,e,r,i,n,o,s),this},e.moveTo=function(t,e){return this.startPoly(t,e),this},e.ellipse=function(t,e,r,i,n){return this.drawShape(new su(t,e,r,i),n),this},e.polyStar=function(t,e,r,i,n,o,s){return this.drawShape(new uu(t,e,r,i,n,o),s),this},e.rect=function(t,e,r,i,n){return this.drawShape(new cu(t,e,r,i),n),this},e.drawShape=function(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this},e.startPoly=function(t,e){var r=this.currentPoly;return r&&this.endPoly(),(r=new eu).points.push(t,e),this.currentPoly=r,this},e.endPoly=function(t){void 0===t&&(t=!1);var e=this.currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this.currentPoly=null,this},e.ensurePoly=function(t){this.currentPoly||(this.currentPoly=new eu,this.currentPoly.points.push(0,0))},t}(),lu=function(){function t(){this.instructions=[],this.dirty=!1}var e=t.prototype;return e.bezierCurveTo=function(t,e,r,i,n,o,s){return this.instructions.push({action:"bezierCurveTo",data:[t,e,r,i,n,o,s]}),this.dirty=!0,this},e.moveTo=function(t,e){return this.instructions.push({action:"moveTo",data:[t,e]}),this.dirty=!0,this},e.ellipse=function(t,e,r,i,n){return this.instructions.push({action:"ellipse",data:[t,e,r,i,n]}),this.dirty=!0,this},e.rect=function(t,e,r,i,n){return this.instructions.push({action:"rect",data:[t,e,r,i,n]}),this.dirty=!0,this},e.polyStar=function(t,e,r,i,n,o,s){return this.instructions.push({action:"polyStar",data:[t,e,r,i,n,o,s]}),this.dirty=!0,this},e.clear=function(){return this.instructions.length=0,this.dirty=!0,this},nn(t,[{key:"shapePath",get:function(){return this._shapePath||(this._shapePath=new hu(this)),this.dirty&&(this.dirty=!1,this._shapePath.buildPath()),this._shapePath}}]),t}();exports.ShapeComponent=function(t){function e(e){var r;if((r=t.call(this,e)||this).path=new lu,r.curveValues=[],r.animated=!0,r.vert="\nprecision highp float;\n\nattribute vec3 aPos;//x y\n\nuniform mat4 effects_MatrixVP;\nuniform mat4 effects_MatrixInvV;\nuniform mat4 effects_ObjectToWorld;\n\nvoid main() {\n  vec4 pos = vec4(aPos.xyz, 1.0);\n  gl_Position = effects_MatrixVP * effects_ObjectToWorld * pos;\n}\n",r.frag="\nprecision highp float;\n\nuniform vec4 _Color;\n\nvoid main() {\n  vec4 color = _Color;\n  color.rgb *= color.a;\n  gl_FragColor = color;\n}\n",r.geometry||(r.geometry=jo.create(e,{attributes:{aPos:{type:jn.FLOAT,size:3,data:new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0])},aUV:{type:jn.FLOAT,size:2,data:new Float32Array}},mode:jn.TRIANGLES,drawCount:4})),!r.material){var i={shader:{vertex:r.vert,fragment:r.frag,glslVersion:exports.GLSLVersion.GLSL1}};r.material=Bo.create(e,i),r.material.setColor("_Color",new Ko(1,1,1,1)),r.material.depthMask=!1,r.material.depthTest=!0,r.material.blending=!0}return r}Ri(e,t);var r=e.prototype;return r.onStart=function(){this.item.getHitTestParams=this.getHitTestParams},r.onUpdate=function(t){this.animated&&(this.buildPath(this.data),this.buildGeometryFromPath(this.path.shapePath),this.animated=!1)},r.buildGeometryFromPath=function(t){for(var e,r=[],i=[],n=wn(t.shapePrimitives);!(e=n()).done;){var o=e.value.shape,s=[],a=i.length,u=r.length/2;o.build(s),o.triangulate(s,r,u,i,a)}var c=r.length/2,h=this.geometry.getAttributeData("aPos"),l=this.geometry.getAttributeData("aUV"),f=this.geometry.getIndexData();(!h||h.length<3*c)&&(h=new Float32Array(3*c)),(!l||l.length<2*c)&&(l=new Float32Array(2*c)),f||(f=new Uint16Array(i.length));for(var p=0;p<c;p++){var d=3*p,m=2*p,v=2*p;h[d]=r[m],h[d+1]=r[m+1],h[d+2]=0,l[v]=h[d],l[v+1]=h[d+1]}f.set(i),this.geometry.setAttributeData("aPos",h),this.geometry.setAttributeData("aUV",l),this.geometry.setIndexData(f),this.geometry.setDrawCount(i.length)},r.buildPath=function(t){this.path.clear();var e=t;switch(e.type){case Hi.Custom:var r=e,i=r.points,n=r.easingIns,o=r.easingOuts;this.curveValues=[];for(var s,a=wn(r.shapes);!(s=a()).done;){var u=s.value;this.setFillColor(u.fill);for(var c=u.indexes,h=1;h<c.length;h++){var l=c[h],f=c[h-1];this.curveValues.push({point:i[l.point],controlPoint1:o[f.easingOut],controlPoint2:n[l.easingIn]})}this.curveValues.push({point:i[c[0].point],controlPoint1:o[c[c.length-1].easingOut],controlPoint2:n[c[0].easingIn]})}this.path.moveTo(this.curveValues[this.curveValues.length-1].point.x,this.curveValues[this.curveValues.length-1].point.y);for(var p,d=wn(this.curveValues);!(p=d()).done;){var m=p.value,v=m.point,y=m.controlPoint1,g=m.controlPoint2;this.path.bezierCurveTo(y.x,y.y,g.x,g.y,v.x,v.y,1)}break;case Hi.Ellipse:var _=e;this.path.ellipse(0,0,_.xRadius,_.yRadius),this.setFillColor(_.fill);break;case Hi.Rectangle:var E=e;this.path.rect(-E.width/2,-E.height/2,E.width,E.height),this.setFillColor(E.fill);break;case Hi.Star:var x=e;this.path.polyStar(x.pointCount,x.outerRadius,x.innerRadius,x.outerRoundness,x.innerRoundness,ou.Star),this.setFillColor(x.fill);break;case Hi.Polygon:var T=e;this.path.polyStar(T.pointCount,T.radius,T.radius,T.roundness,T.roundness,ou.Polygon),this.setFillColor(T.fill)}},r.setFillColor=function(t){if(t){var e=t.color;this.material.setColor("_Color",new Ko(e.r,e.g,e.b,e.a))}},r.fromData=function(e){t.prototype.fromData.call(this,e),this.data=e;var r=this.material;r.stencilRef=void 0!==e.renderer.mask?[e.renderer.mask,e.renderer.mask]:void 0,$n(r,e.renderer.maskMode)},e}(Rn),exports.ShapeComponent=fr([un("ShapeComponent")],exports.ShapeComponent),exports.Fake3DComponent=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).loop=!1,e.amountOfMotion=1,e.animationLength=2,e.mode=1,e.startPositionX=0,e.startPositionY=0,e.startPositionZ=0,e.endPositionX=0,e.endPositionY=0,e.endPositionZ=0,e.amplitudeX=0,e.amplitudeY=0,e.amplitudeZ=0,e.phaseX=0,e.phaseY=0,e.phaseZ=0,e}Ri(e,t);var r=e.prototype;return r.onStart=function(){this.effectComponent=this.item.getComponent(exports.EffectComponent)},r.onUpdate=function(t){this.updateFake3D()},r.updateFake3D=function(){if(this.effectComponent){var t=this.item.time%this.animationLength/this.animationLength,e=0,r=0,i=0;switch(this.mode){case 0:var n=Math.PI;e=Math.sin(2*n*(t+this.phaseX))*this.amplitudeX,r=Math.sin(2*n*(t+this.phaseY))*this.amplitudeY,i=Math.sin(2*n*(t+this.phaseZ))*this.amplitudeZ;break;case 1:var o=t;this.loop&&(o>.5&&(o=1-o),o*=2),e=this.startPositionX*(1-o)+o*this.endPositionX,r=this.startPositionY*(1-o)+o*this.endPositionY,i=this.startPositionZ*(1-o)+o*this.endPositionZ}var s=this.effectComponent.material;s.setFloat("_PosX",e*this.amountOfMotion),s.setFloat("_PosY",r*this.amountOfMotion),s.setFloat("_PosZ",i*this.amountOfMotion)}},e}(fn),fr([cn()],exports.Fake3DComponent.prototype,"loop",void 0),fr([cn()],exports.Fake3DComponent.prototype,"amountOfMotion",void 0),fr([cn()],exports.Fake3DComponent.prototype,"animationLength",void 0),fr([cn()],exports.Fake3DComponent.prototype,"mode",void 0),fr([cn()],exports.Fake3DComponent.prototype,"startPositionX",void 0),fr([cn()],exports.Fake3DComponent.prototype,"startPositionY",void 0),fr([cn()],exports.Fake3DComponent.prototype,"startPositionZ",void 0),fr([cn()],exports.Fake3DComponent.prototype,"endPositionX",void 0),fr([cn()],exports.Fake3DComponent.prototype,"endPositionY",void 0),fr([cn()],exports.Fake3DComponent.prototype,"endPositionZ",void 0),fr([cn()],exports.Fake3DComponent.prototype,"amplitudeX",void 0),fr([cn()],exports.Fake3DComponent.prototype,"amplitudeY",void 0),fr([cn()],exports.Fake3DComponent.prototype,"amplitudeZ",void 0),fr([cn()],exports.Fake3DComponent.prototype,"phaseX",void 0),fr([cn()],exports.Fake3DComponent.prototype,"phaseY",void 0),fr([cn()],exports.Fake3DComponent.prototype,"phaseZ",void 0),exports.Fake3DComponent=fr([un("Fake3DComponent")],exports.Fake3DComponent),exports.Fake3DAnimationMode=void 0,(au=exports.Fake3DAnimationMode||(exports.Fake3DAnimationMode={}))[au.Circular=0]="Circular",au[au.Linear=1]="Linear",exports.CameraController=function(t){function e(e,r){var i;return i=t.call(this,e)||this,r&&i.fromData(r),i}Ri(e,t);var r=e.prototype;return r.onUpdate=function(){if(this.item.composition&&this.item.transform.getValid()){var t=this.item.composition.camera;t.near=this.options.near,t.far=this.options.far,t.fov=this.options.fov,t.clipMode=this.options.clipMode,t.position=this.transform.getWorldPosition(),t.rotation=this.transform.getWorldRotation()}},r.fromData=function(e){t.prototype.fromData.call(this,e),this.options=e.options},e}(pn),exports.CameraController=fr([un(qi.CameraController)],exports.CameraController);var fu,pu=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e}(bi);exports.HitTestType=void 0,(fu=exports.HitTestType||(exports.HitTestType={}))[fu.triangle=1]="triangle",fu[fu.box=2]="box",fu[fu.sphere=3]="sphere",fu[fu.custom=4]="custom";var du="click",mu="touchstart",vu="touchmove",yu="touchend",gu=function(){function t(t,e){void 0===e&&(e=!1),this.target=t,this.allowPropagation=e,this.enabled=!0,this.handlers={},this.nativeHandlers={}}var e=t.prototype;return e.bindListeners=function(){var t,e,i,n,o,s=this;o=function(t){return t};var a,u="mousedown",c="mousemove",h="mouseup",l=function(t,e,i,o,a){void 0===o&&(o=0),void 0===a&&(a=0);var u=0,c=0,h=r.performance.now();if(!s.target)return Yr.error("Trigger TouchEvent after EventSystem is disposed."),{x:e,y:i,vx:0,vy:c,dx:o,dy:a,ts:h,width:0,height:0,origin:t};var l=s.target,f=l.width,p=l.height;if(n){var d=h-n.ts;u=(o-n.dx)/d||0,c=(a-n.dy)/d||0,n={dx:o,dy:a,ts:h}}return{x:e,y:i,vx:u,vy:c,dx:o,dy:a,ts:h,width:f,height:p,origin:t}};wr()&&(o=function(t){var e=t.touches,r=t.changedTouches;return e[0]||r[0]},u="touchstart",c="touchmove",h="touchend"),this.nativeHandlers=((a={})[u]=function(a){if(s.enabled){var u=o(a),c=_u(u);t=c.x,e=c.y,n=i={clientX:u.clientX,clientY:u.clientY,ts:r.performance.now(),x:t,y:e},s.dispatchEvent(mu,l(a,t,e))}},a[c]=function(r){if(i&&s.enabled){var n=_u(o(r));t=n.x,e=n.y,s.dispatchEvent(vu,l(r,t,e,t-i.x,e-i.y))}},a[h]=function(r){if(i&&s.enabled){!s.allowPropagation&&r.cancelable&&(r.preventDefault(),r.stopPropagation());var n=o(r),a=_u(n),u=Math.abs(i.clientX-n.clientX)+Math.abs(i.clientY-n.clientY);t=a.x,e=a.y,u<4&&s.dispatchEvent(du,l(r,t,e)),s.dispatchEvent(yu,l(r,t,e,t-i.x,e-i.y))}i=0},a),Object.keys(this.nativeHandlers).forEach((function(t){var e;null==(e=s.target)||e.addEventListener(String(t),s.nativeHandlers[t])}))},e.dispatchEvent=function(t,e){var r=this.handlers[t];null==r||r.forEach((function(t){return t(e)}))},e.addEventListener=function(t,e){var r=this.handlers[t];return r||(r=this.handlers[t]=[]),xr(r,e),function(){Tr(r,e)}},e.removeEventListener=function(t,e){var r=this.handlers[t];r&&Tr(r,e)},e.dispose=function(){var t=this;this.target&&(this.handlers={},Object.keys(this.nativeHandlers).forEach((function(e){var r;null==(r=t.target)||r.removeEventListener(String(e),t.nativeHandlers[e])})),this.nativeHandlers={},this.target=null)},t}();function _u(t){var e=t.target,r=t.clientX,i=t.clientY,n=e.getBoundingClientRect(),o=n.left,s=n.top;return{x:(r-o)/n.width*2-1,y:1-(i-s)/n.height*2}}var Eu=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e}(bi),xu=1,Tu=function(){function t(t,e,r,i){this.transform=r,this.engine=i,this.color=t.options.previewColor;var n=this.createMaterial(e),o=this.createGeometry();this.mesh=this.createMesh(o,n),this.updateMesh()}var e=t.prototype;return e.updateMesh=function(){var t=this.mesh.material,e=t.getVector2("uSize").clone(),r=t.getVector4("uPos").clone(),i=new bn,n=new Cn,o=this.transform.scale.clone();this.transform.assignWorldTRS(i,n,o),e.x=o.x,e.y=o.y,r.x=i.x,r.y=i.y,r.z=i.z,t.setVector2("uSize",e),t.setVector4("uPos",r),t.setQuaternion("uQuat",n)},e.createMaterial=function(t){var e,r=[["ENV_EDITOR",(null==(e=this.engine.renderer)?void 0:e.env)===Xa]],i=Ya(this.color).getValue(0),n={shader:{vertex:"\nprecision highp float;\n\nattribute vec2 aPoint;\nuniform vec4 uPos;\nuniform vec2 uSize;\nuniform vec4 uQuat;\nuniform vec4 uColor;\nuniform mat4 effects_ObjectToWorld;\nuniform mat4 effects_MatrixInvV;\nuniform mat4 effects_MatrixVP;\nvarying vec4 vColor;\n#ifdef ENV_EDITOR\n  uniform vec4 uEditorTransform;\n#endif\n\nvec3 rotateByQuat(vec3 a, vec4 quat){\n  vec3 qvec = quat.xyz;\n  vec3 uv = cross(qvec, a);\n  vec3 uuv = cross(qvec, uv) * 2.;\n  return a +(uv * 2. * quat.w + uuv);\n}\n\nvoid main() {\n  vec4 _pos = uPos;\n  vec3 point = rotateByQuat(vec3(aPoint.xy * uSize, 0.),uQuat);\n  vec4 pos = vec4(_pos.xyz, 1.0);\n  pos = effects_ObjectToWorld * pos;\n  pos.xyz += effects_MatrixInvV[0].xyz * point.x+ effects_MatrixInvV[1].xyz * point.y;\n  gl_Position = effects_MatrixVP * pos;\n  vColor = uColor;\n  #ifdef ENV_EDITOR\n    gl_Position = vec4(gl_Position.xy * uEditorTransform.xy + uEditorTransform.zw * gl_Position.w, gl_Position.zw);\n  #endif\n}\n",fragment:"\nprecision highp float;\n\n#define fragColor gl_FragColor\n\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vColor*vColor.a;\n}\n",glslVersion:exports.GLSLVersion.GLSL1,cacheId:t.cachePrefix+"_effects_interact",macros:r},uniformSemantics:{effects_MatrixVP:"VIEWPROJECTION",effects_MatrixInvV:"VIEWINVERSE",effects_ObjectToWorld:"MODEL",uEditorTransform:"EDITOR_TRANSFORM"}},o=Bo.create(this.engine,n);return o.blending=!0,o.depthTest=!1,o.setVector4("uPos",new An(0,0,0,0)),o.setVector2("uSize",new Tn(1,1)),o.setVector4("uColor",new An(i[0]/255,i[1]/255,i[2]/255,i[3])),o.setQuaternion("uQuat",new Cn(0,0,0,0)),o},e.createGeometry=function(){var t=new Uint8Array([0,1,1,2,2,3,3,0]);return jo.create(this.engine,{attributes:{aPoint:{size:2,offset:0,stride:2*Float32Array.BYTES_PER_ELEMENT,data:new Float32Array([-.5,.5,.5,.5,.5,-.5,-.5,-.5])}},drawCount:t.length,indices:{data:t},mode:jn.LINES,maxVertex:4})},e.createMesh=function(t,e){return is.create(this.engine,{name:"Interact_preview"+xu++,priority:0,worldMatrix:Pn.fromIdentity(),geometry:t,material:e})},t}();function bu(t,e){var r=1e-5*(e||1);return t&&Math.abs(t.vx||0)<r&&Math.abs(t.vy||0)<r}exports.InteractComponent=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).downgrade=.95,e.dragRatio=[1,1],e.dragRange={dxRange:[0,0],dyRange:[0,0]},e.duringPlay=!1,e._interactive=!0,e.getHitTestParams=function(t){if(e.clickable){var r=e.item.props.content.options.behavior,i=e.getBoundingBox();return i?{type:i.type,triangles:i.area,behavior:r}:void 0}},e}Ri(e,t);var r=e.prototype;return r.getDragRangeX=function(){return this.dragRange.dxRange},r.setDragRangeX=function(t,e){this.dragRange.dxRange=[t,e]},r.getDragRangeY=function(){return this.dragRange.dyRange},r.setDragRangeY=function(t,e){this.dragRange.dyRange=[t,e]},r.onStart=function(){var t=this.item.props.content.options,e=this.item.engine.renderer.env,r=this.item.composition,i=this.interactData.options,n=i.type,o=i.showPreview;if(n===vi.CLICK&&(this.clickable=!0,o&&e===Xa)){var s=null==r?void 0:r.getRendererOptions();void 0!==s&&(this.previewContent=new Tu(this.item.props.content,s,this.transform,this.engine))}t.type===vi.DRAG&&(e!==Xa||t.enableInEditor)&&(null==r?void 0:r.event)&&this.beginDragTarget(t,r.event),this.previewContent&&(this.previewContent.mesh.item=this.item,this.materials=this.previewContent.mesh.materials),this.item.getHitTestParams=this.getHitTestParams},r.onDisable=function(){t.prototype.onDisable.call(this),this.item&&this.item.composition&&(this.duringPlay&&!this.item.transform.getValid()&&(this.item.composition.removeInteractiveItem(this.item,this.item.props.content.options.type),this.duringPlay=!1),this.clickable=!1,this.endDragTarget())},r.onEnable=function(){t.prototype.onEnable.call(this),this.interactData.options.type===vi.CLICK&&(this.clickable=!0)},r.onUpdate=function(t){var e;if(this.duringPlay=!0,this.item.time>0&&this.item.time-t/1e3<=0){var r,i=this.item.props.content.options;null==(r=this.item.composition)||r.addInteractiveItem(this.item,i.type)}null==(e=this.previewContent)||e.updateMesh(),this.dragEvent&&this.bouncingArg&&(this.bouncingArg.vx*=this.downgrade,this.bouncingArg.vy*=this.downgrade,this.bouncingArg.dy+=this.bouncingArg.vy,this.bouncingArg.dx+=this.bouncingArg.vx,bu(this.bouncingArg)?(this.dragEvent=null,this.bouncingArg=null):this.handleDragMove(this.dragEvent,this.bouncingArg))},r.render=function(t){this.previewContent&&this.previewContent.mesh.render(t)},r.onDestroy=function(){var t;null==(t=this.previewContent)||t.mesh.dispose()},r.endDragTarget=function(){},r.handleDragMove=function(t,e){if((null==t?void 0:t.cameraParam)&&this.canInteract()&&this.item.composition){var r,i,n=t.cameraParam,o=n.position,s=n.fov,a=e.dy,u=e.dx*e.width/e.height,c=o[2],h=Math.tan(s*Math.PI/180/2)*Math.abs(c),l=a*h,f=u*h,p=this.dragRange,d=p.dxRange,m=p.dyRange,v=o[0]-this.dragRatio[0]*f,y=o[1]-this.dragRatio[1]*l,g=d[0],_=d[1],E=m[0],x=m[1];if(v=xn(v,g,_),y=xn(y,E,x),v!==g&&v!==_&&g!==_)null==(r=e.origin)||r.preventDefault();if(y!==E&&y!==x&&E!==x)null==(i=e.origin)||i.preventDefault();this.item.composition.camera.position=new bn(v,y,c)}},r.beginDragTarget=function(t,r){var i=this;if("camera"===t.target){var n,o={touchstart:function(t){var e;if(i.canInteract()){i.dragEvent=null,i.bouncingArg=null;var r=null==(e=i.item.composition)?void 0:e.camera;n={x:t.x,y:t.y,cameraParam:{position:(null==r?void 0:r.position.toArray())||[0,0,8],fov:(null==r?void 0:r.fov)||60}}}},touchmove:function(t){i.handleDragMove(n,t),i.bouncingArg=t},touchend:function(t){if(i.canInteract()){var e=i.bouncingArg;if(!bu(e,3)&&e){e.vx*=5,e.vy*=5,i.dragEvent=to({},n)}n=null}}};Object.keys(o).forEach((function(t){r.addEventListener(t,o[t])})),o.touchmove({dx:0,dy:0,width:1,height:1}),this.item.getComponent(e).endDragTarget=function(){Object.keys(o).forEach((function(t){r.removeEventListener(t,o[t])}))}}},r.getBoundingBox=function(){var t=this.transform.getWorldMatrix(),e=ia(bn.ZERO,.5*this.transform.size.x,.5*this.transform.size.y);return e.forEach((function(e){t.transformPoint(e.p0),t.transformPoint(e.p1),t.transformPoint(e.p2)})),{type:exports.HitTestType.triangle,area:e}},r.fromData=function(e){if(t.prototype.fromData.call(this,e),this.interactData=e,e.options.type===vi.DRAG){var r=e.options;r.dxRange&&(this.dragRange.dxRange=r.dxRange),r.dyRange&&(this.dragRange.dyRange=r.dyRange)}},r.canInteract=function(){var t;return Boolean(null==(t=this.item.composition)?void 0:t.interactive)&&this._interactive},nn(e,[{key:"interactive",get:function(){return this._interactive},set:function(t){this._interactive=t,t||(this.bouncingArg=null)}}]),e}(dn),exports.InteractComponent=fr([un(qi.InteractComponent)],exports.InteractComponent);var Au=function(){function t(){this.triangles=[],this.worldMatrix=new Pn}var e=t.prototype;return e.getBoundingBoxData=function(){return this.applyWorldMatrix(this.boundingBoxData.area),this.boundingBoxData},e.getBoundingBox=function(){for(var t,e=-Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=wn(this.boundingBoxData.area);!(t=o()).done;){var s=t.value;e=Math.max(s.p0.x,s.p1.x,s.p2.x,e),r=Math.max(s.p0.y,s.p1.y,s.p2.y,r),i=Math.min(s.p0.x,s.p1.x,s.p2.x,i),n=Math.min(s.p0.y,s.p1.y,s.p2.y,n)}var a=[],u=new bn(i,r,0),c=new bn(e,r,0),h=new bn(e,n,0),l=new bn(i,n,0);return a.push({p0:u,p1:c,p2:h}),a.push({p0:u,p1:h,p2:l}),this.applyWorldMatrix(a),{type:exports.HitTestType.triangle,area:a}},e.setGeometry=function(t,e){this.geometry!==t&&(this.triangles=this.geometryToTriangles(t),this.geometry=t);for(var r,i=[],n=wn(this.triangles);!(r=n()).done;){var o=r.value;i.push({p0:o.p0,p1:o.p1,p2:o.p2})}e&&this.worldMatrix.copyFrom(e),this.boundingBoxData={type:exports.HitTestType.triangle,area:i}},e.geometryToTriangles=function(t){for(var e,r,i=null!=(e=t.getIndexData())?e:[],n=null!=(r=t.getAttributeData("aPos"))?r:[],o=[],s=0;s<i.length;s+=3){var a=3*i[s],u=3*i[s+1],c=3*i[s+2],h={x:n[a],y:n[a+1],z:n[a+2]},l={x:n[u],y:n[u+1],z:n[u+2]},f={x:n[c],y:n[c+1],z:n[c+2]};o.push({p0:h,p1:l,p2:f})}return o},e.applyWorldMatrix=function(t){var e=this;return t.forEach((function(t){t.p0=e.worldMatrix.transformPoint(t.p0,new bn),t.p1=e.worldMatrix.transformPoint(t.p1,new bn),t.p2=e.worldMatrix.transformPoint(t.p2,new bn)})),t},t}();function Ru(t){return t.maxVertexUniforms>=256?exports.maxSpriteMeshItemCount=32:t.maxVertexUniforms>=128?exports.maxSpriteMeshItemCount=16:void 0}function Su(t,e){var r=null!=e?e:{},i=r.env,n=void 0===i?"":i,o=r.wireframe,s=[["ENV_EDITOR",n===Xa]];return{fragment:o?cs:ls,vertex:hs,glslVersion:1===t?exports.GLSLVersion.GLSL1:exports.GLSLVersion.GLSL3,macros:s,shared:!0}}function Cu(t,e){return t.cachePrefix+"_effects_sprite_"+e}function Ou(t,e,r,i){var n=Su(r,{wireframe:t.wireframe,env:i});return n.shared=!0,n}exports.maxSpriteMeshItemCount=8;var Mu,Pu={blending:0,cacheId:"-",mask:0,maskMode:0,occlusion:!1,side:0,cachePrefix:"-"},Iu=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).name="sprite",e}return Ri(e,t),e.precompile=function(t,e,r){var i=e.getShaderLibrary(),n=e.engine.gpuCapability,o=n.level,s=n.detail,a=(null!=r?r:{}).env;return(null==i?void 0:i.shaderResults[Cu(Pu,2)])||(null==i||i.addShader(Ou(Pu,0,1,a)),null==i||i.addShader(Ou(Pu,exports.maxSpriteMeshItemCount,1,a)),s.writableFragDepth&&(null==i||i.addShader(Un(o,!0)))),Promise.resolve()},e}(bi),wu=function(){function t(){this.playableOutputs=[],this.playables=[]}var e=t.prototype;return e.evaluate=function(t){for(var e,r=wn(this.playableOutputs);!(e=r()).done;){e.value.context.deltaTime=t}for(var i,n=wn(this.playableOutputs);!(i=n()).done;){var o=i.value;this.prepareFrameWithRoot(o)}for(var s,a=wn(this.playableOutputs);!(s=a()).done;){var u=s.value;this.processFrameWithRoot(u)}},e.addOutput=function(t){this.playableOutputs.push(t)},e.addPlayable=function(t){this.playables.push(t)},e.processFrameWithRoot=function(t){t.sourcePlayable.processFrame(t.context),t.processFrame()},e.prepareFrameWithRoot=function(t){t.prepareFrame(),t.sourcePlayable.prepareFrame(t.context)},e.updatePlayableTime=function(t,e){0===t.getPlayState()&&t.setTime(t.getTime()+e)},t}(),Lu=function(){function t(t,e){this.onPlayablePlayFlag=!0,this.onPlayablePauseFlag=!1,this.duration=0,this.destroyed=!1,this.playState=0,this.time=0,t.addPlayable(this)}var e=t.prototype;return e.play=function(){switch(this.playState){case 0:break;case 1:this.playState=0,this.onPlayablePlayFlag=!0,this.onPlayablePauseFlag=!1}},e.pause=function(){if(0===this.playState)this.playState=1,this.onPlayablePauseFlag=!0,this.onPlayablePlayFlag=!1},e.setTime=function(t){this.time=t},e.getTime=function(){return this.time},e.setDuration=function(t){this.duration=t},e.getDuration=function(){return this.duration},e.getPlayState=function(){return this.playState},e.prepareFrame=function(t){},e.processFrame=function(t){},e.onPlayableDestroy=function(){},e.dispose=function(){this.destroyed||(this.onPlayableDestroy(),this.destroyed=!0)},t}(),Fu=function(){function t(){this.context={deltaTime:0,output:this}}var e=t.prototype;return e.setSourcePlayable=function(t){this.sourcePlayable=t},e.setUserData=function(t){this.userData=t},e.getUserData=function(){return this.userData},e.prepareFrame=function(){},e.processFrame=function(){},t}(),Nu=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e}(ln);!function(t){t[t.Playing=0]="Playing",t[t.Paused=1]="Paused"}(Mu||(Mu={}));var Du,Vu=new Cn,Uu=1,Bu=function(){function t(t,e){void 0===t&&(t={}),this.taggedProperties={},this.position=new bn(0,0,0),this.quat=new Cn(0,0,0,1),this.rotation=new Wo(0,0,0),this.scale=new bn(1,1,1),this.anchor=new bn(0,0,0),this.size=new Tn(1,1),this.children=[],this.worldMatrix=Pn.fromIdentity(),this.localMatrix=Pn.fromIdentity(),this.valid=!0,this.dirtyFlags={localData:!1,localMatrix:!1,worldMatrix:!1,parentMatrix:!1},this.worldTRSCache={position:new bn(0,0,0),quat:new Cn(0,0,0,1),scale:new bn(1,1,1)},this.name="transform_"+Uu++,t&&this.setTransform(t),e&&(this.parentTransform=e),void 0!==t.valid&&this.setValid(t.valid)}var e=t.prototype;return e.setPosition=function(t,e,r){this.position.x===t&&this.position.y===e&&this.position.z===r||(this.position.x=t,this.position.y=e,this.position.z=r,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.translate=function(t,e,r){0===t&&0===e&&0===r||(this.position.x+=t,this.position.y+=e,this.position.z+=r,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setRotation=function(t,e,r){this.rotation.x===t&&this.rotation.y===e&&this.rotation.z===r||(this.rotation.x=t,this.rotation.y=e,this.rotation.z=r,this.quat.setFromEuler(this.rotation),this.quat.conjugate(),this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setQuaternion=function(t,e,r,i){this.quat.x===t&&this.quat.y===e&&this.quat.z===r&&this.quat.w===i||(this.quat.x=t,this.quat.y=e,this.quat.z=r,this.quat.w=i,this.rotation.setFromQuaternion(this.quat),this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setScale=function(t,e,r){this.scale.x===t&&this.scale.y===e&&this.scale.z===r||(this.scale.x=t,this.scale.y=e,this.scale.z=r,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setSize=function(t,e){this.size.x===t&&this.size.y===e||(this.size.x=t,this.size.y=e,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.rotateByQuat=function(t){this.quat.multiply(t),this.rotation.setFromQuaternion(this.quat),this.dirtyFlags.localData=!0,this.dispatchValueChange()},e.scaleBy=function(t,e,r){this.scale.x*=t,this.scale.y*=e,this.scale.z*=r,this.dirtyFlags.localData=!0,this.dispatchValueChange()},e.setAnchor=function(t,e){this.anchor.x===t&&this.anchor.y===e||(this.anchor.x=t,this.anchor.y=e,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setTransform=function(t,e){var r=t.position,i=t.rotation,n=t.scale,o=t.size,s=t.quat,a=t.name,u=t.anchor;if(a&&(this.name=a),r&&(hr(r,bn)?this.setPosition(r.x,r.y,r.z):this.setPosition(r[0],r[1],r[2])),s)hr(s,Cn)?this.setQuaternion(s.x,s.y,s.z,s.w):this.setQuaternion(s[0],s[1],s[2],s[3]);else if(i){var c=e?-1:1;hr(i,Wo)?this.setRotation(i.x*c,i.y*c,i.z*c):this.setRotation(i[0]*c,i[1]*c,i[2]*c)}n&&(hr(n,bn)?this.setScale(n.x,n.y,n.z):this.setScale(n[0],n[1],n[2])),o&&this.setSize(o.x,o.y),u&&(hr(u,Tn)?this.setAnchor(u.x,u.y):this.setAnchor(u[0],u[1]))},e.addChild=function(t){xr(this.children,t)},e.removeChild=function(t){Tr(this.children,t)},e.getRotation=function(){return t.getRotation(this.quat,new Wo)},e.getQuaternion=function(){return this.quat},e.updateLocalMatrix=function(){this.valid?(this.dirtyFlags.localData&&(this.localMatrix.compose(this.position,this.quat,this.scale,this.anchor),this.dirtyFlags.localMatrix=!0),this.dirtyFlags.localData=!1):this.localMatrix.isIdentity()||(this.localMatrix.identity(),this.dirtyFlags.localMatrix=!0)},e.getMatrix=function(){return this.updateLocalMatrix(),this.localMatrix},e.getParentMatrix=function(){return this.parent&&(this.parentMatrix=this.parent.getWorldMatrix(),this.dirtyFlags.parentMatrix=this.dirtyFlags.parentMatrix||this.parent.dirtyFlags.localMatrix||this.parent.dirtyFlags.worldMatrix),this.parentMatrix},e.getWorldMatrix=function(){var t=this.getMatrix(),e=this.getParentMatrix();return(this.dirtyFlags.localMatrix||this.dirtyFlags.parentMatrix)&&(e?this.worldMatrix.multiplyMatrices(e,t):this.worldMatrix.copyFrom(t),this.dirtyFlags.worldMatrix=!0,this.dirtyFlags.localMatrix=!1,this.dirtyFlags.parentMatrix=!1),this.worldMatrix},e.getWorldScale=function(){var t=this.worldTRSCache;this.dirtyFlags.worldMatrix&&(this.getWorldMatrix().decompose(t.position,t.quat,t.scale),this.dirtyFlags.worldMatrix=!1);return this.worldTRSCache.scale.clone()},e.getWorldPosition=function(){return this.updateTRSCache(),this.worldTRSCache.position.clone()},e.getWorldRotation=function(){return this.updateTRSCache(),t.getRotation(this.worldTRSCache.quat,new Wo)},e.assignWorldTRS=function(t,e,r){this.updateTRSCache(),t&&t.copyFrom(this.worldTRSCache.position),e&&e.copyFrom(this.worldTRSCache.quat),r&&r.copyFrom(this.worldTRSCache.scale)},e.cloneFromMatrix=function(t,e){t.decompose(this.position,this.quat,this.scale),e&&e.copyFrom(this.scale),this.dirtyFlags.localData=!0,this.dispatchValueChange()},e.setValid=function(t){this.valid!==t&&(this.valid=t,t?this.dirtyFlags.localData=!0:(this.localMatrix.identity(),this.dirtyFlags.localMatrix=!0),this.dispatchValueChange())},e.getValid=function(){return this.valid},e.toData=function(){var t=this.taggedProperties;return t.position=this.position.clone(),t.eulerHint={x:this.rotation.x,y:this.rotation.y,z:this.rotation.z},t.scale=this.scale.clone(),t},e.fromData=function(t){var e={position:(new bn).copyFrom(t.position),rotation:new Wo(t.eulerHint.x,t.eulerHint.y,t.eulerHint.z),scale:(new bn).copyFrom(t.scale)};this.setTransform(e)},e.dispose=function(){},e.updateTRSCache=function(){var t=this.getWorldMatrix();if(this.dirtyFlags.worldMatrix){var e=this.worldTRSCache;t.decompose(e.position,e.quat,e.scale),this.dirtyFlags.worldMatrix=!1}},e.dispatchValueChange=function(){this.children.forEach((function(t){t.parentMatrixDirty=!0}))},t.getRotation=function(t,e){var r=Vu.copyFrom(t);return r.conjugate(),e.setFromQuaternion(r)},nn(t,[{key:"parentTransform",get:function(){return this.parent},set:function(t){t&&this.parent!==t&&this!==t&&(this.parent&&this.parent.removeChild(this),t.addChild(this),this.parent=t,this.parentMatrixDirty=!0)}},{key:"parentMatrixDirty",get:function(){return this.dirtyFlags.parentMatrix},set:function(t){this.dirtyFlags.parentMatrix!==t&&(this.dirtyFlags.parentMatrix=t,this.dispatchValueChange())}}]),t}(),ku=function(){var t=this,e=this;this.listeners={},this.off=function(e,r){t.listeners[e]&&(t.listeners[e]=t.listeners[e].filter((function(t){return t.listener!==r})))},this.on=function(e,r,i){return t.listeners[e]=t.listeners[e]||[],t.listeners[e].push({listener:r,options:i}),function(){return t.off(e,r)}},this.once=function(e,r){t.on(e,r,{once:!0})},this.emit=function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var o;null==(o=e.listeners[t])||o.forEach((function(r){var n=r.listener,o=r.options;n.apply(void 0,[].concat(i)),(null==o?void 0:o.once)&&e.off(t,n)}))},this.getListeners=function(e){var r;return(null==(r=t.listeners[e])?void 0:r.map((function(t){return t.listener})))||[]}};exports.VFXItem=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).children=[],i.transform=new Bu,i.time=0,i.duration=0,i.start=0,i.endBehavior=Mi.forward,i.type=gi.base,i.isDuringPlay=!1,i.components=[],i.rendererComponents=[],i.active=!0,i.visible=!0,i.speed=1,i.listIndex=0,i.isEnabled=!1,i.eventProcessor=new ku,i.name="VFXItem",i.transform.name=i.name,i.transform.engine=e,r&&i.fromData(r),i}Ri(e,t);var r=e.prototype;return r.on=function(t,e,r){this.eventProcessor.on(t,e,r)},r.off=function(t,e){this.eventProcessor.off(t,e)},r.once=function(t,e){this.eventProcessor.once(t,e)},r.emit=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n;(n=this.eventProcessor).emit.apply(n,[].concat([t],r))},r.getListeners=function(t){return this.eventProcessor.getListeners(t)},r.setSpeed=function(t){this.speed=t},r.getSpeed=function(){return this.speed},r.addComponent=function(t){var e=new t(this.engine);return this.components.push(e),e.setVFXItem(this),e},r.getComponent=function(t){for(var e,r,i=wn(this.components);!(r=i()).done;){var n=r.value;if(hr(n,t)){e=n;break}}return e},r.getComponents=function(t){for(var e,r=[],i=wn(this.components);!(e=i()).done;){var n=e.value;hr(n,t)&&r.push(n)}return r},r.setParent=function(t){(t!==this||t)&&(this.parent&&Tr(this.parent.children,this),this.parent=t,e.isCamera(this)||(this.transform.parentTransform=t.transform),t.children.push(this),this.composition||(this.composition=t.composition),!this.isDuringPlay&&t.isDuringPlay&&this.beginPlay())},r.setColor=function(t,e,r,i){},r.setOpacity=function(t){},r.setActive=function(t){this.active!==t&&(this.active=!!t,this.onActiveChanged())},r.setVisible=function(t){for(var e,r=wn(this.components);!(e=r()).done;){e.value.enabled=t}this.visible=t},r.getVisible=function(){return this.visible},r.getWorldTransform=function(t){var e=null!=t?t:new Bu({valid:!0});return e.cloneFromMatrix(this.transform.getWorldMatrix()),e},r.translate=function(t,e,r){this.transform.translate(t,e,r)},r.rotate=function(t,e,r){var i=new Wo(t,e,r),n=Cn.fromEuler(i);n.conjugate(),this.transform.rotateByQuat(n)},r.scale=function(t,e,r){this.transform.scaleBy(t,e,r)},r.setPositionByPixel=function(t,e){if(this.composition){var r=this.transform.getWorldPosition().z,i=this.composition.camera.getInverseVPRatio(r),n=i.x,o=i.y,s=this.composition.renderer.getWidth()/2,a=this.composition.renderer.getHeight()/2;this.transform.setPosition((2*t/s-1)*n,(1-2*e/a)*o,r)}},r.setPosition=function(t,e,r){this.transform.setPosition(t,e,r)},r.setRotation=function(t,e,r){this.transform.setRotation(t,e,r)},r.setScale=function(t,e,r){this.transform.setScale(t,e,r)},r.getBoundingBox=function(){},r.getHitTestParams=function(t){},r.getCurrentPosition=function(){var t=new bn;return this.transform.assignWorldTRS(t),t},r.find=function(t){var e;if(this.name===t)return this;var r=[];(e=r).push.apply(e,[].concat(this.children));for(var i=0;i<r.length;){var n,o=r[i];if(i++,o.name===t)return o;(n=r).push.apply(n,[].concat(o.children))}},r.beginPlay=function(){this.isDuringPlay=!0,this.composition&&this.active&&!this.isEnabled&&this.onEnable();for(var t,e=wn(this.children);!(t=e()).done;){var r=t.value;r.isDuringPlay||r.beginPlay()}},r.onActiveChanged=function(){this.isEnabled?this.onDisable():this.onEnable()},r.onEnable=function(){this.isEnabled=!0;for(var t,e=wn(this.components);!(t=e()).done;){var r=t.value;r.enabled&&!r.isStartCalled&&(r.onStart(),r.isStartCalled=!0)}for(var i,n=wn(this.components);!(i=n()).done;){var o=i.value;o.enabled&&!o.isEnableCalled&&o.enable()}},r.onDisable=function(){this.isEnabled=!1;for(var t,e=wn(this.components);!(t=e()).done;){var r=t.value;r.enabled&&r.isEnableCalled&&r.disable()}},r.fromData=function(e){t.prototype.fromData.call(this,e);var r=e.id,i=e.name,n=e.delay,o=e.parentId,s=e.endBehavior,a=e.transform,u=e.duration,c=void 0===u?0:u;if(this.props=e,this.type=e.type,this.id=r.toString(),this.name=i,this.start=n||this.start,a){var h;if(a.position=(new bn).copyFrom(a.position),a.quat)a.quat=new Cn(a.quat.x,a.quat.y,a.quat.z,a.quat.w);else a.rotation=(new Wo).copyFrom(null!=(h=a.eulerHint)?h:a.rotation);a.scale=(new bn).copyFrom(a.scale),a.size&&(a.size=(new Tn).copyFrom(a.size)),a.anchor&&(a.anchor=(new Tn).copyFrom(a.anchor)),this.transform.setTransform(a)}if(this.transform.name=this.name,this.transform.engine=this.engine,this.parentId=o,this.duration=c,this.endBehavior=s,e.content||(e.content={options:{}}),c<0)throw new Error("Item duration can't be less than 0, see "+Ha["Item duration can't be less than 0"]+".");this.rendererComponents.length=0;for(var l,f=wn(this.components);!(l=f()).done;){var p=l.value;p.item=this,hr(p,dn)&&this.rendererComponents.push(p),hr(p,exports.ParticleSystem)&&(this.components.includes(p.renderer)||this.components.push(p.renderer),this.rendererComponents.push(p.renderer))}},r.toData=function(){var t,e;(this.taggedProperties.id=this.guid,this.taggedProperties.transform=this.transform.toData(),this.taggedProperties.dataType=qi.VFXItemData,"rootItem"!==(null==(t=this.parent)?void 0:t.name))&&(this.taggedProperties.parentId=null==(e=this.parent)?void 0:e.guid);if(!this.taggedProperties.components){this.taggedProperties.components=[];for(var r,i=wn(this.components);!(r=i()).done;){var n=r.value;hr(n,exports.EffectComponent)&&this.taggedProperties.components.push(n)}}this.taggedProperties.content={}},r.translateByPixel=function(t,e){if(this.composition){var r=this.composition.renderer.canvas.getBoundingClientRect(),i=r.width,n=r.height,o=this.transform.getWorldPosition().z,s=this.composition.camera.getInverseVPRatio(o),a=s.x,u=s.y;this.transform.translate(2*t*a/i,-2*e*u/n,0)}},r.dispose=function(){if(this.resetChildrenParent(),this.composition){this.composition.destroyItem(this);for(var t,e=wn(this.components.slice());!(t=e()).done;){t.value.dispose()}this.components=[],this._content=void 0,this.composition=null,this.transform.setValid(!1)}},r.resetChildrenParent=function(){for(var t,e=wn(this.children);!(t=e()).done;){var r=t.value;this.parent&&r.setParent(this.parent)}var i;this.parent&&Tr(null==(i=this.parent)?void 0:i.children,this)},e.isComposition=function(t){return t.type===gi.composition},e.isSprite=function(t){return t.type===gi.sprite},e.isParticle=function(t){return t.type===gi.particle},e.isNull=function(t){return t.type===gi.null},e.isTree=function(t){return t.type===gi.tree},e.isCamera=function(t){return t.type===gi.camera},e.isAncestor=function(t,e){for(var r=e.parent;r;){if(r===t)return!0;r=r.parent}return!1},nn(e,[{key:"content",get:function(){return this._content}},{key:"compositionReusable",get:function(){var t,e;return null!=(e=null==(t=this.composition)?void 0:t.reusable)&&e}},{key:"renderOrder",get:function(){return this.listIndex},set:function(t){if(this.listIndex!==t){this.listIndex=t;for(var e,r=wn(this.rendererComponents);!(e=r()).done;){e.value.priority=t}}}},{key:"isActive",get:function(){return this.active}},{key:"isVisible",get:function(){return this.visible}}]),e}(ln),fr([cn()],exports.VFXItem.prototype,"components",void 0),exports.VFXItem=fr([un(qi.VFXItemData)],exports.VFXItem),exports.Item=void 0,(Du=exports.Item||(exports.Item={})).is=function(t,e){return t.type===e},Du.isComposition=function(t){return t.type===gi.composition},Du.isParticle=function(t){return t.type===gi.particle},Du.isNull=function(t){return t.type===gi.null};var zu=[1,1,1,1],Gu=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).renderColor=[1,1,1,1],e}Ri(e,t);var r=e.prototype;return r.processFrame=function(t){var e,r=t.output.getUserData();if(hr(r,exports.VFXItem)){if(this.activeComponent||(this.activeComponent=this.getActiveComponent(r)),!this.activeMaterial){var i,n;this.activeMaterial=null==(i=this.activeComponent)?void 0:i.material;var o=null==(n=this.activeMaterial)?void 0:n.getVector4("_Color");o&&(this.startColor=o.toArray())}null==(e=this.activeComponent)||e.setAnimationTime(this.time);var s,a,u,c=Js(zu,1),h=this.time/r.duration,l=this.opacityOverLifetime,f=this.colorOverLifetime;if(f&&(c=Rr(f,h,!0),s=!0),l&&(c[3]*=l.getValue(h),s=!0),s)$s(this.renderColor,c,this.startColor),null==(u=this.activeMaterial)||null==(a=u.getVector4("_Color"))||a.setFromArray(this.renderColor)}},r.create=function(t){this.clipData=t;var e,r=t.colorOverLifetime;r&&(this.opacityOverLifetime=Ya(null!=(e=r.opacity)?e:1),r.color&&r.color[0]===Ci.GRADIENT_COLOR&&(this.colorOverLifetime=Sr(r.color[1])));return this},r.getActiveComponent=function(t){return t.getComponent(Za)},e}(Lu),Xu=[[0,0,1,1,void 0]],Hu=0;exports.SpriteColorPlayableAsset=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.createPlayable=function(t){var e=new Gu(t);return e.create(this.data),e},r.fromData=function(t){this.data=t},e}(Nu),exports.SpriteColorPlayableAsset=fr([un(qi.SpriteColorPlayableAsset)],exports.SpriteColorPlayableAsset),exports.SpriteComponent=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).splits=Xu,i.frameAnimationLoop=!1,i.name="MSprite"+Hu++,i.geometry=i.createGeometry(jn.TRIANGLES),i.setItem(),r&&i.fromData(r),i}Ri(e,t);var r=e.prototype;return r.onUpdate=function(t){var e=this;this.isManualTimeSet||(this.frameAnimationTime+=t/1e3,this.isManualTimeSet=!1);var r=this.frameAnimationTime,i=this.item.duration;r>i&&this.frameAnimationLoop&&(r%=i);var n=Math.min(Math.max(r/i,0),1),o=this.textureSheetAnimation,s=this.renderer.texture.source.video;if(s&&(0===r?s.pause():s.play().catch((function(t){e.engine.renderErrors.add(t)}))),o){var a,u,c,h,l,f=o.total||o.row*o.col,p=0,d=0,m=1,v=1;if(this.splits){var y=this.splits[0];u=y[4],p=y[0],d=y[1],u?(m=y[3],v=y[2]):(m=y[2],v=y[3])}if(u?(c=1/o.row*m,h=1/o.col*v):(c=1/o.col*m,h=1/o.row*v),o.animate){var g=Math.round(n*(f-1)),_=Math.floor(g/o.col),E=g-_*o.col;l=u?[c*_,h*(o.col-E)]:[c*E,h*(1+_)]}else l=[0,h];null==(a=this.material.getVector4("_TexOffset"))||a.setFromArray([p+l[0],v+d-l[1],c,h])}},r.onDestroy=function(){var t=this.getTextures();this.item&&this.item.composition&&this.item.composition.destroyTextures(t),t.forEach((function(t){var e=t.source;e.sourceType===exports.TextureSourceType.video&&(null==e?void 0:e.video)&&(e.video.pause(),e.video.src="",e.video.load())}))},r.createGeometry=function(t){var e=12*this.splits.length;return jo.create(this.engine,{attributes:{aPos:{type:jn.FLOAT,size:3,data:new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0])},atlasOffset:{size:2,offset:0,releasable:!0,type:jn.FLOAT,data:new Float32Array(0)}},indices:{data:new Uint16Array(0),releasable:!0},mode:t,maxVertex:e})},r.getItemGeometryData=function(){var t=this.splits,e=this.textureSheetAnimation,r=this.renderer;if(r.shape){for(var i=r.shape,n=i.index,o=void 0===n?[]:n,s=i.aPoint,a=void 0===s?[]:s,u=new Float32Array(a),c=[],h=[],l=0;l<u.length;l+=6)u[l]*=1,u[l+1]*=1,h.push(a[l+2],a[l+3]),c.push(u[l],u[l+1],0);return this.geometry.setAttributeData("aPos",new Float32Array(c)),{index:o,atlasOffset:h}}var f=[-.5,.5,-.5,-.5,.5,.5,.5,-.5],p=[],d=[],m=2,v=2;1===t.length&&(m=1,v=1);for(var y=[],g=0;g<m;g++)for(var _=0;_<v;_++){var E=4*(2*_+g),x=e?[0,0,1,1,t[0][4]]:t[2*_+g],T=x[4]?[0,0,1,0,0,1,1,1]:[0,1,0,0,1,1,1,0],b=((g+g+1)/m-1)/2,A=((_+_+1)/v-1)/2,R=x[0],S=x[1],C=x[4]?x[3]:x[2],O=x[4]?x[2]:x[3],M=[f[0]/m+b,f[1]/v+A,f[2]/m+b,f[3]/v+A,f[4]/m+b,f[5]/v+A,f[6]/m+b,f[7]/v+A];p.push(T[0]*C+R,T[1]*O+S,T[2]*C+R,T[3]*O+S,T[4]*C+R,T[5]*O+S,T[6]*C+R,T[7]*O+S),y.push(1*M[0],1*M[1],0,1*M[2],1*M[3],0,1*M[4],1*M[5],0,1*M[6],1*M[7],0),d.push(E,1+E,2+E,2+E,1+E,3+E)}return this.geometry.setAttributeData("aPos",new Float32Array(y)),{index:d,atlasOffset:p}},r.fromData=function(e){t.prototype.fromData.call(this,e);var r,i,n,o,s,a,u=e.interaction,c=e.options,h=e.listIndex,l=void 0===h?0:h,f=e.renderer;f||(f={}),this.interaction=u,this.renderer={renderMode:null!=(r=f.renderMode)?r:_i.MESH,blending:null!=(i=f.blending)?i:li.ALPHA,texture:null!=(n=f.texture)?n:this.engine.emptyTexture,occlusion:!!f.occlusion,transparentOcclusion:!!f.transparentOcclusion||f.maskMode===pi.MASK,side:null!=(o=f.side)?o:fi.DOUBLE,shape:f.shape,mask:null!=(s=f.mask)?s:0,maskMode:null!=(a=f.maskMode)?a:pi.NONE,order:l},this.emptyTexture=this.engine.emptyTexture,this.splits=e.splits||Xu,this.textureSheetAnimation=e.textureSheetAnimation,this.cachePrefix="-",this.renderInfo=qa(this);var p=this.createGeometry(jn.TRIANGLES),d=this.createMaterial(this.renderInfo,2);this.worldMatrix=Pn.fromIdentity(),this.material=d,this.geometry=p;var m=c.startColor||[1,1,1,1];this.material.setVector4("_Color",(new An).setFromArray(m)),this.material.setVector4("_TexOffset",(new An).setFromArray([0,0,1,1])),this.setItem()},e}(Za),exports.SpriteComponent=fr([un(qi.SpriteComponent)],exports.SpriteComponent);var ju="lookup_texture",Yu="offscreen_canvas",Wu={};function Zu(t){return Wu[t]}var qu=function(){function t(t){var e=this;Object.keys(t).forEach((function(r){e[r]=t[r]}))}return t.prototype.generate=function(t){var e=Ku(this.arc,this.arcMode,t)*vn,r=Math.cos(e)*this.radius,i=Math.sin(e)*this.radius,n=new bn(r,i,0),o=Math.tan(this.angle*vn),s=n.clone().multiply(o);return s.z+=1,{position:n.multiply($r(0,1)),direction:s.normalize()}},t}();function Ku(t,e,r){if(e===wi.RANDOM)t=$r(0,t);else if(e===wi.UNIDIRECTIONAL_CYCLE){var i=r.index%(r.total+1);t=t/r.total*i}else if(e===wi.BIDIRECTIONAL_CYCLE){var n=r.index/(r.total+1),o=n-Math.floor(n);t*=Math.floor(n)%2?1-o:o}else e===wi.UNIFORM_BURST&&(t=t*r.burstIndex/r.burstCount);return t}var Qu,Ju=function(){function t(t){var e=this;Object.keys(t).forEach((function(r){e[r]=t[r]}))}return t.prototype.generate=function(t){var e=Ku(this.arc,this.arcMode,t)*vn,r=new bn(Math.cos(e),Math.sin(e),0),i=this.radius;return{direction:r,position:r.clone().multiply(i)}},t}(),$u=function(){function t(t){this._d=(t.width||1)/2,this._h=(t.height||1)/2}return t.prototype.generate=function(t){var e=$r(-this._d,this._d),r=$r(-this._h,this._h);return{direction:new bn(0,0,1),position:new bn(e,r,0)}},t}(),tc=function(){function t(t){this._d=(t.width||1)/2,this._h=(t.height||1)/2,this.arcMode=t.arcMode,this.arc=t.arc}return t.prototype.generate=function(t){var e=Ku(this.arc,this.arcMode,t)*vn,r=new bn(Math.cos(e),Math.sin(e),0),i=this._d,n=this._h,o=Math.atan2(n,i),s=Math.tan(e),a=new bn;return e<o?a.set(i,i*s,0):e>=o&&e<Math.PI-o?a.set(n/s,n,0):e<Math.PI+o?a.set(-i,-i*s,0):e<2*Math.PI-o?a.set(-n/s,-n,0):a.set(i,i*s,0),{direction:r,position:a}},t}(),ec=function(){function t(t){this._d=t.width||1,this.arcMode=t.arcMode}return t.prototype.generate=function(t){var e=this.arcMode===wi.UNIFORM_BURST?t.burstIndex%t.burstCount/(t.burstCount-1):$r(0,1);return{direction:new bn(0,1,0),position:new bn(this._d*(e-.5),0,0)}},t}(),rc=new Pn,ic=function(){function t(t){var e=this;Object.keys(t).forEach((function(r){e[r]=t[r]}))}return t.prototype.generate=function(t){var e=this.donutRadius,r=this.radius-e,i=$r(0,2*Math.PI),n=Ku(this.arc,this.arcMode,t)*vn,o=rc.setFromRotationZ(n),s=new bn(Math.cos(i),Math.sin(i),0),a=new bn(r+Math.cos(i)*e,0,Math.sin(i)*e);return{direction:o.transformNormal(s),position:o.transformPoint(a)}},t}(),nc=new Pn,oc=function(){function t(t){var e=this;Object.keys(t).forEach((function(r){e[r]=t[r]}))}var e=t.prototype;return e.getHorizontalAngle=function(){return $r(-90,90)},e.generate=function(t){var e=Ku(this.arc,this.arcMode,t)*vn,r=this.getHorizontalAngle()*vn,i=this.radius,n=new bn(Math.cos(r),0,Math.sin(r)),o=nc.setFromRotationZ(e).transformNormal(n);return{position:o.clone().multiply(i),direction:o}},t}(),sc=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.getHorizontalAngle=function(){return $r(0,90)},e}(oc),ac=function(){function t(t){var e=t.detail||{anchors:[.5,.5],block:[0,0]};this.anchors=new Float32Array(e.anchors),this.width=t.width||1,this.height=t.height||1,this.block=e.block,this.arcMode=t.arcMode,this.random=xn(t.random||0,0,1)}return t.prototype.generate=function(t){var e=this.anchors,r=e.length/2-1,i=Math.floor(Ku(r,this.arcMode,t)),n=(e[2*i]+this.block[0]*this.random*Math.random())%1-.5,o=(e[2*i+1]+this.block[1]*this.random*Math.random())%1-.5,s=new bn(n,o,0);return{position:new bn(n*this.width,o*this.height,0),direction:s.normalize()}},t}(),uc=function(){function t(){}return t.prototype.generate=function(){return{position:new bn,direction:new bn}},t}(),cc=((Qu={})[di.NONE]=uc,Qu[di.CONE]=qu,Qu[di.SPHERE]=oc,Qu[di.HEMISPHERE]=sc,Qu[di.CIRCLE]=Ju,Qu[di.DONUT]=ic,Qu[di.RECTANGLE]=$u,Qu[di.EDGE]=ec,Qu[di.RECTANGLE_EDGE]=tc,Qu[di.TEXTURE]=ac,Qu);function hc(t){if(!t)return new uc;var e=to({radius:1,arc:360,angle:0,arcMode:wi.RANDOM},t),r=t.type,i=cc[r];if(!i)throw new Error("Invalid shape: "+r+".");var n=new i(e);if(r!==di.NONE){var o=t.alignSpeedDirection,s=t.upDirection,a=void 0===s?[0,0,1]:s;n.alignSpeedDirection=o,n.upDirection=bn.fromArray(a).normalize()}return n}function lc(t,e,r,i,n){var o,s;if(n===function(t,e,r,i){for(var n=0,o=e,s=r-i;o<r;o+=i)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}(t,e,r,i)>0)for(o=e;o<r;o+=i)s=Mc(o,t[o],t[o+1],s);else for(o=r-i;o>=e;o-=i)s=Mc(o,t[o],t[o+1],s);return s&&bc(s,s.next)&&(Pc(s),s=s.next),s}function fc(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!bc(i,i.next)&&0!==Tc(i.prev,i,i.next))i=i.next;else{if(Pc(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function pc(t){var e=t.prev,r=t,i=t.next;if(Tc(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Ec(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&Tc(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function dc(t,e,r,i){var n=t.prev,o=t,s=t.next;if(Tc(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,u=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,c=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,h=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,l=gc(a,u,e,r,i),f=gc(c,h,e,r,i),p=t.prevZ,d=t.nextZ;p&&p.z>=l&&d&&d.z<=f;){if(p!==t.prev&&p!==t.next&&Ec(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Tc(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,d!==t.prev&&d!==t.next&&Ec(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Tc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;p&&p.z>=l;){if(p!==t.prev&&p!==t.next&&Ec(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Tc(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;d&&d.z<=f;){if(d!==t.prev&&d!==t.next&&Ec(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Tc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function mc(t,e){return t.x-e.x}function vc(t,e){if(e=function(t,e){var r,i=e,n=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=n&&a>s){if(s=a,a===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===s)return r;var u,c=r,h=r.x,l=r.y,f=1/0;i=r;do{n>=i.x&&i.x>=h&&n!==i.x&&Ec(o<l?n:s,o,h,l,o<l?s:n,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(n-i.x),Cc(i,t)&&(u<f||u===f&&(i.x>r.x||i.x===r.x&&yc(r,i)))&&(r=i,f=u)),i=i.next}while(i!==c);return r}(t,e),e){var r=Oc(e,t);fc(e,e.next),fc(r,r.next)}}function yc(t,e){return Tc(t.prev,t,e.prev)<0&&Tc(e.next,t,t.next)<0}function gc(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _c(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Ec(t,e,r,i,n,o,s,a){return(n-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(i-a)-(r-s)*(e-a)>=0&&(r-s)*(o-a)-(n-s)*(i-a)>=0}function xc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Ac(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Cc(t,e)&&Cc(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(Tc(t.prev,t,e.prev)||Tc(t,e.prev,e))||bc(t,e)&&Tc(t.prev,t,t.next)>0&&Tc(e.prev,e,e.next)>0)}function Tc(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function bc(t,e){return t.x===e.x&&t.y===e.y}function Ac(t,e,r,i){var n=Sc(Tc(t,e,r)),o=Sc(Tc(t,e,i)),s=Sc(Tc(r,i,t)),a=Sc(Tc(r,i,e));return n!==o&&s!==a||(!(0!==n||!Rc(t,r,e))||(!(0!==o||!Rc(t,i,e))||(!(0!==s||!Rc(r,t,i))||!(0!==a||!Rc(r,e,i)))))}function Rc(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Sc(t){return t>0?1:t<0?-1:0}function Cc(t,e){return Tc(t.prev,t,t.next)<0?Tc(t,e,t.next)>=0&&Tc(t,t.prev,e)>=0:Tc(t,e,t.prev)<0||Tc(t,t.next,e)<0}function Oc(t,e){var r=new Ic(t.i,t.x,t.y),i=new Ic(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function Mc(t,e,r,i){var n=new Ic(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Pc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ic(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var wc=0;function Lc(t,e,r,i){r=r||2,wc=i||0;var n,o,s,a,u,c,h,l=e&&e.length,f=l?e[0]*r:t.length,p=lc(t,0,f,r,!0),d=[];if(!p||p.next===p.prev)return d;if(l&&(p=function(t,e,r,i){var n,o,s,a=[];for(n=0,o=e.length;n<o;n++)(s=lc(t,e[n]*i,n<o-1?e[n+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),a.push(_c(s));for(a.sort(mc),n=0;n<a.length;n++)vc(a[n],r),r=fc(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=s=t[0],o=a=t[1];for(var m=r;m<f;m+=r)(u=t[m])<n&&(n=u),(c=t[m+1])<o&&(o=c),u>s&&(s=u),c>a&&(a=c);h=0!==(h=Math.max(s-n,a-o))?1/h:0}return Fc(p,d,r,n,o,h),d}function Fc(t,e,r,i,n,o,s){if(t){!s&&o&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=gc(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,o,s,a,u,c=1;do{for(r=t,t=null,o=null,s=0;r;){for(s++,i=r,a=0,e=0;e<c&&(a++,i=i.nextZ);e++);for(u=c;a>0||u>0&&i;)0!==a&&(0===u||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,u--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,c*=2}while(s>1)}(n)}(t,i,n,o);for(var a,u,c=t;t.prev!==t.next;)if(a=t.prev,u=t.next,o?dc(t,i,n,o):pc(t))e.push(a.i/r+wc),e.push(t.i/r+wc),e.push(u.i/r+wc),Pc(t),t=u.next,c=u.next;else if((t=u)===c){s?1===s?Fc(t=Nc(fc(t),e,r),e,r,i,n,o,2):2===s&&Dc(t,e,r,i,n,o):Fc(fc(t),e,r,i,n,o,1);break}}}function Nc(t,e,r){var i=t;do{var n=i.prev,o=i.next.next;!bc(n,o)&&Ac(n,i,i.next,o)&&Cc(n,o)&&Cc(o,n)&&(e.push(n.i/r+wc),e.push(i.i/r+wc),e.push(o.i/r+wc),Pc(i),Pc(i.next),i=t=o),i=i.next}while(i!==t);return fc(i)}function Dc(t,e,r,i,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&xc(s,a)){var u=Oc(s,a);return s=fc(s,s.next),u=fc(u,u.next),Fc(s,e,r,i,n,o),void Fc(u,e,r,i,n,o)}a=a.next}s=s.next}while(s!==t)}function Vc(t,e){for(var r=t.s,i=t.p,n=r[1],o=i[1],s=0,a=0;a<n.length;a++){s+=n[a].length-1}var u,c=new Float32Array(6*s),h=e.indexBase,l=void 0===h?0:h,f=e.uvTransform,p=0,d=0,m=0,v=1,y=1;f&&(d=f[0],m=f[1],u=f[4],v=u?f[3]:f[2],y=u?f[2]:f[3]);for(var g=[0,0],_=0===u?0:-Math.PI/2,E=0;E<n.length;E++)for(var x=n[E],T=o[E],b=o[E+1]||o[0],A=x,R=[0,0],S=0;S<A.length-1;S++){kc(R,A[S],T,b,T[4],T[5],b[2],b[3]),O(R[0],R[1])}var C=Lc(Array.from(c),null,6,l);return{aPoint:c,index:new Uint16Array(C)};function O(t,e){c[p++]=t/2,c[p++]=e/2,f?(g[0]=t,g[1]=e,Bc(g,g,_),c[p++]=d+(g[0]+1)/2*v,c[p++]=m+(g[1]+1)/2*y):(c[p++]=(t+1)/2,c[p++]=(e+1)/2),p+=2}}function Uc(t,e){for(var r=[],i=function(t){var e=[];return"gs"in t?t.gs.forEach((function(t){e.push({p:[Ci.SHAPE_POINTS,t.p],s:[Ci.SHAPE_SPLITS,t.s]})})):"g"in t?e.push({p:[Ci.SHAPE_POINTS,t.g.p],s:[Ci.SHAPE_SPLITS,t.g.s]}):e.push(t),e}(t),n=0,o=0,s=0,a=0;a<i.length;a++){var u=Vc(i[a],{indexBase:n,uvTransform:e});n+=u.aPoint.length/5,r.push(u),o+=u.aPoint.length,s+=u.index.length}if(1===r.length)return r[0];for(var c=new Float32Array(o),h=new Uint16Array(s),l=0,f=0,p=0;l<r[l];l++){var d=r[l];c.set(d.aPoint,f),f+=d.aPoint.length,h.set(d.index,p),p+=d.index.length}return{aPoint:c,index:h}}function Bc(t,e,r){var i=Math.cos(r),n=Math.sin(r),o=e[0],s=e[1];return t[0]=i*o+n*s,t[1]=-n*o+i*s,t}function kc(t,e,r,i,n,o,s,a){var u=1-e,c=u*u*u,h=3*e*u*u,l=3*e*e*u,f=e*e*e;return t[0]=c*r[0]+h*n+l*s+f*i[0],t[1]=c*r[1]+h*o+l*a+f*i[1],t}var zc=function(){function t(t){var e=t.time,r=t.interval,i=t.count,n=t.cycles,o=t.probability;this.time=+e||0,this.interval=+r||1,this.count=hr(i,Ta)?i:Ya(i),this.cycles=+n||1/0,this.probability=isNaN(o)?1:+o,this.reset()}var e=t.prototype;return e.getGeneratorOptions=function(t,e){if(t-this.time-this.now>this.interval*this.index&&this.internalCycles>0)return this.internalCycles--,this.index++,Math.random()<=this.probability?{index:this.index,total:1/this.interval,count:this.count.getValue(e),cycleIndex:this.cycles-this.internalCycles-1}:null},e.reset=function(){this.internalCycles=this.cycles,this.index=0,this.now=0},e.clone=function(){return new t({time:this.time,interval:this.interval,count:this.count,cycles:this.cycles,probability:this.probability})},t}(),Gc=function(t){this.content=t},Xc=function(){function t(t){this.sort=t,this.length=0}var e=t.prototype;return e.findNodeByContent=function(t){var e=this.first;if(e)do{if(t(e.content))return e}while(e=e.next)},e.insertNode=function(t,e){var r=t.next;t.next=e,e.pre=t,e.next=r,r&&(r.pre=e)},e.shiftNode=function(t){var e=new Gc(t);if(this.length++,1===this.length)return this.first=this.last=e;for(var r=this.first;r;){if(!(this.sort(r.content,e.content)<=0))return r.pre?this.insertNode(r.pre,e):(this.first=e,e.next=r,r.pre=e),e;if(!r.next)return this.insertNode(r,e),this.last=e;r=r.next}},e.pushNode=function(t){var e=new Gc(t);if(this.length++,1===this.length)return this.last=this.first=e;for(var r=this.last;r;){if(!(this.sort(e.content,r.content)<=0))return this.insertNode(r,e),r===this.last&&(this.last=e),e;if(this.first===r)return r.pre=e,e.next=r,this.first=e;r=r.pre}},e.removeNode=function(t){var e=this.first;if(this.length--,e===t){var r=this.first=e.next;r&&(r.pre=null)}else if((e=this.last)===t){var i=this.last=e.pre;i&&(i.next=null)}else if(t){var n=t.pre,o=t.next;n.next=o,o&&(o.pre=n)}t.pre=null,t.next=null},e.forEach=function(t,e){var r=this.first,i=0;if(r)do{t.call(e||this,r.content,i++)}while(r=r.next)},e.forEachReverse=function(t,e){var r=this.last,i=this.length-1;if(r)do{t.call(e||this,r.content,i--)}while(r=r.pre)},e.getNodeByIndex=function(t){var e=0,r=this.first;if(!r||t>=this.length||t<0)return null;for(;e<t;)r=r.next,e++;return r},t}(),Hc=new bn,jc=new bn,Yc=function(){function t(t,e){this.pointStart=[];var r,i=e.colorOverLifetime,n=e.colorOverTrail,o=e.maxTrailCount,s=e.opacityOverLifetime,a=void 0===s?Ya(1):s,u=e.widthOverTrail,c=e.name,h=e.occlusion,l=e.blending,f=e.maskMode,p=e.textureMap,d=void 0===p?[0,0,1,1]:p,m=e.texture,v=e.transparentOcclusion,y=e.minimumVertexDistance,g=e.lifetime,_=e.matrix,E=t.gpuCapability,x=E.detail,T=E.level,b=Math.max(e.pointCountPerTrail,2),A={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},R=x.maxVertexTextures>0,S=(null!=(r=t.renderer)?r:{}).env,C={},O=[["ENABLE_VERTEX_TEXTURE",R],["LOOKUP_TEXTURE_CURVE",0],["ENV_EDITOR",S===Xa]],M=o>64,P=0;i&&(O.push(["COLOR_OVER_LIFETIME",!0]),P|=1,C.uColorOverLifetime=bo.createWithData(t,Dr(i))),n&&(O.push(["COLOR_OVER_TRAIL",!0]),P|=4,C.uColorOverTrail=bo.createWithData(t,Dr(n))),M?(O.push(["ATTR_TRAIL_START",1]),P|=8):C.uTrailStart=new Float32Array(o),C.uOpacityOverLifetimeValue=a.toUniform(A);var I=u.toUniform(A);O.push(["VERT_CURVE_VALUE_COUNT",A.index],["VERT_MAX_KEY_FRAME_COUNT",A.max]),C.uVCurveValues=Ta.getAllData(A);var w={shader:{vertex:ds,fragment:fs,macros:O,glslVersion:1===T?exports.GLSLVersion.GLSL1:exports.GLSLVersion.GLSL3,shared:!0,name:"trail#"+c,cacheId:"-t:+"+P+"+"+A.index+"+"+A.max},uniformSemantics:{effects_MatrixVP:"VIEWPROJECTION",effects_MatrixInvV:"VIEWINVERSE",effects_ObjectToWorld:"MODEL",uEditorTransform:"EDITOR_TRANSFORM"}},L=b*o*2,F=(b-1)*o,N=Float32Array.BYTES_PER_ELEMENT,D=12*N,V={attributes:{aColor:{size:4,stride:D,data:new Float32Array(12*L)},aSeed:{size:1,stride:D,offset:4*N,dataSource:"aColor"},aInfo:{size:3,stride:D,offset:5*N,dataSource:"aColor"},aPos:{size:4,stride:D,offset:8*N,dataSource:"aColor"},aTime:{size:1,data:new Float32Array(L)},aDir:{size:3,data:new Float32Array(3*L)}},indices:{data:new Uint16Array(6*L)},drawCount:6*F,name:"trail#"+c,bufferUsage:jn.DYNAMIC_DRAW};if(M)V.attributes.aTrailStart={size:1,data:new Float32Array(L)};else{var U=new Float32Array(L);V.attributes.aTrailStartIndex={size:1,data:U};for(var B=0;B<o;B++)for(var k=2*b,z=B*k,G=0;G<k;G++)U[z+G]=B}var X=Kn(l),H=Bo.create(t,w);H.blending=!0,H.depthMask=h,H.depthTest=!0,$n(H,f),Qn(H,l);var j=this.mesh=is.create(t,{name:"MTrail_"+c,material:H,geometry:jo.create(t,V)}),Y=null!=m?m:bo.createWithData(t);Object.keys(C).map((function(t){var e=C[t];if(hr(e,bo))H.setTexture(t,e);else if("uTrailStart"===t)H.setFloats("uTrailStart",e);else if("uVCurveValues"===t){for(var r=[],i=0;i<e.length;i+=4){var n=new An(e[i],e[i+1],e[i+2],e[i+3]);r.push(n)}H.setVector4Array(t,r)}else H.setVector4(t,An.fromArray(e))})),H.setFloat("uTime",0),H.setVector4("uWidthOverTrail",An.fromArray(I)),H.setVector2("uTexOffset",new Tn(0,0)),H.setVector4("uTextureMap",An.fromArray(d)),H.setVector4("uParams",new An(0,b-1,0,0)),H.setTexture("uMaskTex",Y),H.setVector4("uColorParams",new An(m?1:0,+X,0,+(h&&!v))),this.maxTrailCount=o,this.pointCountPerTrail=b,this.checkVertexDistance=y>0,this.minimumVertexDistance=Math.pow(y||.001,2),this.useAttributeTrailStart=M,this.lifetime=g,_&&(this.mesh.worldMatrix=_),this.geometry=j.firstGeometry(),this.trailCursors=new Uint16Array(o)}var e=t.prototype;return e.addPoint=function(t,e,r){r=r||{};var i=this.trailCursors[t],n=this.pointCountPerTrail,o=this.geometry,s=n-1,a=i%n,u=(i-1)%n,c=(i-2)%n,h=this.getTrailPosition(t,u,Hc);if(!(h&&this.checkVertexDistance&&(null==h?void 0:h.distanceSquared(e))<this.minimumVertexDistance)){var l=t*n+a,f=Kc(h,e),p=r.time||this.time,d=[Math.random(),r.lifetime||this.lifetime,i],m=r.size||1,v=6*l,y=new Float32Array(6);y.set(f,0),y.set(f,3),o.setAttributeSubData("aDir",v,y),o.setAttributeSubData("aTime",2*l,new Float32Array([p,p]));var g=r.color||[1,1,1,1],_=new Float32Array(24),E=e.toArray();if(_.set(g,0),_.set(d,4),_[7]=0,_.set(E,8),_[11]=.5*m,_.set(g,12),_.set(d,16),_[19]=1,_.set(E,20),_[23]=-.5*m,o.setAttributeSubData("aColor",24*l,_),u>=0){var x=this.getTrailPosition(t,c,jc),T=new Float32Array(Kc(x,h,e)),b=6*(t*n+u);o.setAttributeSubData("aDir",b,T),o.setAttributeSubData("aDir",b+3,T);var A=t*n*2,R=new Uint16Array([2*u+A,2*u+1+A,2*a+A,2*a+A,2*u+1+A,2*a+1+A]),S=6*(t*s+(i-1)%s);o.setIndexSubData(S,R)}i=++this.trailCursors[t];var C=this.mesh.material,O=C.getVector4("uParams"),M=d[2];if(this.useAttributeTrailStart){for(var P=2*n,I=new Float32Array(P),w=0;w<P;w++)I[w]=M;o.setAttributeSubData("aTrailStart",t*I.length,I)}else{var L=C.getFloats("uTrailStart");null!=L&&(L[t]=M,C.setFloats("uTrailStart",L))}O&&(O.y=Math.max(O.y,i-1)-Math.max(0,i-n),C.setVector4("uParams",O))}},e.getTrailPosition=function(t,e,r){var i=this.pointCountPerTrail;if(e>=0&&e<i){var n=24*(t*i+e)+8,o=this.geometry.getAttributeData("aColor");return zr(o),r.x=o[n],r.y=o[1+n],r.z=o[2+n],r}},e.clearAllTrails=function(){var t=this.geometry.getIndexData();zr(t),this.trailCursors=new Uint16Array(this.trailCursors.length),this.geometry.setIndexData(new Uint16Array(t.length))},e.minusTime=function(t){var e=this.geometry.getAttributeData("aTime");zr(e);for(var r=0;r<e.length;r++)e[r]-=t;this.geometry.setAttributeData("aTime",e),this.time-=t},e.clearTrail=function(t){if(0!==this.trailCursors[t]){var e=6*(this.pointCountPerTrail-1),r=this.geometry.getIndexData();zr(r),r.set(new Uint16Array(e),t*e),this.geometry.setIndexData(r),this.trailCursors[t]=0}},e.getPointStartPos=function(t){return this.pointStart[t]},e.setPointStartPos=function(t,e){this.pointStart[t]=e},e.onUpdate=function(t){},nn(t,[{key:"time",get:function(){return this.mesh.material.getFloat("uTime")||0},set:function(t){this.mesh.material.setFloat("uTime",null!=t?t:0)}}]),t}(),Wc=new bn,Zc=new bn,qc=new bn;function Kc(t,e,r){var i=Wc;return t||r?(t?r?(Zc.subtractVectors(e,t).normalize(),Zc.subtractVectors(r,e),qc.copyFrom(Zc).normalize(),i.addVectors(Zc,qc)):i.subtractVectors(e,t):i.subtractVectors(r,e),i.normalize().toArray()):[0,0,0]}var Qc=function(t){function e(e,r,i){var n;(n=t.call(this,e)||this).name="ParticleSystemRenderer",r&&(n.particleMesh=new fh(e,r)),i&&(n.trailMesh=new Yc(e,i));var o=[n.particleMesh.mesh];return n.materials.push(n.particleMesh.mesh.material),n.trailMesh&&(o.push(n.trailMesh.mesh),n.materials.push(n.trailMesh.mesh.material)),n.meshes=o,n}Ri(e,t);var r=e.prototype;return r.onStart=function(){this._priority=this.item.renderOrder,this.particleMesh.gravityModifier.scaleXCoord(this.item.duration);for(var t,e=wn(this.meshes);!(t=e()).done;){t.value.onStart()}},r.onUpdate=function(t){var e,r=this.particleMesh.time,i=null!=(e=this.particleMesh.mesh.material.getVector4("uParams"))?e:new An;this.particleMesh.mesh.material.setVector4("uParams",i.set(r,this.item.duration,0,0))},r.render=function(t){for(var e,r=wn(this.meshes);!(e=r()).done;){e.value.render(t)}},r.reset=function(){var t;this.particleMesh.clearPoints(),null==(t=this.trailMesh)||t.clearAllTrails()},r.updateTime=function(t,e){this.particleMesh.time=t,this.particleMesh.onUpdate(e),this.trailMesh&&(this.trailMesh.time=t,this.trailMesh.onUpdate(e))},r.minusTimeForLoop=function(t){var e;this.particleMesh.minusTime(t),null==(e=this.trailMesh)||e.minusTime(t)},r.updateWorldMatrix=function(t){this.particleMesh.mesh.worldMatrix=t,this.trailMesh&&(this.trailMesh.mesh.worldMatrix=t)},r.setVisible=function(t){var e;this.particleMesh.mesh.setVisible(t),null==(e=this.trailMesh)||e.mesh.setVisible(t)},r.getTextures=function(){var t=[],e=this.particleMesh.mesh.material.textures;if(Object.keys(e).forEach((function(r){t.push(e[r])})),this.trailMesh){var r=this.trailMesh.mesh.material.textures;Object.keys(r).forEach((function(e){t.push(r[e])}))}return t},r.setParticlePoint=function(t,e){this.particleMesh.setPoint(t,e)},r.removeParticlePoint=function(t){this.particleMesh.removePoint(t)},r.getParticlePointColor=function(t){return this.particleMesh.getPointColor(t)},r.hasTrail=function(){return void 0!==this.trailMesh},r.clearTrail=function(t){var e;null==(e=this.trailMesh)||e.clearTrail(t)},r.addTrailPoint=function(t,e,r){var i;null==(i=this.trailMesh)||i.addPoint(t,e,r)},r.setTrailStartPosition=function(t,e){var r;null==(r=this.trailMesh)||r.setPointStartPos(t,e)},r.getTrailStartPosition=function(t){return this.trailMesh.getPointStartPos(t)},e}(dn);exports.ParticleSystem=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).destroyed=!1,i.getHitTestParams=function(t){var e=i.interaction;if(t||e)return{type:exports.HitTestType.custom,collect:function(t){return i.raycast({radius:(null==e?void 0:e.radius)||.4,multiple:!!(null==e?void 0:e.multiple),removeParticle:(null==e?void 0:e.behavior)===Ii.removeParticle,ray:t})}}},r&&i.fromData(r),i}Ri(e,t);var r=e.prototype;return r.isFrozen=function(){return this.frozen},r.isEnded=function(){return this.ended},r.initEmitterTransform=function(){var t,e=this.item.transform.position.clone(),r=this.item.transform.rotation.clone(),i=this.props.emitterTransform&&this.props.emitterTransform.path;i&&(i[0]===Ci.CONSTANT_VEC3?e.add(i[1]):t=Ya(i)),this.basicTransform={position:e,rotation:r,path:t};var n=this.transform.parentTransform,o=e.clone();if(t&&o.add(t.getValue(0)),this.transform.setPosition(o.x,o.y,o.z),this.options.particleFollowParent&&n){var s=n.getWorldMatrix();this.renderer.updateWorldMatrix(s)}},r.updateEmitterTransform=function(t){var e=this.transform.parentTransform,r=this.basicTransform,i=r.path,n=r.position.clone();if(i){var o=this.item.duration;n.add(i.getValue(t/o))}if(this.transform.setPosition(n.x,n.y,n.z),this.options.particleFollowParent&&e){var s=e.getWorldMatrix();this.renderer.updateWorldMatrix(s)}},r.addParticle=function(t,e){var r,i=this.particleLink,n=[t.delay+t.lifetime,0,t.delay,t];if(i.length<e)r=n[1]=i.length;else{var o=i.first;i.removeNode(o),r=n[1]=o.content[1]}i.pushNode(n),this.renderer.setParticlePoint(r,t),this.clearPointTrail(r),this.transform.parentTransform&&this.renderer.setTrailStartPosition(r,this.transform.parentTransform.position.clone())},r.setVisible=function(t){this.renderer.setVisible(t)},r.setOpacity=function(t){var e,r=this.renderer.particleMesh.mesh.material,i=this.renderer.particleMesh.mesh.geometry,n=(null==(e=r.getVector4("uOpacityOverLifetimeValue"))?void 0:e.toArray())||[1,1,1,1];r.setVector4("uOpacityOverLifetimeValue",new An(n[0],n[1],n[2],t));for(var o=i.getAttributeData("aColor")||[],s=0;s<o.length;s+=32)o[8*s+7]=t},r.setColor=function(t,e,r,i){var n,o=this.renderer.particleMesh.mesh.material,s=this.renderer.particleMesh.mesh.geometry,a=(null==(n=o.getVector4("uOpacityOverLifetimeValue"))?void 0:n.toArray())||[1,1,1,1];o.setVector4("uOpacityOverLifetimeValue",new An(a[0],a[1],a[2],i));for(var u=s.getAttributeData("aColor")||[],c=0;c<u.length;c+=32)u[8*c+4]=t,u[8*c+5]=e,u[8*c+6]=r,u[8*c+7]=i},r.setParentTransform=function(t){},r.getTextures=function(){return this.renderer.getTextures()},r.startEmit=function(){this.started&&!this.ended||(this.reset(),this.started=!0,this.ended=!1)},r.stop=function(){this.ended=!0,this.started=!1},r.reset=function(){this.renderer.reset(),this.lastUpdate=0,this.loopStartTime=0,this.lastEmitTime=-1/this.emission.rateOverTime.getValue(0),this.generatedCount=0,this.particleLink=new Xc((function(t,e){return t[0]-e[0]})),this.emission.bursts.forEach((function(t){return t.reset()})),this.frozen=!1,this.ended=!1,this.destroyed=!1},r.update=function(t){var e=this;if(this.started&&!this.frozen){var r=this.lastUpdate+t/1e3,i=this.options,n=this.loopStartTime,o=this.emission;this.lastUpdate=r,this.upDirectionWorld=null,this.renderer.updateTime(r,t);var s=this.particleLink,a=(r-n)/this.item.duration,u=this.timePassed,c=!1,h=function(){e.trails&&!c&&(c=!0,s.forEach((function(t){var r=t[0],i=t[1],n=t[2],o=t[3];r<u?e.clearPointTrail(i):u>n&&e.updatePointTrail(i,a,o,n)})))};if(this.ended){if(this.item.endBehavior!==Mi.restart&&Mi.destroy===this.item.endBehavior){var l=s.last;l&&l.content[0]<this.lastUpdate&&(this.destroyed=!0)}}else{var f=this.item.duration,p=this.lifetime;if(u<f){var d=1/o.rateOverTime.getValue(p),m=Math.floor((u-this.lastEmitTime)/d),v=m,y=d/m,g=r,_=i.maxCount;this.updateEmitterTransform(u);for(var E=function(){var t=s.first;return e.emissionStopped||s.length===_&&t&&t.content[0]-n>u},x=0;x<v&&x<_&&!E();x++){var T=this.createPoint(p);T.delay+=g+x*y,this.addParticle(T,_),this.lastEmitTime=u}for(var b=o.bursts,A=(null==b?void 0:b.length)-1,R=0;A>=0&&R<_&&!E();A--){var S=b[A],C=!S.disabled&&S.getGeneratorOptions(u,p);if(C){var O=o.burstOffsets[A],M=O&&O[C.cycleIndex]||[0,0,0];S.once&&this.removeBurst(A);for(var P=0;P<C.count&&R<_;P++){var I;if(E())break;var w=this.initPoint(this.shape.generate({total:C.total,index:C.index,burstIndex:P,burstCount:C.count}));w.delay+=g,R++,(I=w.transform).translate.apply(I,[].concat(M)),this.addParticle(w,_)}}}}else if(this.item.endBehavior===Mi.restart)h(),this.loopStartTime=r-f,this.lastEmitTime-=f,this.lastUpdate-=f,o.bursts.forEach((function(t){return t.reset()})),this.particleLink.forEach((function(t){t[0]-=f,t[2]-=f,t[3].delay-=f})),this.renderer.minusTimeForLoop(f);else{this.ended=!0,this.item.endBehavior===Mi.freeze&&(this.frozen=!0)}}h()}},r.onDestroy=function(){this.item&&this.item.composition&&(this.item.composition.destroyTextures(this.getTextures()),this.meshes.forEach((function(t){return t.dispose({material:{textures:exports.DestroyOptions.keep}})})))},r.getParticleBoxes=function(){var t=this.particleLink,e=this.renderer,r=[],i=this.particleCount,n=0;if(!t||!e)return r;for(var o=t.last,s=!1;!s;){var a=o.content[0],u=o.content[3];if(a>this.timePassed){var c=this.getPointPosition(u);r.push({center:c,size:u.transform.scale}),o.pre?o=o.pre:s=!0}++n>i&&(s=!0)}return r},r.raycast=function(t){var e=this.particleLink,r=this.renderer;if(e&&r){var i=e.last,n=[],o=new bn,s=!1;if(i&&i.content)do{var a=i.content,u=a[0],c=a[1];a[2];var h=a[3];if(!(u>this.timePassed))break;var l=this.getPointPosition(h),f=t.ray,p=!1;f&&(p=!!f.intersectSphere({center:l,radius:t.radius},o)),p&&(t.removeParticle&&(r.removeParticlePoint(c),this.clearPointTrail(c),e.removeNode(i),i.content=[0]),n.push(l),t.multiple||(s=!0))}while((i=i.pre)&&!s);return n}},r.clearPointTrail=function(t){this.trails&&this.trails.dieWithParticles&&this.renderer.clearTrail(t)},r.updatePointTrail=function(t,e,r,i){var n=this.renderer;if(n.hasTrail()){var o=this.trails,s=this.getPointPosition(r),a=o.inheritParticleColor?n.getParticlePointColor(t):[1,1,1,1],u=r.transform.getWorldScale().toArray(),c=1,h=o.lifetime.getValue(e);if(o.sizeAffectsWidth&&(c*=u[0]),o.sizeAffectsLifetime&&(h*=u[0]),o.parentAffectsPosition&&this.transform.parentTransform){s.add(this.transform.parentTransform.position);var l=n.getTrailStartPosition(t);l&&s.subtract(l)}n.addTrailPoint(t,s,{color:a,lifetime:h,size:c,time:i})}},r.getPointPositionByIndex=function(t){var e=this.particleLink.getNodeByIndex(t);return e?this.getPointPosition(e.content[3]):(console.error("Get point error."),null)},r.getPointPosition=function(t){var e=t.transform,r=t.vel,i=t.lifetime,n=t.delay,o=t.gravity,s=void 0===o?[]:o,a=this.options.forceTarget,u=this.lastUpdate-n,c=new bn,h=bn.fromArray(s);e.assignWorldTRS(c);var l=Ks(new bn,this.options,h,u,i,c,r);if(a){var f=a.target||[0,0,0],p=a.curve.getValue(u/i),d=1-p;l.x=l.x*d+f[0]*p,l.y=l.y*d+f[1]*p,l.z=l.z*d+f[2]*p}return l},r.initPoint=function(t){var e=this.options,r=this.lifetime,i=this.shape,n=e.startSpeed.getValue(r),o=e.particleFollowParent?this.transform.getMatrix():this.transform.getWorldMatrix(),s=t.position,a=o.transformPoint(s,new bn),u=new Bu({position:a,valid:!0}),c=t.direction;if(c=o.transformNormal(c,Jc).normalize(),e.startTurbulence&&e.turbulence){for(var h=0;h<3;h++)ih.setElement(h,e.turbulence[h].getValue(r));nh.setFromVector3(ih.negate()),sh.setFromEuler(nh).transformNormal(c).normalize()}var l,f=eh,p=rh;i.alignSpeedDirection?(p.copyFrom(c),this.upDirectionWorld||(i.upDirection?this.upDirectionWorld=i.upDirection.clone():this.upDirectionWorld=bn.Z.clone(),o.transformNormal(this.upDirectionWorld)),f.crossVectors(p,this.upDirectionWorld).normalize(),f.isZero()&&f.set(1,0,0)):(f.set(1,0,0),p.set(0,1,0));var d=this.textureSheetAnimation;d&&d.animate&&((l=oh)[0]=d.animationDelay.getValue(r),l[1]=d.animationDuration.getValue(r),l[2]=d.cycles.getValue(r));var m=th;e.start3DRotation?m.set(e.startRotationX.getValue(r),e.startRotationY.getValue(r),e.startRotationZ.getValue(r)):e.startRotation?m.set(0,0,e.startRotation.getValue(r)):m.set(0,0,0),u.setRotation(m.x,m.y,m.z);var v=e.startColor.getValue(r);3===v.length&&(v[3]=1);var y=$c;if(e.start3DSize)y.x=e.startSizeX.getValue(r),y.y=e.startSizeY.getValue(r);else{var g=e.startSize.getValue(r),_=e.sizeAspect.getValue(r);y.x=g,y.y=0===_?0:g/_}var E=c.clone();if(E.multiply(n),!e.particleFollowParent){var x=new bn;this.transform.assignWorldTRS(void 0,void 0,x),y.x*=x.x,y.y*=x.y}return u.setScale(y.x,y.y,1),{size:y,vel:E,color:v,delay:e.startDelay.getValue(r),lifetime:e.startLifetime.getValue(r),uv:uh(this.uvs,!0),gravity:e.gravity,sprite:l,dirY:p,dirX:f,transform:u}},r.addBurst=function(t,e){var r=!1;if(this.emission.bursts.includes(t)||(this.emission.bursts.push(t),r=!0),r&&hr(e,Array)){var i=this.emission.bursts.indexOf(t);return this.emission.burstOffsets[i]=e,i}return-1},r.removeBurst=function(t){t<this.emission.bursts.length&&(this.emission.burstOffsets[t]=null,this.emission.bursts.splice(t,1))},r.createPoint=function(t){var e={total:this.emission.rateOverTime.getValue(t),index:this.generatedCount,burstIndex:0,burstCount:0};return this.generatedCount++,this.initPoint(this.shape.generate(e))},r.stopParticleEmission=function(){this.emissionStopped=!0},r.resumeParticleEmission=function(){this.emissionStopped=!1},r.getBoundingBox=function(){var t=this.getParticleBoxes();return{type:exports.HitTestType.sphere,area:t}},r.fromData=function(e){t.prototype.fromData.call(this,e);var r=e;this.props=r,this.destroyed=!1;var i,n,o,s,a,u=r.options,c=r.positionOverLifetime,h=void 0===c?{}:c,l=r.shape,f=null==h?void 0:h.gravityOverLifetime,p=Qs(null==h?void 0:h.gravity),d=r.textureSheetAnimation,m=d?{animationDelay:Ya(d.animationDelay||0),animationDuration:Ya(d.animationDuration||1),cycles:Ya(d.cycles||1),animate:d.animate,col:d.col,row:d.row,total:d.total||d.col*d.row}:void 0,v=!!(l&&l.turbulenceX||(null==l?void 0:l.turbulenceY)||(null==l?void 0:l.turbulenceZ));v&&(i=[Ya(null!=(n=l.turbulenceX)?n:0),Ya(null!=(o=l.turbulenceY)?o:0),Ya(null!=(s=l.turbulenceZ)?s:0)]);this.name="ParticleSystem",this.shape=hc(l),this.emission={rateOverTime:Ya(r.emission.rateOverTime),burstOffsets:ah(null!=(a=r.emission.burstOffsets)?a:[]),bursts:(r.emission.bursts||[]).map((function(t){return new zc(t)}))},this.textureSheetAnimation=m;var y,g,_=r.renderer||{},E=r.rotationOverLifetime;E&&((y={}).asRotation=!!E.asRotation,y.z=E.z?Ya(E.z):Ya(0),E.separateAxes&&(y.x=E.x&&Ya(E.x),y.y=E.y&&Ya(E.y))),(null==h?void 0:h.forceTarget)&&(g={target:h.target||[0,0,0],curve:Ya(h.forceCurve||[Ci.LINE,[[0,0],[1,1]]])});var x={x:h.linearX&&Ya(h.linearX||0),y:h.linearY&&Ya(h.linearY||0),z:h.linearZ&&Ya(h.linearZ||0),asMovement:h.asMovement},T={x:h.orbitalX&&Ya(h.orbitalX),y:h.orbitalY&&Ya(h.orbitalY),z:h.orbitalZ&&Ya(h.orbitalZ),center:h.orbCenter,asRotation:h.asRotation},b=r.sizeOverLifetime||{},A=r.colorOverLifetime,R=(null==b?void 0:b.separateAxes)?{separateAxes:!0,x:Ya(b.x),y:Ya(b.y)}:{separateAxes:!1,x:Ya(("size"in b?b.size:b.x)||1)};_.anchor=_.anchor||[0,0];var S,C,O=Tn.fromArray(_.anchor);this.options={particleFollowParent:!!u.particleFollowParent,startLifetime:Ya(u.startLifetime),startDelay:Ya(u.startDelay||0),startSpeed:Ya(h.startSpeed||0),startColor:Ya(u.startColor),looping:!1,maxCount:null!=(S=u.maxCount)?S:0,gravityModifier:Ya(f||0),gravity:p,start3DSize:!!u.start3DSize,startTurbulence:v,turbulence:i,speedOverLifetime:h.speedOverLifetime&&Ya(h.speedOverLifetime),linearVelOverLifetime:x,orbitalVelOverLifetime:T,forceTarget:g},u.startRotationZ&&(this.options.startRotation=Ya(u.startRotationZ||0)),(u.startRotationX||u.startRotationY)&&(this.options.start3DRotation=!0,this.options.startRotationX=Ya(u.startRotationX||0),this.options.startRotationY=Ya(u.startRotationY||0),this.options.startRotationZ=Ya(u.startRotationZ||0)),u.start3DSize?(this.options.startSizeX=Ya(u.startSizeX),this.options.startSizeY=Ya(u.startSizeY)):(this.options.startSize=Ya(u.startSize),this.options.sizeAspect=Ya(u.sizeAspect||1));var M={meshSlots:u.meshSlots,name:this.name,matrix:Pn.IDENTITY,shaderCachePrefix:"",renderMode:_.renderMode||_i.BILLBOARD,side:_.side||fi.DOUBLE,gravity:p,blending:_.blending||li.ALPHA,rotationOverLifetime:y,gravityModifier:this.options.gravityModifier,linearVelOverLifetime:this.options.linearVelOverLifetime,orbitalVelOverLifetime:this.options.orbitalVelOverLifetime,speedOverLifetime:this.options.speedOverLifetime,sprite:m,occlusion:!!_.occlusion,transparentOcclusion:!!_.transparentOcclusion,maxCount:u.maxCount,mask:_.mask,maskMode:null!=(C=_.maskMode)?C:pi.NONE,forceTarget:g,diffuse:_.texture,sizeOverLifetime:R,anchor:O};if(A){var P=A.color,I=A.opacity;M.colorOverLifetime={},I&&(M.colorOverLifetime.opacity=Ya(A.opacity)),P&&(P[0]===Ci.GRADIENT_COLOR?M.colorOverLifetime.color=A.color[1]:P[0]===Ci.RGBA_COLOR?M.colorOverLifetime.color=bo.createWithData(this.engine,{data:new Uint8Array(P[1]),width:1,height:1}):hr(P,bo)&&(M.colorOverLifetime.color=P))}var w,L=[],F=[0,0,1,1];if(r.splits){var N=r.splits[0];F=(w=N[4])?[N[0],N[1],N[3],N[2]]:[N[0],N[1],N[2],N[3]]}if(m&&!m.animate)for(var D=w?m.row:m.col,V=w?m.col:m.row,U=m.total||D*V,B=0,k=0;k<D;k++)for(var z=0;z<V&&B<U;z++,B++)L.push([k*F[2]/D+F[0],z*F[3]/V+F[1],F[2]/D,F[3]/V]);else L.push(F);this.uvs=L,M.textureFlip=w;var G,X=r.trails;X&&(this.trails={lifetime:Ya(X.lifetime),dieWithParticles:!1!==X.dieWithParticles,sizeAffectsWidth:!!X.sizeAffectsWidth,sizeAffectsLifetime:!!X.sizeAffectsLifetime,inheritParticleColor:!!X.inheritParticleColor,parentAffectsPosition:!!X.parentAffectsPosition},G={name:"Trail",matrix:Pn.IDENTITY,minimumVertexDistance:X.minimumVertexDistance||.02,maxTrailCount:u.maxCount,pointCountPerTrail:Math.round(X.maxPointPerTrail)||32,blending:X.blending,texture:X.texture,opacityOverLifetime:Ya(X.opacityOverLifetime||1),widthOverTrail:Ya(X.widthOverTrail||1),shaderCachePrefix:"",lifetime:this.trails.lifetime,occlusion:!!X.occlusion,transparentOcclusion:!!X.transparentOcclusion,textureMap:X.textureMap,mask:_.mask,maskMode:_.maskMode},X.colorOverLifetime&&X.colorOverLifetime[0]===Ci.GRADIENT_COLOR&&(G.colorOverLifetime=X.colorOverLifetime[1]),X.colorOverTrail&&X.colorOverTrail[0]===Ci.GRADIENT_COLOR&&(G.colorOverTrail=X.colorOverTrail[1])),this.renderer=new Qc(this.engine,M,G),this.renderer.item=this.item,this.meshes=this.renderer.meshes;var H,j=r.interaction;j&&(this.interaction={multiple:j.multiple,radius:null!=(H=j.radius)?H:.4,behavior:j.behavior});this.item.getHitTestParams=this.getHitTestParams,this.item._content=this},nn(e,[{key:"timePassed",get:function(){return this.lastUpdate-this.loopStartTime}},{key:"lifetime",get:function(){return this.timePassed/this.item.duration}},{key:"particleCount",get:function(){return this.particleLink.length}}]),e}(fn),exports.ParticleSystem=fr([un(qi.ParticleSystem)],exports.ParticleSystem);var Jc=new bn,$c=new Tn,th=new Wo,eh=new bn,rh=new bn,ih=new bn,nh=new Wo,oh=[0,0,0],sh=new Pn;function ah(t){var e={};return Array.isArray(t)&&t.forEach((function(t){var r=hr(t,Array),i=r?t[0]:t.index,n=e[i];n||(n=e[i]=[]),r?n.push(t.slice(1,4)):n.push([+t.x,+t.y,+t.z])})),e}function uh(t,e){var r=Math.floor(Math.random()*t.length),i=t[r];return e||t.splice(r,1),i}var ch=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).lastTime=0,e}Ri(e,t);var r=e.prototype;return r.start=function(t){var e=t.output.getUserData();!this.particleSystem&&hr(e,exports.VFXItem)&&(this.particleSystem=e.getComponent(exports.ParticleSystem),this.particleSystem&&(this.particleSystem.name=e.name,this.particleSystem.startEmit(),this.particleSystem.initEmitterTransform()))},r.processFrame=function(t){this.time>=0&&this.start(t);var e=this.particleSystem;if(e){var r=t.deltaTime;this.time>=0&&this.time<e.item.duration&&e.isEnded()&&e.reset(),Math.abs(this.time-this.lastTime)<.001&&(r=0),e.update(r)}this.lastTime=this.time},e}(Lu),hh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createPlayable=function(t){return new ch(t)},e}(Nu),lh={uSprite:"vec4",uParams:"vec4",uAcceleration:"vec4",uGravityModifierValue:"vec4",uOpacityOverLifetimeValue:"vec4",uRXByLifeTimeValue:"vec4",uRYByLifeTimeValue:"vec4",uRZByLifeTimeValue:"vec4",uLinearXByLifetimeValue:"vec4",uLinearYByLifetimeValue:"vec4",uLinearZByLifetimeValue:"vec4",uSpeedLifetimeValue:"vec4",uOrbXByLifetimeValue:"vec4",uOrbYByLifetimeValue:"vec4",uOrbZByLifetimeValue:"vec4",uSizeByLifetimeValue:"vec4",uSizeYByLifetimeValue:"vec4",uColorParams:"vec4",uFSprite:"vec4",uPreviewColor:"vec4",uVCurveValues:"vec4Array",uFCurveValues:"vec4",uFinalTarget:"vec3",uForceCurve:"vec4",uOrbCenter:"vec3",uTexOffset:"vec2",uPeriodValue:"vec4",uMovementValue:"vec4",uStrengthValue:"vec4",uWaveParams:"vec4"},fh=function(){function t(t,e){var r;this.particleCount=0,this.cachedRotationVector3=new bn,this.cachedRotationMatrix=new Zo,this.cachedLinearMove=new bn,this.tempMatrix3=new Zo,this.VERT_MAX_KEY_FRAME_COUNT=0;var i,n,o=(null!=(r=t.renderer)?r:{}).env,s=e.speedOverLifetime,a=e.colorOverLifetime,u=e.linearVelOverLifetime,c=e.orbitalVelOverLifetime,h=e.sizeOverLifetime,l=e.rotationOverLifetime,f=e.sprite,p=e.gravityModifier,d=e.maxCount,m=e.textureFlip,v=e.useSprite,y=e.name,g=e.gravity,_=e.forceTarget,E=e.side,x=e.occlusion,T=e.anchor,b=e.blending,A=e.maskMode,R=e.mask,S=e.transparentOcclusion,C=e.meshSlots,O=e.renderMode,M=void 0===O?0:O,P=e.diffuse,I=void 0===P?bo.createWithData(t):P,w=t.gpuCapability.detail,L=w.halfFloatTexture,F=w.maxVertexUniforms,N=[["RENDER_MODE",+M],["ENV_EDITOR",o===Xa]],D=t.gpuCapability.level,V={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},U={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},B=F>0,k={},z=0,G=0;(this.useSprite=v,B&&N.push(["ENABLE_VERTEX_TEXTURE",!0]),s&&(N.push(["SPEED_OVER_LIFETIME",!0]),G|=2,k.uSpeedLifetimeValue=s.toUniform(V)),(null==f?void 0:f.animate)&&(N.push(["USE_SPRITE",!0]),G|=4,k.uFSprite=k.uSprite=new Float32Array([f.col,f.row,f.total,f.blend?1:0]),this.useSprite=!0),(null==a?void 0:a.color)&&(N.push(["COLOR_OVER_LIFETIME",!0]),G|=16,k.uColorOverLifetime=hr(a.color,bo)?a.color:bo.createWithData(t,Dr(a.color))),(null==a?void 0:a.opacity)?k.uOpacityOverLifetimeValue=a.opacity.toUniform(V):k.uOpacityOverLifetimeValue=Ya(1).toUniform(V),["x","y","z"].forEach((function(t,e){var r=0,n=0;(null==u?void 0:u[t])&&(k["uLinear"+t.toUpperCase()+"ByLifetimeValue"]=u[t].toUniform(V),r=1,G|=1<<7+e,u.enabled=!0),N.push(["LINEAR_VEL_"+t.toUpperCase(),r]),(null==c?void 0:c[t])&&(k["uOrb"+t.toUpperCase()+"ByLifetimeValue"]=c[t].toUniform(V),n=1,G|=1<<10+e,i=!0,c.enabled=!0),N.push(["ORB_VEL_"+t.toUpperCase(),n])})),(null==u?void 0:u.asMovement)&&(N.push(["AS_LINEAR_MOVEMENT",!0]),G|=32),i&&((null==c?void 0:c.asRotation)&&(N.push(["AS_ORBITAL_MOVEMENT",!0]),G|=64),k.uOrbCenter=new Float32Array((null==c?void 0:c.center)||[0,0,0])),k.uSizeByLifetimeValue=null==h?void 0:h.x.toUniform(V),null==h?void 0:h.separateAxes)&&(N.push(["SIZE_Y_BY_LIFE",1]),G|=16384,k.uSizeYByLifetimeValue=null==h||null==(n=h.y)?void 0:n.toUniform(V));(null==l?void 0:l.z)&&(k.uRZByLifeTimeValue=l.z.toUniform(V),G|=32768,N.push(["ROT_Z_LIFETIME",1])),(null==l?void 0:l.x)&&(k.uRXByLifeTimeValue=l.x.toUniform(V),G|=65536,N.push(["ROT_X_LIFETIME",1])),(null==l?void 0:l.y)&&(k.uRYByLifeTimeValue=l.y.toUniform(V),G|=1<<17,N.push(["ROT_Y_LIFETIME",1])),(null==l?void 0:l.asRotation)&&(N.push(["ROT_LIFETIME_AS_MOVEMENT",1]),G|=1<<18),k.uGravityModifierValue=p.toUniform(V),_&&(N.push(["FINAL_TARGET",!0]),G|=1<<19,k.uFinalTarget=new Float32Array(_.target||[0,0,0]),k.uForceCurve=_.curve.toUniform(V)),L&&U.max?(G|=1<<20,k.uFCurveValueTexture=Ao(t,Ta.getAllData(U,!0),U.index,1)):k.uFCurveValues=Ta.getAllData(U);var X=V.max+V.curves.length-32>F;if(2===D&&(V.max=-1,V.index=C?C[0]:dh(V.index),U.index>0&&(U.max=-1,U.index=C?C[1]:dh(U.index))),X&&L&&B){var H=Ao(t,Ta.getAllData(V,!0),V.index,1);k.uVCurveValueTexture=H,z=1}else k.uVCurveValues=Ta.getAllData(V);var j=["-p:",M,G,V.index,V.max,U.index,U.max].join("+");N.push(["VERT_CURVE_VALUE_COUNT",V.index],["FRAG_CURVE_VALUE_COUNT",U.index],["VERT_MAX_KEY_FRAME_COUNT",V.max],["FRAG_MAX_KEY_FRAME_COUNT",U.max]),this.VERT_MAX_KEY_FRAME_COUNT=V.max;var Y={shader:{fragment:fs,vertex:"#define LOOKUP_TEXTURE_CURVE "+z+"\n"+ps,glslVersion:1===D?exports.GLSLVersion.GLSL1:exports.GLSLVersion.GLSL3,shared:!0,cacheId:j,macros:N,name:"particle#"+y},uniformSemantics:{effects_MatrixV:"VIEW",effects_MatrixVP:"VIEWPROJECTION",uEditorTransform:"EDITOR_TRANSFORM",effects_ObjectToWorld:"MODEL"}},W=Kn(b);k.uTexOffset=new Float32Array(I?[1/I.getWidth(),1/I.getHeight()]:[0,0]),k.uMaskTex=I,k.uColorParams=new Float32Array([I?1:0,+W,0,+(!!x&&!S)]),k.uParams=[0,0,0,0],k.uAcceleration=[(null==g?void 0:g[0])||0,(null==g?void 0:g[1])||0,(null==g?void 0:g[2])||0,0];var Z=Bo.create(t,Y);Z.blending=!0,Z.depthTest=!0,Z.depthMask=!!x,Z.stencilRef=R?[R,R]:void 0,$n(Z,A),Qn(Z,b),Jn(Z,E),Object.keys(k).map((function(t){var e=k[t];if(hr(e,bo))Z.setTexture(t,e);else{var r=[];switch(lh[t]){case"vec4":Z.setVector4(t,An.fromArray(e));break;case"vec3":Z.setVector3(t,bn.fromArray(e));break;case"vec2":Z.setVector2(t,Tn.fromArray(e));break;case"vec4Array":for(var i=0;i<e.length;i+=4){var n=new An(e[i],e[i+1],e[i+2],e[i+3]);r.push(n)}Z.setVector4Array(t,r),r.length=0;break;default:console.warn("Uniform "+t+"'s type not in typeMap.")}}})),Z.setVector3("emissionColor",new bn(0,0,0)),Z.setFloat("emissionIntensity",0);var q=jo.create(t,function(t,e,r){var i=Float32Array.BYTES_PER_ELEMENT,n=12*i,o={aPos:{size:3,offset:0,stride:n,data:new Float32Array(0)},aVel:{size:3,offset:3*i,stride:n,dataSource:"aPos"},aDirX:{size:3,offset:6*i,stride:n,dataSource:"aPos"},aDirY:{size:3,offset:9*i,stride:n,dataSource:"aPos"},aRot:{size:3,offset:0,stride:8*i,data:new Float32Array(0)},aSeed:{size:1,offset:3*i,stride:8*i,dataSource:"aRot"},aColor:{size:4,offset:4*i,stride:8*i,dataSource:"aRot"},aOffset:{size:4,stride:4*i,data:new Float32Array(0)},aTranslation:{size:3,data:new Float32Array(0)},aLinearMove:{size:3,data:new Float32Array(0)},aRotation0:{size:3,offset:0,stride:9*i,data:new Float32Array(0)},aRotation1:{size:3,offset:3*i,stride:9*i,dataSource:"aRotation0"},aRotation2:{size:3,offset:6*i,stride:9*i,dataSource:"aRotation0"}};e&&(o.aSprite={size:3,stride:3*i,data:new Float32Array(0)});return{attributes:o,indices:{data:new Uint16Array(0)},name:r,maxVertex:t}}(4*d,this.useSprite,"particle#"+y)),K=is.create(t,{name:"MParticle_"+y,material:Z,geometry:q});this.anchor=T,this.mesh=K,this.geometry=K.firstGeometry(),this.forceTarget=_,this.sizeOverLifetime=h,this.speedOverLifetime=s,this.linearVelOverLifetime=u,this.orbitalVelOverLifetime=c,this.orbitalVelOverLifetime=c,this.gravityModifier=p,this.rotationOverLifetime=l,this.maxCount=d,this.textureOffsets=m?[0,0,1,0,0,1,1,1]:[0,1,0,0,1,1,1,0],this.time=0}var e=t.prototype;return e.getPointColor=function(t){var e=this.geometry.getAttributeData("aRot"),r=32*t+4;return zr(e),[e[r],e[r+1],e[r+2],e[r+3]]},e.clearPoints=function(){this.resetGeometryData(this.geometry),this.particleCount=0,this.geometry.setDrawCount(0),this.maxParticleBufferCount=0},e.resetGeometryData=function(t){for(var e=t.getAttributeNames(),r=t.getIndexData(),i=0;i<e.length;i++){var n=e[i],o=t.getAttributeData(n);o&&t.setAttributeData(n,new o.constructor(0))}t.setIndexData(new r.constructor(0))},e.onUpdate=function(t){var e=this.geometry.getAttributeData("aPos"),r=Math.ceil(e.length/12);this.applyTranslation(r,t),this.applyRotation(r,t),this.applyLinearMove(r,t)},e.minusTime=function(t){for(var e=this.geometry.getAttributeData("aOffset"),r=0;r<e.length;r+=4)e[r+2]-=t;this.geometry.setAttributeData("aOffset",e),this.time-=t},e.removePoint=function(t){t<this.particleCount&&this.geometry.setAttributeSubData("aOffset",16*t,new Float32Array(16))},e.setPoint=function(t,e){var r=this.maxCount;if(t<r){var i=t+1,n=4*i,o=this.geometry,s=i>this.maxParticleBufferCount,a=1;this.particleCount>300?a=(this.particleCount+100)/this.particleCount:this.particleCount>100?a=1.4:this.particleCount>0&&(a=2);var u={aPos:new Float32Array(48),aRot:new Float32Array(32),aOffset:new Float32Array(16),aTranslation:new Float32Array(12),aLinearMove:new Float32Array(12),aRotation0:new Float32Array(36)},c=this.useSprite;c&&(u.aSprite=new Float32Array(12));var h=new bn,l=new Cn,f=new bn(1,1,1);e.transform.assignWorldTRS(h,l,f);var p,d=Bu.getRotation(l,new Wo),m=h.toArray(),v=d.toArray(),y=this.textureOffsets,g=[0,0,e.delay,e.lifetime],_=[0,0,1,1],E=e.vel,x=e.color,T=[-.5,.5,-.5,-.5,.5,.5,.5,-.5],b=Math.random();c&&(p=e.sprite);for(var A=0;A<4;A++){var R=2*A,S=3*A,C=4*A,O=12*A,M=8*A;u.aPos.set(m,O),E.fill(u.aPos,O+3),u.aRot.set(v,M),u.aRot[M+3]=b,u.aRot.set(x,M+4),c&&u.aSprite.set(p,S);var P=e.uv||_;if(P){var I=c?1-y[R+1]:y[R+1];g[0]=P[0]+y[R]*P[2],g[1]=P[1]+I*P[3]}u.aOffset.set(g,C);for(var w=A+A,L=(T[w]-this.anchor.x)*f.x,F=(T[w+1]-this.anchor.y)*f.y,N=0;N<3;N++)u.aPos[O+6+N]=e.dirX.getElement(N)*L,u.aPos[O+9+N]=e.dirY.getElement(N)*F}var D=new Uint16Array([0,1,2,2,1,3].map((function(e){return e+4*t})));if(s){var V=br(o.getIndexData(),6*i,6*r,a);V.set(D,6*t),o.setIndexData(V),this.maxParticleBufferCount=V.length/6}else o.setIndexSubData(6*t,D);Object.keys(u).forEach((function(e){var i=u[e],c=o.getAttributeStride(e)/Float32Array.BYTES_PER_ELEMENT;if(s){var h=o.getAttributeData(e);zr(h);var l=br(h,n*c,4*r*c,a);l.set(i,i.length*t),o.setAttributeData(e,l)}else o.setAttributeSubData(e,i.length*t,i)})),this.particleCount=Math.max(i,this.particleCount),o.setDrawCount(6*this.particleCount)}},e.applyTranslation=function(t,e){var r=this.time,i=this.geometry.getAttributeData("aTranslation"),n=this.geometry.getAttributeData("aVel"),o=this.geometry.getAttributeData("aOffset");i.length<3*t&&(i=this.expandArray(i,3*t));for(var s=0,a=0,u=0,c=this.mesh.material.getVector4("uAcceleration"),h=this.mesh.material.getVector4("uGravityModifierValue"),l=0;l<t;l+=4){var f=12*l+3;s=n[f],a=n[f+1],u=n[f+2];var p=r-o[4*l+2],d=o[4*l+3];if(c&&h){var m=this.gravityModifier.getIntegrateValue(0,p,d),v=c.x*m,y=c.y*m,g=c.z*m;if(this.speedOverLifetime){var _=this.speedOverLifetime.getValue(p/d);s=s*_+v,a=a*_+y,u=u*_+g}else s+=v,a+=y,u+=g}var E=3*l;if(o[4*l+2]<r){var x=s*(e/1e3),T=a*(e/1e3),b=u*(e/1e3);i[E]+=x,i[E+1]+=T,i[E+2]+=b,i[E+3]+=x,i[E+4]+=T,i[E+5]+=b,i[E+6]+=x,i[E+7]+=T,i[E+8]+=b,i[E+9]+=x,i[E+10]+=T,i[E+11]+=b}}this.geometry.setAttributeData("aTranslation",i)},e.applyRotation=function(t,e){var r=this.geometry.getAttributeData("aRotation0"),i=this.geometry.getAttributeData("aOffset"),n=this.geometry.getAttributeData("aRot"),o=this.geometry.getAttributeData("aSeed"),s=this.time,a=this.cachedRotationMatrix;r.length<9*t&&(r=this.expandArray(r,9*t));for(var u=0;u<t;u+=4){var c=xn((s-i[4*u+2])/i[4*u+3],0,1),h=8*u,l=this.cachedRotationVector3.set(n[h],n[h+1],n[h+2]),f=o[8*u+3],p=l;this.rotationOverLifetime?(this.rotationOverLifetime.x&&(hr(this.rotationOverLifetime.x,Ra)?p.x+=this.rotationOverLifetime.x.getValue(c,f):p.x+=this.rotationOverLifetime.x.getValue(c)),this.rotationOverLifetime.y&&(hr(this.rotationOverLifetime.y,Ra)?p.y+=this.rotationOverLifetime.y.getValue(c,f):p.y+=this.rotationOverLifetime.y.getValue(c)),this.rotationOverLifetime.z&&(hr(this.rotationOverLifetime.z,Ra)?p.z+=this.rotationOverLifetime.z.getValue(c,f):p.z+=this.rotationOverLifetime.z.getValue(c))):a.setZero(),0===p.dot(p)&&a.identity();var d=Math.PI/180,m=p.x*d,v=p.y*d,y=p.z*d,g=Math.sin(m),_=Math.sin(v),E=Math.sin(y),x=Math.cos(m),T=Math.cos(v),b=Math.cos(y);a.set(b,-E,0,E,b,0,0,0,1),a.multiply(this.tempMatrix3.set(T,0,_,0,1,0,-_,0,T)),a.multiply(this.tempMatrix3.set(1,0,0,0,x,-g,0,g,x));var A=9*u,R=a.elements;r.set(R,A),u+4<=t&&(r.set(R,A+9),r.set(R,A+18),r.set(R,A+27))}this.geometry.setAttributeData("aRotation0",r)},e.applyLinearMove=function(t,e){var r=this.geometry.getAttributeData("aLinearMove"),i=this.geometry.getAttributeData("aOffset"),n=this.geometry.getAttributeData("aSeed"),o=this.time;r.length<3*t&&(r=this.expandArray(r,3*t));var s=this.cachedLinearMove;if(this.linearVelOverLifetime&&this.linearVelOverLifetime.enabled)for(var a=0;a<t;a+=4){var u=o-i[4*a+2],c=i[4*a+3],h=u/c,l=n[8*a+3];s.setZero(),this.linearVelOverLifetime.asMovement?(this.linearVelOverLifetime.x&&(hr(this.linearVelOverLifetime.x,Ra)?s.x=this.linearVelOverLifetime.x.getValue(h,l):s.x=this.linearVelOverLifetime.x.getValue(h)),this.linearVelOverLifetime.y&&(hr(this.linearVelOverLifetime.y,Ra)?s.y=this.linearVelOverLifetime.y.getValue(h,l):s.y=this.linearVelOverLifetime.y.getValue(h)),this.linearVelOverLifetime.z&&(hr(this.linearVelOverLifetime.z,Ra)?s.z=this.linearVelOverLifetime.z.getValue(h,l):s.z=this.linearVelOverLifetime.z.getValue(h))):(this.linearVelOverLifetime.x&&(hr(this.linearVelOverLifetime.x,Ra)?s.x=this.linearVelOverLifetime.x.getIntegrateValue(0,u,l):s.x=this.linearVelOverLifetime.x.getIntegrateValue(0,u,c)),this.linearVelOverLifetime.y&&(hr(this.linearVelOverLifetime.y,Ra)?s.y=this.linearVelOverLifetime.y.getIntegrateValue(0,u,l):s.y=this.linearVelOverLifetime.y.getIntegrateValue(0,u,c)),this.linearVelOverLifetime.z&&(hr(this.linearVelOverLifetime.z,Ra)?s.z=this.linearVelOverLifetime.z.getIntegrateValue(0,u,l):s.z=this.linearVelOverLifetime.z.getIntegrateValue(0,u,c)));var f=3*a;r[f]=s.x,r[f+1]=s.y,r[f+2]=s.z,r[f+3]=s.x,r[f+4]=s.y,r[f+5]=s.z,r[f+6]=s.x,r[f+7]=s.y,r[f+8]=s.z,r[f+9]=s.x,r[f+10]=s.y,r[f+11]=s.z}this.geometry.setAttributeData("aLinearMove",r)},e.expandArray=function(t,e){var r=new Float32Array(e);return r.set(t),r},t}(),ph=[10,32,64,160];function dh(t){for(var e=0;e<ph.length;e++){var r=ph[e];if(r>t)return r}return t||ph[0]}function mh(t,e,r){var i;void 0===r&&(r="");var n,o=t.content,s=+((null==(i=o.renderer)?void 0:i.renderMode)||0),a=[["RENDER_MODE",s],["ENV_EDITOR",r===Xa]],u=e.level,c=e.detail,h={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},l={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},f=c.maxVertexUniforms>0,p=(null!=(n=o.positionOverLifetime)?n:{}).speedOverLifetime,d=0,m=0;f&&a.push(["ENABLE_VERTEX_TEXTURE",!0]),p&&(a.push(["SPEED_OVER_LIFETIME",!0]),m|=2,Va(h,p));var v=o.textureSheetAnimation;v&&v.animate&&(a.push(["USE_SPRITE",!0]),m|=4);var y=o.colorOverLifetime;y&&y.color&&(a.push(["COLOR_OVER_LIFETIME",!0]),m|=16);var g=y&&y.opacity;g&&Va(h,g);var _,E=o.positionOverLifetime;if(["x","y","z"].forEach((function(t,e){var r=0,i="linear"+t.toUpperCase(),n="orbital"+t.toUpperCase();(null==E?void 0:E[i])&&(Va(h,E[i]),r=1,m|=1<<7+e),a.push(["LINEAR_VEL_"+t.toUpperCase(),r]);var o=0;(null==E?void 0:E[n])&&(Va(h,E[n]),o=1,m|=1<<10+e,_=!0),a.push(["ORB_VEL_"+t.toUpperCase(),o])})),(null==E?void 0:E.asMovement)&&(a.push(["AS_LINEAR_MOVEMENT",!0]),m|=32),_&&(null==E?void 0:E.asRotation)&&(a.push(["AS_ORBITAL_MOVEMENT",!0]),m|=64),o.sizeOverLifetime){var x=o.sizeOverLifetime;x.separateAxes?(Va(h,x.x),a.push(["SIZE_Y_BY_LIFE",1]),m|=16384,Va(h,x.y)):Va(h,x.size)}if(o.rotationOverLifetime){var T=o.rotationOverLifetime;T.z&&(Va(h,null==T?void 0:T.z),m|=32768,a.push(["ROT_Z_LIFETIME",1])),T.separateAxes&&(T.x&&(Va(h,T.x),m|=65536,a.push(["ROT_X_LIFETIME",1])),T.y&&(Va(h,T.y),m|=1<<17,a.push(["ROT_Y_LIFETIME",1]))),(null==T?void 0:T.asRotation)&&(a.push(["ROT_LIFETIME_AS_MOVEMENT",1]),m|=1<<18)}Va(h,null==E?void 0:E.gravityOverLifetime),(null==E?void 0:E.forceTarget)&&(a.push(["FINAL_TARGET",!0]),m|=1<<19,Va(h,E.forceCurve));var b=c.halfFloatTexture;b&&l.max&&(m|=1<<20);var A=c.maxVertexUniforms,R=h.max+h.curves.length-32>A;Zu(ju)&&(R=!0),2===u&&(h.max=-1,l.index>0&&(l.max=-1)),R&&b&&f&&(d=1);var S=["-p:",s,m,h.index,h.max,l.index,l.max].join("+"),C={fragment:fs,vertex:"#define LOOKUP_TEXTURE_CURVE "+d+"\n"+ps,shared:!0,cacheId:S,macros:a,name:"particle#"+t.name};return a.push(["VERT_CURVE_VALUE_COUNT",h.index],["FRAG_CURVE_VALUE_COUNT",l.index],["VERT_MAX_KEY_FRAME_COUNT",h.max],["FRAG_MAX_KEY_FRAME_COUNT",l.max]),{shader:C,vertex:h.index,fragment:l.index}}function vh(t,e,r){var i,n=null==(i=t.cacheId)?void 0:i.split("+");if(n[3]=e,n[5]=r,t.cacheId=n.join("+"),t.macros)for(var o=0;o<t.macros.length;o++){var s=t.macros[o];if("VERT_CURVE_VALUE_COUNT"===s[0])s[1]=e;else if("FRAG_CURVE_VALUE_COUNT"===s[0]){s[1]=r;break}}}var yh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.precompile=function(t,e,r){var i=e.engine.gpuCapability,n=i.level,o=(null!=r?r:{}).env,s=e.getShaderLibrary(),a=[],u=[],c=0,h=0;return t.forEach((function(t){t.items.forEach((function(t){exports.Item.isParticle(t)&&a.push(t)}))})),a.forEach((function(t){var e=mh(t,i,o),r=e.shader,a=e.fragment,l=e.vertex;if(u.push(r),c=Math.max(c,a),h=Math.max(h,l),t.content.trails){var f=function(t,e,r,i,n){void 0===n&&(n="");var o=0,s=Zu(ju)?1:0,a=[["ENABLE_VERTEX_TEXTURE",i.detail.maxVertexTextures>0],["LOOKUP_TEXTURE_CURVE",s],["ENV_EDITOR",n===Xa]],u={curves:[],index:0,max:0,lineSegCount:0,curveCount:0};return t.colorOverLifetime&&(a.push(["COLOR_OVER_LIFETIME",!0]),o|=1),t.colorOverTrail&&(a.push(["COLOR_OVER_TRAIL",!0]),o|=4),e>64&&(a.push(["ATTR_TRAIL_START",1]),o|=8),Va(u,t.opacityOverLifetime),Va(u,t.widthOverTrail),a.push(["VERT_CURVE_VALUE_COUNT",u.index],["VERT_MAX_KEY_FRAME_COUNT",u.max]),{vertex:ds,fragment:fs,macros:a,shared:!0,name:"trail#"+r,cacheId:"-t:+"+o+"+"+u.index+"+"+u.max}}(t.content.trails,t.content.options.maxCount,t.name,i,o);f.glslVersion=2===n?exports.GLSLVersion.GLSL3:exports.GLSLVersion.GLSL1,null==s||s.addShader(f)}})),u.forEach((function(t){2===n?(vh(t,h,c),t.glslVersion=exports.GLSLVersion.GLSL3):t.glslVersion=exports.GLSLVersion.GLSL1,null==s||s.addShader(t)})),2===n&&a.forEach((function(t){t.content.options.meshSlots=[h,c]})),Promise.resolve()},e}(bi),gh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e}(bi),_h=function(){function t(t){this.curveValues={},this.playable=t}var e=t.prototype;return e.setCurveValue=function(t,e,r){return this.findCurveValue(t,e)?this.curveValues[t+e].value=r:this.curveValues[t+e]={componentType:t,propertyName:e,value:r},this.curveValues[t+e]},e.findCurveValue=function(t,e){return this.curveValues[t+e]},t}(),Eh=function(t){function e(e){var r;return(r=t.call(this,e)||this).animationStream=new _h(Sn(r)),r}return Ri(e,t),e}(Lu),xh=new Wo,Th=new bn(1,1,1),bh=new bn,Ah=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.start=function(){var t=this.boundObject,e=t.transform.scale;this.originalTransform={position:t.transform.position.clone(),rotation:t.transform.getRotation().clone(),scale:new bn(e.x,e.y,e.x)};var r,i=this.data.positionOverLifetime,n=this.data.rotationOverLifetime,o=this.data.sizeOverLifetime;if(i&&0!==Object.keys(i).length){this.positionOverLifetime=i,i.path&&(this.originalTransform.path=Ya(i.path));var s=i.linearX||i.linearY||i.linearZ;s&&(this.linearVelOverLifetime={x:i.linearX&&Ya(i.linearX),y:i.linearY&&Ya(i.linearY),z:i.linearZ&&Ya(i.linearZ),asMovement:i.asMovement,enabled:!!s});var a=i.orbitalX||i.orbitalY||i.orbitalZ;a&&(this.orbitalVelOverLifetime={x:i.orbitalX&&Ya(i.orbitalX),y:i.orbitalY&&Ya(i.orbitalY),z:i.orbitalZ&&Ya(i.orbitalZ),center:Qs(i.orbCenter),asRotation:i.asRotation,enabled:!!a}),this.speedOverLifetime=i.speedOverLifetime&&Ya(i.speedOverLifetime)}if(o&&(o.separateAxes?(this.sizeSeparateAxes=!0,this.sizeXOverLifetime=Ya(o.x||1),this.sizeYOverLifetime=Ya(o.y||1),this.sizeZOverLifetime=Ya(o.z||1)):this.sizeXOverLifetime=Ya(o.size||1)),n&&(this.rotationOverLifetime={asRotation:n.asRotation,separateAxes:n.separateAxes,z:Ya(n.z||0)},n.separateAxes)){var u=this.rotationOverLifetime;u.x=Ya(n.x||0),u.y=Ya(n.y||0)}this.gravity=bn.fromArray((null==i?void 0:i.gravity)||[]),this.gravityModifier=Ya(null!=(r=null==i?void 0:i.gravityOverLifetime)?r:0),this.direction=(null==i?void 0:i.direction)?bn.fromArray(i.direction).normalize():new bn,this.startSpeed=(null==i?void 0:i.startSpeed)||0,this.velocity=this.direction.clone(),this.velocity.multiply(this.startSpeed)},r.processFrame=function(t){if(!this.boundObject){var e=t.output.getUserData();hr(e,exports.VFXItem)&&(this.boundObject=e,this.start())}this.boundObject&&this.boundObject.composition&&this.sampleAnimation()},r.sampleAnimation=function(){var t=this,e=this.boundObject,r=e.duration,i=this.time/r;if(i=i<0?0:i>1?1:i,this.sizeXOverLifetime){Th.x=this.sizeXOverLifetime.getValue(i),this.sizeSeparateAxes?(Th.y=this.sizeYOverLifetime.getValue(i),Th.z=this.sizeZOverLifetime.getValue(i)):Th.z=Th.y=Th.x;var n=this.originalTransform.scale;e.transform.setScale(Th.x*n.x,Th.y*n.y,Th.z*n.z)}if(this.rotationOverLifetime){var o=function(e){return t.rotationOverLifetime.asRotation?e.getValue(i):e.getIntegrateValue(0,i,r)},s=o(this.rotationOverLifetime.z),a=this.rotationOverLifetime.separateAxes;xh.x=a?o(this.rotationOverLifetime.x):0,xh.y=a?o(this.rotationOverLifetime.y):0,xh.z=s;var u=xh.addEulers(this.originalTransform.rotation,xh);e.transform.setRotation(u.x,u.y,u.z)}if(this.positionOverLifetime){var c=bh;Ks(c,this,this.gravity,this.time,r,this.originalTransform.position,this.velocity),this.originalTransform.path&&c.add(this.originalTransform.path.getValue(i)),e.transform.setPosition(c.x,c.y,c.z)}},e}(Eh);exports.TransformPlayableAsset=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.createPlayable=function(t){var e=new Ah(t);return e.data=this.transformAnimationData,e},r.fromData=function(t){this.transformAnimationData=t},e}(Nu),exports.TransformPlayableAsset=fr([un(qi.TransformPlayableAsset)],exports.TransformPlayableAsset);var Rh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.processFrame=function(t){var e=t.output.getUserData();hr(e,exports.VFXItem)&&(e.time=this.time)},e}(Lu);exports.ActivationPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createPlayable=function(t){return new Rh(t)},e}(Nu),exports.ActivationPlayableAsset=fr([un(qi.ActivationPlayableAsset)],exports.ActivationPlayableAsset),exports.AnimationClip=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).duration=0,e.positionCurves=[],e.rotationCurves=[],e.scaleCurves=[],e.floatCurves=[],e}Ri(e,t);var r=e.prototype;return r.sampleAnimation=function(t,e){var r=e/t.duration;r=r<0?0:r>1?1:r;for(var i,n=wn(this.positionCurves);!(i=n()).done;){var o=i.value,s=o.keyFrames.getValue(r),a=this.findTarget(t,o.path);null==a||a.transform.setPosition(s.x,s.y,s.z)}for(var u,c=wn(this.rotationCurves);!(u=c()).done;){var h=u.value,l=h.keyFrames.getValue(r),f=this.findTarget(t,h.path);null==f||f.transform.setQuaternion(l.x,l.y,l.z,l.w)}for(var p,d=wn(this.scaleCurves);!(p=d()).done;){var m=p.value,v=m.keyFrames.getValue(r),y=this.findTarget(t,m.path);null==y||y.transform.setScale(v.x,v.y,v.z)}},r.fromData=function(t){this.positionCurves.length=0,this.scaleCurves.length=0,this.floatCurves.length=0;for(var e,r=wn(t.positionCurves);!(e=r()).done;){var i=e.value,n={path:i.path,keyFrames:Ya(i.keyFrames)};this.duration=Math.max(this.duration,n.keyFrames.getMaxTime()),this.positionCurves.push(n)}for(var o,s=wn(t.rotationCurves);!(o=s()).done;){var a=o.value,u={path:a.path,keyFrames:Ya(a.keyFrames)};this.duration=Math.max(this.duration,u.keyFrames.getMaxTime()),this.rotationCurves.push(u)}for(var c,h=wn(t.scaleCurves);!(c=h()).done;){var l=c.value,f={path:l.path,keyFrames:Ya(l.keyFrames)};this.duration=Math.max(this.duration,f.keyFrames.getMaxTime()),this.scaleCurves.push(f)}for(var p,d=wn(t.floatCurves);!(p=d()).done;){var m=p.value,v={path:m.path,keyFrames:Ya(m.keyFrames),property:m.property,className:m.className};this.duration=Math.max(this.duration,v.keyFrames.getMaxTime()),this.floatCurves.push(v)}},r.findTarget=function(t,e){for(var r,i=t,n=wn(e);!(r=n()).done;){for(var o,s=r.value,a=!1,u=wn(i.children);!(o=u()).done;){var c=o.value;if(c.name===s){i=c,a=!0;break}}if(!a)return}return i},e}(ln),exports.AnimationClip=fr([un(qi.AnimationClip)],exports.AnimationClip);var Sh,Ch=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.processFrame=function(t){var e=t.output.getUserData();hr(e,exports.VFXItem)&&e.composition&&this.clip.sampleAnimation(e,this.time)},e}(Lu),Oh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).clipPlayables=[],e.clipWeights=[],e}Ri(e,t);var r=e.prototype;return r.processFrame=function(t){for(var e,r=wn(this.clipPlayables);!(e=r()).done;){e.value.processFrame(t)}this.evaluate(t)},r.setClipWeight=function(t,e){if(hr(t,Lu)){for(var r=0;r<this.clipPlayables.length;r++)if(this.clipPlayables[r]===t)return void(this.clipWeights[r]=e)}else this.clipWeights.length<t+1&&(this.clipWeights.length=t+1),this.clipWeights[t]=e},r.getClipWeight=function(t){return this.clipWeights[t]},r.getClipPlayable=function(t){return this.clipPlayables[t]},r.evaluate=function(t){},e}(Lu),Mh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.evaluate=function(t){var e=t.output.getUserData();if(hr(e,exports.VFXItem)){for(var r=e,i=!1,n=0;n<this.clipPlayables.length;n++)if(this.getClipWeight(n)>0){i=!0;break}i?(r.transform.setValid(!0),r.setActive(!0)):(r.transform.setValid(!1),r.setActive(!1))}},e}(Oh),Ph=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.processFrame=function(t){this.value=this.curve.getValue(this.time/this.getDuration())},e}(Lu),Ih=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).propertyName="",e}return Ri(e,t),e.prototype.evaluate=function(t){var e=t.output.getUserData();if(e){var r=!1,i=e[this.propertyName];if(hr(i,Ko)){i.setZero();for(var n=0;n<this.clipPlayables.length;n++){var o=this.getClipWeight(n);if(o>0){var s=this.getClipPlayable(n);if(!hr(s,Ph)){console.error("ColorPropertyMixerPlayable received incompatible input");continue}var a=s.value;i.r+=a.r*o,i.g+=a.g*o,i.b+=a.b*o,i.a+=a.a*o,r=!0}}r&&(e[this.propertyName]=i)}}},e}(Oh),wh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).propertyName="",e}return Ri(e,t),e.prototype.evaluate=function(t){var e=t.output.getUserData();if(e){for(var r=!1,i=0,n=0;n<this.clipPlayables.length;n++){var o=this.getClipWeight(n);if(o>0){var s=this.getClipPlayable(n);if(!hr(s,Ph)){console.error("FloatPropertyTrack added non-FloatPropertyPlayableAsset");continue}i+=s.value*o,r=!0}}r&&(e[this.propertyName]=i)}},e}(Oh),Lh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.evaluate=function(t){},e}(Oh),Fh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.evaluate=function(t){},e}(Oh),Nh=function(){function t(){}return t.collectSerializableObject=function(e,r){if(!r[e.getInstanceId()]){e.toData(),r[e.getInstanceId()]=e;var i=hn(e);if(i)for(var n,o=wn(Object.keys(i));!(n=o()).done;){var s=n.value,a=e.taggedProperties[s];if(void 0===a&&(a=e[s]),ln.is(a))t.collectSerializableObject(a,r);else if(qr(a))for(var u,c=wn(a);!(u=c()).done;){var h=u.value;ln.is(h)&&t.collectSerializableObject(h,r)}else if(Qr(a))for(var l,f=wn(Object.keys(a));!(l=f()).done;){var p=a[l.value];ln.is(p)&&t.collectSerializableObject(p,r)}}}},t.serializeEffectObject=function(e){var r={},i=to({},e.engine.jsonSceneData);t.collectSerializableObject(e,r);for(var n,o=wn(Object.keys(r));!(n=o()).done;){var s=r[n.value];i[s.getInstanceId()]||(i[s.getInstanceId()]={}),t.serialize(s,i[s.getInstanceId()])}return i},t.serialize=function(e,r){e.toData(),r||(r={});var i=hn(e);if(i)for(var n,o=wn(Object.keys(i));!(n=o()).done;){var s=n.value,a=e[s];"number"==typeof a||"string"==typeof a||"boolean"==typeof a||t.checkTypedArray(a)?r[s]=a:qr(a)?(r[s]||(r[s]=[]),t.serializeArrayProperty(a,r[s],0)):ln.is(a)?r[s]={id:a.getInstanceId()}:Qr(a)&&(r[s]||(r[s]={}),t.serializeObjectProperty(a,r[s],0))}for(var u,c=wn(Object.keys(e.taggedProperties));!(u=c()).done;){var h=u.value,l=e.taggedProperties[h];"number"==typeof l||"string"==typeof l||"boolean"==typeof l||t.checkTypedArray(l)?r[h]=l:qr(l)?(r[h]||(r[h]=[]),t.serializeArrayProperty(l,r[h],0)):ln.is(l)?r[h]={id:l.getInstanceId()}:Qr(l)&&(r[h]||(r[h]={}),t.serializeObjectProperty(l,r[h],0))}return r},t.deserialize=function(e,r){for(var i,n=r.taggedProperties,o=hn(r),s=r.engine,a=wn(Object.keys(e));!(i=a()).done;){var u=i.value;if(!o||!o[u]){var c=e[u];n[u]=t.deserializeProperty(c,s,0)}}if(o)for(var h,l=wn(Object.keys(o));!(h=l()).done;){var f=h.value,p=e[f];if(void 0!==p){var d=o[f].type;r[f]=t.deserializeProperty(p,s,0,d)}}r.fromData(n)},t.deserializeAsync=function(e,r){return cr((function(){var i,n,o,s,a,u,c,h,l,f,p,d;return pr(this,(function(m){switch(m.label){case 0:i=r.taggedProperties,n=hn(r),o=r.engine,s=wn(Object.keys(e)),m.label=1;case 1:return(a=s()).done?[3,4]:(u=a.value,n&&n[u]?[3,3]:(c=e[u],[4,t.deserializePropertyAsync(c,o,0)]));case 2:i[u]=m.sent(),m.label=3;case 3:return[3,1];case 4:if(!n)return[3,8];h=wn(Object.keys(n)),m.label=5;case 5:return(l=h()).done?[3,8]:(f=l.value,void 0===(p=e[f])?[3,7]:(d=n[f].type,[4,t.deserializePropertyAsync(p,o,0,d)]));case 6:r[f]=m.sent(),m.label=7;case 7:return[3,5];case 8:return r.fromData(i),[2]}}))}))()},t.checkTypedArray=function(t){return hr(t,Int8Array)||hr(t,Uint8Array)||hr(t,Uint8ClampedArray)||hr(t,Int16Array)||hr(t,Uint16Array)||hr(t,Int32Array)||hr(t,Uint32Array)||hr(t,Float32Array)||hr(t,Float64Array)||hr(t,ArrayBuffer)},t.checkDataPath=function(t){return!!(Qr(t)&&1===Object.keys(t).length&&"id"in t&&Zr(t.id)&&32===t.id.length)},t.checkGLTFNode=function(t){return Qr(t)&&void 0!==t.nodeIndex&&void 0!==t.isJoint},t.checkImageSource=function(t){return Jr(t)||hr(t,r.HTMLImageElement)},t.deserializeProperty=function(e,r,i,n){if(!(i>14)){if(qr(e)){for(var o,s=[],a=wn(e);!(o=a()).done;){var u=o.value;s.push(t.deserializeProperty(u,r,i+1,n))}return s}if(t.checkDataPath(e))return r.assetLoader.loadGUID(e.id);if(Qr(e)&&e.constructor===Object){var c;c=n?new n:{};for(var h,l=wn(Object.keys(e));!(h=l()).done;){var f=h.value;c[f]=t.deserializeProperty(e[f],r,i+1)}return c}return e}console.error("The nested object layers of the serialized data exceed the maximum limit.")},t.deserializePropertyAsync=function(e,r,i,n){return cr((function(){var o,s,a,u,c,h,l,f,p;return pr(this,(function(d){switch(d.label){case 0:if(i>14)return console.error("The nested object layers of the serialized data exceed the maximum limit."),[2];if(!qr(e))return[3,5];o=[],s=wn(e),d.label=1;case 1:return(a=s()).done?[3,4]:(u=a.value,c=o.push,[4,t.deserializePropertyAsync(u,r,i+1,n)]);case 2:c.apply(o,[d.sent()]),d.label=3;case 3:return[3,1];case 4:return[2,o];case 5:return t.checkDataPath(e)?[4,r.assetLoader.loadGUIDAsync(e.id)]:[3,7];case 6:return[2,d.sent()];case 7:if(!Qr(e)||e.constructor!==Object)return[3,12];h=n?new n:{},l=wn(Object.keys(e)),d.label=8;case 8:return(f=l()).done?[3,11]:(p=f.value,[4,t.deserializePropertyAsync(e[p],r,i+1)]);case 9:h[p]=d.sent(),d.label=10;case 10:return[3,8];case 11:return[2,h];case 12:return[2,e];case 13:return[2]}}))}))()},t.serializeObjectProperty=function(e,r,i){if(i>14)console.error("The nested object layers of the serialized data exceed the maximum limit.");else{r||(r={});for(var n,o=wn(Object.keys(e));!(n=o()).done;){var s=n.value,a=e[s];"number"==typeof a||"string"==typeof a||"boolean"==typeof a||t.checkTypedArray(e)?r[s]=a:qr(a)?(r[s]||(r[s]=[]),t.serializeArrayProperty(a,r[s],i+1)):ln.is(a)?r[s]={id:a.getInstanceId()}:Qr(a)&&(r[s]||(r[s]={}),t.serializeObjectProperty(a,r[s],i+1))}}},t.serializeArrayProperty=function(e,r,i){if(i>14)console.error("The nested object layers of the serialized data exceed the maximum limit.");else{r||(r=[]);for(var n=0;n<e.length;n++){var o=e[n];"number"==typeof o||"string"==typeof o||"boolean"==typeof o||t.checkTypedArray(e)?r[n]=o:qr(o)?(r[n]||(r[n]=[]),t.serializeArrayProperty(o,r[n],i+1)):ln.is(o)?r[n]={id:o.getInstanceId()}:Qr(o)&&(r[n]||(r[n]={}),t.serializeObjectProperty(o,r[n],i+1))}}},t}(),Dh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).time=0,e.startTime=0,e.items=[],e.reusable=!1,e.sceneBindings=[],e.graph=new wu,e}Ri(e,t);var r=e.prototype;return r.onStart=function(){this.timelineAsset||(this.timelineAsset=new exports.TimelineAsset(this.engine)),this.resolveBindings(),this.timelinePlayable=this.timelineAsset.createPlayable(this.graph),this.item.endBehavior!==Mi.destroy&&this.setReusable(!0)},r.setReusable=function(t){for(var r,i=wn(this.timelineAsset.tracks);!(r=i()).done;){var n=r.value.boundObject;if(hr(n,exports.VFXItem)){var o=n.getComponent(e);o&&o.setReusable(t)}}},r.getReusable=function(){return this.reusable},r.onUpdate=function(t){var e=this.time;this.timelinePlayable.setTime(e),this.timelinePlayable.evaluate(),this.graph.evaluate(t)},r.createContent=function(){if(this.item.composition)for(var t,r=wn(this.items);!(t=r()).done;){var i=t.value;if(i.composition=this.item.composition,exports.VFXItem.isComposition(i)){this.item.composition.refContent.push(i);var n=i.props.content.options.refId,o=this.item.composition.refCompositionProps.get(n);if(!o)throw new Error("Referenced precomposition with Id: "+n+" does not exist.");var s=i.addComponent(e);Nh.deserialize(o,s),s.createContent();for(var a,u=wn(s.items);!(a=u()).done;){var c=a.value;c.setInstanceId(ei());for(var h,l=wn(c.components);!(h=l()).done;){h.value.setInstanceId(ei())}}}}},r.onEnable=function(){for(var t,e=wn(this.items);!(t=e()).done;){t.value.setActive(!0)}},r.onDisable=function(){for(var t,e=wn(this.items);!(t=e()).done;){t.value.setActive(!1)}},r.onDestroy=function(){this.item.composition&&this.items&&(this.items.forEach((function(t){return t.dispose()})),this.items.length=0)},r.hitTest=function(t,e,r,i,n,o){for(var s,a=function(o){var a=s.items[o];if(a.isActive&&a.transform.getValid()&&!exports.VFXItem.isComposition(a)&&!h(a)){var l=a.getHitTestParams(n);if(l){var f=!1,p=new bn;if(l.type===exports.HitTestType.triangle)for(var d=l.triangles,m=l.backfaceCulling,v=0;v<d.length;v++){var y=d[v];if(t.intersectTriangle(y,p,m)){f=!0,u.push(p);break}}else if(l.type===exports.HitTestType.box){var g=l.center,_=l.size,E=g.clone().addScaledVector(_,.5),x=g.clone().addScaledVector(_,-.5);t.intersectBox({min:E,max:x},p)&&(f=!0,u.push(p))}else if(l.type===exports.HitTestType.sphere){var T=l.center,b=l.radius;t.intersectSphere({center:T,radius:b},p)&&(f=!0,u.push(p))}else if(l.type===exports.HitTestType.custom){var A=l.collect(t,new Tn(e,r));A&&A.length>0&&(A.forEach((function(t){u.push(t)})),f=!0)}if(f){var R={compContent:s.item,id:a.id,name:a.name,position:u[u.length-1],parentId:a.parentId,hitPositions:u,behavior:l.behavior};if(a.emit("click",R),i.push(R),c(R))return{v:i}}}}},u=[],c=(null==o?void 0:o.stop)||Wr,h=(null==o?void 0:o.skip)||Wr,l=(null==o?void 0:o.maxCount)||this.items.length,f=0;f<this.items.length&&i.length<l;f++){var p=(s=this,a(f));if("object"===lr(p))return p.v}return i},r.setChildrenRenderOrder=function(t){for(var r,i=wn(this.items);!(r=i()).done;){var n=r.value;n.renderOrder=t++;var o=n.getComponent(e);o&&(t=o.setChildrenRenderOrder(t))}return t},r.fromData=function(e){var r;t.prototype.fromData.call(this,e),this.items=e.items,this.startTime=null!=(r=e.startTime)?r:0,this.sceneBindings=e.sceneBindings,this.timelineAsset=e.timelineAsset},r.resolveBindings=function(){for(var t,e=wn(this.sceneBindings);!(t=e()).done;){var r=t.value;r.key.boundObject=r.value}for(var i,n=wn(this.timelineAsset.tracks);!(i=n()).done;){var o=i.value;this.updateTrackAnimatedObject(o)}},r.updateTrackAnimatedObject=function(t){for(var e,r=wn(t.getChildTracks());!(e=r()).done;){var i=e.value;i.updateAnimatedObject(),this.updateTrackAnimatedObject(i)}},e}(pn),Vh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.processFrame=function(t){var e=t.output.getUserData();hr(e,Dh)&&(e.time=this.getTime())},e}(Lu),Uh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.evaluate=function(t){var e=t.output.getUserData();if(hr(e,Dh)){for(var r=e,i=!1,n=0;n<this.clipPlayables.length;n++)if(this.getClipWeight(n)>0){i=!0;break}i?r.item.setActive(!0):r.item.setActive(!1)}},e}(Oh),Bh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.evaluate=function(t){},e}(Oh),kh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).propertyName="",e}return Ri(e,t),e.prototype.evaluate=function(t){var e=t.output.getUserData();if(e){var r=!1,i=e[this.propertyName];if(hr(i,An)){i.setZero();for(var n=0;n<this.clipPlayables.length;n++){var o=this.getClipWeight(n);if(o>0){var s=this.getClipPlayable(n);if(!hr(s,Ph)){console.error("Vector4PropertyTrack added non-Vector4PropertyPlayableAsset");continue}var a=s.value;i.x+=a.x*o,i.y+=a.y*o,i.z+=a.z*o,i.w+=a.w*o,r=!0}}r&&(e[this.propertyName]=i)}}},e}(Oh),zh=function(){function t(){this.start=0,this.duration=0}return t.prototype.toLocalTime=function(t){var e=t-this.start,r=this.duration;return e-r>0&&(this.endBehavior===Mi.restart?e%=r:this.endBehavior===Mi.freeze&&(e=Math.min(r,e))),e},t}();exports.TrackAsset=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).trackType=0,e.clipSeed=0,e.clips=[],e.children=[],e}Ri(e,t);var r=e.prototype;return r.updateAnimatedObject=function(){this.parent&&(this.boundObject=this.parent.boundObject)},r.createTrackMixer=function(t){return new Oh(t)},r.createOutput=function(){return new Fu},r.createPlayableGraph=function(t,e){return this.createMixerPlayableGraph(t,e)},r.createMixerPlayableGraph=function(t,e){for(var r,i=[],n=wn(this.clips);!(r=n()).done;){var o=r.value;i.push(o)}return this.compileClips(t,i,e)},r.compileClips=function(t,e,r){for(var i,n=this.createTrackMixer(t),o=wn(e);!(i=o()).done;){var s=i.value,a=this.createClipPlayable(t,s);a.setDuration(s.duration);var u=new Gh(s,a,n,this);r.push(u),n.clipPlayables.push(a),n.setClipWeight(a,0)}return n},r.createPlayable=function(t){return new Lu(t)},r.getChildTracks=function(){return this.children},r.addChild=function(t){this.children.push(t),t.parent=this},r.createClip=function(t,e){var r=new zh;return r.asset=new t(this.engine),r.name=e||"TimelineClip"+r.id,this.addClip(r),r},r.getClips=function(){return this.clips},r.findClip=function(t){for(var e,r=wn(this.clips);!(e=r()).done;){var i=e.value;if(i.name===t)return i}},r.addClip=function(t){t.id=(this.clipSeed++).toString(),this.clips.push(t)},r.createClipPlayable=function(t,e){return e.asset.createPlayable(t)},r.fromData=function(e){t.prototype.fromData.call(this,e);for(var r,i=wn(this.children);!(r=i()).done;){r.value.parent=this}},e}(Nu),fr([cn(zh)],exports.TrackAsset.prototype,"clips",void 0),fr([cn()],exports.TrackAsset.prototype,"children",void 0),exports.TrackAsset=fr([un(qi.TrackAsset)],exports.TrackAsset),exports.TrackType=void 0,(Sh=exports.TrackType||(exports.TrackType={}))[Sh.MasterTrack=0]="MasterTrack",Sh[Sh.ObjectTrack=1]="ObjectTrack";var Gh=function(){function t(t,e,r,i){this.clip=t,this.playable=e,this.parentMixer=r,this.track=i,hr(this.track.boundObject,exports.VFXItem)&&(this.particleSystem=this.track.boundObject.getComponent(exports.ParticleSystem))}return t.prototype.evaluateAt=function(t){var e=this.clip,r=1,i=!1,n=!1,o=this.track.boundObject;t>=e.start+e.duration&&e.endBehavior===Mi.destroy?hr(o,exports.VFXItem)&&exports.VFXItem.isParticle(o)&&this.particleSystem&&!this.particleSystem.destroyed?r=1:(r=0,i=!0):t-this.clip.start>=0?(r=1,n=!0):t<e.start&&(r=0),n&&this.playable.getPlayState()!==Mu.Playing&&this.playable.play(),this.parentMixer.setClipWeight(this.playable,r);var s=parseFloat(e.toLocalTime(t).toFixed(3));this.playable.setTime(s),i&&this.playable.getPlayState()===Mu.Playing&&this.playable.pause()},nn(t,[{key:"enable",set:function(t){t?this.playable.play():(this.parentMixer.setClipWeight(this.playable,0),this.playable.pause())}}]),t}();exports.ActivationTrack=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createTrackMixer=function(t){return new Mh(t)},e}(exports.TrackAsset),exports.ActivationTrack=fr([un(qi.ActivationTrack)],exports.ActivationTrack);var Xh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).propertyNames=[],e.path="",e}Ri(e,t);var r=e.prototype;return r.updateAnimatedObject=function(){for(var t=this.propertyNames,e=this.parent.boundObject,r=0;r<t.length-1;r++){var i=e[t[r]];void 0===i&&console.error("The "+t[r]+" property of "+e+" was not found"),e=i}this.boundObject=e},r.fromData=function(e){t.prototype.fromData.call(this,e);var r=this.path.split(".");this.propertyNames=r},e}(exports.TrackAsset);fr([cn()],Xh.prototype,"path",void 0),exports.FloatPropertyTrack=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.createTrackMixer=function(t){var e=new wh(t),r=this.propertyNames;if(r.length>0){var i=r[r.length-1];e.propertyName=i}return e},r.updateAnimatedObject=function(){for(var t=this.propertyNames,e=this.parent.boundObject,r=0;r<t.length-1;r++){var i=e[t[r]];void 0===i&&console.error("The "+t[r]+" property of "+e+" was not found"),e=i}this.boundObject=e},e}(Xh),exports.FloatPropertyTrack=fr([un(qi.FloatPropertyTrack)],exports.FloatPropertyTrack),exports.SpriteColorTrack=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createTrackMixer=function(t){return new Fh(t)},e}(exports.TrackAsset),exports.SpriteColorTrack=fr([un(qi.SpriteColorTrack)],exports.SpriteColorTrack),exports.SubCompositionTrack=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.updateAnimatedObject=function(){if(!this.parent||!hr(this.parent.boundObject,exports.VFXItem))throw new Error("SubCompositionTrack needs to be set under the VFXItem track.");this.boundObject=this.parent.boundObject.getComponent(Dh)},r.createTrackMixer=function(t){return new Uh(t)},e}(exports.TrackAsset),exports.SubCompositionTrack=fr([un(qi.SubCompositionTrack)],exports.SubCompositionTrack),exports.TransformTrack=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createTrackMixer=function(t){return new Bh(t)},e}(exports.TrackAsset),exports.TransformTrack=fr([un(qi.TransformTrack)],exports.TransformTrack),exports.MaterialTrack=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.updateAnimatedObject=function(){hr(this.parent.boundObject,dn)&&(this.parent.boundObject,this.boundObject=this.parent.boundObject.materials[this.index])},e}(exports.TrackAsset),fr([cn()],exports.MaterialTrack.prototype,"index",void 0),exports.MaterialTrack=fr([un("MaterialTrack")],exports.MaterialTrack);var Hh=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createTrackMixer=function(t){return new Lh(t)},e}(exports.TrackAsset);exports.Vector4PropertyTrack=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createTrackMixer=function(t){var e=new kh(t),r=this.propertyNames;if(r.length>0){var i=r[r.length-1];e.propertyName=i}return e},e}(Xh),exports.Vector4PropertyTrack=fr([un(qi.Vector4PropertyTrack)],exports.Vector4PropertyTrack),exports.ColorPropertyTrack=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createTrackMixer=function(t){var e=new Ih(t),r=this.propertyNames;if(r.length>0){var i=r[r.length-1];e.propertyName=i}return e},e}(Xh),exports.ColorPropertyTrack=fr([un(qi.ColorPropertyTrack)],exports.ColorPropertyTrack),exports.ColorPropertyPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createPlayable=function(t){var e=new Ph(t);return e.curve=Ya(this.curveData),e.value=e.curve.getValue(0),e},e}(Nu),fr([cn()],exports.ColorPropertyPlayableAsset.prototype,"curveData",void 0),exports.ColorPropertyPlayableAsset=fr([un(qi.ColorPropertyPlayableAsset)],exports.ColorPropertyPlayableAsset),exports.FloatPropertyPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createPlayable=function(t){var e=new Ph(t);return e.curve=Ya(this.curveData),e.value=e.curve.getValue(0),e},e}(Nu),fr([cn()],exports.FloatPropertyPlayableAsset.prototype,"curveData",void 0),exports.FloatPropertyPlayableAsset=fr([un(qi.FloatPropertyPlayableAsset)],exports.FloatPropertyPlayableAsset),exports.SubCompositionPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createPlayable=function(t){return new Vh(t)},e}(Nu),exports.SubCompositionPlayableAsset=fr([un(qi.SubCompositionPlayableAsset)],exports.SubCompositionPlayableAsset);var jh=function(){function t(t,e,r){this.children=[],this.trackAsset=t,this.mixer=e,this.output=r}return t.prototype.addChild=function(t){this.children.push(t)},t}();exports.TimelineAsset=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).tracks=[],e.cacheFlattenedTracks=null,e}Ri(e,t);var r=e.prototype;return r.createPlayable=function(t){for(var e,r=new Yh(t),i=wn(this.tracks);!(e=i()).done;){var n=e.value;hr(n,exports.ObjectBindingTrack)&&n.create(this)}return this.sortTracks(this.tracks),r.compileTracks(t,this.flattenedTracks),r},r.createTrack=function(t,e,r){var i=new t(this.engine);return i.name=r||t.name,e.addChild(i),this.invalidate(),i},r.invalidate=function(){this.cacheFlattenedTracks=null},r.addSubTracksRecursive=function(t,e){for(var r,i=wn(t.getChildTracks());!(r=i()).done;){var n=r.value;e.push(n)}for(var o,s=wn(t.getChildTracks());!(o=s()).done;){var a=o.value;this.addSubTracksRecursive(a,e)}},r.sortTracks=function(t){for(var e=[],r=0;r<t.length;r++)e.push(new Wh(t[r],r));e.sort(Zh),t.length=0;for(var i,n=wn(e);!(i=n()).done;){var o=i.value;t.push(o.track)}},r.fromData=function(t){},nn(e,[{key:"flattenedTracks",get:function(){if(!this.cacheFlattenedTracks){this.cacheFlattenedTracks=[];for(var t,e=wn(this.tracks);!(t=e()).done;){var r=t.value;this.cacheFlattenedTracks.push(r),this.addSubTracksRecursive(r,this.cacheFlattenedTracks)}}return this.cacheFlattenedTracks}}]),e}(Nu),fr([cn()],exports.TimelineAsset.prototype,"tracks",void 0),exports.TimelineAsset=fr([un(qi.TimelineAsset)],exports.TimelineAsset);var Yh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).clips=[],e.masterTrackInstances=[],e}Ri(e,t);var r=e.prototype;return r.prepareFrame=function(t){},r.evaluate=function(){for(var t,e=this.getTime(),r=wn(this.clips);!(t=r()).done;){t.value.evaluateAt(e)}},r.compileTracks=function(t,e){for(var r,i=e,n={},o=wn(i);!(r=o()).done;){var s=r.value,a=s.createPlayableGraph(t,this.clips),u=s.createOutput();u.setUserData(s.boundObject),t.addOutput(u),u.setSourcePlayable(a);var c=new jh(s,a,u);n[s.getInstanceId()]=c,s.parent||this.masterTrackInstances.push(c)}for(var h,l=wn(i);!(h=l()).done;)for(var f,p=h.value,d=n[p.getInstanceId()],m=wn(p.getChildTracks());!(f=m()).done;){var v=n[f.value.getInstanceId()];d.addChild(v)}},e}(Lu),Wh=function(t,e){this.track=t,this.originalIndex=e};function Zh(t,e){var r=t.track.boundObject,i=e.track.boundObject;return hr(r,exports.VFXItem)&&hr(i,exports.VFXItem)?exports.VFXItem.isAncestor(r,i)?-1:exports.VFXItem.isAncestor(i,r)?1:t.originalIndex-e.originalIndex:t.originalIndex-e.originalIndex}function qh(t,e){return!e||"object"!==lr(e)&&"function"!=typeof e?Sn(t):e}exports.Vector4PropertyPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.createPlayable=function(t){var e=new Ph(t);return e.curve=Ya(this.curveData),e.value=e.curve.getValue(0),e},e}(Nu),fr([cn()],exports.Vector4PropertyPlayableAsset.prototype,"curveData",void 0),exports.Vector4PropertyPlayableAsset=fr([un("Vector4PropertyPlayableAsset")],exports.Vector4PropertyPlayableAsset),exports.ObjectBindingTrack=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.updateAnimatedObject=function(){},r.create=function(t){if(hr(this.boundObject,exports.VFXItem)){var e=this.boundObject;if(e.getComponent(exports.ParticleSystem)){var r=t.createTrack(Hh,this,"ParticleTrack");r.boundObject=this.boundObject;var i=r.createClip(hh);i.start=e.start,i.duration=e.duration,i.endBehavior=e.endBehavior}}},e}(exports.TrackAsset),exports.ObjectBindingTrack=fr([un(qi.ObjectBindingTrack)],exports.ObjectBindingTrack);var Kh=function(){function t(t){this.width=0,this.height=0;var e=t.textHeight,r=void 0===e?100:e,i=t.textWidth,n=void 0===i?100:i,o=t.textOverflow,s=void 0===o?Bi.clip:o,a=t.textBaseline,u=void 0===a?ki.top:a,c=t.textAlign,h=void 0===c?zi.left:c,l=t.text,f=void 0===l?" ":l,p=t.letterSpace,d=void 0===p?0:p,m=t.autoWidth,v=void 0!==m&&m,y=t.fontSize,g=t.lineHeight,_=void 0===g?y:g,E=y+d;this.autoWidth=v,this.maxTextWidth=f.length*E,this.width=n,this.height=r,this.letterSpace=d,this.overflow=s,this.textBaseline=u,this.textAlign=h,this.lineHeight=_}var e=t.prototype;return e.getOffsetY=function(t,e,r,i){var n=t.outlineWidth,o=t.fontScale,s=(r-i)/3,a=i+n*o,u=r*(e-1),c=0;switch(this.textBaseline){case ki.top:c=a+s;break;case ki.middle:c=(this.height*o-u+a)/2;break;case ki.bottom:c=this.height*o-u-s}return c},e.getOffsetX=function(t,e){var r=0;switch(this.textAlign){case zi.left:r=t.outlineWidth*t.fontScale;break;case zi.middle:r=(this.width*t.fontScale-e)/2;break;case zi.right:r=this.width*t.fontScale-e}return r},e.setSize=function(t,e){this.width=t,this.height=e},t}(),Qh=function(t){this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineWidth=0,this.hasShadow=!1,this.fontDesc="",this.fontScale=2,this.fontOffset=0;var e,r,i,n,o,s,a=t.textColor,u=void 0===a?[1,1,1,1]:a,c=t.fontSize,h=void 0===c?40:c,l=t.outline,f=t.shadow,p=t.fontWeight,d=void 0===p?"normal":p,m=t.fontStyle,v=void 0===m?"normal":m,y=t.fontFamily,g=void 0===y?"sans-serif":y;(this.textColor=u,this.textWeight=d,this.fontStyle=v,this.fontFamily=g,this.fontSize=h,l)&&(this.isOutlined=!0,this.outlineColor=null!=(e=l.outlineColor)?e:[1,1,1,1],this.outlineWidth=null!=(r=l.outlineWidth)?r:1,this.fontOffset+=this.outlineWidth);f&&(this.hasShadow=!0,this.shadowBlur=null!=(i=f.shadowBlur)?i:2,this.shadowColor=null!=(n=f.shadowColor)?n:[0,0,0,1],this.shadowOffsetX=null!=(o=f.shadowOffsetX)?o:0,this.shadowOffsetY=null!=(s=f.shadowOffsetY)?s:0);this.fontStyle!==Xi.normal&&(this.fontOffset+=this.fontSize*Math.tan(.20943951))},Jh=function(){function t(){this.elements=[]}var e=t.prototype;return e.dispose=function(){this.elements.forEach((function(t){return t.remove()})),this.elements.length=0},e.getCanvas=function(){if(0!==this.elements.length){var t=this.elements.shift();return zr(t),t}if(Zu(Yu))return r.window._createOffscreenCanvas(10,10);var e=r.document.createElement("canvas");return e.getContext("2d",{willReadFrequently:!0}),e},e.saveCanvas=function(t){t.width=1,t.height=1,this.elements.length<3?xr(this.elements,t):t.remove()},t}(),$h=new Jh,tl=["serif","sans-serif","monospace","courier"],el=0;exports.TextComponent=function(t){function e(e,r){var i;if((i=t.call(this,e)||this).isDirty=!0,i.lineCount=0,i.SCALE_FACTOR=.1,i.ALPHA_FIX_VALUE=1/255,i.name="MText"+el++,i.geometry=i.createGeometry(jn.TRIANGLES),r&&i.fromData(r),i.canvas=$h.getCanvas(),$h.saveCanvas(i.canvas),i.context=i.canvas.getContext("2d",{willReadFrequently:!0}),i.setItem(),!r)return qh(i);var n=r.options;return i.updateWithOptions(n),i.updateTexture(),i}Ri(e,t);var r=e.prototype;return r.onUpdate=function(e){t.prototype.onUpdate.call(this,e),this.updateTexture()},r.fromData=function(e){t.prototype.fromData.call(this,e);var r,i,n,o,s,a,u=e.interaction,c=e.options,h=e.listIndex,l=void 0===h?0:h,f=e.renderer;f||(f={}),this.interaction=u,this.renderer={renderMode:null!=(r=f.renderMode)?r:_i.MESH,blending:null!=(i=f.blending)?i:li.ALPHA,texture:null!=(n=f.texture)?n:this.engine.emptyTexture,occlusion:!!f.occlusion,transparentOcclusion:!!f.transparentOcclusion||f.maskMode===pi.MASK,side:null!=(o=f.side)?o:fi.DOUBLE,mask:null!=(s=f.mask)?s:0,maskMode:null!=(a=f.maskMode)?a:pi.NONE,order:l},this.interaction=u,this.updateWithOptions(c),this.updateTexture()},r.updateWithOptions=function(t){},r.updateTexture=function(t){},e}(Za),exports.TextComponent=fr([un(qi.TextComponent)],exports.TextComponent);var rl=function(){function t(){}var e=t.prototype;return e.updateWithOptions=function(t){this.textStyle=new Qh(t),this.textLayout=new Kh(t),this.text=t.text.toString(),this.lineCount=this.getLineCount(t.text,!0)},e.getLineCount=function(t,e){for(var r=this.context,i=this.textLayout.letterSpace,n=e?this.textStyle.fontSize/10:1/this.textStyle.fontScale,o=this.textLayout.width+this.textStyle.fontOffset,s=1,a=0,u=0;u<t.length;u++){var c,h,l=t[u],f=(null!=(h=null==r||null==(c=r.measureText(l))?void 0:c.width)?h:0)*n;((a+=i)+f>o&&u>0||"\n"===l)&&(s++,a=0),"\n"!==l&&(a+=f)}return s},e.setFontSize=function(t){if(this.textStyle.fontSize!==t){var e=this.textStyle.fontSize-t;this.textLayout.lineHeight+=e,this.textStyle.fontSize=t,this.isDirty=!0}},e.setFontWeight=function(t){this.textStyle.textWeight!==t&&(this.textStyle.textWeight=t,this.isDirty=!0)},e.setFontStyle=function(t){this.textStyle.fontStyle!==t&&(this.textStyle.fontStyle=t,this.isDirty=!0)},e.setText=function(t){this.text!==t&&(this.text=t.toString(),this.lineCount=this.getLineCount(t,!1),this.isDirty=!0)},e.setTextAlign=function(t){this.textLayout.textAlign!==t&&(this.textLayout.textAlign=t,this.isDirty=!0)},e.setTextBaseline=function(t){this.textLayout.textBaseline!==t&&(this.textLayout.textBaseline=t,this.isDirty=!0)},e.setTextColor=function(t){this.textStyle.textColor!==t&&(this.textStyle.textColor=t,this.isDirty=!0)},e.setFontFamily=function(t){this.textStyle.fontFamily!==t||Gr(t)?(this.textStyle.fontFamily=t,this.isDirty=!0):console.warn("The font is either the current font or an risky font family.")},e.setOutlineColor=function(t){this.textStyle.outlineColor!==t&&(this.textStyle.outlineColor=t,this.isDirty=!0)},e.setOutlineWidth=function(t){this.textStyle.outlineWidth!==t&&(this.textStyle.outlineWidth=t,this.isDirty=!0)},e.setShadowBlur=function(t){this.textStyle.shadowBlur!==t&&(this.textStyle.shadowBlur=t,this.isDirty=!0)},e.setShadowColor=function(t){this.textStyle.shadowColor!==t&&(this.textStyle.shadowColor=t,this.isDirty=!0)},e.setShadowOffsetX=function(t){this.textStyle.shadowOffsetX!==t&&(this.textStyle.shadowOffsetX=t,this.isDirty=!0)},e.setShadowOffsetY=function(t){this.textStyle.shadowOffsetY!==t&&(this.textStyle.shadowOffsetY=t,this.isDirty=!0)},e.setFontScale=function(t){this.textStyle.fontScale!==t&&(this.textStyle.fontScale=t,this.isDirty=!0)},e.setAutoWidth=function(t){this.textLayout.autoWidth!==t&&(this.textLayout.autoWidth=t,this.isDirty=!0)},e.updateTexture=function(t){if(void 0===t&&(t=!0),this.isDirty&&this.context&&this.canvas){var e=this.context,r=this.textStyle,i=this.textLayout,n=r.fontScale,o=(i.width+r.fontOffset)*n,s=i.lineHeight*this.lineCount,a=r.fontSize*n,u=i.lineHeight*n;this.char=(this.text||"").split(""),this.canvas.width=o,i.autoWidth?(this.canvas.height=s*n,this.item.transform.size.set(1,s/i.height)):this.canvas.height=i.height*n;var c=this.canvas.height;e.clearRect(0,0,o,c),e.fillStyle="rgba(255, 255, 255, 0.0039)",t||(e.translate(0,c),e.scale(1,-1)),e.fillRect(0,0,o,c),r.fontDesc=this.getFontDesc(),e.font=r.fontDesc,r.hasShadow&&this.setupShadow(),r.isOutlined&&this.setupOutline(),e.fillStyle="rgba("+r.textColor[0]+", "+r.textColor[1]+", "+r.textColor[2]+", "+r.textColor[3]+")";for(var h=[],l=0,f=i.getOffsetY(r,this.lineCount,u,a),p=[],d=[],m=0;m<this.char.length;m++){var v=this.char[m],y=e.measureText(v);((l+=i.letterSpace*n)+y.width>o&&m>0||"\n"===v)&&(h.push({y:f,width:l,chars:p,charOffsetX:d}),l=0,f+=u,p=[],d=[]),"\n"!==v&&(p.push(v),d.push(l),l+=y.width)}h.push({y:f,width:l,chars:p,charOffsetX:d}),h.forEach((function(t){var n=i.getOffsetX(r,t.width);t.chars.forEach((function(i,o){r.isOutlined&&e.strokeText(i,n+t.charOffsetX[o],t.y),e.fillText(i,n+t.charOffsetX[o],t.y)}))})),r.hasShadow&&(e.shadowColor="transparent");var g=e.getImageData(0,0,this.canvas.width,this.canvas.height);this.material.setTexture("_MainTex",bo.createWithData(this.engine,{data:new Uint8Array(g.data),width:g.width,height:g.height},{flipY:t,magFilter:jn.LINEAR,minFilter:jn.LINEAR,wrapS:jn.CLAMP_TO_EDGE,wrapT:jn.CLAMP_TO_EDGE})),this.isDirty=!1}},e.getFontDesc=function(){var t=this.textStyle,e=t.fontSize,r=t.fontScale,i=t.fontFamily,n=t.textWeight,o=t.fontStyle,s=(e*r).toString()+"px ";return tl.includes(i)?s+=i:s+='"'+i+'"',n!==Gi.normal&&(s=n+" "+s),o!==Xi.normal&&(s=o+" "+s),s},e.setupOutline=function(){var t=this.context,e=this.textStyle,r=e.outlineColor,i=e.outlineWidth,n=r[0],o=r[1],s=r[2],a=r[3];t&&(t.strokeStyle="rgba("+255*n+", "+255*o+", "+255*s+", "+a+")",t.lineWidth=2*i)},e.setupShadow=function(){var t=this.context,e=this.textStyle,r=e.outlineColor,i=e.shadowBlur,n=e.shadowOffsetX,o=e.shadowOffsetY,s=r[0],a=r[1],u=r[2],c=r[3];t&&(t.shadowColor="rgba("+255*s+", "+255*a+", "+255*u+", "+c+")",t.shadowBlur=i,t.shadowOffsetX=n,t.shadowOffsetY=-o)},t}();ii(exports.TextComponent,[rl]);var il=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e}(bi),nl=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e}(ln);exports.BinaryAsset=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.fromData=function(t){},e}(ln),fr([cn()],exports.BinaryAsset.prototype,"buffer",void 0),exports.BinaryAsset=fr([un(qi.BinaryAsset)],exports.BinaryAsset);var ol=function(){function t(t){this.engine=t}var e=t.prototype;return e.loadGUID=function(e){if(this.engine.objectInstance[e])return this.engine.objectInstance[e];var r,i=this.findData(e);if(i){switch(i.dataType){case qi.Material:r=Bo.create(this.engine);break;case qi.Geometry:r=jo.create(this.engine);break;case qi.Texture:r=bo.create(this.engine);break;default:var n=t.getClass(i.dataType);n&&(r=new n(this.engine))}if(r)return r.setInstanceId(i.id),this.engine.addInstance(r),Nh.deserialize(i,r),r;console.error("Constructor for DataType: "+i.dataType+" not found.")}else console.error("Object data with uuid: "+e+" not found.")},e.loadGUIDAsync=function(e){var r=this;return cr((function(){var i,n,o;return pr(this,(function(s){switch(s.label){case 0:return r.engine.objectInstance[e]?[2,r.engine.objectInstance[e]]:(i=r.findData(e))?[3,2]:r.engine.database?[4,r.engine.database.loadGUID(e)]:(console.error("Object data with uuid: "+e+" not found."),[2,void 0]);case 1:return(n=s.sent())?(r.engine.addInstance(n),[2,n]):(console.error("Disk data with uuid: "+e+" not found."),[2,void 0]);case 2:switch(i.dataType){case qi.Material:n=Bo.create(r.engine);break;case qi.Geometry:n=jo.create(r.engine);break;case qi.Texture:n=bo.create(r.engine);break;default:(o=t.getClass(i.dataType))&&(n=new o(r.engine))}return n?(n.setInstanceId(i.id),r.engine.addInstance(n),[4,Nh.deserializeAsync(i,n)]):(console.error("Constructor for DataType: "+i.dataType+" not found."),[2,void 0]);case 3:return s.sent(),[2,n]}}))}))()},e.findData=function(t){return this.engine.jsonSceneData[t]},t.getClass=function(t){return an[t]},t}(),sl=function(){function t(){}return t.prototype.loadGUID=function(t){return cr((function(){return pr(this,(function(t){return[2,void 0]}))}))()},t}();function al(t,e){if(!t.includes(e))return t.push(e),!0}function ul(t){if(Number.isFinite(t))return[Ci.CONSTANT,t];if(t){var e=t[0],r=t[1];if(Array.isArray(e))return;if("static"===e||e===Ci.CONSTANT)return[Ci.CONSTANT,t[1]];if("lines"===e)return[Ci.LINE,t[1]];if(e===Ci.LINE){var i=r.map((function(t){return[Oi.LINE,t]}));return[Ci.BEZIER_CURVE,i]}return"curve"===e||e===Ci.CURVE?[Ci.BEZIER_CURVE,Ol(r)]:t}}function cl(t,e){return Array.isArray(t)&&"random"===t[0]?[Ci.CONSTANT,t[1][e]]:ul(t)}function hl(t){return t&&"color"===t[0]?dl(t[1],!0):[1,1,1,1]}function ll(t,e){if(t)return"colors"===t[0]?[Ci.COLORS,t[1].map((function(t){return dl(t,e)}))]:"gradient"===t[0]?pl(t[1],e):"color"===t[0]?[Ci.RGBA_COLOR,dl(t[1],e)]:t}function fl(t){return t&&"random"===t[0]?[Ci.RANDOM,t[1]]:ul(t)}function pl(t,e){if(t){var r=[];return Object.getOwnPropertyNames(t).forEach((function(i){var n=function(t){var e=/^(-)?([\d+.]+)%$/.exec(t);if(e)return+e[2]/100*(e[1]?-1:1);return+t}(i),o=dl(t[i],e);r.push([n,o[0],o[1],o[2],o[3]])})),r=r.sort((function(t,e){return t[0]-e[0]})),[Ci.GRADIENT_COLOR,r]}}function dl(t,e){var r;if("string"==typeof t){t=t.replace(/[\s\t\r\n]/g,"");var i=/rgba?\(([.\d]+),([.\d]+),([.\d]+),?([.\d]+)?\)/.exec(t);if(i){var n=+i[4];r=[+i[1],+i[2],+i[3],isNaN(n)?255:Math.round(255*n)]}else/^#[a-f\d]{3}$/i.test(t)?r=[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),255]:(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))&&(r=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),255]||[0,0,0,255])}else hr(t,Array)&&(r=[t[0],t[1],t[2],isNaN(t[3])?255:Math.round(255*t[3])]);return e&&(r=ml(r)),r}function ml(t){if(Array.isArray(t))return t.map((function(t){return Number.isFinite(t/255)?Number((t/255).toFixed(6)):0}))}function vl(t,e){return Array.isArray(t)?t[0]===Ci.GRADIENT_COLOR?t:("gradient"===t[0]||"color"===t[0])&&pl(t[1],e):pl(t,e)}function yl(t){if(t){if(3===t.length)return[Ci.CONSTANT_VEC3,t];var e=t[0];if("path"===e||"bezier"===e||e===Ci.BEZIER_PATH||e===Ci.LINEAR_PATH){var r=t[1],i=r[0],n=r[1],o=r[2],s=Ol(i);if(!o){o=[];for(var a=0;a<n.length;a++){var u=n[a].slice();0===a?o.push(u):a<n.length-1?(o.push(u),o.push(u)):o.push(u)}}return[Ci.BEZIER_CURVE_PATH,[s,n,o]]}return t}}function gl(t){for(var e,r=wn(Object.keys(t));!(e=r()).done;){var i=e.value;t[i]=Number(t[i])}return t}function _l(t){for(var e,r=wn(Object.keys(t));!(e=r()).done;){var i=e.value;void 0===t[i]&&delete t[i]}return t}var El,xl=Math.cos,Tl=Math.sin,bl=Math.PI/180,Al=180/Math.PI;function Rl(t,e){return t?[t[0]-.5,.5-t[1]]:e?Sl[e]:[0,0]}var Sl=((El={})[Ei.PARTICLE_ORIGIN_CENTER]=[0,0],El[Ei.PARTICLE_ORIGIN_CENTER_BOTTOM]=[0,-.5],El[Ei.PARTICLE_ORIGIN_CENTER_TOP]=[0,.5],El[Ei.PARTICLE_ORIGIN_LEFT_TOP]=[-.5,.5],El[Ei.PARTICLE_ORIGIN_LEFT_CENTER]=[-.5,0],El[Ei.PARTICLE_ORIGIN_LEFT_BOTTOM]=[-.5,-.5],El[Ei.PARTICLE_ORIGIN_RIGHT_CENTER]=[.5,0],El[Ei.PARTICLE_ORIGIN_RIGHT_BOTTOM]=[.5,-.5],El[Ei.PARTICLE_ORIGIN_RIGHT_TOP]=[.5,.5],El);function Cl(t,e,r,i){var n=r[0],o=r[1],s=i[0],a=s-n;return[[n+(s-n)/3,o+(t*=a)/3],[s-(s-n)/3,i[1]-(e*=a)/3]]}function Ol(t){for(var e=-1e6,r=1e6,i=0;i<t.length;i++)e=Math.max(e,t[i][1]),r=Math.min(r,t[i][1]);for(var n=[[t[0][0],t[0][1]]],o=0;o<t.length-1;o++){var s=t[o][3]*(e-r),a=t[o+1][2]*(e-r),u=[t[o][0],t[o][1]],c=[t[o+1][0],t[o+1][1]];if(u[0]!=c[0]){var h=Cl(s,a,u,c),l=h[0],f=h[1];n[n.length-1].push(l[0]),n[n.length-1].push(l[1]),n.push([f[0],f[1],c[0],c[1]])}else n[n.length-1].push(c[0]),n[n.length-1].push(c[1])}return n.map((function(t,e){return 0===e?[Oi.EASE_OUT,t]:e===n.length-1?[Oi.EASE_IN,t]:[Oi.EASE,t]}))}function Ml(t){return t.compositions.forEach((function(t){t.items.forEach((function(t){t.type===gi.null&&t.endBehavior===Mi.destroy&&(t.endBehavior=Mi.freeze)}))})),t.version="2.1",t}function Pl(t){for(var e,r,i,n=function(){var t=u.value;3!==t.endBehavior&&1!==t.endBehavior||(t.endBehavior=Mi.freeze),t.items=t.items.filter((function(t){return"8"!==t.type})),t.items.forEach((function(t){t.type===gi.particle&&(t.content.filter&&delete t.content.filter)}));for(var e,r=wn(t.items);!(e=r()).done;){var i=e.value;c[i.id]=ei(),i.oldId=i.id,i.id=c[i.id],h[i.id]=i}t.items.forEach((function(e,r){if(e.parentId)if(e.parentId.includes("^")){var i=e.parentId.split("^")[0],n=e.parentId.split("^")[1];e.parentId=c[i]+"^"+n}else e.parentId=c[e.parentId];o.items.push(e),t.items[r]={id:e.id}}));var n=to({},t,{timelineAsset:{id:""},sceneBindings:[]});o.compositions.push(n),function(t,e,r){for(var i,n=[],o=[],s=[],a={tracks:[],id:ei(),dataType:"TimelineAsset"},u=wn(t.items);!(i=u()).done;){var c=e[i.value.id],h=[],l={id:ei(),dataType:"ActivationPlayableAsset"};s.push(l);var f={id:ei(),dataType:"ActivationTrack",children:[],clips:[{start:c.delay,duration:c.duration,endBehavior:c.endBehavior,asset:{id:l.id}}]};if(h.push({id:f.id}),o.push(f),c.type!==gi.particle){var p={id:ei(),dataType:"TransformPlayableAsset",sizeOverLifetime:c.content.sizeOverLifetime,rotationOverLifetime:c.content.rotationOverLifetime,positionOverLifetime:c.content.positionOverLifetime};s.push(p);var d={id:ei(),dataType:"TransformTrack",children:[],clips:[{start:c.delay,duration:c.duration,endBehavior:c.endBehavior,asset:{id:p.id}}]};h.push({id:d.id}),o.push(d)}if(c.type===gi.sprite||c.type===gi.text){var m={id:ei(),dataType:"SpriteColorPlayableAsset",colorOverLifetime:c.content.colorOverLifetime};s.push(m);var v={id:ei(),dataType:"SpriteColorTrack",children:[],clips:[{start:c.delay,duration:c.duration,endBehavior:c.endBehavior,asset:{id:m.id}}]};h.push({id:v.id}),o.push(v)}if(c.type===gi.composition){var y={id:ei(),dataType:"SubCompositionPlayableAsset"};s.push(y);var g={id:ei(),dataType:"SubCompositionTrack",children:[],clips:[{start:c.delay,duration:c.duration,endBehavior:c.endBehavior,asset:{id:y.id}}]};h.push({id:g.id}),o.push(g)}var _={id:ei(),dataType:"ObjectBindingTrack",children:h,clips:[]};o.push(_),a.tracks.push({id:_.id}),n.push({key:{id:_.id},value:{id:c.id}})}for(var E,x=[],T=wn(o);!(E=T()).done;){var b=E.value;x.push({id:b.id})}t.timelineAsset={id:a.id},t.sceneBindings=n,r.miscs.push(a);for(var A,R=wn(o);!(A=R()).done;){var S=A.value;r.miscs.push(S)}for(var C,O=wn(s);!(C=O()).done;){var M=C.value;r.miscs.push(M)}}(n,h,o)},o=to({},t,{items:[],compositions:[],components:[],materials:[],shaders:[],geometries:[],animations:[],miscs:[]}),s=wn(o.images);!(r=s()).done;){r.value.id=ei()}if(null!=(e=o).textures||(e.textures=[]),o.textures.forEach((function(t){var e;t.id=ei(),t.dataType=qi.Texture,t.source={id:null==(e=o.images[t.source])?void 0:e.id}})),o.textures.length<o.images.length)for(var a=o.textures.length;a<o.images.length;a++)o.textures.push({id:ei(),dataType:qi.Texture,source:{id:o.images[a].id},flipY:!0});t.bins&&(i=t.bins,o.bins=i.map((function(t){return{url:t.url,dataType:"BinaryAsset",id:ei()}})));for(var u,c={},h={},l=wn(t.compositions);!(u=l()).done;)n();for(var f,p=wn(o.items);!(f=p()).done;){var d=f.value;if(d.content){if(d.content.renderer&&void 0!==d.content.renderer.texture){var m=d.content.renderer.texture;d.content.renderer.texture={id:o.textures[m].id}}if(d.content.trails&&void 0!==d.content.trails.texture){var v=d.content.trails.texture;d.content.trails.texture={id:o.textures[v].id}}}if(d.transform){var y,g,_,E=[].concat(null!=(y=d.transform.position)?y:[0,0,0]),x=[].concat(null!=(g=d.transform.rotation)?g:[0,0,0]),T=[].concat(null!=(_=d.transform.scale)?_:[1,1,1]);if(Object.assign(d,{transform:{position:{x:E[0],y:E[1],z:E[2]},eulerHint:{x:x[0],y:x[1],z:x[2]},scale:{x:T[0],y:T[1],z:T[0]}}}),d.type===gi.sprite&&(d.transform.size={x:T[0],y:T[1]},d.transform.scale={x:1,y:1,z:1}),d.type===gi.sprite){var b=d.content;b.renderer||(b.renderer={});var A,R,S,C,O=b.renderer,M=Rl(O.anchor,O.particleOrigin),P=d.transform.size;if(!O.anchor&&void 0!==O.particleOrigin)d.transform.position.x+=-M[0]*(null!=(A=null==P?void 0:P.x)?A:1),d.transform.position.y+=-M[1]*(null!=(R=null==P?void 0:P.y)?R:1);d.transform.anchor={x:M[0]*(null!=(S=null==P?void 0:P.x)?S:1),y:M[1]*(null!=(C=null==P?void 0:P.y)?C:1)}}}if(d.type===gi.particle){var I=d.content;I.renderer||(I.renderer={});var w=I.renderer;I.renderer.anchor=Rl(w.anchor,w.particleOrigin)}if(d.type===gi.camera&&d.content.positionOverLifetime&&0!==Object.keys(d.content.positionOverLifetime).length&&(d.content.positionOverLifetime.asMovement=!0),void 0!==d.pn){var L=d.pn,F=t.plugins,N=void 0===F?[]:F;void 0!==L&&Number.isInteger(L)&&(d.pluginName=N[L])}switch("editor-gizmo"===d.pluginName&&(d.type="editor-gizmo"),"orientation-transformer"===d.pluginName&&(d.type="orientation-transformer"),d.content.options.target&&"editor-gizmo"===d.pluginName&&(d.content.options.target=c[d.content.options.target]),d.type===gi.spine&&t.spines&&0!==t.spines.length&&wl(t.spines[d.content.options.spine],d.content,o),d.type!==gi.sprite&&d.type!==gi.particle&&d.type!==gi.mesh&&d.type!==gi.skybox&&d.type!==gi.light&&"camera"!==d.type&&d.type!==gi.tree&&d.type!==gi.interact&&d.type!==gi.camera&&d.type!==gi.text&&d.type!==gi.spine&&"editor-gizmo"!==d.type&&"orientation-transformer"!==d.type||(d.components=[],o.components.push(d.content),d.content.id=ei(),d.content.item={id:d.id},d.dataType=qi.VFXItemData,d.components.push({id:d.content.id})),d.type!==gi.null&&d.type!==gi.composition||(d.components=[],d.dataType=qi.VFXItemData),d.type){case gi.sprite:d.content.dataType=qi.SpriteComponent;break;case gi.particle:d.content.dataType=qi.ParticleSystem;break;case gi.mesh:d.content.dataType=qi.MeshComponent;break;case gi.skybox:d.content.dataType=qi.SkyboxComponent;break;case gi.light:d.content.dataType=qi.LightComponent;break;case"camera":d.content.dataType=qi.CameraComponent;break;case"editor-gizmo":d.content.dataType="GizmoComponent";break;case"orientation-transformer":d.content.dataType="OrientationComponent";break;case gi.tree:d.content.dataType=qi.TreeComponent;break;case gi.interact:d.content.dataType=qi.InteractComponent;break;case gi.camera:d.content.dataType=qi.CameraController;break;case gi.text:d.content.dataType=qi.TextComponent;break;case gi.spine:d.content.dataType=qi.SpineComponent}}return o.version="3.0",o}function Il(t){if(t)for(var e,r=wn(Object.keys(t));!(e=r()).done;){var i=e.value,n=t[i],o=Array.isArray(n);o&&2===n.length&&Array.isArray(n[1])?t[i]="path"===i?yl(n):ul(n):o||"object"!=typeof n||Il(n)}}function wl(t,e,r){e.resource={atlas:{bins:{id:r.bins[t.atlas[1][0]].id},source:t.atlas[1].slice(1)},skeleton:{bins:{id:r.bins[t.skeleton[1][0]].id},source:t.skeleton[1].slice(1)},skeletonType:t.skeletonType,images:t.images.map((function(t){return{id:r.textures[t].id}}))}}function Ll(t,e){var r,i=t.options,n=t.velocityOverLifetime||{},o={path:yl(null==(r=t.transform)?void 0:r.path),gravity:i.gravity,gravityOverLifetime:ul(i.gravityModifier),direction:i.direction,startSpeed:i.startSpeed,asMovement:n.asMovement,linearX:ul(n.linearX),linearY:ul(n.linearY),linearZ:ul(n.linearZ),asRotation:n.asRotation,orbCenter:n.orbCenter,orbitalX:ul(n.orbitalX),orbitalY:ul(n.orbitalY),orbitalZ:ul(n.orbitalZ),speedOverLifetime:ul(n.speedOverLifetime)};_l(o);var s={options:{startColor:hl(i.startColor)},positionOverLifetime:o};i.startSize&&(e.scale=[i.startSize,i.startSize/(i.sizeAspect||1),1]),i.startRotation&&(e.rotation?e.rotation[2]+=i.startRotation:e.rotation=[0,0,i.startRotation]);var a=t.rotationOverLifetime;if(a){var u=s.rotationOverLifetime={separateAxes:a.separateAxes,asRotation:a.asRotation};u.separateAxes?(u.x=ul(a.x),u.y=ul(a.y),u.z=ul(a.z)):u.z=ul(a.angularVelocity)}var c=t.colorOverLifetime;if(c){var h=s.colorOverLifetime={opacity:ul(c.opacity)};c.color&&(h.color=vl(c.color))}var l=t.sizeOverLifetime;return l&&(s.sizeOverLifetime={separateAxes:l.separateAxes,size:ul(l.size),x:ul(l.x),y:ul(l.y),z:ul(l.z)}),s}var Fl=/^(\d+)\.(\d+)\.(\d+)(-(\w+)\.\d+)?$/,Nl=/^(\d+)\.(\d+)$/,Dl=!1;function Vl(t){if(!t||"object"!=typeof t)throw new Error("Invalid input: Expected a JSON object.");var e;if(function(t){var e,r=null==(e=t.version)?void 0:e.split(".");!r||Number(r[0])>2||2===Number(r[0])&&Number(r[1])>=2||t.compositions.forEach((function(t){t.items.forEach((function(t){t.type!==gi.mesh&&t.type!==gi.light||(t.endBehavior=1===t.endBehavior?Mi.destroy:t.endBehavior)}))}))}(t),Fl.test(t.version))return Dl="0"===(null==(e=/^(\d+)/.exec(t.version))?void 0:e[0]),Pl(Ml(function(t){var e;Ul="1.0";var r=t.plugins||[];(null==(e=t.bins)?void 0:e.length)&&(Ul="1.3");var i,n=(t.requires||[]).slice(),o=t.images.map((function(e,r){return Bl(e,r,t.imageTags||[])})),s=t.textures||o.map((function(t,e){return{source:e,flipY:!0}})),a={plugins:r,shapes:t.shapes||[],type:"ge",version:Ul,playerVersion:null!=(i=t.playerVersion)?i:{web:"",native:""},compositionId:t.compositionId+"",compositions:t.compositions.map((function(t){return kl(t,{plugins:r,requires:n})})),images:o,imgUsage:t._imgs,binUsage:t.binUsage,spines:t.spines,requires:t.requires,textures:s,bins:(t.bins||[]).slice()};t._textures&&(a._textures=t._textures);return a}(t)));Dl=!1;var r=Nl.exec(t.version)||[],i=Number(r[1]),n=Number(r[2]);if(i)return(i<2||2===i&&n<4)&&(t=function(t){return t.compositions.map((function(t){for(var e,r=wn(t.items);!(e=r()).done;)Il(e.value.content)})),t}(t)),i<3?Pl(Ml(t)):t;throw new Error("Invalid JSON version: "+t.version+".")}var Ul="1.0";function Bl(t,e,r){var i=r[e],n=t.oriY;if("string"==typeof t)return{id:ei(),renderLevel:i,url:t,oriY:n};if(t.template)return{id:ei(),url:t.url,template:t.template,webp:t.webp,renderLevel:i,oriY:n};if(t.compressed)return{id:ei(),url:t.url,oriY:n,compressed:{astc:t.compressed.android,pvrtc:t.compressed.iOS},webp:t.webp,renderLevel:i};if(t.url)return{id:ei(),url:t.url,webp:t.webp,renderLevel:i,oriY:n};if(t&&t.sourceType)return t;throw new Error("Invalid image type.")}function kl(t,e){var r;void 0===e&&(e={});var i={id:t.id+"",camera:to({clipMode:0},t.camera),duration:t.duration,endBehavior:t.endBehavior,items:t.items.map((function(t){return Hl(t,e)})),name:t.name},n=t.startTime||t.st;n&&(i.startTime=n);var o=null==(r=t.meta)?void 0:r.previewSize;return o&&o[0]===o[1]&&0===o[0]&&(o=void 0),o&&(i.previewSize=o),i}var zl,Gl=[0,0,0,1],Xl=.5;function Hl(t,e){var r;void 0===e&&(e={});var i,n,o,s,a,u,c=gi.base,h=t.endBehavior,l=NaN;if(t.content?(c=t.type||gi.plugin,u=t.pn,a=t.pluginName,o=t.content,n=t.content,isNaN(u)&&!a&&(a=o.options.type),t.duration&&(l=t.duration),i=t.transform||y(n.transform)):t.particle?(c=gi.particle,i=y((n=t.particle).transform,Dl,!0),o=function(t){var e=t.options,r=t.transform,i={type:di.NONE};if(t.shape){var n,o=null==(n=t.shape.shape)?void 0:n.replace(/([A-Z])/g,"_$1").toUpperCase().replace(/^_/,"");if(i=to({},t.shape,{type:di[o]}),t.shape.upDirection){var s=t.shape.upDirection,a=s[0],u=s[1],c=s[2];0===a&&0===u&&0===c&&delete i.upDirection}}e.startTurbulence&&(i.turbulenceX=fl(e.turbulenceX),i.turbulenceY=fl(e.turbulenceY),i.turbulenceZ=fl(e.turbulenceZ));var h=t.emission;h.bursts&&h.bursts.length>0&&(h.bursts=h.bursts.map((function(t){return gl(t)}))),h.burstOffsets&&h.burstOffsets.length>0&&(h.burstOffsets=h.burstOffsets.map((function(t){return gl(t)}))),h.rateOverTime&&(h.rateOverTime=fl(h.rateOverTime));var l={renderer:t.renderer,shape:i,splits:t.splits,emission:h,options:{startLifetime:fl(e.startLifetime),start3DSize:!!e.start3DSize,startSize:fl(e.startSize),startSizeX:fl(e.startSizeX),startSizeY:fl(e.startSizeY),sizeAspect:fl(e.sizeAspect),maxCount:e.maxCount,startDelay:fl(e.startDelay),startColor:ll(e.startColor,!0),startRotationZ:fl(e.startRotation||e.startRotationZ),particleFollowParent:e.particleFollowParent}};e.start3DRotation&&(l.options.startRotationX=fl(e.startRotationX),l.options.startRotationY=fl(e.startRotationY)),r&&r.path&&(l.emitterTransform={path:yl(r.path)});var f=t.sizeOverLifetime;f&&(f.separateAxes?l.sizeOverLifetime={separateAxes:!0,x:fl(f.x),y:fl(f.y)}:l.sizeOverLifetime={size:fl(f.size)});var p=t.velocityOverLifetime||{},d=p.speedOverLifetime;d=d?ul(d):void 0,l.positionOverLifetime={gravity:e.gravity,gravityOverLifetime:ul(e.gravityModifier),startSpeed:fl(e.startSpeed),speedOverLifetime:d,asMovement:p.asMovement,linearX:fl(p.linearX),linearY:fl(p.linearY),linearZ:fl(p.linearZ),asRotation:p.asRotation,orbCenter:p.orbCenter,orbitalX:fl(p.orbitalX),orbitalY:fl(p.orbitalY),orbitalZ:fl(p.orbitalZ),forceTarget:p.forceTarget,target:p.target,forceCurve:ul(p.forceCurve)},_l(l.positionOverLifetime);var m=t.rotationOverLifetime;m&&(l.rotationOverLifetime={separateAxes:m.separateAxes,asRotation:m.asRotation,z:fl(m.separateAxes?m.z:m.angularVelocity)},m.separateAxes&&(l.rotationOverLifetime.y=ul(m.y),l.rotationOverLifetime.x=ul(m.x)));var v=t.colorOverLifetime;if(v){var y=l.colorOverLifetime={opacity:ul(v.opacity)};v.color&&(y.color=vl(v.color))}var g=t.textureSheetAnimation;g&&(l.textureSheetAnimation={row:g.row,col:g.col,total:g.total,animate:g.animate,cycles:ul(g.cycles),animationDelay:cl(g.animationDelay,0),animationDuration:cl(g.animationDuration,0)});var _=t.trails;_&&(l.trails={lifetime:fl(_.lifetime),dieWithParticles:_.dieWithParticles,maxPointPerTrail:_.maxPointPerTrail,minimumVertexDistance:_.minimumVertexDistance,widthOverTrail:ul(_.widthOverTrail),colorOverTrail:_.colorOverTrail&&vl(_.colorOverTrail,!1),blending:_.blending,colorOverLifetime:_.colorOverLifetime&&vl(_.colorOverLifetime,!1),inheritParticleColor:_.inheritParticleColor,occlusion:_.occlusion,transparentOcclusion:_.transparentOcclusion,orderOffset:_.orderOffset,sizeAffectsLifetime:_.sizeAffectsLifetime,sizeAffectsWidth:_.sizeAffectsWidth,texture:_.texture,parentAffectsPosition:_.parentAffectsPosition,opacityOverLifetime:fl(_.opacityOverLifetime)}),l.trails&&_l(l.trails);var E=t.interaction;return E&&(l.interaction={behavior:E.behavior,radius:E.radius,multiple:E.multiple}),l}(n)):t.sprite?(c=gi.sprite,o=function(t,e){var r=Ll(t,e),i=t.textureSheetAnimation;return i&&(r.textureSheetAnimation={row:i.row,col:i.col,total:i.total||void 0,animate:i.animate}),r.renderer=t.renderer,t.splits&&(r.splits=t.splits),t.interaction&&(r.interaction=t.interaction),r}(n=t.sprite,i=y(n.transform,!1,!0))):t.cal?(c=gi.null,o=Ll(n=t.cal,i=y(n.transform,!1,!0))):t.ui?(c=gi.interact,i=y((n=t.ui).transform),o=function(t){var e,r=t.options;switch(r.type){case"click":e={type:vi.CLICK,showPreview:r.showPreview,previewColor:r.previewColor&&hl(r.previewColor),behavior:r.behavior||yi.NOTIFY};break;case"drag":e={type:vi.DRAG,enableInEditor:!!r.enableInEditor,dxRange:r.dxRange,dyRange:r.dyRange,target:r.target};break;case"message":e={type:vi.MESSAGE}}return{options:e}}(n),i.scale=[n.options.width||1,n.options.height||1,1]):t.model&&(n=t.model,1===t.model.options.type&&(c=gi.camera,i=y(n.transform),o=function(t){var e,r=t.options,i={options:{fov:r.fov,far:r.far,near:r.near,clipMode:r.clipMode}},n=t.velocityOverLifetime;if(n||(null==(e=t.transform)?void 0:e.path)){var o,s={path:yl(null==(o=t.transform)?void 0:o.path),linearX:ul(null==n?void 0:n.translateX),linearY:ul(null==n?void 0:n.translateY),linearZ:ul(null==n?void 0:n.translateZ)};_l(s),i.positionOverLifetime=s}var a=t.rotationOverLifetime;if(a){var u={separateAxes:a.separateAxes,x:ul(null==a?void 0:a.rotateX),y:ul(null==a?void 0:a.rotateY),z:a.separateAxes?ul(null==a?void 0:a.rotateZ):ul(a.rotation)};_l(u),i.rotationOverLifetime=u}return i}(n))),null==(r=o.renderer)?void 0:r.anchor){var f=new Float32Array(o.renderer.anchor);f[0]==Xl&&f[1]==Xl?delete o.renderer.anchor:e.requires&&al(e.requires,"anchor")}if(n){var p,d,m=null==(p=n.options)?void 0:p.looping;if(m)h=Array.isArray(m)?m[1]?Mi.restart:Mi.destroy:Mi.restart;else h=h||(null==n||null==(d=n.options)?void 0:d.endBehavior)||Mi.destroy;n.options.renderLevel&&(s=n.options.renderLevel),isNaN(l)&&(l=n.options.duration)}var v={type:c,name:t.name,delay:t.delay,duration:l,id:t.id+"",transform:i,endBehavior:h,renderLevel:s,content:o};return a?e.plugins?(al(e.plugins,a),v.pn=e.plugins.indexOf(a)):v.pluginName=a:Number.isInteger(u)&&(v.pn=u),t.parentId&&(v.parentId=t.parentId+""),v;function y(t,e,r){if(t){var i={},n=t.rotation;if(n&&(i.rotation=e?[-n[0],-n[1],-n[2]]:[n[0],n[1],n[2]],r)){var o=(s=Gl,a=i.rotation[0],u=i.rotation[1],c=i.rotation[2],h=xl(a*bl/2),l=xl(u*bl/2),f=xl(c*bl/2),p=Tl(a*bl/2),d=Tl(u*bl/2),m=Tl(c*bl/2),s[0]=p*l*f+h*d*m,s[1]=h*d*f-p*l*m,s[2]=h*l*m+p*d*f,s[3]=h*l*f-p*d*m,s);i.rotation=function(t,e){var r,i,n,o=e[0],s=e[1],a=e[2],u=e[3],c=o+o,h=s+s,l=a+a,f=o*c,p=s*c,d=s*h,m=a*l,v=u*l,y=1-d-m,g=p-v,_=p+v,E=1-f-m,x=a*c-u*h,T=a*h+u*c,b=1-f-d;return t[1]=Math.asin((i=-1,(r=-x)>(n=1)?n:r<i?i:r))*Al,Math.abs(x)<.9999999?(t[0]=Math.atan2(T,b)*Al,t[2]=Math.atan2(_,y)*Al):(t[0]=0,t[2]=Math.atan2(-g,E)*Al),t}([],o)}return t.position&&(i.position=t.position),Array.isArray(t.scale)&&(i.scale=[t.scale[0]||1,t.scale[1]||1,t.scale[2]||1]),i}var s,a,u,c,h,l,f,p,d,m;return{}}}var jl,Yl=((zl={})[hi.S]=[hi.S,hi.BPlus,hi.APlus],zl[hi.A]=[hi.A,hi.BPlus,hi.APlus],zl[hi.B]=[hi.B,hi.BPlus],zl);function Wl(t,e){if(!t||!e)return!0;var r=Yl[e];return!!r&&r.includes(t)}function Zl(t,e){var r,i,n=null!=(i=null==t?void 0:t.background)?i:{},o=n.name,s=n.url;return o&&(e&&e[o]?r=e[o]:s&&(r=s)),r}function ql(t,e,r){return Kl.apply(this,arguments)}function Kl(){return Kl=cr((function(t,e,i){var n,o;return pr(this,(function(s){switch(s.label){case 0:return"string"!=typeof t?[3,2]:[4,uo(t)];case 1:return n=s.sent(),[3,3];case 2:n=t,s.label=3;case 3:if(!n)throw new Error("Image not provided.");if(!e)return[2,n];if(o=Zl(e,i)){if(Zr(o)&&o!==n.src)return[2,uo(o)];if(hr(o,r.HTMLImageElement))return[2,o]}return[2,n]}}))})),Kl.apply(this,arguments)}exports.Scene=void 0,(jl=exports.Scene||(exports.Scene={})).isJSONObject=function(t){return Qr(t)&&"jsonScene"in t},jl.isURL=function(t){return Qr(t)&&"url"in t},jl.isWithOptions=function(t){return Qr(t)&&"options"in t};var Ql=1,Jl=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e=new eo),this.options=t,this.downloader=e,this.assets={},this.sourceFrom={},this.id=Ql++,this.timers=[],this.updateOptions(t)}var e=t.prototype;return e.updateOptions=function(t){void 0===t&&(t={}),this.options=t,t.pluginData||(t.pluginData={});var e=t.timeout,r=void 0===e?10:e;this.timeout=r},e.loadScene=function(t,e,i){var n=this;return cr((function(){var o,s,a,u,c,h,l,f,p,d,m,v,y;return pr(this,(function(g){return s=Zr(t)?t:n.id,a=r.performance.now(),u=[],c=null==e?void 0:e.engine.gpuCapability,l=null!=(h=null==c?void 0:c.detail.compressedTexture)?h:exports.COMPRESSED_TEXTURE.NONE,f={},d=!1,m=new Promise((function(t,e){p=r.window.setTimeout((function(){d=!0,n.removeTimer(p);var t=r.performance.now()-a;e(new Error("Load time out: totalTime: "+t.toFixed(4)+"ms "+u.join(" ")+", url: "+s+"."))}),1e3*n.timeout),n.timers.push(p)})),v=cr((function(t,e){var i,n,o,s;return pr(this,(function(a){switch(a.label){case 0:if(d)return[3,4];i=r.performance.now(),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e()];case 2:return n=a.sent(),o=r.performance.now()-i,u.push("["+t+": "+o.toFixed(2)+"]"),f[t]=o,[2,n];case 3:throw s=a.sent(),new Error("Load error in "+t+", "+s+".");case 4:throw new Error("Load canceled.")}}))})),y=cr((function(){var c,h,d,m,y,g,_,E,x,T,b,A,R,S,C,O,M,P,I,w;return pr(this,(function(L){switch(L.label){case 0:return Zr(t)?(h=new r.URL(t,r.location.href).href,n.baseUrl=h,[4,v("loadJSON",(function(){return n.loadJSON(h)}))]):[3,2];case 1:return o=L.sent(),[3,3];case 2:o=t,n.baseUrl=r.location.href,L.label=3;case 3:return exports.Scene.isJSONObject(o)?(c=to({},o),d=c.jsonScene,m=c.pluginSystem,y=c.images,g=d.compositions,_=d.images,n.assignImagesToAssets(_,y),[4,Promise.all([v("plugin:processAssets",(function(){return n.processPluginAssets(d,m,i)})),v("plugin:precompile",(function(){return n.precompile(g,m,e,i)}))])]):[3,5];case 4:return L.sent(),[3,10];case 5:return[4,v("processJSON",(function(){return n.processJSON(o)}))];case 6:return E=L.sent(),x=E.jsonScene,T=E.pluginSystem,b=x.bins,A=void 0===b?[]:b,R=x.images,S=x.compositions,C=x.fonts,[4,Promise.all([v("processBins",(function(){return n.processBins(A)})),v("processImages",(function(){return n.processImages(R,l)})),v("plugin:processAssets",(function(){return n.processPluginAssets(x,T,i)})),v("plugin:precompile",(function(){return n.precompile(S,T,e,i)})),v("processFontURL",(function(){return n.processFontURL(C)}))])];case 7:return O=L.sent(),M=O[0],P=O[1],[4,v("processTextures",(function(){return n.processTextures(P,M,x)}))];case 8:return I=L.sent(),c={timeInfos:f,url:t,renderLevel:n.options.renderLevel,storage:{},pluginSystem:T,jsonScene:x,bins:M,images:P,textureOptions:I},[4,v("plugin:prepareResource",(function(){return T.loadResources(c,n.options)}))];case 9:L.sent(),L.label=10;case 10:return[4,v("prepareAssets",(function(){return n.prepareAssets(null==e?void 0:e.engine)}))];case 11:return L.sent(),w=r.performance.now()-a,Yr.info("Load asset: totalTime: "+w.toFixed(4)+"ms "+u.join(" ")+", url: "+s+"."),r.window.clearTimeout(p),n.removeTimer(p),c.totalTime=w,c.startTime=a,c.timeInfos=f,[2,c]}}))})),[2,Promise.race([m,y()])]}))}))()},e.precompile=function(t,e,r,i){return cr((function(){return pr(this,(function(n){switch(n.label){case 0:return r&&r.getShaderLibrary()?[4,e.precompile(t,r,i)]:[2];case 1:return n.sent(),[2]}}))}))()},e.processJSON=function(t){var e=this;return cr((function(){var r,i,n;return pr(this,(function(o){switch(o.label){case 0:return r=Vl(t),i=r.plugins,[4,(n=new ui(void 0===i?[]:i)).processRawJSON(r,e.options)];case 1:return o.sent(),[2,{jsonScene:r,pluginSystem:n}]}}))}))()},e.processBins=function(t){var e=this;return cr((function(){var i,n,o;return pr(this,(function(s){return i=e.options.renderLevel,n=e.baseUrl,o=t.map((function(o){if(hr(o,ArrayBuffer))return o;if(Wl(o.renderLevel,i))return e.loadBins(new r.URL(o.url,n).href);throw new Error("Invalid bins source: "+JSON.stringify(t)+".")})),[2,Promise.all(o)]}))}))()},e.processFontURL=function(e){var i=this;return cr((function(){var n;return pr(this,(function(o){return e?(n=e.map(cr((function(e){var n,o,s;return pr(this,(function(a){switch(a.label){case 0:if(!e.fontURL||t.fontCache.has(e.fontFamily))return[3,4];Gr(e.fontFamily)||console.warn("Risky font family: "+e.fontFamily+"."),a.label=1;case 1:return a.trys.push([1,3,,4]),n=new r.URL(e.fontURL,i.baseUrl).href,[4,(s=new FontFace(null!=(o=e.fontFamily)?o:"","url("+n+")")).load()];case 2:return a.sent(),r.document.fonts.add(s),t.fontCache.add(e.fontFamily),[3,4];case 3:return a.sent(),Yr.warn("Invalid font family or font source: "+JSON.stringify(e.fontURL)+"."),[3,4];case 4:return[2]}}))}))),[2,Promise.all(n)]):[2]}))}))()},e.processImages=function(t,e){void 0===e&&(e=0);var i=this;return cr((function(){var n,o,s,a,u,c,h,l;return pr(this,(function(f){switch(f.label){case 0:return n=i.options,o=n.useCompressedTexture,s=n.variables,a=n.disableWebP,u=n.disableAVIF,c=i.baseUrl,h=t.map(cr((function(t,n){var h,l,f,p,d,m,v,y,g,_,E,x,T,b,A,R,S,C,O,M,P;return pr(this,(function(n){switch(n.label){case 0:if(h=t.url,l=t.webp,f=t.avif,p=new r.URL(h,c).href,d=!a&&l?new r.URL(l,c).href:void 0,m=!u&&f?new r.URL(f,c).href:void 0,v=t.id,!("template"in t))return[3,8];if(y=t.template,!(g=y.background))return[3,7];_=Zl(y,s),E=g.type===Wi.video,x=g&&E?po:uo,n.label=1;case 1:return n.trys.push([1,6,,7]),[4,vo(_,x)];case 2:return hr(T=n.sent(),r.HTMLVideoElement)?(i.sourceFrom[v]={url:T.src,type:exports.TextureSourceType.video},[2,T]):[3,3];case 3:return g&&Array.isArray(_)&&s&&(s[g.name]=T.src),i.sourceFrom[v]={url:T.src,type:exports.TextureSourceType.image},[4,ql(T,y,s)];case 4:return[2,n.sent()];case 5:return[3,7];case 6:throw b=n.sent(),new Error("Failed to load. Check the template or if the URL is "+(E?"video":"image")+" type, URL: "+_+", Error: "+(b.message||b)+".");case 7:return[3,9];case 8:if("compressed"in t&&o&&e){if(A=t.compressed,e===exports.COMPRESSED_TEXTURE.ASTC?R=A.astc:e===exports.COMPRESSED_TEXTURE.PVRTC&&(R=A.pvrtc),R)return S=new r.URL(R,c).href,i.sourceFrom[v]={url:S,type:exports.TextureSourceType.compressed},[2,i.loadBins(S)]}else if(hr(t,r.HTMLImageElement)||hr(t,r.HTMLCanvasElement)||hr(t,r.HTMLVideoElement)||hr(t,bo))return[2,t];n.label=9;case 9:return m?[4,so(p,m)]:[3,11];case 10:return P=n.sent(),[3,13];case 11:return[4,no(p,d)];case 12:P=n.sent(),n.label=13;case 13:return O=(C=P).url,M=C.image,i.sourceFrom[v]={url:O,type:exports.TextureSourceType.image},[2,M]}}))}))),[4,Promise.all(h)];case 1:return l=f.sent(),i.assignImagesToAssets(t,l),[2,l]}}))}))()},e.processPluginAssets=function(t,e,r){var i=this;return cr((function(){var n,o,s,a,u;return pr(this,(function(c){switch(c.label){case 0:return[4,e.processAssets(t,r)];case 1:for(n=c.sent(),o=n.reduce((function(t,e){return t.assets=t.assets.concat(e.assets),t.loadedAssets=t.loadedAssets.concat(e.loadedAssets),t}),{assets:[],loadedAssets:[]}),s=o.assets,a=o.loadedAssets,u=0;u<s.length;u++)i.assets[s[u].id]=a[u];return[2]}}))}))()},e.prepareAssets=function(t){var e=this;return cr((function(){var r,i,n,o,s;return pr(this,(function(a){if(!t)return[2];for(r=wn(Object.keys(e.assets));!(i=r()).done;)n=i.value,o=e.assets[n],(s=new nl(t)).data=o,s.setInstanceId(n),t.addInstance(s);return[2]}))}))()},e.processTextures=function(t,e,i){var n=this;return cr((function(){var o,s,a;return pr(this,(function(u){return s=null!=(o=i.textures)?o:t.map((function(t,e){return{source:e}})),a=s.map(cr((function(t,o){var s,a,u,c,h,l;return pr(this,(function(f){switch(f.label){case 0:if(hr(t,bo))return[2,t];if(!("mipmaps"in t))return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,go(t,e,n.assets,i.bins)];case 2:return[2,f.sent()];case 3:throw s=f.sent(),new Error("Load texture "+o+" fails, error message: "+s+".");case 4:return a=t.source,u=t.id,h="",Qr(a)?(c=n.assets[a.id],h=a.id,[3,7]):[3,5];case 5:return"string"!=typeof a?[3,7]:[4,uo(ri(a))];case 6:c=f.sent(),f.label=7;case 7:if(c)return l=function(t,e,i){var n={id:i,dataType:qi.Texture};if(hr(t,bo))return to({},t.source,n);if(hr(t,r.HTMLImageElement)||Jr(t))return to({image:t,sourceType:exports.TextureSourceType.image,sourceFrom:e,keepImageSource:!0,minFilter:jn.LINEAR,magFilter:jn.LINEAR},n);if(hr(t,r.HTMLVideoElement))return to({sourceType:exports.TextureSourceType.video,video:t,minFilter:jn.LINEAR,magFilter:jn.LINEAR},n);if(hr(t,ArrayBuffer))return to({},Mo(t),{sourceFrom:e},n);if("width"in t&&"height"in t&&"data"in t)return to({sourceType:exports.TextureSourceType.data,data:t,wrapS:jn.CLAMP_TO_EDGE,wrapT:jn.CLAMP_TO_EDGE,minFilter:jn.NEAREST,magFilter:jn.NEAREST},n);throw new Error("Invalid texture options.")}(c,n.sourceFrom[h],u),[2,l.sourceType===exports.TextureSourceType.compressed?l:to({},l,t)];throw new Error("Invalid texture source: "+a+".")}}))}))),[2,Promise.all(a)]}))}))()},e.loadJSON=function(t){var e=this;return cr((function(){return pr(this,(function(r){return[2,new Promise((function(r,i){e.downloader.downloadJSON(t,r,(function(e,r){i("Couldn't load JSON "+JSON.stringify(t)+": status "+e+", "+r)}))}))]}))}))()},e.loadBins=function(t){var e=this;return cr((function(){return pr(this,(function(r){return[2,new Promise((function(r,i){e.downloader.downloadBinary(t,r,(function(e,r){i("Couldn't load bins "+JSON.stringify(t)+": status "+e+", "+r)}))}))]}))}))()},e.assignImagesToAssets=function(t,e){for(var r=0;r<t.length;r++)this.assets[t[r].id]=e[r]},e.removeTimer=function(t){var e=this.timers.indexOf(t);-1!==e&&this.timers.splice(e,1)},e.dispose=function(){this.timers.length&&this.timers.map((function(t){return r.window.clearTimeout(t)})),this.assets={},this.sourceFrom={},this.timers=[]},t}();Jl.fontCache=new Set;var $l,tf=new bn(1,1,1),ef=function(){function t(t,e){void 0===e&&(e={}),this.name=t,this.viewportMatrix=Pn.fromIdentity(),this.viewMatrix=Pn.fromIdentity(),this.projectionMatrix=Pn.fromIdentity(),this.viewProjectionMatrix=Pn.fromIdentity(),this.inverseViewMatrix=Pn.fromIdentity(),this.dirty=!0;var r=e.near,i=void 0===r?.1:r,n=e.far,o=void 0===n?20:n,s=e.fov,a=void 0===s?60:s,u=e.aspect,c=void 0===u?1:u,h=e.clipMode,l=void 0===h?Si.portrait:h,f=e.position,p=void 0===f?[0,0,8]:f,d=e.rotation,m=void 0===d?[0,0,0]:d;this.options={near:i,far:o,fov:a,aspect:c,clipMode:l,position:bn.fromArray(p),rotation:Wo.fromArray(m)},this.dirty=!0,this.updateMatrix()}var e=t.prototype;return e.setViewportMatrix=function(t){this.viewportMatrix=t.clone(),this.dirty=!0},e.getViewportMatrix=function(){return this.viewportMatrix},e.getViewMatrix=function(){return this.updateMatrix(),this.viewMatrix.clone()},e.getInverseViewMatrix=function(){return this.updateMatrix(),this.inverseViewMatrix.clone()},e.getProjectionMatrix=function(){return this.updateMatrix(),this.projectionMatrix.clone()},e.getInverseProjectionMatrix=function(){var t;return this.updateMatrix(),null==(t=this.inverseProjectionMatrix)?void 0:t.clone()},e.getViewProjectionMatrix=function(){return this.updateMatrix(),this.viewProjectionMatrix.clone()},e.getInverseViewProjectionMatrix=function(){return this.updateMatrix(),this.inverseViewProjectionMatrix||(this.inverseViewProjectionMatrix=this.viewProjectionMatrix.clone(),this.inverseViewProjectionMatrix.invert()),this.inverseViewProjectionMatrix.clone()},e.getModelViewProjection=function(t,e){return t.multiplyMatrices(this.viewProjectionMatrix,e)},e.getInverseVPRatio=function(t){var e=new bn(this.position.x,this.position.y,t),r=this.getViewProjectionMatrix(),i=this.getInverseViewProjectionMatrix();if(!this.viewportMatrix.isIdentity()){var n=this.viewportMatrix.clone();i.premultiply(n),r.multiply(n.invert())}var o=r.projectPoint(e).z,s=i.projectPoint(new bn(1,1,o)),a=s.x,u=s.y,c=i.projectPoint(new bn(-1,-1,o)),h=c.x,l=c.y;return new bn((a-h)/2,(u-l)/2,0)},e.setQuat=function(t){void 0===this.options.quat?(this.options.quat=t.clone(),this.dirty=!0):this.options.quat.equals(t)||(this.options.quat.copyFrom(t),this.dirty=!0),this.dirty&&this.setRotationByQuat(t)},e.getQuat=function(){var t=this.options.quat;if(void 0===t){t=new Cn;var e=this.options.rotation;e&&t.setFromEuler(e),this.options.quat=t}return t},e.getOptions=function(){return this.options},e.copy=function(t){var e=t.near,r=t.far,i=t.fov,n=t.clipMode,o=t.aspect,s=t.position,a=t.rotation;this.near=e,this.far=r,this.fov=i,this.clipMode=n,this.aspect=o,this.position=s,this.rotation=a,this.updateMatrix()},e.updateMatrix=function(){if(this.dirty){var t=this.options,e=t.fov,r=t.aspect,i=t.near,n=t.far,o=t.clipMode,s=t.position;this.projectionMatrix.perspective(e*vn,r,i,n,o===Si.portrait),this.projectionMatrix.premultiply(this.viewportMatrix),this.inverseViewMatrix.compose(s,this.getQuat(),tf),this.viewMatrix.copyFrom(this.inverseViewMatrix).invert(),this.viewProjectionMatrix.multiplyMatrices(this.projectionMatrix,this.viewMatrix),this.inverseViewProjectionMatrix=null,this.dirty=!1}},e.setRotationByQuat=function(t){Bu.getRotation(t,this.options.rotation)},nn(t,[{key:"near",get:function(){return this.options.near},set:function(t){this.options.near!==t&&(this.options.near=t,this.dirty=!0)}},{key:"far",get:function(){return this.options.far},set:function(t){this.options.far!==t&&(this.options.far=t,this.dirty=!0)}},{key:"fov",get:function(){return this.options.fov},set:function(t){this.options.fov!==t&&(this.options.fov=t,this.dirty=!0)}},{key:"aspect",get:function(){return this.options.aspect},set:function(t){this.options.aspect!==t&&(this.options.aspect=t,this.dirty=!0)}},{key:"clipMode",get:function(){return this.options.clipMode},set:function(t){void 0!==t&&this.options.clipMode!==t&&(this.options.clipMode=t,this.dirty=!0)}},{key:"position",get:function(){return this.options.position.clone()},set:function(t){this.options.position.equals(t)||(this.options.position.copyFrom(t),this.dirty=!0)}},{key:"rotation",get:function(){return this.options.rotation.clone()},set:function(t){this.options.rotation.equals(t)||(this.options.rotation.copyFrom(t),this.dirty=!0,this.options.quat=void 0)}}]),t}(),rf=function(){function t(t,e){this.refCompositionProps=new Map,this.imgUsage={},this.mask=0,this.refCompositions=new Map,this.engine=e;var r=t.jsonScene,i=t.renderLevel,n=t.textureOptions,o=t.pluginSystem,s=t.totalTime,a=r.compositions,u=r.compositionId;if(!n)throw new Error("scene.textures expected.");for(var c,h=n,l=wn(a);!(c=l()).done;){var f=c.value;f.id===u?this.composition=f:this.refCompositions.set(f.id,f)}if(!this.composition)throw new Error("Invalid composition id: "+u+".");this.jsonScene=r,this.renderLevel=i,this.pluginSystem=o,this.totalTime=null!=s?s:0,this.textures=h,this.sourceContent=this.getContent(this.composition)}var e=t.prototype;return e.getContent=function(t){var e=to({},t);return this.assembleItems(e),isNaN(e.endBehavior)&&(e.endBehavior=Mi.freeze),e.startTime||(e.startTime=0),e},e.assembleItems=function(t){this.mask++;var e={},r=[];if(this.jsonScene){for(var i,n=wn(this.jsonScene.components);!(i=n()).done;){var o=i.value;e[o.id]=o}for(var s,a=wn(t.items);!(s=a()).done;){var u=s.value,c=this.engine.jsonSceneData[u.id],h=c;if(Wl(c.renderLevel,this.renderLevel)){if(h.type===gi.sprite||h.type===gi.particle||h.type===gi.spine||h.type===gi.shape)for(var l,f=wn(h.components);!(l=f()).done;){var p=e[l.value.id];this.preProcessItemContent(p)}if(h.type===gi.composition){var d=c.content.options.refId,m=this.refCompositions.get(d);if(!m)throw new Error("Invalid ref composition id: "+d+".");var v=this.getContent(m);this.refCompositionProps.has(d)||this.refCompositionProps.set(d,v)}r.push(u)}}t.items=r}},e.preProcessItemContent=function(t){if(t.renderer){t.renderer=this.changeTex(t.renderer),"mask"in t.renderer||this.processMask(t.renderer);var e,r,i=t.splits&&!t.textureSheetAnimation?t.splits[0]:void 0,n=t.renderer.shape;if(Number.isInteger(n))e=null==(r=this.jsonScene)?void 0:r.shapes[n];else n&&(e=n);void 0===e||"aPoint"in e&&"index"in e||(t.renderer.shape=Uc(e,i))}"trails"in t&&void 0!==t.trails&&(t.trails=this.changeTex(t.trails))},e.changeTex=function(t){if(!t.texture)return t;var e=t.texture.id;return void 0!==e&&this.addTextureUsage(e),t},e.addTextureUsage=function(t){var e,r=null!=(e=this.imgUsage)?e:{};t&&r&&(Object.prototype.hasOwnProperty.call(r,t)||(r[t]=0),r[t]++)},e.processMask=function(t){var e=t.maskMode;e!==pi.NONE&&(t.mask||(e===pi.MASK?t.mask=++this.mask:e!==pi.OBSCURED&&e!==pi.REVERSE_OBSCURED||(t.mask=this.mask)))},e.dispose=function(){this.textures=[],this.composition=void 0,this.jsonScene=void 0,this.totalTime=0,this.pluginSystem=void 0,this.sourceContent=void 0,this.refCompositions.clear(),this.refCompositionProps.clear()},t}(),nf=function(){function t(){this.update=new sf,this.lateUpdate=new af}var e=t.prototype;return e.addComponent=function(t){t.onUpdate!==fn.prototype.onUpdate&&this.update.addComponent(t),t.onLateUpdate!==fn.prototype.onLateUpdate&&this.lateUpdate.addComponent(t)},e.removeComponent=function(t){t.onUpdate!==fn.prototype.onUpdate&&this.update.removeComponent(t),t.onLateUpdate!==fn.prototype.onLateUpdate&&this.lateUpdate.removeComponent(t)},e.clear=function(){this.update.clear(),this.lateUpdate.clear()},t}(),of=function(){function t(){this.components=[],this.ticks=[]}var e=t.prototype;return e.tick=function(t){this.tickComponents(this.components,t);for(var e=0;e<this.ticks.length;e++)this.ticks[e](t)},e.tickComponents=function(t,e){},e.addComponent=function(t){this.components.includes(t)||this.components.push(t)},e.removeComponent=function(t){var e=this.components.indexOf(t);e>-1&&this.components.splice(e,1)},e.addTick=function(t,e){var r=t.bind(e);this.ticks.includes(r)||this.ticks.push(r)},e.clear=function(){this.components=[]},t}(),sf=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.tickComponents=function(t,e){for(var r,i=wn(t);!(r=i()).done;){r.value.onUpdate(e)}},e}(of),af=function(t){function e(){return t.apply(this,arguments)}return Ri(e,t),e.prototype.tickComponents=function(t,e){for(var r,i=wn(t);!(r=i()).done;){r.value.onLateUpdate(e)}},e}(of),uf=function(t){function e(e,r){var i,n;(i=t.call(this)||this).sceneTicking=new nf,i.speed=1,i.isEnded=!1,i.loaderData={},i.refContent=[],i.refCompositionProps=new Map,i.postProcessingEnabled=!1,i.assigned=!1,i.destroyed=!1,i.postLoaders=[],i.paused=!1,i.lastVideoUpdateTime=0,i.isEndCalled=!1;var o=e.reusable,s=void 0!==o&&o,a=e.speed,u=void 0===a?1:a,c=e.baseRenderOrder,h=void 0===c?0:c,l=e.renderer,f=e.event,p=e.width,d=e.height,m=e.handleItemMessage;i.compositionSourceManager=new rf(r,l.engine),s&&(i.keepResource=!0,r.textures=void 0,r.consumed=!0);var v,y,g=i.compositionSourceManager,_=g.sourceContent,E=g.pluginSystem,x=g.imgUsage,T=g.totalTime,b=g.refCompositionProps;return i.postProcessingEnabled=null!=(v=null==(n=r.jsonScene.renderSettings)?void 0:n.postProcessingEnabled)&&v,zr(_),i.renderer=l,i.refCompositionProps=b,i.rootItem=new exports.VFXItem(i.getEngine(),_),i.rootItem.name="rootItem",i.rootItem.composition=Sn(i),i.rootComposition=i.rootItem.addComponent(Dh),i.width=p,i.height=d,i.renderOrder=h,i.id=_.id,i.renderer=l,i.texInfo=s?{}:x,i.event=f,i.statistic={loadStart:null!=(y=r.startTime)?y:0,loadTime:null!=T?T:0,compileTime:0,firstFrameTime:0},i.reusable=s,i.speed=u,i.autoRefTex=!i.keepResource&&i.texInfo&&i.rootItem.endBehavior!==Mi.restart,i.name=_.name,i.pluginSystem=E,i.pluginSystem.initializeComposition(Sn(i),r),i.camera=new ef(i.name,to({},null==_?void 0:_.camera,{aspect:p/d})),i.url=r.url,i.assigned=!0,i.interactive=!0,i.handleItemMessage=m,i.createRenderFrame(),i.rendererOptions=null,Nh.deserialize(_,i.rootComposition),i.rootComposition.createContent(),i.buildItemTree(i.rootItem),i.rootComposition.setChildrenRenderOrder(0),i.pluginSystem.resetComposition(Sn(i),i.renderFrame),i}Ri(e,t);var i=e.prototype;return i.getDuration=function(){return this.rootItem.duration},i.restart=function(){this.reset(),this.forwardTime(this.startTime)},i.setIndex=function(t){this.renderOrder=t},i.getIndex=function(){return this.renderOrder},i.setSpeed=function(t){this.speed=t},i.setVisible=function(t){this.rootItem.setVisible(t)},i.getSpeed=function(){return this.speed},i.play=function(){this.isEnded&&this.reusable&&this.restart(),this.rootComposition.isStartCalled?this.gotoAndPlay(this.time-this.startTime):this.gotoAndPlay(0)},i.pause=function(){this.paused=!0},i.getPaused=function(){return this.paused},i.resume=function(){this.paused=!1},i.gotoAndPlay=function(t){this.setTime(t),this.resume()},i.gotoAndStop=function(t){this.setTime(t),this.pause()},i.createRenderFrame=function(){this.renderFrame=new Ms({camera:this.camera,renderer:this.renderer,keepColorBuffer:this.keepColorBuffer,globalVolume:this.globalVolume,postProcessingEnabled:this.postProcessingEnabled}),this.renderFrame.cachedTextures=this.textures},i.setTime=function(t){var e=this.speed,r=this.paused;r&&this.resume(),this.setSpeed(1),this.forwardTime(t+this.startTime),this.setSpeed(e),r&&this.pause(),this.emit("goto",{time:t})},i.addItem=function(t){this.items.push(t),t.setParent(this.rootItem)},i.forwardTime=function(t){for(var e=1e3*t-1e3*this.rootComposition.time,r=e<0,i=Math.abs(e),n=r?-15:15;i>15;i-=15)this.update(n);this.update(r?-i:i)},i.reset=function(){this.rendererOptions=null,this.isEnded=!1,this.isEndCalled=!1,this.rootComposition.time=0,this.pluginSystem.resetComposition(this,this.renderFrame)},i.prepareRender=function(){var t=this,e=this.renderFrame;this.postLoaders.length=0,this.pluginSystem.plugins.forEach((function(r){r.prepareRenderFrame(t,e)&&t.postLoaders.push(r)})),this.postLoaders.forEach((function(r){return r.postProcessFrame(t,e)}))},i.update=function(t){if(this.assigned&&!this.paused){var e=parseFloat(this.getUpdateTime(t*this.speed).toFixed(0));this.updateRootComposition(e/1e3),this.updateVideo(),this.updatePluginLoaders(t),this.rootItem.isDuringPlay||(this.callAwake(this.rootItem),this.rootItem.beginPlay()),this.sceneTicking.update.tick(e),this.sceneTicking.lateUpdate.tick(e),this.updateCamera(),this.prepareRender(),this.isEnded&&!this.isEndCalled&&(this.isEndCalled=!0,this.emit("end",{composition:this})),this.shouldDispose()&&this.dispose()}},i.shouldDispose=function(){return this.isEnded&&this.rootItem.endBehavior===Mi.destroy&&!this.reusable},i.getUpdateTime=function(t){var e=1e3*this.startTime,r=1e3*this.rootComposition.time;return t<0&&r+t<e?e-r:t},i.callAwake=function(t){for(var e,r=wn(t.components);!(e=r()).done;){var i=e.value;i.isAwakeCalled||(i.onAwake(),i.isAwakeCalled=!0)}for(var n,o=wn(t.children);!(n=o()).done;){var s=n.value;this.callAwake(s)}},i.buildItemTree=function(t){if(t.composition){for(var e,r=new Map,i=t.getComponent(Dh).items,n=wn(i);!(e=n()).done;){var o=e.value;r.set(o.id,o)}for(var s,a=wn(i);!(s=a()).done;){var u=s.value;if(void 0===u.parentId)u.setParent(t);else{var c=r.get(u.parentId);if(!c)throw new Error("The element references a non-existent element, please check the data.");u.parent=c,u.transform.parentTransform=c.transform,c.children.push(u)}}for(var h,l=wn(i);!(h=l()).done;){var f=h.value;exports.VFXItem.isComposition(f)&&this.buildItemTree(f)}}},i.updateVideo=function(){var t,e=r.performance.now();e-this.lastVideoUpdateTime>33&&((null!=(t=this.textures)?t:[]).forEach((function(t){return null==t?void 0:t.uploadCurrentVideoFrame()})),this.lastVideoUpdateTime=e)},i.updateCamera=function(){this.camera.updateMatrix()},i.updatePluginLoaders=function(t){var e=this;this.pluginSystem.plugins.forEach((function(r){return r.onCompositionUpdate(e,t)}))},i.updateRootComposition=function(t){if(this.rootComposition.isActiveAndEnabled){var e=parseFloat((this.time+t-this.rootItem.start).toFixed(3)),r=!1,i=this.rootItem.duration,n=this.rootItem.endBehavior;if(e-i>.001)switch(r=!0,n){case Mi.restart:e%=i,this.restart();break;case Mi.freeze:e=Math.min(i,e);case Mi.forward:case Mi.destroy:}this.rootComposition.time=e,this.isEnded!==r&&(r?this.isEnded=!0:(this.isEnded=!1,this.isEndCalled=!1))}},i.getItemByName=function(t){return this.rootItem.find(t)},i.getHitTestRay=function(t,e){var r=this.renderFrame.editorTransform,i=r.x,n=r.y;return ra((t-r.z)/i,(e-r.w)/n,this.camera)},i.getEngine=function(){var t;return null==(t=this.renderer)?void 0:t.engine},i.hitTest=function(t,e,r,i){var n;if(this.isDestroyed||!this.interactive)return[];var o=[],s=this.getHitTestRay(t,e);return null==(n=this.rootItem.getComponent(Dh))||n.hitTest(s,t,e,o,r,i),this.refContent.forEach((function(n){var a;null==(a=n.getComponent(Dh))||a.hitTest(s,t,e,o,r,i)})),o},i.addInteractiveItem=function(t,e){if(e===vi.MESSAGE)return this.handleItemMessage({name:t.name,phrase:2,id:t.id,compositionId:this.id}),t.emit("message",{name:t.name,phrase:2,id:t.id}),t.id},i.removeInteractiveItem=function(t,e){e===vi.MESSAGE&&(this.handleItemMessage({name:t.name,phrase:1,id:t.id,compositionId:this.id}),t.emit("message",{name:t.name,phrase:1,id:t.id}))},i.destroyTextures=function(t){for(var e=0;e<t.length;e++){var r,i=t[e];if(i)if(i.sourceType!==exports.TextureSourceType.data||this.texInfo[i.getInstanceId()]){if(this.autoRefTex)--this.texInfo[i.getInstanceId()]||i.dispose()}else i!==(null==(r=this.rendererOptions)?void 0:r.emptyTexture)&&i!==this.renderFrame.transparentTexture&&i!==this.getEngine().emptyTexture&&i.dispose()}},i.destroyItem=function(t){var e=this;t.type==gi.composition?t.endBehavior!==Mi.freeze&&t.getComponent(Dh).items.forEach((function(t){return e.pluginSystem.plugins.forEach((function(r){return r.onCompositionItemRemoved(e,t)}))})):(Tr(this.items,t),this.pluginSystem.plugins.forEach((function(r){return r.onCompositionItemRemoved(e,t)})))},i.lost=function(t){this.videoState=this.textures.map((function(t){if("video"in t.source)return t.source.video.pause(),t.source.video.currentTime})),this.textures.map((function(t){return t.dispose()})),this.dispose()},i.dispose=function(){var t,e,r=this;if(!this.destroyed){this.destroyed=!0;var i={},n=this.textures;n&&this.keepResource&&n.forEach((function(t){(null==t?void 0:t.dispose)&&(i[t.id]=t.dispose,t.dispose=Wr)})),this.rootItem.dispose(),this.renderFrame.dispose(),null==(t=this.rendererOptions)||t.emptyTexture.dispose(),null==(e=this.pluginSystem)||e.destroyComposition(this),this.update=function(){Yr.error("Update disposed composition: "+r.name+".")},this.dispose=Wr,n&&this.keepResource&&n.forEach((function(t){return t.dispose=i[t.id]})),this.compositionSourceManager.dispose(),this.refCompositionProps.clear(),this.renderer.env!==Xa&&this.renderer.clear({stencilAction:exports.TextureLoadAction.clear,clearStencil:0,depthAction:exports.TextureLoadAction.clear,clearDepth:1,colorAction:exports.TextureLoadAction.clear,clearColor:[0,0,0,0]})}},i.setEditorTransform=function(t,e,r){this.renderFrame.editorTransform.set(t,t,e,r)},i.translateByPixel=function(t,e){this.renderer?this.rootItem.translateByPixel(t,e):console.warn("Renderer not assigned. Operation aborted.")},i.setPositionByPixel=function(t,e){this.renderer?this.rootItem.setPositionByPixel(t,e):console.warn("Renderer not assigned. Operation aborted.")},i.translate=function(t,e,r){this.rootItem.translate(t,e,r)},i.setPosition=function(t,e,r){this.rootItem.setPosition(t,e,r)},i.rotate=function(t,e,r){this.rootItem.rotate(t,e,r)},i.setRotation=function(t,e,r){this.rootItem.setRotation(t,e,r)},i.scale=function(t,e,r){this.rootItem.scale(t,e,r)},i.setScale=function(t,e,r){this.rootItem.setScale(t,e,r)},i.offloadTexture=function(){this.textureOffloaded||(this.textures.forEach((function(t){return t&&t.offloadData()})),this.textureOffloaded=!0)},i.getRendererOptions=function(){return this.rendererOptions||(this.rendererOptions={emptyTexture:this.renderFrame.emptyTexture,cachePrefix:"-"}),this.rendererOptions},i.reloadTexture=function(){var t=this;return cr((function(){return pr(this,(function(e){switch(e.label){case 0:return t.textureOffloaded?[4,Promise.all(t.textures.map((function(t){return null==t?void 0:t.reloadData()})))]:[3,2];case 1:e.sent(),t.textureOffloaded=!1,e.label=2;case 2:return[2]}}))}))()},nn(e,[{key:"transform",get:function(){return this.rootItem.transform}},{key:"textures",get:function(){return this.compositionSourceManager.textures}},{key:"items",get:function(){return this.rootComposition.items}},{key:"startTime",get:function(){return this.rootComposition.startTime}},{key:"time",get:function(){return this.rootComposition.time}},{key:"isDestroyed",get:function(){return this.destroyed}},{key:"viewportMatrix",get:function(){return this.camera.getViewportMatrix()},set:function(t){this.camera.setViewportMatrix(t)}}]),e}(ku),cf=new Int32Array(2),hf=new Float32Array(cf.buffer),lf=new Float64Array(cf.buffer),ff=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];!function(t){t[t.UTF8_BYTES=1]="UTF8_BYTES",t[t.UTF16_STRING=2]="UTF16_STRING"}($l||($l={}));var pf=function(){function t(t){this.bytes_=t,this.position_=0,this.text_decoder_=new r.TextDecoder}var e=t.prototype;return e.clear=function(){this.position_=0},e.bytes=function(){return this.bytes_},e.position=function(){return this.position_},e.setPosition=function(t){this.position_=t},e.capacity=function(){return this.bytes_.length},e.readInt8=function(t){return this.readUint8(t)<<24>>24},e.readUint8=function(t){return this.bytes_[t]},e.readInt16=function(t){return this.readUint16(t)<<16>>16},e.readUint16=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8},e.readInt32=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24},e.readUint32=function(t){return this.readInt32(t)>>>0},e.readInt64=function(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))},e.readUint64=function(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))},e.readFloat32=function(t){return cf[0]=this.readInt32(t),hf[0]},e.readFloat64=function(t){return cf[ff?0:1]=this.readInt32(t),cf[ff?1:0]=this.readInt32(t+4),lf[0]},e.writeInt8=function(t,e){this.bytes_[t]=e},e.writeUint8=function(t,e){this.bytes_[t]=e},e.writeInt16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},e.writeUint16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},e.writeInt32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},e.writeUint32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},e.writeInt64=function(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))},e.writeUint64=function(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))},e.writeFloat32=function(t,e){hf[0]=e,this.writeInt32(t,cf[0])},e.writeFloat64=function(t,e){lf[0]=e,this.writeInt32(t,cf[ff?0:1]),this.writeInt32(t+4,cf[ff?1:0])},e.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var t="",e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t},e.__offset=function(t,e){var r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0},e.__union=function(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t},e.__string=function(t,e){t+=this.readInt32(t);var r=this.readInt32(t);t+=4;var i=this.bytes_.subarray(t,t+r);return e===$l.UTF8_BYTES?i:this.text_decoder_.decode(i)},e.__union_with_string=function(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)},e.__indirect=function(t){return t+this.readInt32(t)},e.__vector=function(t){return t+this.readInt32(t)+4},e.__vector_len=function(t){return this.readInt32(t+this.readInt32(t))},e.__has_identifier=function(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(var e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0},e.createScalarList=function(t,e){for(var r=[],i=0;i<e;++i){var n=t(i);null!==n&&r.push(n)}return r},e.createObjList=function(t,e){for(var r=[],i=0;i<e;++i){var n=t(i);null!==n&&r.push(n.unpack())}return r},t.allocate=function(e){return new t(new Uint8Array(e))},t}(),df=function(){function t(t){var e;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,e=t||1024,this.bb=pf.allocate(e),this.space=e}var e=t.prototype;return e.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null},e.forceDefaults=function(t){this.force_defaults=t},e.dataBuffer=function(){return this.bb},e.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},e.prep=function(e,r){e>this.minalign&&(this.minalign=e);for(var i=1+~(this.bb.capacity()-this.space+r)&e-1;this.space<i+e+r;){var n=this.bb.capacity();this.bb=t.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(i)},e.pad=function(t){for(var e=0;e<t;e++)this.bb.writeInt8(--this.space,0)},e.writeInt8=function(t){this.bb.writeInt8(this.space-=1,t)},e.writeInt16=function(t){this.bb.writeInt16(this.space-=2,t)},e.writeInt32=function(t){this.bb.writeInt32(this.space-=4,t)},e.writeInt64=function(t){this.bb.writeInt64(this.space-=8,t)},e.writeFloat32=function(t){this.bb.writeFloat32(this.space-=4,t)},e.writeFloat64=function(t){this.bb.writeFloat64(this.space-=8,t)},e.addInt8=function(t){this.prep(1,0),this.writeInt8(t)},e.addInt16=function(t){this.prep(2,0),this.writeInt16(t)},e.addInt32=function(t){this.prep(4,0),this.writeInt32(t)},e.addInt64=function(t){this.prep(8,0),this.writeInt64(t)},e.addFloat32=function(t){this.prep(4,0),this.writeFloat32(t)},e.addFloat64=function(t){this.prep(8,0),this.writeFloat64(t)},e.addFieldInt8=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt8(e),this.slot(t))},e.addFieldInt16=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt16(e),this.slot(t))},e.addFieldInt32=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt32(e),this.slot(t))},e.addFieldInt64=function(t,e,r){(this.force_defaults||e!==r)&&(this.addInt64(e),this.slot(t))},e.addFieldFloat32=function(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat32(e),this.slot(t))},e.addFieldFloat64=function(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat64(e),this.slot(t))},e.addFieldOffset=function(t,e,r){(this.force_defaults||e!=r)&&(this.addOffset(e),this.slot(t))},e.addFieldStruct=function(t,e,r){e!=r&&(this.nested(e),this.slot(t))},e.nested=function(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")},e.notNested=function(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")},e.slot=function(t){null!==this.vtable&&(this.vtable[t]=this.offset())},e.offset=function(){return this.bb.capacity()-this.space},e.addOffset=function(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)},e.startObject=function(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(var e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()},e.endObject=function(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var t=this.offset(),e=this.vtable_in_use-1;e>=0&&0==this.vtable[e];e--);for(var r=e+1;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);var i=2*(r+2);this.addInt16(i);var n=0,o=this.space;t:for(e=0;e<this.vtables.length;e++){var s=this.bb.capacity()-this.vtables[e];if(i==this.bb.readInt16(s)){for(var a=2;a<i;a+=2)if(this.bb.readInt16(o+a)!=this.bb.readInt16(s+a))continue t;n=this.vtables[e];break}}return n?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,n-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t},e.finish=function(t,e,r){var i=r?4:0;if(e){var n=e;if(this.prep(this.minalign,8+i),4!=n.length)throw new TypeError("FlatBuffers: file identifier must be length 4");for(var o=3;o>=0;o--)this.writeInt8(n.charCodeAt(o))}this.prep(this.minalign,4+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},e.finishSizePrefixed=function(t,e){this.finish(t,e,!0)},e.requiredField=function(t,e){var r=this.bb.capacity()-t,i=r-this.bb.readInt32(r);if(!(e<this.bb.readInt16(i)&&0!=this.bb.readInt16(i+e)))throw new TypeError("FlatBuffers: field "+e+" must be set")},e.startVector=function(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(4,t*e),this.prep(r,t*e)},e.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},e.createSharedString=function(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);var e=this.createString(t);return this.string_maps.set(t,e),e},e.createString=function(t){return null==t?0:(e=hr(t,Uint8Array)?t:this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector());var e},e.createByteVector=function(t){return null==t?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())},e.createObjectOffset=function(t){return null===t?0:"string"==typeof t?this.createString(t):t.pack(this)},e.createObjectOffsetList=function(t){for(var e=[],r=0;r<t.length;++r){var i=t[r];if(null===i)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");e.push(this.createObjectOffset(i))}return e},e.createStructOffsetList=function(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()},t.growByteBuffer=function(t){var e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var r=e<<1,i=pf.allocate(r);return i.setPosition(r-e),i.bytes().set(t.bytes(),r-e),i},t}(),mf=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.dataType=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},e.data=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},e.dataLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.dataArray=function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},e.unpack=function(){return new vf(this.dataType(),this.bb.createScalarList(this.data.bind(this),this.dataLength()))},e.unpackTo=function(t){t.dataType=this.dataType(),t.data=this.bb.createScalarList(this.data.bind(this),this.dataLength())},t.getRootAsFBEffectsObjectData=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBEffectsObjectData=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBEffectsObjectData=function(t){t.startObject(2)},t.addDataType=function(t,e){t.addFieldOffset(0,e,0)},t.addData=function(t,e){t.addFieldOffset(1,e,0)},t.createDataVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()},t.startDataVector=function(t,e){t.startVector(1,e,1)},t.endFBEffectsObjectData=function(t){return t.endObject()},t.createFBEffectsObjectData=function(e,r,i){return t.startFBEffectsObjectData(e),t.addDataType(e,r),t.addData(e,i),t.endFBEffectsObjectData(e)},t}(),vf=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=[]),this.dataType=t,this.data=e}return t.prototype.pack=function(t){var e=null!==this.dataType?t.createString(this.dataType):0,r=mf.createDataVector(t,this.data);return mf.createFBEffectsObjectData(t,e,r)},t}(),yf=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.exportObjects=function(t,e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new mf).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null},e.exportObjectsLength=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0},e.unpack=function(){return new gf(this.bb.createObjList(this.exportObjects.bind(this),this.exportObjectsLength()))},e.unpackTo=function(t){t.exportObjects=this.bb.createObjList(this.exportObjects.bind(this),this.exportObjectsLength())},t.getRootAsFBEffectsPackageData=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBEffectsPackageData=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBEffectsPackageData=function(t){t.startObject(1)},t.addExportObjects=function(t,e){t.addFieldOffset(0,e,0)},t.createExportObjectsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},t.startExportObjectsVector=function(t,e){t.startVector(4,e,4)},t.endFBEffectsPackageData=function(t){return t.endObject()},t.finishFBEffectsPackageDataBuffer=function(t,e){t.finish(e)},t.finishSizePrefixedFBEffectsPackageDataBuffer=function(t,e){t.finish(e,void 0,!0)},t.createFBEffectsPackageData=function(e,r){return t.startFBEffectsPackageData(e),t.addExportObjects(e,r),t.endFBEffectsPackageData(e)},t}(),gf=function(){function t(t){void 0===t&&(t=[]),this.exportObjects=t}return t.prototype.pack=function(t){var e=yf.createExportObjectsVector(t,t.createObjectOffsetList(this.exportObjects));return yf.createFBEffectsPackageData(t,e)},t}(),_f=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.offset=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0},e.indexCount=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},e.vertexCount=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):0},e.unpack=function(){return new Ef(this.offset(),this.indexCount(),this.vertexCount())},e.unpackTo=function(t){t.offset=this.offset(),t.indexCount=this.indexCount(),t.vertexCount=this.vertexCount()},t.getRootAsFBSubMesh=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBSubMesh=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBSubMesh=function(t){t.startObject(3)},t.addOffset=function(t,e){t.addFieldInt32(0,e,0)},t.addIndexCount=function(t,e){t.addFieldInt32(1,e,0)},t.addVertexCount=function(t,e){t.addFieldInt32(2,e,0)},t.endFBSubMesh=function(t){return t.endObject()},t.createFBSubMesh=function(e,r,i,n){return t.startFBSubMesh(e),t.addOffset(e,r),t.addIndexCount(e,i),t.addVertexCount(e,n),t.endFBSubMesh(e)},t}(),Ef=function(){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.offset=t,this.indexCount=e,this.vertexCount=r}return t.prototype.pack=function(t){return _f.createFBSubMesh(t,this.offset,this.indexCount,this.vertexCount)},t}(),xf=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.semantic=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},e.offset=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},e.format=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):0},e.dimension=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):0},e.normalize=function(){var t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},e.unpack=function(){return new Tf(this.semantic(),this.offset(),this.format(),this.dimension(),this.normalize())},e.unpackTo=function(t){t.semantic=this.semantic(),t.offset=this.offset(),t.format=this.format(),t.dimension=this.dimension(),t.normalize=this.normalize()},t.getRootAsFBVertexChannel=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBVertexChannel=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBVertexChannel=function(t){t.startObject(5)},t.addSemantic=function(t,e){t.addFieldOffset(0,e,0)},t.addOffset=function(t,e){t.addFieldInt32(1,e,0)},t.addFormat=function(t,e){t.addFieldInt32(2,e,0)},t.addDimension=function(t,e){t.addFieldInt32(3,e,0)},t.addNormalize=function(t,e){t.addFieldInt8(4,+e,0)},t.endFBVertexChannel=function(t){return t.endObject()},t.createFBVertexChannel=function(e,r,i,n,o,s){return t.startFBVertexChannel(e),t.addSemantic(e,r),t.addOffset(e,i),t.addFormat(e,n),t.addDimension(e,o),t.addNormalize(e,s),t.endFBVertexChannel(e)},t}(),Tf=function(){function t(t,e,r,i,n){void 0===t&&(t=null),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=!1),this.semantic=t,this.offset=e,this.format=r,this.dimension=i,this.normalize=n}return t.prototype.pack=function(t){var e=null!==this.semantic?t.createString(this.semantic):0;return xf.createFBVertexChannel(t,e,this.offset,this.format,this.dimension,this.normalize)},t}(),bf=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.vertexCount=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0},e.channels=function(t,e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new xf).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null},e.channelsLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.unpack=function(){return new Af(this.vertexCount(),this.bb.createObjList(this.channels.bind(this),this.channelsLength()))},e.unpackTo=function(t){t.vertexCount=this.vertexCount(),t.channels=this.bb.createObjList(this.channels.bind(this),this.channelsLength())},t.getRootAsFBVertexData=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBVertexData=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBVertexData=function(t){t.startObject(2)},t.addVertexCount=function(t,e){t.addFieldInt32(0,e,0)},t.addChannels=function(t,e){t.addFieldOffset(1,e,0)},t.createChannelsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},t.startChannelsVector=function(t,e){t.startVector(4,e,4)},t.endFBVertexData=function(t){return t.endObject()},t.createFBVertexData=function(e,r,i){return t.startFBVertexData(e),t.addVertexCount(e,r),t.addChannels(e,i),t.endFBVertexData(e)},t}(),Af=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=[]),this.vertexCount=t,this.channels=e}return t.prototype.pack=function(t){var e=bf.createChannelsVector(t,t.createObjectOffsetList(this.channels));return bf.createFBVertexData(t,this.vertexCount,e)},t}(),Rf=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.id=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},e.name=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null},e.vertexData=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?(t||new bf).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null},e.indexFormat=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):0},e.indexOffset=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):0},e.subMeshes=function(t,e){var r=this.bb.__offset(this.bb_pos,14);return r?(e||new _f).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null},e.subMeshesLength=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0},e.mode=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):0},e.buffer=function(t){var e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__string(this.bb_pos+e,t):null},e.binaryData=function(t){var e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},e.binaryDataLength=function(){var t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0},e.binaryDataArray=function(){var t=this.bb.__offset(this.bb_pos,20);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},e.boneNames=function(t,e){var r=this.bb.__offset(this.bb_pos,22);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null},e.boneNamesLength=function(){var t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0},e.rootBoneName=function(t){var e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null},e.inverseBindMatrices=function(t){var e=this.bb.__offset(this.bb_pos,26);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},e.inverseBindMatricesLength=function(){var t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__vector_len(this.bb_pos+t):0},e.inverseBindMatricesArray=function(){var t=this.bb.__offset(this.bb_pos,26);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},e.unpack=function(){return new Sf(this.id(),this.name(),null!==this.vertexData()?this.vertexData().unpack():null,this.indexFormat(),this.indexOffset(),this.bb.createObjList(this.subMeshes.bind(this),this.subMeshesLength()),this.mode(),this.buffer(),this.bb.createScalarList(this.binaryData.bind(this),this.binaryDataLength()),this.bb.createScalarList(this.boneNames.bind(this),this.boneNamesLength()),this.rootBoneName(),this.bb.createScalarList(this.inverseBindMatrices.bind(this),this.inverseBindMatricesLength()))},e.unpackTo=function(t){t.id=this.id(),t.name=this.name(),t.vertexData=null!==this.vertexData()?this.vertexData().unpack():null,t.indexFormat=this.indexFormat(),t.indexOffset=this.indexOffset(),t.subMeshes=this.bb.createObjList(this.subMeshes.bind(this),this.subMeshesLength()),t.mode=this.mode(),t.buffer=this.buffer(),t.binaryData=this.bb.createScalarList(this.binaryData.bind(this),this.binaryDataLength()),t.boneNames=this.bb.createScalarList(this.boneNames.bind(this),this.boneNamesLength()),t.rootBoneName=this.rootBoneName(),t.inverseBindMatrices=this.bb.createScalarList(this.inverseBindMatrices.bind(this),this.inverseBindMatricesLength())},t.getRootAsFBGeometryData=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBGeometryData=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBGeometryData=function(t){t.startObject(12)},t.addId=function(t,e){t.addFieldOffset(0,e,0)},t.addName=function(t,e){t.addFieldOffset(1,e,0)},t.addVertexData=function(t,e){t.addFieldOffset(2,e,0)},t.addIndexFormat=function(t,e){t.addFieldInt32(3,e,0)},t.addIndexOffset=function(t,e){t.addFieldInt32(4,e,0)},t.addSubMeshes=function(t,e){t.addFieldOffset(5,e,0)},t.createSubMeshesVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},t.startSubMeshesVector=function(t,e){t.startVector(4,e,4)},t.addMode=function(t,e){t.addFieldInt32(6,e,0)},t.addBuffer=function(t,e){t.addFieldOffset(7,e,0)},t.addBinaryData=function(t,e){t.addFieldOffset(8,e,0)},t.createBinaryDataVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()},t.startBinaryDataVector=function(t,e){t.startVector(1,e,1)},t.addBoneNames=function(t,e){t.addFieldOffset(9,e,0)},t.createBoneNamesVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},t.startBoneNamesVector=function(t,e){t.startVector(4,e,4)},t.addRootBoneName=function(t,e){t.addFieldOffset(10,e,0)},t.addInverseBindMatrices=function(t,e){t.addFieldOffset(11,e,0)},t.createInverseBindMatricesVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addFloat32(e[r]);return t.endVector()},t.startInverseBindMatricesVector=function(t,e){t.startVector(4,e,4)},t.endFBGeometryData=function(t){return t.endObject()},t}(),Sf=function(){function t(t,e,r,i,n,o,s,a,u,c,h,l){void 0===t&&(t=null),void 0===e&&(e=null),void 0===r&&(r=null),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=[]),void 0===s&&(s=0),void 0===a&&(a=null),void 0===u&&(u=[]),void 0===c&&(c=[]),void 0===h&&(h=null),void 0===l&&(l=[]),this.id=t,this.name=e,this.vertexData=r,this.indexFormat=i,this.indexOffset=n,this.subMeshes=o,this.mode=s,this.buffer=a,this.binaryData=u,this.boneNames=c,this.rootBoneName=h,this.inverseBindMatrices=l}return t.prototype.pack=function(t){var e=null!==this.id?t.createString(this.id):0,r=null!==this.name?t.createString(this.name):0,i=null!==this.vertexData?this.vertexData.pack(t):0,n=Rf.createSubMeshesVector(t,t.createObjectOffsetList(this.subMeshes)),o=null!==this.buffer?t.createString(this.buffer):0,s=Rf.createBinaryDataVector(t,this.binaryData),a=Rf.createBoneNamesVector(t,t.createObjectOffsetList(this.boneNames)),u=null!==this.rootBoneName?t.createString(this.rootBoneName):0,c=Rf.createInverseBindMatricesVector(t,this.inverseBindMatrices);return Rf.startFBGeometryData(t),Rf.addId(t,e),Rf.addName(t,r),Rf.addVertexData(t,i),Rf.addIndexFormat(t,this.indexFormat),Rf.addIndexOffset(t,this.indexOffset),Rf.addSubMeshes(t,n),Rf.addMode(t,this.mode),Rf.addBuffer(t,o),Rf.addBinaryData(t,s),Rf.addBoneNames(t,a),Rf.addRootBoneName(t,u),Rf.addInverseBindMatrices(t,c),Rf.endFBGeometryData(t)},t}(),Cf=function(){function t(){this.exportObjectDatas=[]}var e=t.prototype;return e.addData=function(t){this.exportObjectDatas.push(t)},e.serializeToBinary=function(){for(var t,e=new df(1),r=new gf,i=[],n=wn(this.exportObjectDatas);!(t=n()).done;){var o=t.value,s=void 0;o.dataType===qi.Geometry&&(s=new vf("Geometry",this.geometryDataToBinary(o))),s&&i.push(s)}return r.exportObjects=i,yf.finishFBEffectsPackageDataBuffer(e,r.pack(e)),e.asUint8Array()},e.deserializeFromBinary=function(t){for(var e=new pf(t),r=yf.getRootAsFBEffectsPackageData(e),i=0;i<r.exportObjectsLength();i++){var n=r.exportObjects(i);if(n){var o=n.dataArray(),s=n.dataType();if(o){var a=void 0;s===qi.Geometry&&(a=this.binaryToGeometryData(o)),a&&this.exportObjectDatas.push(a)}}}},e.geometryDataToBinary=function(t){var e=new df(1),r=new Sf,i=t.indexFormat,n=t.indexOffset,o=t.mode,s=t.id,a=t.vertexData,u=t.boneNames,c=void 0===u?[]:u,h=t.rootBoneName,l=void 0===h?"":h,f=t.inverseBindMatrices,p=void 0===f?[]:f,d=t.binaryData,m=void 0===d?[]:d;r.indexFormat=i,r.indexOffset=n,r.mode=o,r.id=s,r.boneNames=c,r.rootBoneName=l,r.inverseBindMatrices=p,r.binaryData=m;var v=new Af;v.vertexCount=a.vertexCount,v.channels=[];for(var y,g=wn(a.channels);!(y=g()).done;){var _=y.value,E=_.semantic,x=_.offset,T=_.format,b=_.dimension,A=_.normalize,R=new Tf(E,x,T,b,A);v.channels.push(R)}r.vertexData=v;for(var S,C=[],O=wn(t.subMeshes);!(S=O()).done;){var M=S.value,P=M.offset,I=M.indexCount,w=M.vertexCount,L=new Ef(P,I,w);C.push(L)}return r.subMeshes=C,yf.finishFBEffectsPackageDataBuffer(e,r.pack(e)),e.asUint8Array()},e.binaryToGeometryData=function(t){var e=new pf(t),r=Rf.getRootAsFBGeometryData(e),i={vertexCount:0,channels:[]},n=r.vertexData();if(n){i.vertexCount=n.vertexCount();for(var o=0;o<n.channelsLength();o++){var s=n.channels(o);if(s){var a,u={semantic:null!=(a=s.semantic())?a:"",offset:s.offset(),format:s.format(),dimension:s.dimension(),normalize:s.normalize()};i.channels.push(u)}}}for(var c=[],h=0;h<r.subMeshesLength();h++){var l=r.subMeshes(h);if(l){var f={offset:l.offset(),vertexCount:l.vertexCount(),indexCount:l.indexCount()};c.push(f)}}for(var p=[],d=0;d<r.boneNamesLength();d++){var m=r.boneNames(d);p.push(m)}var v,y,g,_,E=r.inverseBindMatricesArray();return{vertexData:i,indexFormat:r.indexFormat(),indexOffset:r.indexOffset(),subMeshes:c,mode:r.mode(),buffer:null!=(v=r.buffer())?v:"",boneNames:p,rootBoneName:null!=(y=r.rootBoneName())?y:"",inverseBindMatrices:E?Array.from(E):void 0,binaryData:null!=(g=r.binaryDataArray())?g:void 0,id:null!=(_=r.id())?_:"",dataType:qi.Geometry}},t}(),Of=function(){function t(){this.renderErrors=new Set,this.destroyed=!1,this.textures=[],this.materials=[],this.geometries=[],this.meshes=[],this.renderPasses=[],this.jsonSceneData={},this.objectInstance={},this.assetLoader=new ol(this),this.emptyTexture=So(this),this.transparentTexture=Co(this)}var e=t.prototype;return e.clearResources=function(){this.jsonSceneData={},this.objectInstance={}},e.addEffectsObjectData=function(t){this.jsonSceneData[t.id]=t},e.findEffectsObjectData=function(t){return this.jsonSceneData[t]},e.addInstance=function(t){this.objectInstance[t.getInstanceId()]=t},e.getInstance=function(t){return this.objectInstance[t]},e.removeInstance=function(t){delete this.objectInstance[t]},e.addPackageDatas=function(t){for(var e,r=t.jsonScene,i=t.textureOptions,n=void 0===i?[]:i,o=r.items,s=void 0===o?[]:o,a=r.materials,u=void 0===a?[]:a,c=r.shaders,h=void 0===c?[]:c,l=r.geometries,f=void 0===l?[]:l,p=r.components,d=void 0===p?[]:p,m=r.animations,v=void 0===m?[]:m,y=r.bins,g=void 0===y?[]:y,_=r.miscs,E=void 0===_?[]:_,x=wn(s);!(e=x()).done;){var T=e.value;this.addEffectsObjectData(T)}for(var b,A=wn(u);!(b=A()).done;){var R=b.value;this.addEffectsObjectData(R)}for(var S,C=wn(h);!(S=C()).done;){var O=S.value;this.addEffectsObjectData(O)}for(var M,P=wn(f);!(M=P()).done;){var I=M.value;this.addEffectsObjectData(I)}for(var w,L=wn(d);!(w=L()).done;){var F=w.value;this.addEffectsObjectData(F)}for(var N,D=wn(v);!(N=D()).done;){var V=N.value;this.addEffectsObjectData(V)}for(var U,B=wn(E);!(U=B()).done;){var k=U.value;this.addEffectsObjectData(k)}for(var z=0;z<g.length;z++){var G=g[z],X=t.bins[z];if(G.dataType===qi.BinaryAsset)G.buffer=X,G.id&&this.addEffectsObjectData(G);else{var H=new Cf;H.deserializeFromBinary(new Uint8Array(X));for(var j,Y=wn(H.exportObjectDatas);!(j=Y()).done;){var W=j.value;this.addEffectsObjectData(W)}}}for(var Z,q=wn(n);!(Z=q()).done;){var K=Z.value;this.addEffectsObjectData(K)}},e.createVFXItems=function(t){var e=this;return cr((function(){var r,i,n,o,s;return pr(this,(function(a){switch(a.label){case 0:r=t.jsonScene,i=wn(r.items),a.label=1;case 1:return(n=i()).done?[3,4]:(o=n.value,"ECS"!==(s=o.type)&&"camera"!==s&&s!==gi.sprite&&s!==gi.particle&&s!==gi.mesh&&s!==gi.skybox&&s!==gi.light&&s!==gi.tree&&s!==gi.interact&&s!==gi.camera?[3,3]:e.database?[4,e.assetLoader.loadGUIDAsync(o.id)]:[3,3]);case 2:a.sent(),a.label=3;case 3:return[3,1];case 4:return[2]}}))}))()},e.addTexture=function(t){this.destroyed||xr(this.textures,t)},e.removeTexture=function(t){this.destroyed||Tr(this.textures,t)},e.addMaterial=function(t){this.destroyed||xr(this.materials,t)},e.removeMaterial=function(t){this.destroyed||Tr(this.materials,t)},e.addGeometry=function(t){this.destroyed||xr(this.geometries,t)},e.removeGeometry=function(t){this.destroyed||Tr(this.geometries,t)},e.addMesh=function(t){this.destroyed||xr(this.meshes,t)},e.removeMesh=function(t){this.destroyed||Tr(this.meshes,t)},e.addRenderPass=function(t){this.destroyed||xr(this.renderPasses,t)},e.removeRenderPass=function(t){this.destroyed||Tr(this.renderPasses,t)},e.getShaderLibrary=function(){return this.renderer.getShaderLibrary()},e.dispose=function(){if(!this.destroyed){this.destroyed=!0;var t=[];this.renderPasses.length>0&&t.push("Pass "+this.renderPasses.length),this.meshes.length>0&&t.push("Mesh "+this.meshes.length),this.geometries.length>0&&t.push("Geom "+this.geometries.length),this.textures.length>0&&t.push("Tex "+this.textures.length),t.length>0&&Yr.warn("Release GPU memory: "+t.join(", ")+"."),this.renderPasses.forEach((function(t){return t.dispose()})),this.meshes.forEach((function(t){return t.dispose()})),this.geometries.forEach((function(t){return t.dispose()})),this.materials.forEach((function(t){return t.dispose()})),this.textures.forEach((function(t){return t.dispose()})),this.textures=[],this.materials=[],this.geometries=[],this.meshes=[],this.renderPasses=[],this.renderer=null}},nn(t,[{key:"isDestroyed",get:function(){return this.destroyed}}]),t}(),Mf=function(){function t(t){void 0===t&&(t=60),this.paused=!0,this.lastTime=0,this.dt=0,this.setFPS(t),this.tickers=[]}var e=t.prototype;return e.getFPS=function(){return this.targetFPS},e.setFPS=function(t){this.targetFPS=xn(t,1,120),this.interval=Math.floor(1e3/t)-2},e.getPaused=function(){return this.paused},e.start=function(){var t=this;if(this.paused=!1,this.dt=0,!this.intervalId){this.lastTime=r.performance.now();var e=r.requestAnimationFrame||function(t){return r.window.setTimeout(t,16.7)},i=function(){t.intervalId=e(i),t.paused||t.tick()};i()}},e.stop=function(){(r.cancelAnimationFrame||r.window.clearTimeout)(this.intervalId),this.intervalId=0,this.lastTime=0,this.paused=!0,this.dt=0,this.tickers=[]},e.pause=function(){this.paused=!0,this.dt=0},e.resume=function(){this.paused=!1,this.dt=0},e.tick=function(){if(!this.paused){var t=r.performance.now();if(this.dt=t-this.lastTime,this.dt>=this.interval){this.lastTime=t,this.resetTickers&&(this.tickers=this.tickers.filter((function(t){return t})),this.resetTickers=!1);for(var e=0,i=this.tickers.length;e<i;e++){var n=this.tickers[e];n(this.dt)}}}},e.add=function(t){if("function"!=typeof t)throw new Error("The tick object must implement the tick method.");this.tickers.push(t)},nn(t,[{key:"deltaTime",get:function(){return this.dt}}]),t}();ai("camera",pu,exports.VFXItem,!0),ai("text",il,exports.VFXItem,!0),ai("sprite",Iu,exports.VFXItem,!0),ai("particle",yh,exports.VFXItem,!0),ai("cal",gh,exports.VFXItem,!0),ai("interact",Eu,exports.VFXItem,!0);var Pf;Yr.info("Core version: 2.2.1.");var If,wf=((Pf={})[jn.RGBA]=34842,Pf[jn.RGB]=34843,Pf[jn.ALPHA]=33325,Pf[jn.RED]=33325,Pf[jn.LUMINANCE_ALPHA]=33327,Pf[jn.LUMINANCE]=33325,Pf),Lf=((If={})[jn.RGBA]=34836,If[jn.RGB]=34837,If[jn.ALPHA]=33326,If[jn.RED]=33326,If[jn.LUMINANCE_ALPHA]=33328,If[jn.LUMINANCE]=33326,If),Ff=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).initialized=!1,r&&i.fromData(r),i}Ri(e,t);var r=e.prototype;return r.bind=function(t){this.pipelineContext.bindTexture(this.target,this.textureBuffer,t)},r.initialize=function(){if(!this.initialized){var t=this.engine;t.addTexture(this),this.pipelineContext=t.getGLPipelineContext();var e=this.pipelineContext.gl,r=this.source,i=r.target,n=void 0===i?e.TEXTURE_2D:i,o=r.name;this.textureBuffer=e.createTexture(),Bf(this.textureBuffer,o),this.target=n,this.update(this.source),this.release(),this.initialized=!0}},r.clone=function(){var t=new e(this.engine,this.source);return t.sourceFrom=this.sourceFrom,t.sourceType=this.sourceType,t.width=this.width,t.height=this.height,t},r.release=function(){switch(this.source.sourceType){case exports.TextureSourceType.image:delete this.source.image,delete this.source.cube;break;case exports.TextureSourceType.data:delete this.source.data;break;case exports.TextureSourceType.compressed:case exports.TextureSourceType.mipmaps:delete this.source.mipmaps}},r.update=function(t){var e=this;if(!this.pipelineContext||!this.textureBuffer)return this.width=0,void(this.height=0);var r,i,n=this.target,o=this.source,s=this.pipelineContext.gl,a=this.engine.gpuCapability.detail,u=o.sourceType,c=o.data,h=o.cube,l=o.image,f=o.video,p=o.mipmaps,d=o.mipmaps,m=t.data,v=t.cube,y=t.generateMipmap,g=t.mipmaps,_=o.format,E=o.type,x=o.internalFormat,T=0,b=0;if(this.bind(u===exports.TextureSourceType.video),E===jn.HALF_FLOAT?((E=a.halfFloatTexture)||Yr.error("Half float texture is not support."),Wn(s)&&x===_&&(_===jn.LUMINANCE&&(_=jn.RED),x=wf[_]),a.halfFloatLinear||(o.minFilter=o.magFilter=s.NEAREST,Yr.warn("Half float linear not support, change to NEAREST."))):E===s.FLOAT&&((E=a.floatTexture)||Yr.error("Float texture is not support."),Wn(s)&&x===_&&(_===jn.LUMINANCE&&(_=jn.RED),x=Lf[_]),a.floatLinear||(o.minFilter=s.NEAREST,o.magFilter=s.NEAREST,Yr.warn("Float linear not support, change to NEAREST."))),void 0===o.premultiplyAlpha&&(o.premultiplyAlpha=!1),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),void 0===o.flipY&&(o.flipY=!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,o.flipY),u===exports.TextureSourceType.framebuffer)m&&(T=null!=(r=m.width)?r:0,b=null!=(i=m.height)?i:0,T&&b&&(this.width!==T||this.height!==b)&&s.texImage2D(n,0,x,T,b,0,_,E,null));else if(u===exports.TextureSourceType.data){var A;if(n===s.TEXTURE_CUBE_MAP)v.forEach((function(t,r){var i=e.texImage2DData(s,s.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,x,_,E,t),n=i[0],o=i[1];T=Math.max(n,T),b=Math.max(o,b)}));else A=this.texImage2DData(s,n,0,x,_,E,c),T=A[0],b=A[1]}else if(u===exports.TextureSourceType.image||u===exports.TextureSourceType.video){if(n===s.TEXTURE_CUBE_MAP)h.forEach((function(t,r){var i=e.texImage2D(s,s.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,x,_,E,t),n=i[0],o=i[1];T=Math.max(n,T),b=Math.max(o,b)}));else if(n===s.TEXTURE_2D){var R,S=null!=l?l:f;R=this.texImage2D(s,n,0,x,_,E,S),T=R[0],b=R[1]}y&&(Nf(T)&&Nf(b)||Wn(s))&&s.generateMipmap(n)}else if(u===exports.TextureSourceType.mipmaps){var C;n===s.TEXTURE_2D?p.forEach((function(t,r){var i;(C="data"in t?e.texImage2DData(s,n,r,x,_,E,t):e.texImage2D(s,n,r,x,_,E,t),0===r)&&(T=(i=C)[0],b=i[1])})):n===s.TEXTURE_CUBE_MAP&&d.forEach((function(t,r){t.forEach((function(t,i){var n;(C="data"in t?e.texImage2DData(s,s.TEXTURE_CUBE_MAP_POSITIVE_X+i,r,x,_,E,t):e.texImage2D(s,s.TEXTURE_CUBE_MAP_POSITIVE_X+i,r,x,_,E,t),0===r)&&(T=(n=C)[0],b=n[1])}))}))}else u===exports.TextureSourceType.compressed&&g&&0!==g.length&&(T=g[0].width,b=g[0].height,g.forEach((function(t,e){s.compressedTexImage2D(n,e,x,t.width,t.height,0,t.data)})));this.width=T,this.height=b,this.setTextureFilters(s,n,o)},r.setTextureFilters=function(t,e,r){var i=r.anisotropic,n=void 0===i?4:i,o=r.wrapS,s=void 0===o?t.CLAMP_TO_EDGE:o,a=r.wrapT,u=void 0===a?t.CLAMP_TO_EDGE:a,c=this.engine.gpuCapability;this.target===t.TEXTURE_2D&&c.setTextureAnisotropic(t,this.target,n);var h=Wn(t)||Nf(this.width)&&Nf(this.height),l=r.magFilter?r.magFilter:t.NEAREST,f=r.minFilter?r.minFilter:t.NEAREST;h||f!==t.LINEAR_MIPMAP_LINEAR&&f!==t.LINEAR_MIPMAP_NEAREST&&f!==t.NEAREST_MIPMAP_LINEAR&&f!==t.NEAREST_MIPMAP_NEAREST||(f=t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,f),t.texParameteri(e,t.TEXTURE_MAG_FILTER,l),t.texParameteri(e,t.TEXTURE_WRAP_S,h?s:t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,h?u:t.CLAMP_TO_EDGE)},r.fromData=function(e){t.prototype.fromData.call(this,e);var r=e,i=this.assembleOptions(r),n=i.sourceType,o=i.sourceFrom,s=i.name,a=void 0===s?"":s;this.source=i,this.sourceType=n,this.sourceFrom=o,this.name=a,this.guid=e.id},r.texImage2D=function(t,e,r,i,n,o,s){var a,u=this,c=this.source,h=c.sourceType,l=c.minFilter,f=c.magFilter,p=c.wrapS,d=c.wrapT,m=null!=(a=this.engine.gpuCapability.detail.maxTextureSize)?a:2048,v=s;if(h!==exports.TextureSourceType.video){var y=l!==t.NEAREST||f!==t.NEAREST||p!==t.CLAMP_TO_EDGE||d!==t.CLAMP_TO_EDGE;(y=y||s.width>m||s.height>m)&&setTimeout((function(){v=u.resizeImage(s)}))}t.texImage2D(e,r,i,n,o,v);var g=[v.width,v.height];return h===exports.TextureSourceType.video?[s.videoWidth,s.videoHeight]:g},r.texImage2DData=function(t,e,r,i,n,o,s){var a=s.data,u=s.width,c=s.height,h=n===t.UNSIGNED_BYTE?new Uint8Array(a.buffer,a.byteOffset,a.byteLength/a.BYTES_PER_ELEMENT):a;return t.texImage2D(e,r,i,u,c,0,n,o,h),[u,c]},r.resizeImage=function(t,e,r){var i,n=null!=(i=this.engine.gpuCapability.detail.maxTextureSize)?i:2048;if(Wn(this.pipelineContext.gl)&&t.width<n&&t.height<n)return t;var o=function(t,e,r,i){var n=t.width,o=t.height,s=Math.min(e,r||ea(n)),a=Math.min(e,i||ea(o));if(a!==o||s!==n){var u=$h.getCanvas(),c=u.getContext("2d");return u.width=s,u.height=a,null==c||c.drawImage(t,0,0,n,o,0,0,s,a),Yr.warn("Image resize from "+n+"x"+o+" to "+s+"x"+a+"."),u}}(t,n,e,r);return o||t},r.reloadData=function(){var t=this;return cr((function(){return pr(this,(function(e){switch(e.label){case 0:return t.offloaded?[4,wo().reload(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))()},r.offloadData=function(){if(this.initialized&&wo().canOffloadTexture(this.source.sourceFrom)){var t=this.target,e=this.pipelineContext.gl;if(e&&this.textureBuffer){var r=new Uint8Array([255]);if(this.bind(),t===e.TEXTURE_2D)e.texImage2D(t,0,e.LUMINANCE,1,1,0,e.LUMINANCE,e.UNSIGNED_BYTE,r);else if(t===e.TEXTURE_CUBE_MAP)for(var i=[e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z],n=0;n<i.length;n++)e.texImage2D(i[n],0,e.LUMINANCE,1,1,0,e.LUMINANCE,e.UNSIGNED_BYTE,r);e.generateMipmap(t),this.width=1,this.height=1}this.offloaded=!0}},r.uploadCurrentVideoFrame=function(){var t=this;return cr((function(){return pr(this,(function(e){return t.source.sourceType===exports.TextureSourceType.video&&t.source.video&&t.initialized?(t.update({video:t.source.video}),[2,!0]):[2,!1]}))}))()},r.updateSource=function(t){this.source=this.assembleOptions(to({},this.source,t)),this.sourceType=this.source.sourceType,this.sourceFrom=this.source.sourceFrom,this.update(this.source)},r.restore=function(){},r.dispose=function(){this.pipelineContext&&this.textureBuffer&&this.pipelineContext.gl.deleteTexture(this.textureBuffer),this.width=0,this.height=0,this.textureBuffer=null,this.destroyed=!0,this.update=function(){Yr.error("This texture has been destroyed.")},this.initialize=ti,void 0!==this.engine&&this.engine.removeTexture(this)},e}(bo);function Nf(t){return!(t&t-1)&&0!==t}var Df=function(){function t(t,e){this.ready=!1,this.disposed=!1,this.gl=t.getGLPipelineContext().gl,this.vaoExt=t.gpuCapability.vaoExt,this.vao=this.createVertexArray(e)}var e=t.prototype;return e.bind=function(){this.bindVertexArray(this.vao)},e.unbind=function(){this.bindVertexArray(null)},e.createVertexArray=function(t){var e=null;return Wn(this.gl)&&(e=this.gl.createVertexArray()),!e&&this.vaoExt&&(e=this.vaoExt.createVertexArrayOES()),Bf(e,t),e},e.bindVertexArray=function(t){var e;Wn(this.gl)?this.gl.bindVertexArray(t):null==(e=this.vaoExt)||e.bindVertexArrayOES(t)},e.dispose=function(){var t;Wn(this.gl)?this.gl.deleteVertexArray(this.vao):null==(t=this.vaoExt)||t.deleteVertexArrayOES(this.vao)},t}(),Vf=1,Uf=function(){function t(t){this.engine=t,this.textures=[],this.renderbuffers=[],this.framebuffers=[],this.destroyed=!1;var e={width:1,height:1,data:new Uint8Array([255])},r=t.getGLPipelineContext(),i=r.gl;this.gl=i,this.pipelineContext=r,this.emptyTexture2D=new Ff(t,{data:e,sourceType:exports.TextureSourceType.data,format:i.LUMINANCE,internalFormat:i.LUMINANCE,type:i.UNSIGNED_BYTE}),this.emptyTexture2D.initialize(),this.emptyTextureCube=new Ff(t,{target:i.TEXTURE_CUBE_MAP,cube:[e,e,e,e,e,e],sourceType:exports.TextureSourceType.data,format:i.LUMINANCE,internalFormat:i.LUMINANCE,type:i.UNSIGNED_BYTE}),this.emptyTextureCube.initialize(),this.name="GLGPURenderer"+Vf,Vf++}var e=t.prototype;return e.copy2=function(t,e){var r=this.gl;if(r){this.sourceFbo||(this.sourceFbo=r.createFramebuffer()),this.targetFbo||(this.targetFbo=r.createFramebuffer());var i=this.pipelineContext;i.bindFramebuffer(r.FRAMEBUFFER,this.sourceFbo),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t.textureBuffer,0),i.bindFramebuffer(r.FRAMEBUFFER,this.targetFbo),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.textureBuffer,0),i.bindFramebuffer(r.READ_FRAMEBUFFER,this.sourceFbo),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.targetFbo);var n=t.getWidth()===t.getHeight()&&e.getWidth()==e.getHeight()?r.NEAREST:r.LINEAR;r.blitFramebuffer(0,0,t.getWidth(),t.getHeight(),0,0,e.getWidth(),e.getHeight(),r.COLOR_BUFFER_BIT,n),i.bindFramebuffer(r.FRAMEBUFFER,null),i.bindFramebuffer(r.READ_FRAMEBUFFER,null),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)}},e.resetColorAttachments=function(t,e){t.bind(),t.resetColorTextures(e)},e.createGLRenderbuffer=function(t){var e=this.gl.createRenderbuffer();return e&&xr(this.renderbuffers,t),e},e.resize=function(t,e){var r=this.gl;(r&&r.drawingBufferWidth!==t||r.drawingBufferHeight!==e)&&(r.canvas.width=t,r.canvas.height=e,r.viewport(0,0,t,e),this.framebuffers.forEach((function(r){var i=r.viewport;r.isCustomViewport||r.resize(i[0],i[1],t*r.viewportScale,e*r.viewportScale)})))},e.drawGeometry=function(t,e,r){if(this.gl){var i=t,n=e.shaderVariant.program;if(n){var o=n.setupAttributes(i),s=this.gl,a=i.indicesBuffer,u=i.drawStart,c=i.drawCount,h=i.mode,l=i.subMeshes;if(l&&l.length){var f,p=l[r];if(c<0)return;if(u=p.offset,a)c=null!=(f=p.indexCount)?f:0;else c=p.vertexCount}a?s.drawElements(h,c,a.type,null!=u?u:0):s.drawArrays(h,u,c),null==o||o.unbind()}}else console.warn("GLGPURenderer has not bound a gl object, unable to render geometry.")},e.createGLFramebuffer=function(t,e){var r=this.gl.createFramebuffer();return r&&(xr(this.framebuffers,t),Bf(r,e,e)),r},e.createVAO=function(t){return new Df(this.engine,t)},e.deleteGLTexture=function(t){t.textureBuffer&&!this.destroyed&&(this.gl.deleteTexture(t.textureBuffer),Tr(this.textures,t),delete t.textureBuffer)},e.deleteGPUBuffer=function(t){t&&!this.destroyed&&(this.gl.deleteBuffer(t.glBuffer),delete t.glBuffer)},e.deleteGLFramebuffer=function(t){t&&!this.destroyed&&(this.gl.deleteFramebuffer(t.fbo),Tr(this.framebuffers,t),delete t.fbo)},e.deleteGLRenderbuffer=function(t){t&&!this.destroyed&&(this.gl.deleteRenderbuffer(t.buffer),Tr(this.renderbuffers,t),delete t.buffer)},e.deleteResource=function(){var t=this,e=this.gl;e&&(e.deleteFramebuffer(this.sourceFbo),e.deleteFramebuffer(this.targetFbo),this.emptyTexture2D.dispose(),this.emptyTextureCube.dispose(),this.framebuffers.forEach((function(e){return t.deleteGLFramebuffer(e)})),this.framebuffers.length=0,this.renderbuffers.forEach((function(e){return t.deleteGLRenderbuffer(e)})),this.renderbuffers.length=0,this.textures.forEach((function(e){return t.deleteGLTexture(e)})),this.textures.length=0)},e.lost=function(t){Yr.error("WebGL context lost, destroying glRenderer by default to prevent memory leaks. Event target: "+t.target+"."),this.deleteResource()},e.dispose=function(){this.deleteResource(),this.emptyTexture2D=this.emptyTextureCube=this.pipelineContext=this.gpu=this.gl=null,this.destroyed=!0},nn(t,[{key:"height",get:function(){var t;return null==(t=this.gl)?void 0:t.drawingBufferHeight}},{key:"width",get:function(){var t;return null==(t=this.gl)?void 0:t.drawingBufferWidth}},{key:"canvas",get:function(){return this.gl.canvas}},{key:"isDestroyed",get:function(){return this.destroyed}}]),t}();function Bf(t,e,r){void 0!==e&&null!==t&&(t.__SPECTOR_Metadata={name:e},t.__SPECTOR_Object_TAG?(t.__SPECTOR_Object_TAG.displayText=e,r&&(t.__SPECTOR_Object_TAG.id=r)):t.__SPECTOR_Object_TAG={displayText:e,id:""})}var kf,zf,Gf=function(){function t(t,e){this.pipelineContext=t,this.byteLength=0,this.destroyed=!1;var r=e.name,i=e.data,n=e.elementCount,o=e.target,s=void 0===o?jn.ARRAY_BUFFER:o,a=e.type,u=void 0===a?jn.FLOAT:a,c=e.usage,h=void 0===c?jn.STATIC_DRAW:c,l=function(t){var e,r;return null!=(r=null==(e=Xf[t])?void 0:e.BYTES_PER_ELEMENT)?r:0}(u);this.target=s,this.type=u,this.usage=h,this.glBuffer=this.createGLBuffer(r),this.bytesPerElement=l,i?this.bufferData(i):n&&this.bufferData(l*n)}var e=t.prototype;return e.createGLBuffer=function(t){var e=this.pipelineContext.gl.createBuffer();return Bf(e,t),e},e.bind=function(){this.pipelineContext.gl.bindBuffer(this.target,this.glBuffer)},e.bufferData=function(t){var e="number"==typeof t?t:t.byteLength;if(this.pipelineContext){this.byteLength=e;var r=this.pipelineContext.gl,i=this.target;r.bindBuffer(i,this.glBuffer),0===e?r.bufferData(i,1,this.usage):(r.bufferData(i,e,this.usage),"number"!=typeof t&&r.bufferSubData(i,0,t))}else this.byteLength=0},e.bufferSubData=function(t,e){if(this.pipelineContext){var r=this.pipelineContext.gl,i=this.target,n=t*this.bytesPerElement,o=n+e.byteLength;r.bindBuffer(i,this.glBuffer),o>this.byteLength&&(this.byteLength=o,r.bufferData(i,o,this.usage)),r.bufferSubData(i,n,e)}else this.byteLength=0},e.dispose=function(){this.pipelineContext.gl.deleteBuffer(this.glBuffer),this.glBuffer=null,this.destroyed=!0},e.readSubData=function(t,e){return!!Wn(this.pipelineContext.gl)&&(this.pipelineContext.gl.getBufferSubData(this.target,t*this.bytesPerElement,e),!0)},nn(t,[{key:"elementCount",get:function(){return this.byteLength/this.bytesPerElement}},{key:"isDestroyed",get:function(){return this.destroyed}}]),t}(),Xf=((kf={})[jn.INT]=Int32Array,kf[jn.FLOAT]=Float32Array,kf[jn.SHORT]=Int16Array,kf[jn.BYTE]=Int8Array,kf[jn.UNSIGNED_BYTE]=Uint8Array,kf[jn.UNSIGNED_INT]=Uint32Array,kf[jn.UNSIGNED_SHORT]=Uint16Array,kf);var Hf=((zf={})[Uint8Array.BYTES_PER_ELEMENT]=jn.UNSIGNED_BYTE,zf[Uint16Array.BYTES_PER_ELEMENT]=jn.UNSIGNED_SHORT,zf[Uint32Array.BYTES_PER_ELEMENT]=jn.UNSIGNED_INT,zf),jf=1,Yf=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).drawCount=0,i.buffers={},i.vaos={},i.skin={},i.initialized=!1,i.indicesReleasable=!1,i.attributesName=[],i.destroyed=!1,r&&i.processProps(r),i}Ri(e,t);var i=e.prototype;return i.getOptions=function(){return to({},this.options)},i.initialize=function(){var t=this;if(!this.initialized){var e=this.engine;zr(e),e.addGeometry(this);var r=this.engine.getGLPipelineContext();Object.keys(this.bufferProps).forEach((function(e){t.buffers[e]=new Gf(r,t.bufferProps[e])})),this.indices&&(this.indicesBuffer=this.createIndicesBuffer(r,this.indices)),this.initialized=!0,this.flush(),this.options=void 0}},i.getAttributeBuffer=function(t){if(this.initialized){var e=this.attributes[t].dataSource;return this.buffers[e]}},i.setAttributeData=function(t,e){if(null!=this.bufferProps){var r=this.getAttributeBufferOption(t),i=this.attributes[t].dataSource;if(r){var n=r.usage,o=r.target;this.bufferProps[i]={data:e,usage:n,target:o,elementCount:e.length},this.dirtyFlags[i].discard=!0,this.dirtyFlags[i].dirty=!0}}},i.getAttributeData=function(t){if(null!=this.bufferProps){var e=this.getAttributeBufferOption(t);return e?e.data:void 0}},i.setAttributeSubData=function(t,e,r){if(null!=this.bufferProps){var i=this.getAttributeBufferOption(t);if(i&&null!=i.data){var n=e,o=e+r.length;if(i.data.length<o){var s=new r.constructor(o);s.set(i.data),i.data=s,this.dirtyFlags[t].discard=!0}else if(!this.dirtyFlags[t].discard){var a=this.dirtyFlags[t];void 0!==a.start&&(a.start=Math.min(a.start,n)),void 0!==a.end&&(a.end=Math.max(a.end,o-1))}i.data.set(r,n),this.dirtyFlags[t].dirty=!0}}},i.getIndexData=function(){return this.indices},i.setIndexData=function(t){(hr(t,Uint8Array)||hr(t,Uint16Array)||hr(t,Uint32Array))&&(this.indices=t,this.dirtyFlags.index.discard=!0,this.dirtyFlags.index.dirty=!0)},i.setIndexSubData=function(t,e){if(this.indices){var r,i=t,n=t+e.length;if(this.indices.length<n){var o=new e.constructor(n);o.set(this.indices),this.indices=o,this.dirtyFlags.index.discard=!0}else if(!this.dirtyFlags.index.discard){var s=this.dirtyFlags.index;void 0!==s.start&&(s.start=Math.min(s.start,i)),void 0!==s.end&&(s.end=Math.max(s.end,n-1))}null==(r=this.indices)||r.set(e,i),this.dirtyFlags.index.dirty=!0}},i.getAttributeStride=function(t){var e=this.attributes[t],r=e.stride,i=e.size,n=e.type;return r||i*Ho[n]},i.getAttributeNames=function(){return this.attributesName},i.setDrawStart=function(t){this.drawStart=t},i.getDrawStart=function(){return this.drawStart},i.setDrawCount=function(t){this.drawCount=t},i.getDrawCount=function(){return this.drawCount},i.getSkinProps=function(){return this.skin},i.getAttributeBufferOption=function(t){var e=this.attributes[t];return e?this.bufferProps[e.dataSource]:void 0},i.createIndicesBuffer=function(t,e){var r=Hf[e.BYTES_PER_ELEMENT],i={data:e,target:jn.ELEMENT_ARRAY_BUFFER,type:r,name:this.name+"##index"};return new Gf(t,i)},i.flush=function(){var t=this;if(this.initialized){var e=this.attributes,r=this.bufferProps,i=this.indices;Object.keys(this.dirtyFlags).forEach((function(n){var o,s,a=t.dirtyFlags[n];if("index"==n)o=t.indicesBuffer,s=i;else{var u=e[n].dataSource;o=t.buffers[u],s=r[u].data}if((a.dirty||a.discard)&&o&&s){if(a.discard)o.bufferData(s);else if(void 0!==a.start&&void 0!==a.end){var c=a.start*s.BYTES_PER_ELEMENT+s.byteOffset,h=a.end-a.start+1,l=new s.constructor(s.buffer,c,h);o.bufferSubData(a.start,l)}a.start=Number.POSITIVE_INFINITY,a.end=0,a.dirty=a.discard=!1}})),Object.keys(this.attributesReleasable).forEach((function(i){var n=t.attributesReleasable[i],o=e[i].dataSource;r[o]&&n&&(r[o].data=void 0)})),this.indicesReleasable}},i.processProps=function(t){var e=t,r=e.drawStart,i=void 0===r?0:r,n=e.drawCount,o=e.mode,s=e.indices,a=e.name,u=void 0===a?"effectsGeometry:"+jf++:a,c=e.bufferUsage,h=void 0===c?jn.STATIC_DRAW:c;this.name=u;var l={},f=[],p={},d={},m={},v=h;this.drawStart=i,void 0!==n&&(this.drawCount=n),this.mode=isNaN(o)?jn.TRIANGLES:o,Object.keys(e.attributes).forEach((function(t){var r=e.attributes[t],i=r.size,n=r.stride,o=r.offset,s=r.normalize,a=r.type,u=void 0===a?jn.FLOAT:a,c=r.releasable,h=r.data;if(!u||"dataSource"in r||h||(h=Yo(u)),h){var y=hr(h,Float32Array)?jn.FLOAT:jn.INT;l[t]={data:h,usage:v,target:jn.ARRAY_BUFFER,name:t},p[t]={size:i,stride:n,offset:o,type:null!=u?u:y,normalize:!!s,dataSource:t},m[t]=null!=c&&c,d[t]={dirty:!0,discard:!0,start:Number.POSITIVE_INFINITY,end:0}}else{var g=r.dataSource;g&&(p[t]={size:i,stride:n,offset:o,type:u,dataSource:g,normalize:!!s})}f.push(t)})),d.index={dirty:!0,discard:!0,start:Number.POSITIVE_INFINITY,end:0},this.indices=null==s?void 0:s.data,this.indicesReleasable=!0===(null==s?void 0:s.releasable),this.bufferProps=l,this.attributes=p,this.attributesName=f,this.attributesReleasable=m,this.dirtyFlags=d,this.options=e,this.initialized=!1},i.fromData=function(e){var i,n=this;if(t.prototype.fromData.call(this,e),this.subMeshes=e.subMeshes,e.buffer?i=new Uint8Array(function(t){for(var e=r.atob(t),i=new Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);var o=i.buffer;return o}(e.buffer)):e.binaryData&&(i=e.binaryData),i){var o=e.vertexData.vertexCount;if(this.hasSemantic(e)){var s={mode:jn.TRIANGLES,attributes:{}};if(e.vertexData.channels.forEach((function(t){var e,r=null!=(e=Wf[t.semantic])?e:t.semantic,a=n.createVertexTypedArray(t,i,o);s.attributes[r]={type:qn(t.format),size:t.dimension,data:a,normalize:t.normalize}})),e.indexFormat!==Ji.None){var a=this.createIndexTypedArray(e.indexFormat,i,e.indexOffset);s.indices={data:a},s.drawCount=a.length}else s.drawCount=o;this.processProps(s)}else{var u=e.vertexData.channels[0],c=e.vertexData.channels[1],h=e.vertexData.channels[2],l=this.createVertexTypedArray(u,i,o),f=this.createVertexTypedArray(c,i,o),p=this.createVertexTypedArray(h,i,o),d=this.createIndexTypedArray(e.indexFormat,i,e.indexOffset),m={mode:jn.TRIANGLES,attributes:{aPos:{type:qn(u.format),size:3,data:l,normalize:u.normalize},aUV:{type:qn(c.format),size:2,data:f,normalize:c.normalize},aNormal:{type:qn(h.format),size:3,data:p,normalize:h.normalize}}};m.indices={data:d},m.drawCount=d.length,this.processProps(m)}this.skin={boneNames:e.boneNames,rootBoneName:e.rootBoneName,inverseBindMatrices:e.inverseBindMatrices}}},i.dispose=function(){var t,e=this;(this.drawStart=0,this.drawCount=NaN,this.bufferProps={},this.indices=void 0,this.attributes={},this.attributesName=[],this.options=void 0,this.initialized)&&(Object.keys(this.buffers).forEach((function(t){e.buffers[t].dispose()})),this.buffers={},null==(t=this.indicesBuffer)||t.dispose(),Object.keys(this.vaos).forEach((function(t){var r;null==(r=e.vaos[t])||r.dispose(),e.vaos[t]=void 0})),this.indicesBuffer=void 0,void 0!==this.engine&&(this.engine.removeGeometry(this),this.engine=void 0));this.destroyed=!0},i.createVertexTypedArray=function(t,e,r){var i=e.buffer;switch(t.format){case Qi.Float32:return new Float32Array(i,e.byteOffset+t.offset,t.dimension*r);case Qi.Int16:return new Int16Array(i,e.byteOffset+t.offset,t.dimension*r);case Qi.Int8:return new Int8Array(i,e.byteOffset+t.offset,t.dimension*r);case Qi.UInt16:return new Uint16Array(i,e.byteOffset+t.offset,t.dimension*r);case Qi.UInt8:return new Uint8Array(i,e.byteOffset+t.offset,t.dimension*r);default:return console.error("Invalid vertex format type: "+t.format+"."),new Float32Array(i,e.byteOffset+t.offset,t.dimension*r)}},i.createIndexTypedArray=function(t,e,r){var i=e.buffer;switch(t){case Ji.UInt16:return new Uint16Array(i,e.byteOffset+r);case Ji.UInt32:return new Uint32Array(i,e.byteOffset+r);default:return console.error("Invalid index format type: "+t+"."),new Uint32Array(i,e.byteOffset+r)}},i.hasSemantic=function(t){var e=!1;return t.vertexData.channels.forEach((function(t){t.semantic&&t.semantic.length>0&&(e=!0)})),e},nn(e,[{key:"isDestroyed",get:function(){return this.destroyed}},{key:"isInitialized",get:function(){return this.initialized}}]),e}(jo),Wf={POSITION:"aPos",TEXCOORD0:"aUV",TEXCOORD_0:"aUV",TEXCOORD1:"aUV2",NORMAL:"aNormal",TANGENT:"aTangent",COLOR:"aColor",JOINTS:"aJoints",JOINTS_0:"aJoints",WEIGHTS:"aWeights",WEIGHTS_0:"aWeights",POSITION_BS0:"aTargetPosition0",POSITION_BS1:"aTargetPosition1",POSITION_BS2:"aTargetPosition2",POSITION_BS3:"aTargetPosition3",POSITION_BS4:"aTargetPosition4",POSITION_BS5:"aTargetPosition5",POSITION_BS6:"aTargetPosition6",POSITION_BS7:"aTargetPosition7",NORMAL_BS0:"aTargetNormal0",NORMAL_BS1:"aTargetNormal1",NORMAL_BS2:"aTargetNormal2",NORMAL_BS3:"aTargetNormal3",TANGENT_BS0:"aTargetTangent0",TANGENT_BS1:"aTargetTangent1",TANGENT_BS2:"aTargetTangent2",TANGENT_BS3:"aTargetTangent3"};var Zf=function(){function t(){this.reset()}var e=t.prototype;return e.setBlendColor=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];this.blendColor[0]===e&&this.blendColor[1]===r&&this.blendColor[2]===i&&this.blendColor[3]===n||(this.blendColor[0]=e,this.blendColor[1]=r,this.blendColor[2]=i,this.blendColor[3]=n)},e.setBlending=function(t){this.blending!==t&&(this.blending=t)},e.setBlendFunctionParameters=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];this.blendFunctionParameters[0]===e&&this.blendFunctionParameters[1]===r&&this.blendFunctionParameters[2]===i&&this.blendFunctionParameters[3]===n||(this.blendFunctionParameters[0]=e,this.blendFunctionParameters[1]=r,this.blendFunctionParameters[2]=i,this.blendFunctionParameters[3]=n)},e.setBlendEquationParameters=function(t){var e=t[0],r=t[1];this.blendEquationParameters[0]===e&&this.blendEquationParameters[1]===r||(this.blendEquationParameters[0]=e,this.blendEquationParameters[1]=r)},e.setDepthTest=function(t){this.depthTest!==t&&(this.depthTest=t)},e.setDepthMask=function(t){this.depthMask!==t&&(this.depthMask=t)},e.setDepthRange=function(t){this.depthRange[0]===t[0]&&this.depthRange[1]===t[1]||(this.depthRange[0]=t[0],this.depthRange[1]=t[1])},e.setDepthFunc=function(t){this.depthFunc!==t&&(this.depthFunc=t)},e.setPolygonOffsetFill=function(t){this.polygonOffsetFill!==t&&(this.polygonOffsetFill=t)},e.setPolygonOffset=function(t){this.polygonOffset[0]===t[0]&&this.polygonOffset[1]===t[1]||(this.polygonOffset[0]=t[0],this.polygonOffset[1]=t[1])},e.setSampleAlphaToCoverage=function(t){this.sampleAlphaToCoverage!==t&&(this.sampleAlphaToCoverage=t)},e.setColorMask=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];this.colorMask[0]===e&&this.colorMask[1]===r&&this.colorMask[2]===i&&this.colorMask[3]===n||(this.colorMask[0]=e,this.colorMask[1]=r,this.colorMask[2]=i,this.colorMask[3]=n)},e.setStencilTest=function(t){this.stencilTest!==t&&(this.stencilTest=t)},e.setStencilMask=function(t){this.stencilMask[0]===t[0]&&this.stencilMask[1]===t[1]||(this.stencilMask[0]=t[0],this.stencilMask[1]=t[1])},e.setStencilRef=function(t){this.stencilRef[0]===t[0]&&this.stencilRef[1]===t[1]||(this.stencilRef[0]=t[0],this.stencilRef[1]=t[1])},e.setStencilFunc=function(t){this.stencilFunc[0]===t[0]&&this.stencilFunc[1]===t[1]||(this.stencilFunc[0]=t[0],this.stencilFunc[1]=t[1])},e.setStencilOpFail=function(t){this.stencilOpFail[0]===t[0]&&this.stencilOpFail[1]===t[1]||(this.stencilOpFail[0]=t[0],this.stencilOpFail[1]=t[1])},e.setStencilOpZFail=function(t){this.stencilOpZFail[0]===t[0]&&this.stencilOpZFail[1]===t[1]||(this.stencilOpZFail[0]=t[0],this.stencilOpZFail[1]=t[1])},e.setStencilOpZPass=function(t){this.stencilOpZPass[0]===t[0]&&this.stencilOpZPass[1]===t[1]||(this.stencilOpZPass[0]=t[0],this.stencilOpZPass[1]=t[1])},e.setCulling=function(t){this.culling!==t&&(this.culling=t)},e.setFrontFace=function(t){this.frontFace!==t&&(this.frontFace=t)},e.setCullFace=function(t){this.cullFace!==t&&(this.cullFace=t)},e.reset=function(){this.blending=!1,this.blendColor=[0,0,0,0],this.blendFunctionParameters=[jn.ONE,jn.ONE_MINUS_SRC_ALPHA,jn.ONE,jn.ONE_MINUS_SRC_ALPHA],this.blendEquationParameters=[jn.FUNC_ADD,jn.FUNC_ADD],this.depthTest=!0,this.depthMask=!0,this.depthRange=[0,1],this.depthFunc=jn.LESS,this.polygonOffset=[0,0],this.polygonOffsetFill=!1,this.sampleAlphaToCoverage=!1,this.colorMask=[!0,!0,!0,!0],this.stencilTest=!1,this.stencilMask=[255,255],this.stencilRef=[0,0],this.stencilFunc=[jn.ALWAYS,jn.ALWAYS],this.stencilOpFail=[jn.KEEP,jn.KEEP],this.stencilOpZFail=[jn.KEEP,jn.KEEP],this.stencilOpZPass=[jn.KEEP,jn.KEEP],this.culling=!1,this.frontFace=jn.CCW,this.cullFace=jn.FRONT},e.apply=function(t){if(t.toggle(jn.SAMPLE_ALPHA_TO_COVERAGE,this.sampleAlphaToCoverage),t.toggle(jn.BLEND,this.blending),t.toggle(jn.DEPTH_TEST,this.depthTest),t.toggle(jn.STENCIL_TEST,this.stencilTest),t.toggle(jn.CULL_FACE,this.culling),t.toggle(jn.POLYGON_OFFSET_FILL,this.polygonOffsetFill),this.stencilTest&&(t.stencilMaskSeparate(jn.BACK,this.stencilMask[1]),t.stencilMaskSeparate(jn.FRONT,this.stencilMask[0]),t.stencilFuncSeparate(jn.BACK,this.stencilFunc[0],this.stencilRef[0],this.stencilMask[0]),t.stencilFuncSeparate(jn.FRONT,this.stencilFunc[1],this.stencilRef[1],this.stencilMask[1]),t.stencilOpSeparate(jn.BACK,this.stencilOpFail[0],this.stencilOpZFail[0],this.stencilOpZPass[0]),t.stencilOpSeparate(jn.FRONT,this.stencilOpFail[1],this.stencilOpZFail[1],this.stencilOpZPass[1])),this.blending){var e=this,r=e.blendColor,i=e.blendEquationParameters,n=e.blendFunctionParameters;t.blendColor(r[0],r[1],r[2],r[3]),t.blendEquationSeparate(i[0],i[1]),t.blendFuncSeparate(n[0],n[1],n[2],n[3])}t.colorMask(this.colorMask[0],this.colorMask[1],this.colorMask[2],this.colorMask[3]),this.depthTest&&(t.depthMask(this.depthMask),t.depthFunc(this.depthFunc),t.depthRange(this.depthRange[0],this.depthRange[1])),this.culling&&(t.cullFace(this.cullFace),t.frontFace(this.frontFace)),this.polygonOffsetFill&&t.polygonOffset(this.polygonOffset[0],this.polygonOffset[1])},t}(),qf=An,Kf=Pn,Qf=function(t){function e(e,r){var i;return(i=t.call(this,e,r)||this).floats={},i.ints={},i.vector2s={},i.vector3s={},i.vector4s={},i.colors={},i.quaternions={},i.matrices={},i.matrice3s={},i.textures={},i.floatArrays={},i.vector4Arrays={},i.matrixArrays={},i.samplers=[],i.uniforms=[],i.uniformDirty=!0,i.macrosDirty=!0,i.glMaterialState=new Zf,r&&(i.shader=new exports.Shader(e),i.shader.shaderData=to({},r.shader,{id:ei(),dataType:qi.Shader})),i}Ri(e,t);var r=e.prototype;return r.enableMacro=function(t,e){this.isMacroEnabled(t)&&this.enabledMacros[t]===e||(this.enabledMacros[t]=null==e||e,this.macrosDirty=!0)},r.disableMacro=function(t){this.isMacroEnabled(t)&&(delete this.enabledMacros[t],this.macrosDirty=!0)},r.isMacroEnabled=function(t){return void 0!==this.enabledMacros[t]},r.createMaterialStates=function(t){this.sampleAlphaToCoverage=!!t.sampleAlphaToCoverage,this.depthTest=t.depthTest,this.depthMask=t.depthMask,this.depthRange=t.depthRange,this.depthFunc=t.depthFunc,this.colorMask=t.colorMask,this.polygonOffset=t.polygonOffset,this.polygonOffsetFill=t.polygonOffsetFill,this.blending=t.blending,this.blendFunction=t.blendFunction,this.stencilTest=t.stencilTest},r.initialize=function(){var t=this,e=this.engine;this.createShaderVariant(),this.shaderVariant.initialize(),this.initialized||(e.addMaterial(this),Object.keys(this.textures).forEach((function(e){var r=t.textures[e];Kr(r.initialize)?r.initialize():Yr.error("Failed to initialize texture: "+JSON.stringify(r)+". Ensure the texture conforms to the expected format.")})),this.initialized=!0)},r.createShaderVariant=function(){(this.shaderDirty||this.macrosDirty)&&(this.shaderVariant=this.shader.createVariant(this.enabledMacros),this.macrosDirty=!1,this.shaderDirty=!1,this.uniformDirty=!0)},r.setupStates=function(t){this.glMaterialState.apply(t)},r.use=function(t,e){var r=t.engine.getGLPipelineContext(),i=this.shaderVariant;if(i.program){var n;if(i.program.bind(),this.setupStates(r),e){for(var o,s=wn(e.uniforms);!(o=s()).done;)n=o.value,this.checkUniform(n);for(var a,u=wn(e.samplers);!(a=u()).done;)n=a.value,this.samplers.includes(n)||(this.samplers.push(n),this.uniformDirty=!0)}if(this.uniformDirty&&(i.fillShaderInformation(this.uniforms,this.samplers),this.uniformDirty=!1),e){for(n in e.floats)i.setFloat(n,e.floats[n]);for(n in e.ints)i.setInt(n,e.ints[n]);for(n in e.vector4s)i.setVector4(n,e.vector4s[n]);for(n in e.vector3s)i.setVector3(n,e.vector3s[n]);for(n in e.matrices)i.setMatrix(n,e.matrices[n])}for(n in this.textures)this.textures[n].textureBuffer||this.textures[n].initialize();for(n in this.floats)i.setFloat(n,this.floats[n]);for(n in this.ints)i.setInt(n,this.ints[n]);for(n in this.floatArrays)i.setFloats(n,this.floatArrays[n]);for(n in this.textures)i.setTexture(n,this.textures[n]);for(n in this.vector2s)i.setVector2(n,this.vector2s[n]);for(n in this.vector3s)i.setVector3(n,this.vector3s[n]);for(n in this.vector4s)i.setVector4(n,this.vector4s[n]);for(n in this.colors)i.setColor(n,this.colors[n]);for(n in this.quaternions)i.setQuaternion(n,this.quaternions[n]);for(n in this.matrices)i.setMatrix(n,this.matrices[n]);for(n in this.matrice3s)i.setMatrix3(n,this.matrice3s[n]);for(n in this.vector4Arrays)i.setVector4Array(n,this.vector4Arrays[n]);for(n in this.matrixArrays)i.setMatrixArray(n,this.matrixArrays[n])}else{var c;null==(c=this.engine)||c.renderErrors.add(new Error("Shader program is not initialized."))}},r.getFloat=function(t){return this.floats[t]},r.setFloat=function(t,e){this.checkUniform(t),this.floats[t]=e},r.getInt=function(t){return this.ints[t]},r.setInt=function(t,e){this.checkUniform(t),this.ints[t]=e},r.getFloats=function(t){return this.floatArrays[t]},r.setFloats=function(t,e){this.checkUniform(t),this.floatArrays[t]=e},r.getVector2=function(t){return this.vector2s[t]},r.setVector2=function(t,e){this.checkUniform(t),this.vector2s[t]=e},r.getVector3=function(t){return this.vector3s[t]},r.setVector3=function(t,e){this.checkUniform(t),this.vector3s[t]=e},r.getVector4=function(t){return this.vector4s[t]},r.setVector4=function(t,e){this.checkUniform(t),this.vector4s[t]=e},r.getColor=function(t){return this.colors[t]},r.setColor=function(t,e){this.checkUniform(t),this.colors[t]=e},r.getQuaternion=function(t){return this.quaternions[t]},r.setQuaternion=function(t,e){this.checkUniform(t),this.quaternions[t]=e},r.getMatrix=function(t){return this.matrices[t]},r.setMatrix=function(t,e){this.checkUniform(t),this.matrices[t]=e},r.setMatrix3=function(t,e){this.checkUniform(t),this.matrice3s[t]=e},r.getVector4Array=function(t){return this.vector4Arrays[t]},r.setVector4Array=function(t,e){this.checkUniform(t),this.vector4Arrays[t]=[];for(var r,i=wn(e);!(r=i()).done;){var n=r.value;this.vector4Arrays[t].push(n.x,n.y,n.z,n.w)}},r.getMatrixArray=function(t){return this.matrixArrays[t]},r.setMatrixArray=function(t,e){this.checkUniform(t),this.matrixArrays[t]=[];for(var r,i=wn(e);!(r=i()).done;)for(var n=r.value,o=0;o<16;o++)this.matrixArrays[t].push(n.elements[o])},r.setMatrixNumberArray=function(t,e){this.checkUniform(t),this.matrixArrays[t]=e},r.getTexture=function(t){return this.textures[t]},r.setTexture=function(t,e){this.samplers.includes(t)||(this.samplers.push(t),this.uniformDirty=!0),this.textures[t]=e},r.hasUniform=function(t){return this.uniforms.includes(t)||this.samplers.includes(t)},r.clone=function(t){var r=t||this.props,i=this.engine;zr(i);var n=new e(i,r);return n.glMaterialState=Object.assign(new Zf,n.glMaterialState),n.floats=this.floats,n.ints=this.ints,n.vector2s=this.vector2s,n.vector3s=this.vector3s,n.vector4s=this.vector4s,n.colors=this.colors,n.quaternions=this.quaternions,n.matrices=this.matrices,n.textures=this.textures,n.floatArrays=this.floatArrays,n.vector4Arrays=this.vector4Arrays,n.matrixArrays=this.matrixArrays,n.samplers=this.samplers,n.uniforms=this.uniforms,n.uniformDirty=!0,n},r.fromData=function(e){t.prototype.fromData.call(this,e),this.uniforms=[],this.samplers=[],this.textures={},this.floats={},this.ints={},this.floatArrays={},this.vector4s={};var r=to({},e);void 0!==e.stringTags.RenderType&&(this.blending=e.stringTags.RenderType===xi.Transparent),void 0!==e.floats.ZTest&&(this.depthTest=0!==e.floats.ZTest),void 0!==e.floats.ZWrite&&(this.depthMask=0!==e.floats.ZWrite);var i,n,o=e.stringTags.RenderFace;for(i in o===Ti.Front?(this.culling=!0,this.cullFace=jn.BACK):o===Ti.Back?(this.culling=!0,this.cullFace=jn.FRONT):this.culling=!1,r.floats)this.setFloat(i,r.floats[i]);for(i in r.ints)this.setInt(i,r.ints[i]);for(i in r.vector4s){var s=r.vector4s[i];this.setVector4(i,new An(s.x,s.y,s.z,s.w))}for(i in r.colors){var a=r.colors[i];this.setColor(i,new Ko(a.r,a.g,a.b,a.a))}for(i in r.textures){var u=r.textures[i];this.setTexture(i,u.texture);var c=u.offset,h=u.scale;c&&h&&this.setVector4(i+"_ST",new qf(h.x,h.y,c.x,c.y))}e.shader&&(this.shader=e.shader,this.shaderSource=this.shader.shaderData),this.stringTags=null!=(n=e.stringTags)?n:{},this.initialized=!1},r.toData=function(){var t=this.taggedProperties;for(var e in this.shader&&(t.shader=this.shader),t.floats={},t.ints={},t.vector4s={},t.colors={},t.textures={},t.dataType=qi.Material,t.stringTags=this.stringTags,this.floats)t.floats[e]=this.floats[e];for(var r in this.ints)t.ints[r]=this.ints[r];for(var i in this.vector4s)t.vector4s[i]=this.vector4s[i];for(var n in this.colors)t.colors[n]=this.colors[n];for(var o in this.textures){t.textures[o]||(t.textures[o]={texture:this.textures[o]});var s=t.textures[o],a=this.getVector4(o+"_ST");a&&(s.scale={x:a.x,y:a.y},s.offset={x:a.z,y:a.w},delete t.vector4s[o+"_ST"])}return t},r.cloneUniforms=function(t){var e,r=t;for(e in r.floats)this.setFloat(e,r.floats[e]);for(e in r.ints)this.setInt(e,r.ints[e]);for(e in r.floatArrays)this.setFloats(e,r.floatArrays[e]);for(e in r.textures)this.setTexture(e,r.textures[e]);for(e in r.vector2s)this.setVector2(e,r.vector2s[e]);for(e in r.vector3s)this.setVector3(e,r.vector3s[e]);for(e in r.vector4s)this.setVector4(e,r.vector4s[e]);for(e in r.colors)this.setColor(e,r.colors[e]);for(e in r.quaternions)this.setQuaternion(e,r.quaternions[e]);for(e in r.matrices)this.setMatrix(e,r.matrices[e]);for(e in r.vector4Arrays){for(var i=[],n=0;n<r.vector4Arrays[e].length;n+=4)i.push(new qf(r.vector4Arrays[e][n],r.vector4Arrays[e][n+1],r.vector4Arrays[e][n+2],r.vector4Arrays[e][n+3]));this.setVector4Array(e,i)}for(e in r.matrixArrays){for(var o=[],s=0;s<r.matrixArrays[e].length;s+=16){for(var a=Kf.fromIdentity(),u=0;u<16;u++)a.elements[u]=r.matrixArrays[e][s+u];o.push(a)}this.setMatrixArray(e,o)}},r.checkUniform=function(t){this.uniforms.includes(t)||(this.uniforms.push(t),this.uniformDirty=!0)},r.dispose=function(t){var e,r=this;this.destroyed||(null==(e=this.shaderVariant)||e.dispose(),(null==t?void 0:t.textures)!==exports.DestroyOptions.keep&&Object.keys(this.textures).forEach((function(t){var e=r.textures[t];e!==r.engine.emptyTexture&&e.dispose()})),this.shaderSource=null,this.uniformSemantics={},this.floats={},this.ints={},this.vector2s={},this.vector3s={},this.vector4s={},this.quaternions={},this.matrices={},this.matrice3s={},this.textures={},this.floatArrays={},this.vector4Arrays={},this.matrixArrays={},this.samplers=[],this.uniforms=[],this.initialize=ti,this.destroyed=!0,void 0!==this.engine&&this.engine.removeMaterial(this))},nn(e,[{key:"blending",get:function(){return this.glMaterialState.blending},set:function(t){void 0!==t&&this.glMaterialState.setBlending(t)}},{key:"blendColor",get:function(){return this.glMaterialState.blendColor},set:function(t){t&&this.glMaterialState.setBlendColor(t)}},{key:"blendFunction",get:function(){return this.glMaterialState.blendFunctionParameters},set:function(t){t&&this.glMaterialState.setBlendFunctionParameters(t)}},{key:"blendEquation",get:function(){return this.glMaterialState.blendEquationParameters},set:function(t){t&&this.glMaterialState.setBlendEquationParameters(t)}},{key:"depthTest",get:function(){return this.glMaterialState.depthTest},set:function(t){void 0!==t&&this.glMaterialState.setDepthTest(t)}},{key:"depthMask",get:function(){return this.glMaterialState.depthMask},set:function(t){void 0!==t&&this.glMaterialState.setDepthMask(t)}},{key:"depthRange",get:function(){return this.glMaterialState.depthRange},set:function(t){t&&this.glMaterialState.setDepthRange(t)}},{key:"depthFunc",get:function(){return this.glMaterialState.depthFunc},set:function(t){void 0!==t&&this.glMaterialState.setDepthFunc(t)}},{key:"polygonOffsetFill",get:function(){return this.glMaterialState.polygonOffsetFill},set:function(t){void 0!==t&&this.glMaterialState.setPolygonOffsetFill(t)}},{key:"polygonOffset",get:function(){return this.glMaterialState.polygonOffset},set:function(t){t&&this.glMaterialState.setPolygonOffset(t)}},{key:"sampleAlphaToCoverage",get:function(){return this.glMaterialState.sampleAlphaToCoverage},set:function(t){void 0!==t&&this.glMaterialState.setSampleAlphaToCoverage(t)}},{key:"colorMask",get:function(){return this.glMaterialState.colorMask},set:function(t){t&&this.glMaterialState.setColorMask(t)}},{key:"stencilTest",get:function(){return this.glMaterialState.stencilTest},set:function(t){void 0!==t&&this.glMaterialState.setStencilTest(t)}},{key:"stencilMask",get:function(){return this.glMaterialState.stencilMask},set:function(t){t&&this.glMaterialState.setStencilMask(t)}},{key:"stencilRef",get:function(){return this.glMaterialState.stencilRef},set:function(t){t&&this.glMaterialState.setStencilRef(t)}},{key:"stencilFunc",get:function(){return this.glMaterialState.stencilFunc},set:function(t){t&&this.glMaterialState.setStencilFunc(t)}},{key:"stencilOpFail",get:function(){return this.glMaterialState.stencilOpFail},set:function(t){t&&this.glMaterialState.setStencilOpFail(t)}},{key:"stencilOpZFail",get:function(){return this.glMaterialState.stencilOpZFail},set:function(t){t&&this.glMaterialState.setStencilOpZFail(t)}},{key:"stencilOpZPass",get:function(){return this.glMaterialState.stencilOpZPass},set:function(t){t&&this.glMaterialState.setStencilOpZPass(t)}},{key:"culling",get:function(){return this.glMaterialState.culling},set:function(t){void 0!==t&&this.glMaterialState.setCulling(t)}},{key:"frontFace",get:function(){return this.glMaterialState.frontFace},set:function(t){void 0!==t&&this.glMaterialState.setFrontFace(t)}},{key:"cullFace",get:function(){return this.glMaterialState.cullFace},set:function(t){void 0!==t&&this.glMaterialState.setCullFace(t)}},{key:"isDestroyed",get:function(){return this.destroyed}}]),e}(Bo),Jf=function(){function t(t){if(this.renderer=t,1===t.engine.gpuCapability.level){this.copyRenderPass=this.createCopyRenderPass().initialize(t);var e=this.copyRenderPass.meshes[0].material.shaderSource;t.pipelineContext.shaderLibrary.addShader(e)}}var e=t.prototype;return e.resetColorAttachments=function(t,e){this.renderer&&t.resetColorAttachments(e)},e.copyTexture=function(t,e){this.renderer&&(t.initialize(),e.initialize(),e.updateSource({sourceType:exports.TextureSourceType.framebuffer,data:{width:e.getWidth()||t.getWidth(),height:e.getHeight()||t.getHeight()}}),2===this.renderer.engine.gpuCapability.level?this.copy2(t,e):this.copy1(t,e))},e.copy2=function(t,e){var r=this.renderer.getFramebuffer();this.renderer.glRenderer.copy2(t,e),this.renderer.setFramebuffer(r)},e.copy1=function(t,e){var r=this.copyRenderPass;if(r){var i=this.renderer;if(i){var n=r.framebuffer;n.viewport[2]=e.getWidth()||t.getWidth(),n.viewport[3]=e.getHeight()||t.getHeight(),i.glRenderer.resetColorAttachments(n,[e]),r.meshes[0].material.setTexture("uTex",t),i.renderRenderPass(r)}}},e.createCopyRenderPass=function(){var t="mri-copy-mesh",e={texture:{format:jn.RGBA}},r=this.renderer.engine,i=new Yf(r,{name:t,mode:jn.TRIANGLE_STRIP,attributes:{aPos:{type:jn.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),n=r.gpuCapability.level,o=new Qf(r,{name:t,shader:{cacheId:"$mri-internal-copy",name:t,vertex:"\nprecision highp float;\nattribute vec2 aPos;\nvarying vec2 vTex;\nvoid main(){\n  gl_Position = vec4(aPos,0.,1.0);\n  vTex = (aPos + vec2(1.))/2.;\n}",fragment:"\nprecision highp float;\nvarying vec2 vTex;\nuniform sampler2D uTex;\nvoid main(){\n  gl_FragColor = texture2D(uTex,vTex);\n}",glslVersion:2===n?exports.GLSLVersion.GLSL3:exports.GLSLVersion.GLSL1}});o.blending=!1,o.depthTest=!1,o.culling=!1;var s=new is(r,{name:t,geometry:i,material:o,priority:0});return new $f(this.renderer,{name:"mri-copy-rp",clearAction:{colorAction:exports.TextureLoadAction.whatever},attachments:[e],meshes:[s]})},e.dispose=function(){var t;this.renderer&&(null==(t=this.copyRenderPass)||t.dispose(),this.renderer=void 0)},t}(),$f=function(t){function e(){return t.apply(this,arguments)}Ri(e,t);var r=e.prototype;return r.configure=function(t){this.currentFramebuffer=t.getFramebuffer(),t.setFramebuffer(this.framebuffer)},r.execute=function(t){this.clearAction&&t.clear(this.clearAction),t.renderMeshes(this.meshes),this.storeAction&&t.clear(this.storeAction),t.setFramebuffer(this.currentFramebuffer)},e}(us),tp=function(){function t(t,e,r){var i=this;void 0===e&&(e="webgl"),void 0===r&&(r={}),this.canvas=t,this.glType=e,this.restoreHandlers=[],this.lostHandlers=[],zr(t),this.gl=Bn(t,e,r),this.contextLostListener=function(t){for(var e,r,n=wn(i.lostHandlers);!(r=n()).done;){r.value.lost(t)}null==(e=i.canvas)||e.removeEventListener("webglcontextlost",i.contextLostListener)},this.contextRestoredListener=function(t){for(var e,r,n=wn(i.restoreHandlers);!(r=n()).done;){r.value.restore()}null==(e=i.canvas)||e.addEventListener("webglcontextlost",i.contextLostListener)},t.addEventListener("webglcontextlost",this.contextLostListener),t.addEventListener("webglcontextrestored",this.contextRestoredListener)}var e=t.prototype;return e.dispose=function(){this.canvas&&(this.canvas.removeEventListener("webglcontextlost",this.contextLostListener),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredListener)),this.gl=null,this.canvas=null},e.addLostHandler=function(t){this.lostHandlers.push(t)},e.removeLostHandler=function(t){var e=this.lostHandlers.indexOf(t);e>-1&&this.lostHandlers.splice(e,1)},e.addRestoreHandler=function(t){this.restoreHandlers.push(t)},e.removeRestoreHandler=function(t){var e=this.restoreHandlers.indexOf(t);e>-1&&this.restoreHandlers.splice(e,1)},t}(),ep=function(t){function e(e){var r;return(r=t.call(this)||this).gpuCapability=new Us(e),r}Ri(e,t);var r=e.prototype;return r.dispose=function(){this.isDestroyed||t.prototype.dispose.call(this)},r.getGLRenderer=function(){return this.renderer},r.getGLRendererInternal=function(){return this.getGLRenderer().glRenderer},r.getGLPipelineContext=function(){return this.getGLRenderer().pipelineContext},e}(Of),rp=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).initialized=!1,void 0!==r&&i.initialize(r),i}Ri(e,t);var r=e.prototype;return r.initialize=function(t){this.initialized||(this.initialized=!0,this.renderer=t,this.buffer=t.createGLRenderbuffer(this))},r.setSize=function(t,e){if(this.initialized){if(this.renderer&&(t!==this.size[0]||e!==this.size[1])){var r=this.renderer,i=r.gl;r.pipelineContext.bindRenderbuffer(i.RENDERBUFFER,this.buffer),t&&e?i.renderbufferStorage(i.RENDERBUFFER,this.format,this.size[0]=t,this.size[1]=e):Yr.error("Invalid render buffer size: "+t+"x"+e+".")}}else Yr.error("Can't set size for uninitialized render buffer.")},r.dispose=function(){this.renderer&&(this.renderer.deleteGLRenderbuffer(this),this.renderer=null,this.buffer=null),this.destroyed=!0,this.initialize=ti},e}(Ds),ip=1,np=function(t){function e(e,r){var i;(i=t.call(this)||this).attachmentTextures=[];var n,o=e.depthStencilAttachment,s=e.viewport,a=e.isCustomViewport,u=e.storeAction,c=e.viewportScale,h=void 0===c?1:c,l=e.name,f=void 0===l?"GLFramebuffer"+ip++:l;return i.renderer=r,i.engine=r.engine,i.depthStencilStorageType=null!=(n=null==o?void 0:o.storageType)?n:exports.RenderPassAttachmentStorageType.none,i.viewport=s,i.isCustomViewport=!!a,i.viewportScale=h,i.name=f,i.storeAction=u,i.updateProps(e),i}Ri(e,t);var r=e.prototype;return r.getDepthTexture=function(){return this.depthTexture},r.getStencilTexture=function(){return this.stencilTexture},r.getColorTextures=function(){return this.colorTextures},r.updateAttachmentTextures=function(){var t=this;this.attachmentTextures.length=0,this.colorTextures.forEach((function(e){e.initialize(),xr(t.attachmentTextures,e.textureBuffer)})),this.stencilTexture&&xr(this.attachmentTextures,this.stencilTexture.textureBuffer),this.depthTexture&&xr(this.attachmentTextures,this.depthTexture.textureBuffer)},r.updateProps=function(t){var e,r,i=this.renderer,n=this.engine.gpuCapability,o=null!=(r=t.depthStencilAttachment)?r:{storageType:exports.RenderPassAttachmentStorageType.none},s=t.attachments.length>0,a=!0;if(this.externalStorage=!1,t.attachments.length>1&&!n.detail.drawBuffers)throw new Error("Multiple color attachments not support.");var u=null==(e=t.depthStencilAttachment)?void 0:e.texture,c=n.detail.readableDepthStencilTextures,h=o.storageType,l=o.storage;if(this.colorTextures=t.attachments.slice(),!s&&h!==exports.RenderPassAttachmentStorageType.none)throw new Error("Use depth stencil attachment without color attachments.");switch(s&&(this.fbo=i.glRenderer.createGLFramebuffer(this,this.name)),h){case exports.RenderPassAttachmentStorageType.depth_stencil_opaque:if(l){if(!hr(l,rp))throw new Error("Invalid depth stencil attachment storage.");this.depthStencilRenderbuffer=l,this.externalStorage=!0}else this.depthStencilRenderbuffer=new rp({format:jn.DEPTH_STENCIL,attachment:jn.DEPTH_STENCIL_ATTACHMENT,storageType:h},i.glRenderer);a=!1;break;case exports.RenderPassAttachmentStorageType.depth_16_opaque:if(l){if(!hr(l,rp))throw new Error("Invalid depth attachment storage.");this.depthStencilRenderbuffer=l,this.externalStorage=!0}else this.depthStencilRenderbuffer=new rp({attachment:jn.DEPTH_ATTACHMENT,format:jn.DEPTH_COMPONENT16,storageType:h},i.glRenderer);break;case exports.RenderPassAttachmentStorageType.stencil_8_opaque:if(l){if(!hr(l,rp))throw new Error("Invalid stencil attachment storage.");this.depthStencilRenderbuffer=l,this.externalStorage=!0}else this.depthStencilRenderbuffer=new rp({attachment:jn.STENCIL_ATTACHMENT,format:jn.STENCIL_INDEX8,storageType:h},i.glRenderer);break;case exports.RenderPassAttachmentStorageType.depth_16_texture:if(!c)throw new Error("Depth texture is not support in framebuffer.");this.depthTexture=null!=u?u:new Ff(this.engine,{sourceType:exports.TextureSourceType.framebuffer,format:jn.DEPTH_COMPONENT,internalFormat:n.internalFormatDepth16,type:jn.UNSIGNED_SHORT,name:this.name+"##depthTex"}),this.depthTexture.initialize();break;case exports.RenderPassAttachmentStorageType.depth_24_stencil_8_texture:if(!c)throw new Error("Depth stencil texture is not support in framebuffer.");this.depthTexture=this.stencilTexture=null!=u?u:new Ff(this.engine,{sourceType:exports.TextureSourceType.framebuffer,format:jn.DEPTH_STENCIL,internalFormat:n.internalFormatDepth24_stencil8,type:n.UNSIGNED_INT_24_8,name:this.name+"##dpthStclTex"}),this.depthTexture.initialize(),a=!0}this.storeInvalidAttachments=this.getStoreAttachments(this.storeAction,a),this.updateAttachmentTextures()},r.getStoreAttachments=function(t,e){var r=this.renderer.glRenderer.gl,i=this.colorTextures.length;if(t&&Wn(r)&&i>0){var n=[];if(t.depthAction===exports.TextureStoreAction.clear&&this.depthStorage&&xr(n,e?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT),t.stencilAction===exports.TextureStoreAction.clear&&this.stencilStorage&&xr(n,e?r.STENCIL_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT),t.colorAction===exports.TextureStoreAction.clear)for(var o=0;o<i;o++)xr(n,r["COLOR_ATTACHMENT"+o]);return n}},r.unbind=function(){var t=this.storeInvalidAttachments;if(null==t?void 0:t.length){var e=this.renderer.glRenderer.gl;Wn(e)&&e.invalidateFramebuffer(e.FRAMEBUFFER,t)}this.renderer.pipelineContext.bindSystemFramebuffer()},r.bind=function(){var t=this;if(this.fbo){var e=this.renderer.glRenderer.gl,r=this.renderer.pipelineContext,i=this.viewport,n=i[0],o=i[1],s=i[2],a=i[3];r.bindFramebuffer(e.FRAMEBUFFER,this.fbo),r.viewport(n,o,s,a);var u=this.renderer.glRenderer.emptyTexture2D.textureBuffer;Object.keys(r.textureUnitDict).forEach((function(e){var i=r.textureUnitDict[e];i&&i!==u&&t.attachmentTextures.includes(i)&&(r.activeTexture(+e),t.renderer.glRenderer.emptyTexture2D.bind())}));for(var c=0;c<4;c++)r.activeTexture(e.TEXTURE0+c),this.renderer.glRenderer.emptyTexture2D.bind();if(!this.ready){var h=this,l=h.depthStencilRenderbuffer,f=h.depthTexture,p=h.stencilTexture;if(r.activeTexture(e.TEXTURE0),l)l.setSize(s,a),e.framebufferRenderbuffer(e.FRAMEBUFFER,l.attachment,e.RENDERBUFFER,l.buffer);else if(f){f.source.data={width:s,height:a},f.update({data:{width:s,height:a,data:new Uint16Array(0)}});var d=f&&p?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.framebufferTexture2D(e.FRAMEBUFFER,d,e.TEXTURE_2D,f.textureBuffer,0)}this.resetColorTextures(this.colorTextures);var m=e.checkFramebufferStatus(e.FRAMEBUFFER);if(m!==e.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer failed, status: "+m+", error: "+e.getError()+".");this.ready=!0}}},r.resetColorTextures=function(t){var e=t,r=this.renderer.glRenderer.gl,i=this.engine.gpuCapability,n=this.viewport,o=[];if(e){for(var s,a=wn(e);!(s=a()).done;){s.value.initialize()}this.colorTextures=e.slice()}this.renderer.pipelineContext.activeTexture(r.TEXTURE0),this.colorTextures.forEach((function(t,e){var s={width:n[2],height:n[3],data:new Uint8Array(0)};t.update({data:s}),i.framebufferTexture2D(r,r.FRAMEBUFFER,e,r.TEXTURE_2D,t.textureBuffer),o.push(!0)})),i.drawBuffers(r,o),this.updateAttachmentTextures()},r.resize=function(t,e,r,i){var n=this.viewport,o=n[0],s=n[1],a=n[2],u=n[3];o===t&&s===e&&a===r&&u===i||(this.viewport=[t,e,r,i],this.ready=!1,this.bind())},r.dispose=function(t){if(this.renderer){this.renderer.glRenderer.deleteGLFramebuffer(this),delete this.fbo;var e,r,i=(null==t?void 0:t.depthStencilAttachment)?t.depthStencilAttachment:exports.RenderPassDestroyAttachmentType.force;if(i===exports.RenderPassDestroyAttachmentType.force||i===exports.RenderPassDestroyAttachmentType.keepExternal&&!this.externalStorage)null==(e=this.depthStencilRenderbuffer)||e.dispose(),null==(r=this.depthTexture)||r.dispose();this.renderer=this.stencilRenderbuffer=this.depthStencilRenderbuffer=null}},nn(e,[{key:"stencilStorage",get:function(){if(this.depthStencilStorageType!==exports.RenderPassAttachmentStorageType.depth_16_opaque)return this.depthStencilRenderbuffer}},{key:"depthStorage",get:function(){if(this.depthStencilStorageType!==exports.RenderPassAttachmentStorageType.stencil_8_opaque)return this.depthStencilRenderbuffer}}]),e}(Xs);var op,sp,ap=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return e>>>0},up=((op={})[jn.FLOAT]=1,op[jn.INT]=1,op[jn.UNSIGNED_INT]=1,op[jn.SHORT]=1,op[jn.BOOL]=1,op[jn.UNSIGNED_SHORT]=1,op[jn.FLOAT_VEC2]=2,op[jn.FLOAT_VEC3]=3,op[jn.FLOAT_VEC4]=4,op[jn.FLOAT_MAT2]=4,op[jn.FLOAT_MAT3]=9,op[jn.FLOAT_MAT4]=16,op[jn.FLOAT_MAT2x3]=6,op[jn.FLOAT_MAT2x4]=8,op[jn.FLOAT_MAT4x3]=12,op[jn.FLOAT_MAT4x2]=8,op[jn.FLOAT_MAT3x4]=12,op[jn.FLOAT_MAT3x2]=6,op[jn.INT_VEC2]=2,op[jn.INT_VEC3]=3,op[jn.INT_VEC4]=4,op[jn.UNSIGNED_INT_VEC2]=2,op[jn.UNSIGNED_INT_VEC3]=3,op[jn.UNSIGNED_INT_VEC4]=4,op[jn.BOOL_VEC2]=2,op[jn.BOOL_VEC3]=3,op[jn.BOOL_VEC4]=4,op),cp=pp(Float32Array),hp=pp(Int32Array),lp=pp(Uint8Array);function fp(t){return function(e,r,i,n){var o={start:r[1],dirty:!0};if(r[2]>1){var s=e;if(s.length){for(var a=n[1]||s.length,u=r[4]/t.BYTES_PER_ELEMENT,c=o.buffer=new t(a*u),h=n[0]||0,l=0;l<a;l++)c[l*u]=s[l+h];o.start+=h*u}}else o.buffer=new t([e]);return o}}function pp(t){return function(e,r,i,n){for(var o=r[8],s=r[2],a=r[5],u=1===s?o:r[4],c=a?u/a:1,h=u/t.BYTES_PER_ELEMENT/c,l=o/t.BYTES_PER_ELEMENT/h,f=up[r[0]],p=f/c,d=(n[0]||0)*f,m=n[1]?c*n[1]:l,v=new t(h*m),y={start:r[1]+u*(n[0]||0),dirty:!0,buffer:v},g=0,_=0,E=d;g<m;g++){for(var x=0;x<p;x++)v[_+x]=e[E+x];_+=h,E+=p}return y}}function dp(t,e){for(var r=function(r){var o=t.getActiveUniformBlockName(e,r);zr(o);var s={index:t.getUniformBlockIndex(e,o),usedByVertexShader:t.getActiveUniformBlockParameter(e,r,t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:t.getActiveUniformBlockParameter(e,r,t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:t.getActiveUniformBlockParameter(e,r,t.UNIFORM_BLOCK_DATA_SIZE),uniformIndices:t.getActiveUniformBlockParameter(e,r,t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES),used:!1,uniforms:{},name:o,id:""};s.used=s.usedByVertexShader||s.usedByFragmentShader,i[r]=s;for(var a=s.uniformIndices,u=[],c=0;c<a.length;c++){var h=t.getActiveUniform(e,a[c]).name.replace("[0]","");s.uniforms[h]=[0,0,0,0,0,0,0,c,0],u[c]=h,n.push(h)}[t.UNIFORM_TYPE,t.UNIFORM_OFFSET,t.UNIFORM_SIZE,t.UNIFORM_BLOCK_INDEX,t.UNIFORM_ARRAY_STRIDE,t.UNIFORM_MATRIX_STRIDE,t.UNIFORM_IS_ROW_MAJOR].forEach((function(r,i){t.getActiveUniforms(e,a,r).forEach((function(t,e){var r=u[e];s.uniforms[r][i]=+t}))}));for(var l=0;l<u.length;l++){var f=s.uniforms[u[l]],p=s.uniforms[u[l+1]],d=p?p[1]:s.size;f[8]=d-f[1]}s.id=function(t){var e=t.name,r=t.size,i=t.uniforms,n=t.uniformIndices;return Object.keys(i).map((function(t){return t+"["+i[t].join(":")+"]"})).join("+"),ap(e+"+",r+"+",n.length+"+")}(s)+""},i=[],n=[],o=t.getProgramParameter(e,t.ACTIVE_UNIFORM_BLOCKS),s=0;s<o;++s)r(s);return{blockSpecs:i,blockUniformNames:n}}(sp={})[jn.FLOAT]=fp(Float32Array),sp[jn.INT]=fp(Int32Array),sp[jn.UNSIGNED_INT]=fp(Uint32Array),sp[jn.SHORT]=fp(Int16Array),sp[jn.BOOL]=fp(Uint8Array),sp[jn.UNSIGNED_SHORT]=fp(Uint16Array),sp[jn.FLOAT_VEC2]=cp,sp[jn.FLOAT_VEC3]=cp,sp[jn.FLOAT_VEC4]=cp,sp[jn.FLOAT_MAT2]=cp,sp[jn.FLOAT_MAT3]=cp,sp[jn.FLOAT_MAT4]=cp,sp[jn.FLOAT_MAT2x3]=cp,sp[jn.FLOAT_MAT2x4]=cp,sp[jn.FLOAT_MAT4x3]=cp,sp[jn.FLOAT_MAT4x2]=cp,sp[jn.FLOAT_MAT3x4]=cp,sp[jn.FLOAT_MAT3x2]=cp,sp[jn.INT_VEC2]=hp,sp[jn.INT_VEC3]=hp,sp[jn.INT_VEC4]=hp,sp[jn.UNSIGNED_INT_VEC2]=hp,sp[jn.UNSIGNED_INT_VEC3]=hp,sp[jn.UNSIGNED_INT_VEC4]=hp,sp[jn.BOOL_VEC2]=lp,sp[jn.BOOL_VEC3]=lp,sp[jn.BOOL_VEC4]=lp;var mp=function(){function t(t,e,r){var i=this;this.engine=t,this.program=e,this.id=r,this.uniformBlockMap={},this.pipelineContext=t.getGLPipelineContext();var n=this.pipelineContext.gl;(this.pipelineContext.useProgram(e),this.attribInfoMap=this.createAttribMap(),Wn(n))&&dp(n,e).blockSpecs.forEach((function(t){return i.uniformBlockMap[t.name]=t}));this.pipelineContext.useProgram(null)}var e=t.prototype;return e.bind=function(){this.pipelineContext.useProgram(this.program)},e.setupAttributes=function(t){var e,r,i=this,n=this.id,o=this.pipelineContext.gl;return t.vaos[n]?r=t.vaos[n]:((r=new Df(this.engine,t.name+"-"+n))||console.error("Failed to create VAO object."),t.vaos[n]=r),r&&r.vao&&(r.bind(),r.ready)||(Object.keys(this.attribInfoMap).forEach((function(e){var r=i.attribInfoMap[e],n=t.attributes[e];if(n){var s=t.buffers[n.dataSource];if(!s)throw new Error("Failed to find a buffer named '"+(n.dataSource||e)+"'. Please ensure the buffer is correctly initialized and bound.");s.bind(),o.enableVertexAttribArray(r.loc),o.vertexAttribPointer(r.loc,n.size,n.type,n.normalize,n.stride||0,n.offset||0)}})),null==(e=t.indicesBuffer)||e.bind(),r&&(r.ready=!0)),r},e.createAttribMap=function(){for(var t=this.pipelineContext.gl,e=this.program,r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var o=t.getActiveAttrib(e,n);if(o){var s=o.name,a=o.type,u=o.size,c=t.getAttribLocation(e,s);r[s]={type:a,name:s,size:u,loc:c}}}return r},e.dispose=function(){this.pipelineContext&&(this.pipelineContext.gl.deleteProgram(this.program),this.pipelineContext=null)},t}(),vp=function(t){function e(e,r){var i;return(i=t.call(this,e,r)||this).initialized=!1,i.uniformLocations={},i.samplerChannels={},i}Ri(e,t);var r=e.prototype;return r.initialize=function(){this.initialized||this.engine.getGLPipelineContext().shaderLibrary.compileShader(this)},r.setFloat=function(t,e){this.pipelineContext.setFloat(this.uniformLocations[t],e)},r.setInt=function(t,e){this.pipelineContext.setInt(this.uniformLocations[t],e)},r.setFloats=function(t,e){this.pipelineContext.setFloats(this.uniformLocations[t],e)},r.setTexture=function(t,e){this.pipelineContext.setTexture(this.uniformLocations[t],this.samplerChannels[t],e)},r.setVector2=function(t,e){this.pipelineContext.setVector2(this.uniformLocations[t],e)},r.setVector3=function(t,e){this.pipelineContext.setVector3(this.uniformLocations[t],e)},r.setVector4=function(t,e){this.pipelineContext.setVector4(this.uniformLocations[t],e)},r.setColor=function(t,e){this.pipelineContext.setColor(this.uniformLocations[t],e)},r.setQuaternion=function(t,e){this.pipelineContext.setQuaternion(this.uniformLocations[t],e)},r.setMatrix=function(t,e){this.pipelineContext.setMatrix(this.uniformLocations[t],e)},r.setMatrix3=function(t,e){this.pipelineContext.setMatrix3(this.uniformLocations[t],e)},r.setVector4Array=function(t,e){this.pipelineContext.setVector4Array(this.uniformLocations[t],e)},r.setMatrixArray=function(t,e){this.pipelineContext.setMatrixArray(this.uniformLocations[t],e)},r.fillShaderInformation=function(t,e){var r=e.slice();t=t.concat(r);for(var i,n=this.pipelineContext.getUniforms(this.program.program,t),o=0;o<t.length;o++)this.uniformLocations[t[o]]=n[o];for(i=0;i<r.length;i++){null==this.uniformLocations[r[i]]&&(r.splice(i,1),i--)}for(i=0;i<r.length;i++){var s=r[i];this.samplerChannels[s]=i}},r.toData=function(){var t=this.taggedProperties;t.dataType=qi.Shader,t.id=this.guid,t.vertex=this.source.vertex,t.fragment=this.source.fragment},r.dispose=function(){var t;this.compileResult&&this.compileResult.shared||null==(t=this.program)||t.dispose()},e}(Ln),yp=0,gp=function(){function t(t,e){this.engine=t,this.pipelineContext=e,this.shaderResults={},this.programMap={},this.glVertShaderMap=new Map,this.glFragShaderMap=new Map,this.shaderAllDone=!1,this.cachedShaders={},this.glAsyncCompileExt=t.gpuCapability.glAsyncCompileExt}var e=t.prototype;return e.compileAllShaders=function(t){var e=this;if(this.shaderAllDone)t&&t([]);else{for(var r,i=[],n=wn(Object.keys(this.cachedShaders));!(r=n()).done;){var o=r.value;this.cachedShaders[o].initialized||i.push(o)}t?i.length?Promise.all(i.map((function(t){return new Promise((function(r){return e.compileShader(e.cachedShaders[t],r)}))}))).then(t).catch((function(){return 0})):t([]):i.map((function(t){return e.compileShader(e.cachedShaders[t])})),this.shaderAllDone=!0}},e.addShader=function(t,e){var r,i,n=[];t.macros&&(r=n).push.apply(r,[].concat(t.macros));e&&(i=n).push.apply(i,[].concat(e));var o=to({},t,{vertex:Ts.genFinalShaderCode({level:this.engine.gpuCapability.level,shaderType:exports.ShaderType.vertex,shader:t.vertex,macros:n}),fragment:Ts.genFinalShaderCode({level:this.engine.gpuCapability.level,shaderType:exports.ShaderType.fragment,shader:t.fragment,macros:n})}),s=this.computeShaderCacheId(o);if(this.cachedShaders[s])return s;this.shaderAllDone=!1;var a=!1;return(o.shared||o.cacheId)&&(a=!0),this.cachedShaders[s]=new vp(this.engine,to({},o,{vertex:o.vertex,fragment:o.fragment,name:o.name||s,shared:a})),this.cachedShaders[s].id=s,s},e.createShader=function(t,e){var r=this.addShader(t,e);return this.cachedShaders[r]},e.compileShader=function(t,e){var i=this,n=t.source,o=n.shared,s=n.vertex,a=n.fragment,u=n.name,c=t.source.cacheId,h=!1;(o||c)&&(h=!0);var l=this.pipelineContext.gl,f={shared:h,status:exports.ShaderCompileResultStatus.compiling},p=this.createProgram(l,s,a,f),d=this.glAsyncCompileExt,m=r.performance.now(),v=function(e){f.status=exports.ShaderCompileResultStatus.success,f.compileTime=r.performance.now()-m,t.program=e,t.initialized=!0,t.pipelineContext=i.pipelineContext,void 0!==i.programMap[t.id]&&console.warn("Find duplicated shader id: "+t.id+"."),i.programMap[t.id]=e},y=function(){if(i.engine.isDestroyed)return console.warn("The player is destroyed during the loadScene process. Please check the timing of calling loadScene and dispose. A common situation is that when calling loadScene, await is not added. This will cause dispose to be called before loadScene is completed."),null==e?void 0:e(f);if(t.initialized)return null==e?void 0:e(f);var n=(!e||!d||d&&1==l.getProgramParameter(f.program,d.COMPLETION_STATUS_KHR))&&p();if(n){if(f.status!==exports.ShaderCompileResultStatus.fail){Bf(n,u);var o=new mp(i.engine,n,t.id);if(l.validateProgram(n),l.getProgramParameter(n,l.VALIDATE_STATUS))v(o);else{var c=l.getProgramInfoLog(n);(null==c?void 0:c.includes("the same texture"))?v(o):(f.status=exports.ShaderCompileResultStatus.fail,f.error=c,console.error("compileProgramError: "+c,"\nvertex:\n",s,"\nfragment:\n",a),l.deleteProgram(n))}}null==e||e(f)}else e&&r.requestAnimationFrame(y)};t.compileResult=f,y()},e.computeShaderCacheId=function(t){var e,r=t.vertex,i=void 0===r?"":r,n=t.fragment,o=void 0===n?"":n,s=t.shared,a=t.cacheId;return e=s||a?a||"shared_"+function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var i=0,n=0;n<arguments.length;n++)for(var o=e[n],s=0;s<o.length;s++)i=Math.imul(31,i)+o.charCodeAt(s)|0;return i}(i,o):"instanced_"+yp++,e},e.createProgram=function(t,e,r,i){var n=t.createProgram(),o=this.createGLShader(t,t.VERTEX_SHADER,e),s=this.createGLShader(t,t.FRAGMENT_SHADER,r);return n&&o&&s?(t.attachShader(n,o),t.attachShader(n,s),t.linkProgram(n),i.program=n,i.status=exports.ShaderCompileResultStatus.compiling,function(){if(i.program=void 0,!t.getProgramParameter(n,t.LINK_STATUS)){var a=t.getProgramInfoLog(n);console.error("Failed to link program: "+a+".");var u=_p(t,o,"vertex",e),c=_p(t,s,"fragment",r);return i.status=exports.ShaderCompileResultStatus.fail,u&&(i.error=u.error,i.status=u.status),c&&(i.error=c.error,i.status=c.status),n}return n}):(i.status=exports.ShaderCompileResultStatus.fail,function(){return null})},e.createGLShader=function(t,e,r){var i=e===t.VERTEX_SHADER?this.glVertShaderMap:this.glFragShaderMap,n=ap(null!=r?r:""),o=i.get(n);if(o)return o;var s=t.createShader(e);return s&&(t.shaderSource(s,r),t.compileShader(s),i.set(n,s)),s},e.deleteShader=function(t){var e=this.programMap[t];void 0!==e&&(e.dispose(),delete this.programMap[t]),void 0!==this.shaderResults[t]&&delete this.shaderResults[t]},e.restore=function(){},e.dispose=function(){var t=this;if(Object.keys(this.programMap).forEach((function(e){t.programMap[e].dispose()})),this.programMap={},this.pipelineContext){var e=this.pipelineContext.gl;this.glFragShaderMap.forEach((function(t){e.deleteShader(t)})),this.glVertShaderMap.forEach((function(t){e.deleteShader(t)})),this.glVertShaderMap=new Map,this.glFragShaderMap=new Map}},t}();function _p(t,e,r,i){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(e);return console.error("compile "+r+" error: "+n,(null!=i?i:"").split("\n").map((function(t,e){return e+1+" "+t})).join("\n")),{error:n,status:exports.ShaderCompileResultStatus.fail}}}var Ep=function(){function t(t,e){this.engine=t,this.gl=e,this.gl=e,this.shaderLibrary=new gp(t,this),this.maxTextureCount=this.gl.TEXTURE0+this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)-1,this.reset()}var e=t.prototype;return e.dispose=function(){this.shaderLibrary.dispose(),this.reset()},e.reset=function(){this.glCapabilityCache={},this.activeTextureIndex=jn.TEXTURE0,this.textureUnitDict={},this.currentFramebuffer={},this.pixelStorei={},this.currentRenderbuffer={}},e.toggle=function(t,e){e?this.enable(t):this.disable(t)},e.enable=function(t){!0!==this.glCapabilityCache[t]&&(this.glCapabilityCache[t]=!0,this.gl.enable(t))},e.disable=function(t){!1!==this.glCapabilityCache[t]&&(this.glCapabilityCache[t]=!1,this.gl.disable(t))},e.bindFramebuffer=function(t,e){this.currentFramebuffer[t]!==e&&(this.currentFramebuffer[t]=e,this.gl.bindFramebuffer(t,e))},e.bindRenderbuffer=function(t,e){this.currentRenderbuffer[t]!==e&&(this.currentRenderbuffer[t]=e,this.gl.bindRenderbuffer(t,e))},e.bindSystemFramebuffer=function(){this.bindFramebuffer(this.gl.FRAMEBUFFER,null)},e.useProgram=function(t){this.set1("useProgram",t)},e.clear=function(t){this.gl.clear(t)},e.clearDepth=function(t){this.set1("clearDepth",t)},e.depthFunc=function(t){this.set1("depthFunc",t)},e.depthMask=function(t){this.set1("depthMask",t)},e.polygonOffset=function(t,e){this.set2("polygonOffset",t,e)},e.depthRange=function(t,e){this.set2("depthRange",t,e)},e.clearStencil=function(t){this.set1("clearStencil",t)},e.stencilMask=function(t){this.stencilMaskSeparate(this.gl.FRONT,t),this.stencilMaskSeparate(this.gl.BACK,t)},e.stencilFunc=function(t,e,r){this.stencilFuncSeparate(this.gl.FRONT,t,e,r),this.stencilFuncSeparate(this.gl.BACK,t,e,r)},e.stencilFuncSeparate=function(t,e,r,i){this.set4("stencilFuncSeparate",t,e,r,i)},e.stencilMaskSeparate=function(t,e){this.set2("stencilMaskSeparate",t,e)},e.stencilOp=function(t,e,r){this.stencilOpSeparate(this.gl.FRONT,t,e,r),this.stencilOpSeparate(this.gl.BACK,t,e,r)},e.stencilOpSeparate=function(t,e,r,i){this.set4("stencilOpSeparate",t,e,r,i)},e.cullFace=function(t){this.set1("cullFace",t)},e.frontFace=function(t){this.set1("frontFace",t)},e.clearColor=function(t,e,r,i){this.set4("clearColor",t,e,r,i)},e.colorMask=function(t,e,r,i){this.set4("colorMask",t,e,r,i)},e.blendColor=function(t,e,r,i){this.set4("blendColor",t,e,r,i)},e.blendFunc=function(t,e){this.blendFuncSeparate(t,e,t,e)},e.blendFuncSeparate=function(t,e,r,i){this.set4("blendFuncSeparate",t,e,r,i)},e.blendEquation=function(t){this.set1("blendEquation",t)},e.blendEquationSeparate=function(t,e){this.set2("blendEquationSeparate",t,e)},e.setPixelStorei=function(t,e){this.pixelStorei[t]!==e&&(this.pixelStorei[t]=e,this.gl.pixelStorei(t,e))},e.viewport=function(t,e,r,i){this.set4("viewport",t,e,r,i)},e.activeTexture=function(t){t=Math.min(t,this.maxTextureCount),this.activeTextureIndex!==t&&(this.activeTextureIndex=t,this.gl.activeTexture(t))},e.bindTexture=function(t,e,r){(this.currentTextureBinding!==e||r)&&(this.gl.bindTexture(t,e),this.currentTextureBinding=e),this.textureUnitDict[this.activeTextureIndex]=e},e.set1=function(t,e){this.glCapabilityCache[t]!==e&&(this.glCapabilityCache[t]=e,this.gl[t](e))},e.set2=function(t,e,r){var i=this.glCapabilityCache[t];i||(i=this.glCapabilityCache[t]={x:NaN,y:NaN}),i.x===e&&i.y===r||this.gl[t](i.x=e,i.y=r)},e.set3=function(t,e,r,i){var n=this.glCapabilityCache[t];n||(n=this.glCapabilityCache[t]={x:NaN,y:NaN,z:NaN}),n.x===e&&n.y===r&&n.z===i||this.gl[t](n.x=e,n.y=r,n.z=i)},e.set4=function(t,e,r,i,n){var o=this.glCapabilityCache[t];o||(o=this.glCapabilityCache[t]={x:NaN,y:NaN,z:NaN,w:NaN}),o.x===e&&o.y===r&&o.z===i&&o.w===n||this.gl[t](o.x=e,o.y=r,o.z=i,o.w=n)},e.get=function(t){return this.glCapabilityCache[t]},e.setFloat=function(t,e){t&&this.gl.uniform1f(t,e)},e.setInt=function(t,e){t&&this.gl.uniform1i(t,e)},e.setFloats=function(t,e){t&&this.gl.uniform1fv(t,e)},e.setVector2=function(t,e){this.setFloat2(t,e.x,e.y)},e.setVector3=function(t,e){this.setFloat3(t,e.x,e.y,e.z)},e.setVector4=function(t,e){this.setFloat4(t,e.x,e.y,e.z,e.w)},e.setColor=function(t,e){this.setFloat4(t,e.r,e.g,e.b,e.a)},e.setQuaternion=function(t,e){this.setFloat4(t,e.x,e.y,e.z,e.w)},e.setVector4Array=function(t,e){t&&e.length%4==0&&this.gl.uniform4fv(t,e)},e.setMatrix=function(t,e){t&&this.gl.uniformMatrix4fv(t,!1,e.elements)},e.setMatrix3=function(t,e){t&&this.gl.uniformMatrix3fv(t,!1,e.elements)},e.setMatrixArray=function(t,e){t&&e.length%16==0&&this.gl.uniformMatrix4fv(t,!1,e)},e.setTexture=function(t,e,r){if(t){this.gl.activeTexture(this.gl.TEXTURE0+e);var i=r.target;this.gl.bindTexture(i,r.textureBuffer),this.gl.uniform1i(t,e)}},e.getUniforms=function(t,e){for(var r=[],i=0;i<e.length;i++)r.push(this.gl.getUniformLocation(t,e[i]));return r},e.setFloat4=function(t,e,r,i,n){t&&this.gl.uniform4f(t,e,r,i,n)},e.setFloat3=function(t,e,r,i){t&&this.gl.uniform3f(t,e,r,i)},e.setFloat2=function(t,e,r){t&&this.gl.uniform2f(t,e,r)},t}(),xp=function(t){function e(e,r,i){var n;(n=t.call(this)||this).canvas=e,n.temporaryRTs={};var o=to({preserveDrawingBuffer:void 0,alpha:!0,stencil:!0,antialias:!0,depth:!0,premultipliedAlpha:!0},i);n.context=new tp(e,r,o);var s=n.context.gl;return zr(s),n.engine=new ep(s),n.engine.renderer=Sn(n),n.pipelineContext=new Ep(n.engine,s),n.glRenderer=new Uf(n.engine),n.extension=new Jf(Sn(n)),n.renderingData={currentFrame:{}},n.framebuffer=new np({storeAction:{},viewport:[0,0,n.width,n.height],attachments:[new Ff(n.engine,{sourceType:exports.TextureSourceType.framebuffer,data:{width:n.width,height:n.height}})],depthStencilAttachment:{storageType:exports.RenderPassAttachmentStorageType.none}},Sn(n)),n}Ri(e,t);var r=e.prototype;return r.renderRenderFrame=function(t){var e,r=t;r.resource&&r.resource.color_b.initialize(),r.emptyTexture.initialize(),r.transparentTexture.initialize();var i=r._renderPasses;if(this.isDestroyed)console.error("Renderer is destroyed, target: GLRenderer.");else{null==(e=r.renderer.getShaderLibrary())||e.compileAllShaders(),this.setFramebuffer(null),this.clear(r.clearAction);var n=r.camera;this.renderingData.currentFrame=r,this.renderingData.currentCamera=n,this.setGlobalMatrix("effects_MatrixInvV",n.getInverseViewMatrix()),this.setGlobalMatrix("effects_MatrixV",n.getViewMatrix()),this.setGlobalMatrix("effects_MatrixVP",n.getViewProjectionMatrix()),this.setGlobalMatrix("_MatrixP",n.getProjectionMatrix()),this.setGlobalVector3("effects_WorldSpaceCameraPos",n.position),Vr(i);for(var o,s=wn(i);!(o=s()).done;){var a=o.value,u=a.delegate;null==u.willBeginRenderPass||u.willBeginRenderPass.call(u,a,this.renderingData),this.renderRenderPass(a),null==u.didEndRenderPass||u.didEndRenderPass.call(u,a,this.renderingData)}for(var c,h=wn(i);!(c=h()).done;){c.value.frameCleanup(this)}}},r.renderRenderPass=function(t){this.renderingData.currentPass=t,t.initialize(this),t.configure(this),t.execute(this)},r.renderMeshes=function(t){for(var e,r=this.renderingData.currentPass.delegate,i=wn(t);!(e=i()).done;){var n=e.value;null==r.willRenderMesh||r.willRenderMesh.call(r,n,this.renderingData),n.render(this),null==r.didRenderMesh||r.didRenderMesh.call(r,n,this.renderingData)}},r.setGlobalFloat=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.floats[t]=e},r.setGlobalVector4=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.vector4s[t]=e},r.getGlobalVector4=function(t){return this.renderingData.currentFrame.globalUniforms.vector4s[t]},r.setGlobalInt=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.ints[t]=e},r.setGlobalMatrix=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.matrices[t]=e},r.setGlobalVector3=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.vector3s[t]=e},r.drawGeometry=function(t,e,r){if(void 0===r&&(r=0),t&&e){e.initialize(),t.initialize(),t.flush();var i=this.renderingData;i.currentFrame.editorTransform&&e.setVector4("uEditorTransform",i.currentFrame.editorTransform);try{e.use(this,i.currentFrame.globalUniforms)}catch(t){return void console.error(t)}this.glRenderer.drawGeometry(t,e,r)}},r.setFramebuffer=function(t){t?(this.framebuffer=t,this.framebuffer.bind(),this.setViewport(t.viewport[0],t.viewport[1],t.viewport[2],t.viewport[3])):(this.pipelineContext.bindSystemFramebuffer(),this.setViewport(0,0,this.getWidth(),this.getHeight()))},r.getFramebuffer=function(){return this.framebuffer},r.getTemporaryRT=function(t,e,r,i,n,o){if(this.temporaryRTs[t])return this.temporaryRTs[t];var s,a,u=exports.RenderPassAttachmentStorageType.none;n===exports.FilterMode.Linear?s=jn.LINEAR:n===exports.FilterMode.Nearest&&(s=jn.NEAREST),o===exports.RenderTextureFormat.RGBA32?a=jn.UNSIGNED_BYTE:o===exports.RenderTextureFormat.RGBAHalf&&(a=jn.HALF_FLOAT),0===i?u=exports.RenderPassAttachmentStorageType.none:16===i?u=exports.RenderPassAttachmentStorageType.depth_16_opaque:24===i&&(u=exports.RenderPassAttachmentStorageType.depth_24_stencil_8_texture);var c=new Ff(this.engine,{sourceType:exports.TextureSourceType.framebuffer,minFilter:s,magFilter:s,internalFormat:jn.RGBA,format:jn.RGBA,type:a}),h=new np({name:t,storeAction:{},viewport:[0,0,e,r],viewportScale:1,isCustomViewport:!0,attachments:[c],depthStencilAttachment:{storageType:u}},this);return this.temporaryRTs[t]=h,h},r.setViewport=function(t,e,r,i){this.pipelineContext.viewport(t,e,r,i)},r.clear=function(t){var e=this.pipelineContext,r=0;if(t.colorAction===exports.TextureLoadAction.clear){var i=t.clearColor;i&&e.clearColor(i[0],i[1],i[2],i[3]),e.colorMask(!0,!0,!0,!0),r=jn.COLOR_BUFFER_BIT}if(t.stencilAction===exports.TextureLoadAction.clear&&(e.stencilMask(255),e.clearStencil(t.clearStencil||0),r|=jn.STENCIL_BUFFER_BIT),t.depthAction===exports.TextureLoadAction.clear){var n=t.clearDepth;e.depthMask(!0),e.clearDepth(Number.isFinite(n)?n:1),r|=jn.DEPTH_BUFFER_BIT}r&&e.clear(r)},r.addLostHandler=function(t){this.context.addLostHandler(t)},r.addRestoreHandler=function(t){this.context.addRestoreHandler(t)},r.getShaderLibrary=function(){return this.pipelineContext.shaderLibrary},r.getWidth=function(){return this.width},r.getHeight=function(){return this.height},r.dispose=function(){var t;this.context.dispose(),this.extension.dispose(),this.pipelineContext.dispose(),null==(t=this.glRenderer)||t.dispose(),this.canvas=null,this.engine.dispose()},r.lost=function(t){t.preventDefault(),this.pipelineContext.dispose(),this.extension.dispose(),this.glRenderer.lost(t)},r.restore=function(){var t=this.context.gl;if(!t)throw new Error("Can not restore automatically because losing gl context.");this.engine=new ep(t),this.engine.renderer=this,this.pipelineContext=new Ep(this.engine,t),this.glRenderer=new Uf(this.engine),this.extension=new Jf(this)},r.resize=function(t,e){var r=this.glRenderer;r&&(this.width===t&&this.height===e||r.resize(t,e))},r.checkGlobalUniform=function(t){var e=this.renderingData.currentFrame.globalUniforms;e.uniforms.includes(t)||e.uniforms.push(t)},nn(e,[{key:"isDestroyed",get:function(){var t=this.glRenderer;return!t||t.isDestroyed}},{key:"height",get:function(){var t,e;return null!=(e=null==(t=this.glRenderer)?void 0:t.height)?e:0}},{key:"width",get:function(){var t,e;return null!=(e=null==(t=this.glRenderer)?void 0:t.width)?e:0}}]),e}(Hs),Tp="https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#MvjnY",bp="https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#ulfNT",Ap="https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#lLlSW",Rp="https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#WZaWg",Sp="https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#YSWQr",Cp="https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#IzodZ",Op="https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#X0ulg";var Mp=new Map,Pp=!1,Ip=1,wp=function(t){function e(e){var i;(i=t.call(this)||this).builtinObjects=[],i.compositions=[],i.displayScale=1,i.resumePending=!1,i.disposed=!1,i.assetManagers=[],i.speed=1,i.baseCompositionIndex=0,i.lost=function(t){var e;null==(e=i.ticker)||e.pause(),i.compositions.forEach((function(e){return e.lost(t)})),i.renderer.lost(t),i.emit("webglcontextlost",t),Lp(Sn(i),!1)};var n=Sn(i);i.restore=cr((function(){var t;return pr(this,(function(e){switch(e.label){case 0:return n.renderer.restore(),[4,Promise.all(n.compositions.map(cr((function(t){var e,r,i,o,s,a,u,c,h,l,f,p;return pr(this,(function(d){switch(d.label){case 0:return e=t.time,r=t.url,i=t.speed,o=t.keepResource,s=t.reusable,a=t.renderOrder,u=t.transform,c=t.videoState,[4,n.loadScene(r)];case 1:(h=d.sent()).speed=i,h.reusable=s,h.keepResource=o,h.renderOrder=a,h.transform.setPosition(u.position.x,u.position.y,u.position.z),h.transform.setRotation(u.rotation.x,u.rotation.y,u.rotation.z),h.transform.setScale(u.scale.x,u.scale.y,u.scale.z),l=0,d.label=2;case 2:return l<c.length?c[l]?((f=h.textures[l].source.video).currentTime=null!=(p=c[l])?p:0,[4,f.play()]):[3,4]:[3,5];case 3:d.sent(),d.label=4;case 4:return l++,[3,2];case 5:return h.isEnded=!1,h.gotoAndPlay(e),[2,h]}}))}))))];case 1:return n.compositions=e.sent(),n.emit("webglcontextrestored"),null==(t=n.ticker)||t.resume(),Pr()&&n.canvas&&(n.canvas.style.display="none",r.window.setTimeout((function(){n.canvas.style.display=""}),0)),[2]}}))})),i.handleResume=function(){i.emit("update",{player:Sn(i),playing:!0})},i.handleClick=function(t){var e=t.x,r=t.y;i.compositions.forEach((function(t){var n=t.hitTest(e,r);if(n.length)for(var o=0;o<n.length;o++){var s=n[o].behavior||yi.NOTIFY;s===yi.NOTIFY?(i.emit("click",to({},n[o],{compositionId:t.id,compositionName:t.name,player:Sn(i)})),t.emit("click",to({},n[o],{compositionId:t.id,compositionName:t.name}))):s===yi.RESUME_PLAYER&&i.resume()}}))};var o=e.container,s=e.canvas,a=e.fps,u=e.name,c=e.pixelRatio,h=e.manualRender,l=e.reportGPUTime,f=e.renderFramework,p=e.notifyTouch,d=e.interactive,m=void 0!==d&&d,v=e.renderOptions,y=void 0===v?{}:v,g=e.env,_=void 0===g?"":g,E=y.willCaptureImage,x=y.premultipliedAlpha;if(Hn.length)throw new Error("Errors before player create: "+Hn.map((function(t,e){return"\n "+(e+1)+": "+t}))+".");if(Pp||"debug-disable"===f)return qh(i);var T,b=Ir()||(T=/iPhone OS (\d+)_(\d+)/.exec(r.navigator.userAgent))&&("13"===T[1]||"16"===T[1]&&"5"===T[2])?"webgl":"webgl2";return f&&(b="webgl"===f?"webgl":"webgl2"),i.reportGPUTime=l,i.pixelRatio=Number.isFinite(c)?c:Mr(),i.offscreenMode=!0,i.env=_,i.name=u||""+Ip++,s?i.canvas=s:(Fp(o),i.canvas=r.document.createElement("canvas"),o.appendChild(i.canvas)),i.container=i.canvas.parentElement,i.renderer=Hs.create(i.canvas,b,{preserveDrawingBuffer:E,premultipliedAlpha:x}),i.renderer.env=_,i.renderer.addLostHandler({lost:i.lost}),i.renderer.addRestoreHandler({restore:i.restore}),i.gpuCapability=i.renderer.engine.gpuCapability,i.builtinObjects.push(So(i.renderer.engine)),Mp.forEach((function(t){t.gpuCapability.type!==i.gpuCapability.type&&Yr.warn("Create player with different WebGL version: old="+t.gpuCapability.type+", new="+i.gpuCapability.type+".\nsee "+Op+".")})),h||(i.ticker=new Mf(a),i.ticker.add(i.tick.bind(Sn(i)))),i.event=new gu(i.canvas,!!p),i.event.bindListeners(),i.event.addEventListener(du,i.handleClick),i.interactive=m,i.resize(),Ru(i.gpuCapability.detail),Mp.set(i.canvas,Sn(i)),function(){for(var t,e=[],r=wn(Mp.values());!(t=r()).done;){var i=t.value;i.paused||e.push(i)}e.length>1&&Yr.error("Current running player count: "+e.length+", see "+Cp+".",e)}(),Lp(Sn(i),!0),i}Ri(e,t);var i=e.prototype;return i.setSpeed=function(t){isNaN(t)||(this.speed=t)},i.getSpeed=function(){return this.speed},i.getCompositionByName=function(t){return this.compositions.find((function(e){return e.name===t}))},i.getCompositions=function(){return this.compositions},i.getAssetManager=function(){return this.assetManagers},i.loadScene=function(t,e){var r=this;return cr((function(){var i,n,o;return pr(this,(function(s){switch(s.label){case 0:return o=r.baseCompositionIndex,qr(t)?(r.baseCompositionIndex+=t.length,[4,Promise.all(t.map(cr((function(t,i){var n;return pr(this,(function(s){switch(s.label){case 0:return[4,r.createComposition(t,e)];case 1:return(n=s.sent()).setIndex(o+i),[2,n]}}))}))))]):[3,2];case 1:return n=s.sent(),[3,4];case 2:return r.baseCompositionIndex+=1,[4,r.createComposition(t,e)];case 3:(n=s.sent()).setIndex(o),s.label=4;case 4:return null==(i=r.ticker)||i.start(),[2,n]}}))}))()},i.createComposition=function(t,e){void 0===e&&(e={});var i=this;return cr((function(){var n,o,s,a,u,c,h,l,f,p,d,m,v,y,g,_,E,x,T,b,A,R,S;return pr(this,(function(C){switch(C.label){case 0:return s=i.renderer,a=s.engine,u=null==(o=a.gpuCapability)||null==(n=o.detail)?void 0:n.asyncShaderCompile,c=r.performance.now(),h=to({autoplay:!0},e),l=t,exports.Scene.isURL(t)&&(exports.Scene.isJSONObject(t)||(l=t.url),exports.Scene.isWithOptions(t)&&(h=to({},h,t.options))),f=new Jl(h),a.clearResources(),i.assetManagers.push(f),[4,f.loadScene(l,i.renderer,{env:i.env})];case 1:for(p=C.sent(),a.addPackageDatas(p),d=wn(i.builtinObjects);!(m=d()).done;)v=m.value,a.addInstance(v);if(i.updateTextVariables(p,h.variables),i.disposed)throw new Error("Disposed player can not used to create Composition.");for(y=0;y<p.textureOptions.length;y++)hr(g=p.textureOptions[y],bo)?a.addInstance(g):(g=a.assetLoader.loadGUID(p.textureOptions[y].id),p.textureOptions[y]=g),g.initialize();return a.database?[4,a.createVFXItems(p)]:[3,3];case 2:C.sent(),C.label=3;case 3:if(_=new uf(to({},h,{renderer:s,width:s.getWidth(),height:s.getHeight(),event:i.event,handleItemMessage:function(t){i.emit("message",t)}}),p),i.ticker&&h.renderLevel===hi.B&&i.ticker.setFPS(Math.min(i.ticker.getFPS(),30)),i.env!==Xa)for(E=wn(Object.keys(i.renderer.engine.objectInstance));!(x=E()).done;)T=x.value,hr(b=i.renderer.engine.objectInstance[T],Bo)&&b.createShaderVariant();return A=r.performance.now(),[4,new Promise((function(t){var e;null==(e=i.renderer.getShaderLibrary())||e.compileAllShaders((function(){t(null)}))}))];case 4:return C.sent(),h.autoplay?(i.autoPlaying=!0,_.play()):_.pause(),R=r.performance.now()-A,S=r.performance.now()-c,_.statistic.compileTime=R,_.statistic.firstFrameTime=S,Yr.info("Shader "+(u?"async":"sync")+" compile ["+_.name+"]: "+R.toFixed(4)+"ms."),Yr.info("First frame ["+_.name+"]: "+S.toFixed(4)+"ms."),i.compositions.push(_),[2,_]}}))}))()},i.updateTextVariables=function(t,e){void 0===e&&(e={});var r=this.renderer.engine;t.jsonScene.items.forEach((function(t){if(t.type===gi.text||t.type===gi.richtext){var i=e[t.name];if(!i)return;t.components.forEach((function(t){var e=t.id,n=r.findEffectsObjectData(e);(null==n?void 0:n.dataType)!==qi.TextComponent&&(null==n?void 0:n.dataType)!==qi.RichTextComponent||(n.options.text=i)}))}}))},i.play=function(){var t;this.offscreenMode&&(this.resize(),this.offscreenMode=!1),this.autoPlaying=!0,this.compositions.map((function(t){t.play()})),null==(t=this.ticker)||t.start()},i.gotoAndPlay=function(t){this.offscreenMode&&(this.resize(),this.offscreenMode=!1),this.autoPlaying=!0,this.compositions.map((function(e){e.gotoAndPlay(t)})),this.ticker?this.ticker.start():this.doTick(0,!0)},i.gotoAndStop=function(t){var e;this.offscreenMode&&(this.resize(),this.offscreenMode=!1),this.autoPlaying=!1,this.compositions.map((function(e){e.gotoAndStop(t)})),this.ticker&&!(null==(e=this.ticker)?void 0:e.getPaused())||this.doTick(0,!0),this.emit("update",{player:this,playing:!1})},i.playSequence=function(t){for(var e,r=function(e){t[e].on("end",(function(){t[e+1].play()}))},i=0;i<t.length-1;i++)r(i);t[0].play(),null==(e=this.ticker)||e.start()},i.pause=function(t){var e;this.paused||(null==(e=this.ticker)||e.pause(),this.emit("pause"),this.emit("update",{player:this,playing:!1}),t&&t.offloadTexture&&this.offloadTexture())},i.resume=function(){var t=this;return cr((function(){var e;return pr(this,(function(r){switch(r.label){case 0:return t.resumePending?[2]:t.paused?(t.resumePending=!0,[4,Promise.all(t.compositions.map((function(t){return t.reloadTexture()})))]):[3,2];case 1:r.sent(),t.resumePending=!1,t.handleResume(),r.label=2;case 2:return null==(e=t.ticker)||e.resume(),[2]}}))}))()},i.tick=function(t){this.doTick(t,this.forceRenderNextFrame),this.forceRenderNextFrame=!1},i.doTick=function(t,e){var r,i=this,n=this.renderer.engine.renderErrors;n.size>0&&(this.emit("rendererror",n.values().next().value),null==(r=this.ticker)||r.pause());t=Math.min(t,33)*this.speed;var o=this.compositions,s=!1;o.sort((function(t,e){return t.getIndex()-e.getIndex()}));for(var a,u=[],c=0;c<o.length;c++){var h=o[c];h.textureOffloaded?(s=!0,Yr.error("Composition "+h.name+" texture offloaded, skip render."),u.push(h)):(!h.isDestroyed&&h.renderer&&h.update(t),h.isDestroyed||u.push(h))}if(this.compositions=u,this.baseCompositionIndex=this.compositions.length,s)return this.emit("rendererror",new Error("Play when texture offloaded.")),null==(a=this.ticker)?void 0:a.pause();if(!this.paused||e){var l=this.gpuCapability.level,f=this.renderer.context.gl,p=2===l&&this.reportGPUTime?kn(f):void 0;if(null==p||p.begin(),this.compositions.length||this.compositions.length<o.length||e){this.renderer.setFramebuffer(null),this.renderer.clear({stencilAction:exports.TextureLoadAction.clear,clearStencil:0,depthAction:exports.TextureLoadAction.clear,clearDepth:1,colorAction:exports.TextureLoadAction.clear,clearColor:[0,0,0,0]});for(var d=0;d<o.length;d++)!o[d].renderFrame.isDestroyed&&this.renderer.renderRenderFrame(o[d].renderFrame)}null==p||p.end(),null==p||p.getTime().then((function(t){return null==i.reportGPUTime?void 0:i.reportGPUTime.call(i,null!=t?t:0)})).catch,this.autoPlaying&&this.emit("update",{player:this,playing:!0})}},i.resizeToAspect=function(t,e){void 0===e&&(e=1),t!==this.displayAspect&&(this.displayAspect=t),e!==this.displayScale&&(this.displayScale=e),this.resize()},i.resize=function(){var t,e,i,n,o=this.canvas.parentElement;if(o){var s=this.getTargetSize(o);t=s[0],e=s[1],i=s[2],n=s[3]}else t=i=this.canvas.width,e=n=this.canvas.height;var a=t/e;if(t&&e){var u,c=r.document.documentElement.clientWidth;i>2*c&&Yr.error("DPI overflowed, width "+i+" is more than 2x document width "+c+", see "+bp+".");var h=this.env?this.gpuCapability.detail.maxTextureSize:2048;(i>h||n>h)&&(Yr.error("Container size overflowed "+i+"x"+n+", see "+Tp+"."),a>1?(i=Math.round(h),n=Math.round(h/a)):(n=Math.round(h),i=Math.round(h*a))),this.renderer.resize(i,n),this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",Yr.info("Resize player "+this.name+" ["+i+","+n+","+t+","+e+"]."),null==(u=this.compositions)||u.forEach((function(t){t.camera.aspect=a}))}},i.clearCanvas=function(t){t?this.renderer.clear({stencilAction:exports.TextureLoadAction.clear,clearStencil:0,depthAction:exports.TextureLoadAction.clear,clearDepth:1,colorAction:exports.TextureLoadAction.clear,clearColor:[0,0,0,0]}):this.forceRenderNextFrame=!0},i.destroyCurrentCompositions=function(){this.compositions.forEach((function(t){return t.dispose()})),this.compositions.length=0,this.baseCompositionIndex=0},i.dispose=function(t){var e;if(Yr.info("Call player destroyed: "+this.name+"."),!this.disposed){Mp.delete(this.canvas),this.pause(),null==(e=this.ticker)||e.stop(),this.assetManagers.forEach((function(t){return t.dispose()})),this.compositions.forEach((function(t){return t.dispose()})),this.compositions.length=0,this.renderer&&(this.renderer.context.removeLostHandler({lost:this.lost}),this.renderer.context.removeRestoreHandler({restore:this.restore}),this.renderer.dispose(!t)),this.event&&this.event.dispose(),this.destroyBuiltinObjects(),Lp(this,!1),hr(this.canvas,r.HTMLCanvasElement)&&!t&&this.renderer.context&&($h.dispose(),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.canvas.remove());var i="Never use destroyed player: "+this.name+" again, see "+Sp+".",n=function(){return function(t){throw new Error(t)}(i)},o=function(){return t=i,Promise.reject(t);var t};this.tick=n,this.resize=n,this.loadScene=o,this.play=o,this.gotoAndPlay=o,this.gotoAndStop=o,this.playSequence=n,this.destroyCurrentCompositions=n,this.resume=o,this.disposed=!0}},i.offloadTexture=function(){this.compositions.forEach((function(t){return t.offloadTexture()}))},i.getTargetSize=function(t){Fp(t);var e,i,n=this.displayAspect,o=null==r.window.getComputedStyle?void 0:r.window.getComputedStyle.call(r.window,t),s=0,a=0;(o?(s=parseInt(o.width,10),a=parseInt(o.height,10)):(s=t.clientWidth,a=t.clientHeight),n)?s/a>n?e=(i=a*this.displayScale)*n:i=(e=s*this.displayScale)/n:(e=s,i=a);var u=this.pixelRatio,c=e,h=i;if(e=Math.round(e*u),(i=Math.round(i*u))<1||i<1){if(!this.offscreenMode)throw new Error("Invalid container size "+e+"x"+i+", see "+Ap+".");e=i=c=h=1}return[c,h,e,i]},i.destroyBuiltinObjects=function(){for(var t,e=wn(this.builtinObjects);!(t=e()).done;){t.value.dispose()}this.builtinObjects.length=0},nn(e,[{key:"compositionCount",get:function(){return this.compositions.length}},{key:"hasPlayable",get:function(){return this.compositions.length>0}},{key:"paused",get:function(){var t;return null==(t=this.ticker)?void 0:t.getPaused()}},{key:"interactive",get:function(){return this.event.enabled},set:function(t){this.event.enabled=t}}]),e}(ku);function Lp(t,e){Object.keys(ni).forEach((function(r){var i=ni[r],n=e?i.onPlayerCreated:i.onPlayerDestroy;null==n||n(t)}))}function Fp(t){if(null==t)throw new Error("Container is not an HTMLElement, see "+Rp+".")}bo.create=function(t,e){return new Ff(t,e)},bo.createWithData=function(t,e,r){void 0===e&&(e=Nr("#fff")),void 0===r&&(r={});var i=r.type,n=void 0===i?jn.UNSIGNED_BYTE:i,o=r.format,s=void 0===o?jn.RGBA:o,a=r.internalFormat,u=r.wrapS,c=void 0===u?jn.MIRRORED_REPEAT:u,h=r.wrapT,l=void 0===h?jn.MIRRORED_REPEAT:h,f=r.minFilter,p=void 0===f?jn.NEAREST:f,d=r.magFilter,m=void 0===d?jn.NEAREST:d,v=r.flipY,y=void 0!==v&&v;return new Ff(t,{data:e,type:n,sourceType:exports.TextureSourceType.data,format:s,internalFormat:a||s,wrapS:c,wrapT:l,minFilter:p,magFilter:m,flipY:y})},Bo.create=function(t,e){return new Qf(t,e)},jo.create=function(t,e){return new Yf(t,e)},is.create=function(t,e){return new is(t,e)},Ds.create=function(t){return new rp(t)},Xs.create=function(t,e){return new np(t,e)},Hs.create=function(t,e,r){return new xp(t,e,r)},Of.create=function(t){return new ep(t)};var Np="2.2.1";Yr.info("Player version: 2.2.1."),exports.AbstractPlugin=bi,exports.ActivationPlayable=Rh,exports.AnimationClipPlayable=Ch,exports.Asset=nl,exports.AssetLoader=ol,exports.AssetManager=Jl,exports.BYTES_TYPE_MAP=Ho,exports.BaseRenderComponent=Za,exports.Behaviour=pn,exports.BezierCurve=Pa,exports.BezierCurvePath=wa,exports.BezierCurveQuat=La,exports.COPY_FRAGMENT_SHADER=Vn,exports.COPY_MESH_SHADER_ID=Nn,exports.COPY_VERTEX_SHADER=Dn,exports.CalculateLoader=gh,exports.Camera=ef,exports.CameraVFXItemLoader=pu,exports.ColorCurve=Wa,exports.Component=fn,exports.Composition=uf,exports.CompositionComponent=Dh,exports.CompositionSourceManager=rf,exports.DEFAULT_FONTS=tl,exports.DEFAULT_FPS=60,exports.Database=sl,exports.Downloader=eo,exports.EFFECTS_COPY_MESH_NAME=Fn,exports.EVENT_TYPE_CLICK=du,exports.EVENT_TYPE_TOUCH_END=yu,exports.EVENT_TYPE_TOUCH_MOVE=vu,exports.EVENT_TYPE_TOUCH_START=mu,exports.EffectsObject=ln,exports.EffectsPackage=Cf,exports.Engine=Of,exports.EventEmitter=ku,exports.EventSystem=gu,exports.Float16ArrayWrapper=Ys,exports.Framebuffer=Xs,exports.GLEngine=ep,exports.GLGeometry=Yf,exports.GLRenderer=xp,exports.GPUCapability=Us,exports.Geometry=jo,exports.GlobalUniforms=Ns,exports.GradientValue=Oa,exports.HELP_LINK=Ha,exports.InteractLoader=Eu,exports.InteractMesh=Tu,exports.KTXTexture=Oo,exports.LineSegments=Ma,exports.LinearValue=Ca,exports.Material=Bo,exports.MaterialDataBlock=Fo,exports.Mesh=is,exports.MeshCollider=Au,exports.PLAYER_OPTIONS_ENV_EDITOR=Xa,exports.POST_PROCESS_SETTINGS="post_process_settings",exports.ParticleBehaviourPlayable=ch,exports.ParticleBehaviourPlayableAsset=hh,exports.ParticleLoader=yh,exports.ParticleMesh=fh,exports.ParticleSystemRenderer=Qc,exports.ParticleTrack=Hh,exports.PassTextureCache=Go,exports.PathSegments=Ia,exports.Player=wp,exports.PluginSystem=ui,exports.PropertyTrack=Xh,exports.RENDER_PASS_NAME_PREFIX=Cs,exports.RENDER_PREFER_LOOKUP_TEXTURE=ju,exports.RUNTIME_ENV="runtime_env",exports.RandomSetValue=Aa,exports.RandomValue=Ra,exports.RandomVectorValue=Sa,exports.RenderFrame=Ms,exports.RenderPass=us,exports.RenderPassPriorityNormal=ns,exports.RenderPassPriorityPostprocess=3e3,exports.RenderPassPriorityPrepare=0,exports.RenderTargetHandle=ss,exports.Renderbuffer=Ds,exports.Renderer=Hs,exports.RendererComponent=dn,exports.RuntimeClip=Gh,exports.SEMANTIC_MAIN_PRE_COLOR_ATTACHMENT_0="PRE_MAIN_COLOR_0",exports.SEMANTIC_MAIN_PRE_COLOR_ATTACHMENT_SIZE_0="PRE_MAIN_COLOR_SIZE_0",exports.SEMANTIC_PRE_COLOR_ATTACHMENT_0="PRE_COLOR_0",exports.SEMANTIC_PRE_COLOR_ATTACHMENT_SIZE_0="PRE_COLOR_SIZE_0",exports.SPRITE_VERTEX_STRIDE=6,exports.SemanticMap=Xo,exports.SerializationHelper=Nh,exports.ShaderFactory=Ts,exports.ShaderVariant=Ln,exports.SpriteLoader=Iu,exports.StaticValue=ba,exports.TEMPLATE_USE_OFFSCREEN_CANVAS=Yu,exports.TextComponentBase=rl,exports.TextLayout=Kh,exports.TextLoader=il,exports.TextStyle=Qh,exports.Texture=bo,exports.TextureFactory=Io,exports.Ticker=Mf,exports.TimelineClip=zh,exports.TimelinePlayable=Yh,exports.TrackSortWrapper=Wh,exports.Transform=Bu,exports.TransformAnimationPlayable=Ah,exports.ValueGetter=Ta,exports.Vector4Curve=Ga,exports.adapter=ar,exports.addByOrder=Ur,exports.addItem=xr,exports.addItemWithOrder=function(t,e,r,i){if(void 0===i&&(i=!1),!t.includes(e)&&(t.push(e),1!==t.length)){var n=t.length-1;if(n){var o=t[n];if(i)for(;t[n-1][r]<o[r]&&(t[n]=t[n-1],0!=--n););else for(;t[n-1][r]>o[r]&&(t[n]=t[n-1],0!=--n););t[n]=o}}},exports.applyMixins=ii,exports.assertExist=zr,exports.asserts=function(t,e){if(void 0===e&&(e="asserts failed"),!t)throw new Error(e)},exports.base64ToFile=ri,exports.blend="vec4 blendColor(vec4 color,vec4 vc,float mode){vec4 ret=color*vc;float alpha=ret.a;if(mode==1.){ret.rgb*=alpha;}else if(mode==2.){ret.rgb*=alpha;ret.a=dot(ret.rgb,vec3(0.33333333));}else if(mode==3.){alpha=color.r*alpha;ret=vec4(vc.rgb*alpha,alpha);}return ret;}",exports.calculateTranslation=Ks,exports.canvasPool=$h,exports.colorGradingFrag=vs,exports.colorStopsFromGradient=Sr,exports.colorToArr=Ar,exports.combineImageTemplate=ql,exports.createCopyShader=Un,exports.createGLContext=Bn,exports.createKeyFrameMeta=Ua,exports.createShape=hc,exports.createValueGetter=Ya,exports.decimalEqual=na,exports.defaultPlugins=oi,exports.deserializeMipmapTexture=go,exports.disableAllPlayer=function(t){Pp=!!t},exports.earcut=Lc,exports.effectsClass=un,exports.effectsClassStore=an,exports.enlargeBuffer=br,exports.ensureFixedNumber=ul,exports.ensureVec3=Qs,exports.findPreviousRenderPass=function(t,e){var r=t.indexOf(e);return t[r-1]},exports.gaussianDownFrag="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform vec2 _TextureSize;float GaussWeight2D(float x,float y,float sigma){float PI=3.14159265358;float E=2.71828182846;float sigma_2=pow(sigma,2.0);float a=-(x*x+y*y)/(2.0*sigma_2);return pow(E,a)/(2.0*PI*sigma_2);}vec3 GaussNxN(sampler2D tex,vec2 uv,vec2 stride,float sigma){vec3 color=vec3(0.,0.,0.);const int r=5/2;float weight=0.0;for(int i=-r;i<=r;i++){for(int j=-r;j<=r;j++){float w=GaussWeight2D(float(i),float(j),sigma);vec2 coord=uv+vec2(i,j)*stride;color+=texture2D(tex,coord).rgb*w;weight+=w;}}color/=weight;return color;}void main(){vec4 mainColor=texture2D(_MainTex,uv);vec3 color=mainColor.rgb;color=GaussNxN(_MainTex,uv,1.0/_TextureSize,1.0);gl_FragColor=vec4(color,1.0);}",exports.gaussianDownHFrag=ys,exports.gaussianDownVFrag=gs,exports.gaussianUpFrag=_s,exports.generateEmptyTypedArray=Yo,exports.generateGUID=ei,exports.generateHalfFloatTexture=Ao,exports.generateTransparentTexture=Co,exports.generateWhiteTexture=So,exports.getActivePlayers=function(){return Array.from(Mp.values())},exports.getBackgroundImage=Zl,exports.getColorFromGradientStops=Rr,exports.getConfig=Zu,exports.getDefaultTextureFactory=wo,exports.getGeometryByShape=Uc,exports.getGeometryTriangles=Vc,exports.getImageItemRenderInfo=qa,exports.getKTXTextureOptions=Mo,exports.getKeyFrameMetaByRawValue=Va,exports.getMergedStore=hn,exports.getParticleMeshShader=mh,exports.getPixelRatio=Mr,exports.getPlayerByCanvas=function(t){return Mp.get(t)},exports.getPreMultiAlpha=Kn,exports.getStandardComposition=kl,exports.getStandardImage=Bl,exports.getStandardItem=Hl,exports.getStandardJSON=Vl,exports.getTextureSize=Ps,exports.glContext=jn,exports.glType2VertexFormatType=function(t){switch(t){case r.WebGLRenderingContext.FLOAT:return Qi.Float32;case r.WebGLRenderingContext.SHORT:return Qi.Int16;case r.WebGLRenderingContext.BYTE:return Qi.Int8;case r.WebGLRenderingContext.UNSIGNED_SHORT:return Qi.UInt16;case r.WebGLRenderingContext.UNSIGNED_BYTE:return Qi.UInt8;default:return Qi.Float32}},exports.gpuTimer=kn,exports.imageDataFromColor=Nr,exports.imageDataFromGradient=Dr,exports.initErrors=Hn,exports.initGLContext=Yn,exports.integrate="float calculateMovement(float t,vec2 p1,vec2 p2,vec2 p3,vec2 p4){float movement=0.0;float h=(t-p1.x)*0.05;for(int i=0;i<=20;i++){float t=float(i)*h;float nt=binarySearchT(t,p1.x,p2.x,p3.x,p4.x);float y=cubicBezier(nt,p1.y,p2.y,p3.y,p4.y);float weight=(i==0||i==20)? 1.0 :(mod(float(i),2.)!=0.)? 4.0 : 2.0;movement+=weight*y;}movement*=h/3.;return movement;}float integrateFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i+=2){vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return ret;}vec2 p1=vec2(k0.x,k0.y);vec2 p2=vec2(k0.z,k0.w);vec2 p3=vec2(k1.z,k1.w);vec2 p4=vec2(k1.x,k1.y);if(time>=k1.x){ret+=calculateMovement(k1.x,p1,p2,p3,p4);}if(time>=k0.x&&time<k1.x){return ret+calculateMovement(time,p1,p2,p3,p4);}}return ret;}float integrateByTimeLineSeg(float t,vec2 p0,vec2 p1){float t0=p0.x;float t1=p1.x;float y0=p0.y;float y1=p1.y;vec4 tSqr=vec4(t,t,t0,t0);tSqr=tSqr*tSqr;vec4 a=vec4(2.*t,3.,-t0,3.)*tSqr;float t1y0=t1*y0;vec4 b=vec4(y0-y1,t0*y1-t1y0,2.*y0+y1,t1y0);float r=dot(a,b);return r/(t0-t1)*0.16666667;}float integrateLineSeg(float time,vec2 p0,vec2 p1){float h=time-p0.x;float y0=p0.y;return(y0+y0+(p1.y-y0)*h/(p1.x-p0.x))*h/2.;}float integrateFromLineSeg(float time,float frameStart,float frameCount){if(time==0.){return 0.;}int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i++){if(i>count){return ret;}vec4 ks=lookup_curve(i+start);vec2 k0=ks.xy;vec2 k1=ks.zw;if(time>k0.x&&time<=k1.x){return ret+integrateLineSeg(time,k0,k1);}ret+=integrateLineSeg(k1.x,k0,k1);vec2 k2=lookup_curve(i+start+1).xy;if(time>k1.x&&time<=k2.x){return ret+integrateLineSeg(time,k1,k2);}ret+=integrateLineSeg(k2.x,k1,k2);}return ret;}float integrateByTimeFromLineSeg(float time,float frameStart,float frameCount){if(time==0.){return 0.;}int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i++){if(i>count){return ret;}vec4 ks=lookup_curve(i+start);vec2 k0=ks.xy;vec2 k1=ks.zw;if(time>k0.x&&time<=k1.x){return ret+integrateByTimeLineSeg(time,k0,k1);}ret+=integrateByTimeLineSeg(k1.x,k0,k1);vec2 k2=lookup_curve(i+start+1).xy;if(time>k1.x&&time<=k2.x){return ret+integrateByTimeLineSeg(time,k1,k2);}ret+=integrateByTimeLineSeg(k2.x,k1,k2);}return ret;}float getIntegrateFromTime0(float t1,vec4 value){float type=value.x;if(type==0.){return value.y*t1;}if(type==1.){vec2 p0=vec2(0.,value.y);vec2 p1=vec2(value.w,value.z);return integrateLineSeg(t1,p0,p1);}if(type==3.){return integrateFromLineSeg(t1,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed)*t1;}if(type==5.){return integrateFromBezierCurveFrames(t1,value.z,value.w);}return 0.;}float getIntegrateByTimeFromTime(float t0,float t1,vec4 value){float type=value.x;if(type==0.){return value.y*(t1*t1-t0*t0)/2.;}else if(type==1.){vec2 p0=vec2(0.,value.y);vec2 p1=vec2(value.w,value.z);return integrateByTimeLineSeg(t1,p0,p1)-integrateByTimeLineSeg(t0,p0,p1);}if(type==3.){return integrateByTimeFromLineSeg(t1,value.y,value.z)-integrateByTimeFromLineSeg(t0,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed)*(t1*t1-t0*t0)/2.;}if(type==5.){return integrateFromBezierCurveFrames(t1,value.z,value.w)-integrateFromBezierCurveFrames(t0,value.z,value.w);}return 0.;}",exports.interpolateColor=Cr,exports.isAlipayMiniApp=Lr,exports.isAndroid=Ir,exports.isArray=qr,exports.isCanvas=Jr,exports.isCanvasUsedByPlayer=function(t){return Mp.has(t)},exports.isFunction=Kr,exports.isIOS=Pr,exports.isIOSByUA=function(){var t=r.navigator.userAgent.toLowerCase().match(/cpu (iphone )?os (.*?) like mac os/);return t?parseInt(t[2],10):0},exports.isMiniProgram=function(){return Lr()||Fr()},exports.isObject=Qr,exports.isSimulatorCellPhone=wr,exports.isString=Zr,exports.isUniformStruct=No,exports.isUniformStructArray=function(t){return t&&void 0!==t.length&&No(t[0])},exports.isValidFontFamily=Gr,exports.isWebGL2=Wn,exports.isWechatMiniApp=Fr,exports.itemFrag=ls,exports.itemFrameFrag=cs,exports.itemVert=hs,exports.loadAVIFOptional=so,exports.loadBinary=ho,exports.loadBlob=function(t){return fo.apply(this,arguments)},exports.loadImage=uo,exports.loadMedia=vo,exports.loadVideo=po,exports.loadWebPOptional=no,exports.logger=Yr,exports.math=es,exports.modifyMaxKeyframeShader=vh,exports.nearestPowerOfTwo=ea,exports.noop=Wr,exports.normalizeColor=ml,exports.numberToFix=oa,exports.parsePercent=Or,exports.particleFrag=fs,exports.particleOriginTranslateMap=ta,exports.particleUniformTypeMap=lh,exports.particleVert=ps,exports.passRenderLevel=Wl,exports.pluginLoaderMap=ni,exports.randomInRange=$r,exports.registerPlugin=ai,exports.removeItem=Tr,exports.rotateVec2=Bc,exports.screenMeshVert=ms,exports.serialize=cn,exports.setBlendMode=Qn,exports.setConfig=function(t,e){return Wu[t]=e},exports.setDefaultTextureFactory=function(t){Po=t},exports.setMaskMode=$n,exports.setMaxSpriteMeshItemCount=function(t){exports.maxSpriteMeshItemCount=t},exports.setRayFromCamera=ra,exports.setSideMode=Jn,exports.setSpriteMeshMaxItemCountByGPU=Ru,exports.sortByOrder=Vr,exports.spec=en,exports.spriteMeshShaderFromFilter=Su,exports.spriteMeshShaderFromRenderInfo=Ou,exports.spriteMeshShaderIdFromRenderInfo=Cu,exports.thresholdFrag=Es,exports.throwDestroyedError=ti,exports.trailVert=ds,exports.translatePoint=function(t,e){for(var r=[-.5,.5,-.5,-.5,.5,.5,.5,-.5],i=0;i<8;i+=2)r[i]+=t,r[i+1]+=e;return r},exports.trianglesFromRect=ia,exports.unregisterPlugin=function(t){delete si[t],delete ni[t],Tr(oi,t)},exports.valIfUndefined=function(t,e){return null==t?e:t},exports.value="#ifdef SHADER_VERTEX\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n#define CURVE_VALUE_ARRAY uVCurveValues\n#define CURVE_VALUE_COUNT VERT_CURVE_VALUE_COUNT\n#define FRAG_CURVE_VALUE_COUNT 0\n#else\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n#define CURVE_VALUE_ARRAY uFCurveValues\n#define CURVE_VALUE_COUNT FRAG_CURVE_VALUE_COUNT\n#define VERT_CURVE_VALUE_COUNT 0\n#endif\n#if CURVE_VALUE_COUNT > 0\n#if LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n#endif\n#else\n#define lookup_curve(i) vec4(0.)\n#endif\n#ifdef WEBGL2\n#define ITR_END (count + 1)\n#else\n#define ITR_END MAX_C\n#endif\n#define NONE_CONST_INDEX 1\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#endif\n#ifdef SHADER_VERTEX\n#define MAX_C VERT_MAX_KEY_FRAME_COUNT\n#else\n#define MAX_C FRAG_MAX_KEY_FRAME_COUNT\n#endif\nmat4 cubicBezierMatrix=mat4(1.0,-3.0,3.0,-1.0,0.0,3.0,-6.0,3.0,0.0,0.0,3.0,-3.0,0.0,0.0,0.0,1.0);float cubicBezier(float t,float y1,float y2,float y3,float y4){vec4 tVec=vec4(1.0,t,t*t,t*t*t);vec4 yVec=vec4(y1,y2,y3,y4);vec4 result=tVec*cubicBezierMatrix*yVec;return result.x+result.y+result.z+result.w;}float binarySearchT(float x,float x1,float x2,float x3,float x4){float left=0.0;float right=1.0;float mid=0.0;float computedX;for(int i=0;i<8;i++){mid=(left+right)*0.5;computedX=cubicBezier(mid,x1,x2,x3,x4);if(abs(computedX-x)<0.0001){break;}else if(computedX>x){right=mid;}else{left=mid;}}return mid;}float valueFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);for(int i=0;i<ITR_END;i+=2){if(i>=count){break;}vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return k0.y;}if(i==int(frameCount-2.)&&time>=k1.x){return k1.y;}if(time>=k0.x&&time<=k1.x){float t=(time-k0.x)/(k1.x-k0.x);float nt=binarySearchT(time,k0.x,k0.z,k1.z,k1.x);return cubicBezier(nt,k0.y,k0.w,k1.w,k1.y);}}}float evaluteLineSeg(float t,vec2 p0,vec2 p1){return p0.y+(p1.y-p0.y)*(t-p0.x)/(p1.x-p0.x);}float valueFromLineSegs(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);int end=start+count;for(int i=0;i<ITR_END;i++){if(i>count){return lookup_curve(i).w;}vec4 seg=lookup_curve(i+start);vec2 p0=seg.xy;vec2 p1=seg.zw;if(time>=p0.x&&time<=p1.x){return evaluteLineSeg(time,p0,p1);}vec2 p2=lookup_curve(i+start+1).xy;if(time>p1.x&&time<=p2.x){return evaluteLineSeg(time,p1,p2);}}return lookup_curve(0).y;}float getValueFromTime(float time,vec4 value){float type=value.x;if(type==0.){return value.y;}if(type==1.){return mix(value.y,value.z,time/value.w);}if(type==3.){return valueFromLineSegs(time,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed);}if(type==5.){return valueFromBezierCurveFrames(time,value.z,value.w);}return 0.;}",exports.valueDefine="#ifdef SHADER_VERTEX\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n#define CURVE_VALUE_ARRAY uVCurveValues\n#define CURVE_VALUE_COUNT VERT_CURVE_VALUE_COUNT\n#define FRAG_CURVE_VALUE_COUNT 0\n#else\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n#define CURVE_VALUE_ARRAY uFCurveValues\n#define CURVE_VALUE_COUNT FRAG_CURVE_VALUE_COUNT\n#define VERT_CURVE_VALUE_COUNT 0\n#endif\n#if CURVE_VALUE_COUNT > 0\n#if LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n#endif\n#else\n#define lookup_curve(i) vec4(0.)\n#endif\n#ifdef WEBGL2\n#define ITR_END (count + 1)\n#else\n#define ITR_END MAX_C\n#endif\n",exports.vecFill=Js,exports.vecMulCombine=$s,exports.version=Np,exports.vertexFormatType2GLType=qn;
