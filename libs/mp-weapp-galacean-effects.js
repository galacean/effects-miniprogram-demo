"use strict";function t(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(r){if("default"!==r&&!(r in t)){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}}))})),Object.freeze(t)}function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var r={},i={};Object.defineProperty(i,"__esModule",{value:!0}),i.platform=void 0,i.platform={getSystemInfoSync:function(){return{pixelRatio:1,system:"",platform:"",language:"",screenWidth:1,screenHeight:1,windowWidth:1,windowHeight:1}},createCanvas:function(){return{addEventListener:function(t,e,r){},removeEventListener:function(t,e){},dispatchEvent:function(t){},width:0,height:0}},createOffscreenCanvas:function(t){return{addEventListener:function(t,e,r){},removeEventListener:function(t,e){},dispatchEvent:function(t){},width:0,height:0}},createImage:function(){},createSelectorQuery:function(){},request:function(t){},downloadFile:function(t){},createVideoContext:function(t){},startDeviceMotionListening:function(t){},stopDeviceMotionListening:function(){},onDeviceMotionChange:function(t){},offDeviceMotionChange:function(t){},getFileSystemManager:function(){}};var n,o=i,a=(n=null,function(){if(n)return n;var t=wx.getWindowInfo(),e=t.pixelRatio,r=t.screenHeight,i=t.screenWidth,o=t.windowHeight,a=t.windowWidth,s=wx.getDeviceInfo(),u=s.system,c=s.platform,h=wx.getAppBaseInfo().language;return n={pixelRatio:e,system:u,platform:c,language:h,screenWidth:i,screenHeight:r,windowWidth:a,windowHeight:o}});o.platform.createCanvas=wx.createCanvas,o.platform.createImage=wx.createImage,o.platform.createOffscreenCanvas=wx.createOffscreenCanvas,o.platform.createSelectorQuery=wx.createSelectorQuery,o.platform.getSystemInfoSync=a,o.platform.request=wx.request,o.platform.createVideoContext=wx.createVideoContext,o.platform.downloadFile=wx.downloadFile,o.platform.startDeviceMotionListening=wx.startDeviceMotionListening,o.platform.stopDeviceMotionListening=wx.stopDeviceMotionListening,o.platform.onDeviceMotionChange=wx.onDeviceMotionChange,o.platform.offDeviceMotionChange=wx.offDeviceMotionChange,o.platform.getFileSystemManager=wx.getFileSystemManager;var s={},u={},c={},h={},l={},f={},d={},p={};Object.defineProperty(p,"__esModule",{value:!0}),p.screen=void 0;var m=i.platform.getSystemInfoSync(),v=m.screenWidth,y=m.screenHeight,g=m.windowWidth,x=m.windowHeight;p.screen={width:v,height:y,availWidth:g,availHeight:x,availLeft:0,availTop:0};var T={};Object.defineProperty(T,"__esModule",{value:!0}),T.noop=void 0,T.noop=function(){};var _=function(){return _=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},_.apply(this,arguments)};Object.defineProperty(d,"__esModule",{value:!0}),d.classList=d.scrollRegion=d.offsetRegion=d.clientRegion=d.style=d.parentNode=void 0;var E=p,b=h,A=T,S=E.screen.availWidth,R=E.screen.availHeight;d.parentNode=function(t,e){var r,i;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return b.document.documentElement}:function(){return b.document.body},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r})),"parentElement"in t||(i=0===e?function(){return null}:1===e?function(){return b.document.documentElement}:function(){return b.document.body},Object.defineProperty(t,"parentElement",{enumerable:!0,get:i}))},d.style=function(t){var e;t.style=_(_({},null!==(e=t.style)&&void 0!==e?e:{}),{top:"0px",left:"0px",width:S+"px",height:R+"px",margin:"0px",padding:"0px"})},d.clientRegion=function(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=S,t.clientHeight=R),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:t.top||0,left:t.left||0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})},d.offsetRegion=function(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=S,t.offsetHeight=R)},d.scrollRegion=function(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=S,t.scrollHeight=R)},d.classList=function(t){t.classList=[],t.classList.add=A.noop,t.classList.remove=A.noop,t.classList.contains=A.noop,t.classList.toggle=A.noop};var C={},M={},O={};Object.defineProperty(O,"__esModule",{value:!0}),O.EventTarget=void 0;var P=new WeakMap,I=function(){function t(){P.set(this,{})}return t.prototype.addEventListener=function(t,e,r){void 0===r&&(r={});var i=P.get(this);i||(i={}),i[t]||(i[t]=[]),i[t].push(e),P.set(this,i),r.capture,r.once,r.passive},t.prototype.removeEventListener=function(t,e,r){var i=P.get(this);if(i){var n=i[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}},t.prototype.dispatchEvent=function(t){var e=P.get(this)[t.type];if(e)for(var r=0;r<e.length;r++)e[r](t)},t}();O.EventTarget=I;var w,N=(w=function(t,e){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},w(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(M,"__esModule",{value:!0}),M.Node=void 0;var L=function(t){function e(){var e=t.call(this)||this;return e.childNodes=[],e}return N(e,t),e.prototype.appendChild=function(t){this.childNodes.push(t)},e.prototype.cloneNode=function(){var t=Object.create(this);return Object.assign(t,this),t},e.prototype.removeChild=function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null},e}(O.EventTarget);M.Node=L;var F=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(C,"__esModule",{value:!0}),C.Element=void 0;var D=function(t){function e(){var e=t.call(this)||this;return e.className="",e.children=[],e}return F(e,t),e.prototype.setAttribute=function(t,e){this[t]=e},e.prototype.getAttribute=function(t){return this[t]},e.prototype.setAttributeNS=function(t,e){this[t]=e},e.prototype.getAttributeNS=function(t){return this[t]},e}(M.Node);C.Element=D;var V=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),B=Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]},U=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},k=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&B(e,t,r);return U(e,t),e};Object.defineProperty(f,"__esModule",{value:!0}),f.HTMLElement=void 0;var z=k(d),G=T,X=function(t){function e(e,r){void 0===e&&(e="");var i=t.call(this)||this;return i.className="",i.children=[],i.focus=G.noop,i.blur=G.noop,i.insertBefore=G.noop,i.appendChild=G.noop,i.removeChild=G.noop,i.remove=G.noop,i.innerHTML="",i.tagName=e.toUpperCase(),z.parentNode(i,r),z.style(i),z.classList(i),z.clientRegion(i),z.offsetRegion(i),z.scrollRegion(i),i}return V(e,t),e}(C.Element);f.HTMLElement=X,Object.defineProperty(X,Symbol.hasInstance,{value:function(t){return"BODY"===(null==t?void 0:t.tagName)}});var H=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(l,"__esModule",{value:!0}),l.Body=void 0;var j=h,W=function(t){function e(){return t.call(this,"body",0)||this}return H(e,t),e.prototype.addEventListener=function(t,e,r){void 0===r&&(r={}),j.document.addEventListener(t,e,r)},e.prototype.removeEventListener=function(t,e){j.document.removeEventListener(t,e)},e.prototype.dispatchEvent=function(t){j.document.dispatchEvent(t)},e}(f.HTMLElement);l.Body=W;var Y={},Z={},q=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Z,"__esModule",{value:!0}),Z.HTMLMediaElement=void 0;var K=function(t){function e(e){return t.call(this,e)||this}return q(e,t),e.prototype.addTextTrack=function(){},e.prototype.captureStream=function(){},e.prototype.fastSeek=function(){},e.prototype.load=function(){},e.prototype.pause=function(){},e.prototype.play=function(){},e}(f.HTMLElement);Z.HTMLMediaElement=K;var Q=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Y,"__esModule",{value:!0}),Y.HTMLVideoElement=void 0;var J=function(t){function e(){return t.call(this,"video")||this}return Q(e,t),e}(Z.HTMLMediaElement);Y.HTMLVideoElement=J;var $={},tt={},et=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(tt,"__esModule",{value:!0}),tt.HTMLAudioElement=tt.HTMLCanvasElement=tt.HTMLImageElement=void 0;var rt=f,it=Z,nt=function(t){function e(){return t.call(this,"img")||this}return et(e,t),e}(rt.HTMLElement);tt.HTMLImageElement=nt,Object.defineProperty(nt,Symbol.hasInstance,{value:function(t){return"IMG"===(null==t?void 0:t.tagName)||(null==t?void 0:t.crossOrigin)}});var ot=function(t){function e(){return t.call(this,"canvas")||this}return et(e,t),e}(rt.HTMLElement);tt.HTMLCanvasElement=ot;var at=function(t){function e(){return t.call(this,"audio")||this}return et(e,t),e}(it.HTMLMediaElement);tt.HTMLAudioElement=at;var st={},ut=Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]},ct=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},ht=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&ut(e,t,r);return ct(e,t),e},lt=function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))},ft=function(t,e){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(st,"__esModule",{value:!0}),st.isMiniGame=st.getCanvas=st.registerOffscreenCanvas=st.registerCanvas=void 0;var dt=i,pt=h,mt=ht(d),vt={},yt=!1;function gt(t,e){return"tagName"in t||(t.tagName="CANVAS"),t.type="canvas",t.width=2*t.width,t.height=2*t.height,mt.parentNode(t,null!=e?e:0),mt.style(t),mt.classList(t),mt.offsetRegion(t),t.focus=function(){},t.blur=function(){},t.addEventListener=function(t,e,r){void 0===r&&(r={}),pt.document.addEventListener(t,e,r)},t.removeEventListener=function(t,e){pt.document.removeEventListener(t,e)},t.dispatchEvent=function(t){pt.document.dispatchEvent(t)},t}function xt(t){return lt(this,void 0,void 0,(function(){return ft(this,(function(e){return[2,new Promise((function(e,r){dt.platform.createSelectorQuery().select(t).node().select(t).boundingClientRect().exec((function(i){try{var n=i[0].node,o=i[1];n?(n.getBoundingClientRect=function(){return o},e(n)):r("create canvas fail, canvas is ".concat(n))}catch(e){r("Cannot find canvas by id: ".concat(t,", ").concat(e))}}))}))]}))}))}st.registerCanvas=function(){return lt(this,arguments,void 0,(function(t){var e,r,i,n,o,a;return void 0===t&&(t={}),ft(this,(function(s){switch(s.label){case 0:return e=t.id,r=void 0===e?"J-canvas":e,i=t.isMiniGame,n=void 0!==i&&i,o=t.elementLevel,a=void 0===o?0:o,"string"!=typeof r?[3,4]:n?(vt=dt.platform.createCanvas(),[3,3]):[3,1];case 1:return[4,xt(r)];case 2:vt=s.sent(),s.label=3;case 3:return[3,5];case 4:(vt=r).id=r,s.label=5;case 5:return gt(vt,a),yt=n,[2,vt]}}))}))},st.registerOffscreenCanvas=gt,st.getCanvas=function(){return vt},st.isMiniGame=function(){return yt};var Tt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty($,"__esModule",{value:!0}),$.Image=void 0;var _t=i,Et=st,bt=function(t){function e(){var r,i,n=t.call(this)||this;if((0,Et.isMiniGame)())n.image=_t.platform.createImage();else{var o=(0,Et.getCanvas)();n.image=null!==(i=null===(r=o.createImage)||void 0===r?void 0:r.call(o))&&void 0!==i?i:{}}return n.image.constructor=e,n.image}return Tt(e,t),e}(tt.HTMLImageElement);$.Image=bt,function(t){var e=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.document=void 0;var r=i,n=l,o=f,a=Y,s=$,u=st,c=function(r){function i(){return r.call(this,"html",0)||this}return e(i,r),i.prototype.addEventListener=function(e,r,i){void 0===i&&(i={}),t.document.addEventListener(e,r,i)},i.prototype.removeEventListener=function(e,r){t.document.removeEventListener(e,r)},i.prototype.dispatchEvent=function(e){t.document.dispatchEvent(e)},i}(o.HTMLElement),h={};t.document={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:null,createElement:function(e){if("canvas"===(e=e.toLowerCase())){if((0,u.isMiniGame)())return(i=r.platform.createCanvas()).addEventListener=function(e,r,i){void 0===i&&(i={}),t.document.addEventListener(e,r,i)},i.removeEventListener=function(e,r){t.document.removeEventListener(e,r)},i.dispatchEvent=function(e){t.document.dispatchEvent(e)},i;var i=r.platform.createOffscreenCanvas({type:"2d"});return(0,u.registerOffscreenCanvas)(i),i}return"img"===e?new s.Image:"video"===e?new a.HTMLVideoElement:new o.HTMLElement(e)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){var e=(0,u.getCanvas)();return t===e.id?e:null},getElementsByTagName:function(e){return"head"===(e=e.toLowerCase())?[t.document.head]:"body"===e?[t.document.body]:"canvas"===e?[(0,u.getCanvas)()]:[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(e){return"head"===e?[t.document.head]:"body"===e?[t.document.body]:"canvas"===e?[(0,u.getCanvas)()]:[]},querySelector:function(e){var r=(0,u.getCanvas)();return"head"===e?t.document.head:"body"===e?t.document.body:"canvas"===e||e==="#".concat(r.id)?r:null},querySelectorAll:function(e){return"head"===e?[t.document.head]:"body"===e?[t.document.body]:"canvas"===e?[(0,u.getCanvas)()]:[]},addEventListener:function(t,e,r){h[t]||(h[t]=[]),h[t].push(e)},removeEventListener:function(t,e){var r=h[t];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===e){r.splice(i,1);break}},dispatchEvent:function(t){var e=t.type,r=h[e];if(r)for(var i=0;i<r.length;i++)r[i](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)}},t.document.documentElement=new c,t.document.head=new o.HTMLElement("head"),t.document.body=new n.Body}(h);var At={};Object.defineProperty(At,"__esModule",{value:!0}),At.Event=void 0;var St=function(t){this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=t,this.timeStamp=Date.now()};At.Event=St;var Rt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(c,"__esModule",{value:!0}),c.dispatchTouchCancel=c.dispatchTouchEnd=c.dispatchTouchMove=c.dispatchTouchStart=void 0;var Ct=h,Mt=st,Ot=function(t){function e(e){var r=t.call(this,e)||this;return r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=(0,Mt.getCanvas)(),r.currentTarget=(0,Mt.getCanvas)(),r}return Rt(e,t),e}(At.Event);function Pt(t){var e=t||{},r=e.x,i=void 0===r?0:r,n=e.y,o=void 0===n?0:n,a=e.clientX,s=void 0===a?0:a,u=e.clientY,c=void 0===u?0:u;Object.keys(t).includes("x")?(t.pageX=t.clientX=i,t.pageY=t.clientY=o):(t.x=s,t.y=c),t.target||(t.target=(0,Mt.getCanvas)())}function It(t){return function(e){var r=new Ot(t);r.changedTouches=e.changedTouches||e.touches,r.touches=e.touches,r.targetTouches=Array.prototype.slice.call(e.touches),r.timeStamp=e.timeStamp,r.changedTouches.forEach((function(t){return Pt(t)})),r.touches.forEach((function(t){return Pt(t)})),r.targetTouches.forEach((function(t){return Pt(t)})),Ct.document.dispatchEvent(r)}}var wt=It("touchstart");c.dispatchTouchStart=wt;var Nt=It("touchmove");c.dispatchTouchMove=Nt;var Lt=It("touchend");c.dispatchTouchEnd=Lt;var Ft=It("touchcancel");c.dispatchTouchCancel=Ft;var Dt={},Vt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.dispatchPointerCancel=Dt.dispatchPointerLeave=Dt.dispatchPointerUp=Dt.dispatchPointerMove=Dt.dispatchPointerDown=void 0;var Bt=st,Ut=h,kt=function(t){function e(e){var r=t.call(this,e)||this;return r.target=(0,Bt.getCanvas)(),r.currentTarget=(0,Bt.getCanvas)(),r}return Vt(e,t),e}(At.Event),zt=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Gt=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function Xt(t,e){for(var r=new kt(t),i=0;i<zt.length;i++){var n=zt[i];r[n]=e[n]||Gt[i]}return r.type=t,r.target=(0,Bt.getCanvas)(),r.currentTarget=(0,Bt.getCanvas)(),r.buttons=function(t){var e=0;"touchstart"!==t&&"touchmove"!==t&&"pointerdown"!==t&&"pointermove"!==t||(e=1);return e}(t),r.which=r.buttons,r.pointerId=(e.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(e.radiusX||.5),r.height=2*(e.radiusY||.5),r.pressure=e.force||.5,r.isPrimary=function(t){return Ht===t.identifier}(e),r.pointerType="touch",r.offsetX=e.pageX||e.x,r.offsetY=e.pageY||e.y,r}var Ht=null;function jt(t){null===Ht&&(Ht=t.identifier)}function Wt(t){Ht===t.identifier&&(Ht=null)}function Yt(t){return function(e){for(var r=e.changedTouches||e.touches,i=0;i<r.length;i++){var n=r[i];switch(t){case"pointerdown":0===i&&jt(n),Ut.document.dispatchEvent(Xt(t,n));break;case"pointermove":case"pointerup":Ut.document.dispatchEvent(Xt(t,n));break;case"pointerleave":case"pointercancel":Wt(n),Ut.document.dispatchEvent(Xt(t,n))}}}}var Zt=Yt("pointerdown");Dt.dispatchPointerDown=Zt;var qt=Yt("pointermove");Dt.dispatchPointerMove=qt;var Kt=Yt("pointerup");Dt.dispatchPointerUp=Kt;var Qt=Yt("pointerleave");Dt.dispatchPointerLeave=Qt;var Jt=Yt("pointercancel");Dt.dispatchPointerCancel=Jt;var $t={};Object.defineProperty($t,"__esModule",{value:!0}),$t.dispatchMouseUp=$t.dispatchMouseMove=$t.dispatchMouseDown=void 0;var te=h;function ee(t){return function(e){e.type=t,te.document.dispatchEvent(e)}}var re=ee("mousedown");$t.dispatchMouseDown=re;var ie=ee("mousemove");$t.dispatchMouseMove=ie;var ne=ee("mouseup");$t.dispatchMouseUp=ne,function(t){var e=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),r=this&&this.__exportStar||function(t,r){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(r,i)||e(r,t,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(c,t),r(Dt,t),r($t,t)}(u);var oe={};Object.defineProperty(oe,"__esModule",{value:!0}),oe.Accelerometer=void 0;var ae=i,se=h,ue=function(){function t(){}return t.prototype.handleDeviceMotionChange=function(t){se.document.dispatchEvent({alpha:t.alpha,gamma:t.gamma,beta:-t.beta,type:"deviceorientation"})},t.prototype.startWatch=function(t){var e=this;void 0===t&&(t="ui"),ae.platform.startDeviceMotionListening({interval:t,success:function(){ae.platform.onDeviceMotionChange(e.handleDeviceMotionChange)}})},t.prototype.stopWatch=function(){ae.platform.offDeviceMotionChange(this.handleDeviceMotionChange)},t}();oe.Accelerometer=ue;var ce={},he=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ce,"__esModule",{value:!0}),ce.btoa=ce.atob=void 0;var le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",fe=function(t){function e(e){var r=t.call(this,e)||this;return r.message=e,r.name="InvalidCharacterError",r}return he(e,t),e}(Error);ce.atob=function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new fe("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",i=0,n=void 0,o=void 0,a=0;o=e.charAt(a++);~o&&(n=i%4?64*n+o:o,i++%4)?r+=String.fromCharCode(255&n>>(-2*i&6)):0)o=le.indexOf(o);return r},ce.btoa=function(t){for(var e,r,i,n,o="",a=0,s=(t=String(t)).length%3;a<t.length;){if((r=t.charCodeAt(a++))>255||(i=t.charCodeAt(a++))>255||(n=t.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");o+=le.charAt((e=r<<16|i<<8|n)>>18&63)+le.charAt(e>>12&63)+le.charAt(e>>6&63)+le.charAt(63&e)}return s?o.slice(0,s-3)+"===".substring(s):o};var de={};Object.defineProperty(de,"__esModule",{value:!0}),de.Blob=void 0;var pe=function(){function t(t,e){void 0===e&&(e="image/png"),this.buffers=t,this.type=e}return t.prototype.arraybuffer=function(){return Promise.resolve(this.buffers[0])},t.prototype.stream=function(){throw"not implemented"},t.prototype.text=function(){throw"not implemented"},t.prototype.slice=function(t,e,r){throw"not implemented"},t}();de.Blob=pe;var me={};Object.defineProperty(me,"__esModule",{value:!0}),me.devicePixelRatio=void 0;var ve=i;me.devicePixelRatio=ve.platform.getSystemInfoSync().pixelRatio;var ye={};Object.defineProperty(ye,"__esModule",{value:!0}),ye.ImageData=void 0;var ge=function(){function t(){var t=arguments.length;if(2==t){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this.w=arguments[0],this.h=arguments[1],void(this.d=new Uint8ClampedArray(this.w*this.h*4))}else 3==t&&"object"==typeof arguments[0]&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this.d=arguments[0],this.w=arguments[1],this.h=arguments[2]);throw new Error("ImageData: params error")}return Object.defineProperty(t.prototype,"width",{get:function(){return this.w},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.h},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this.d},enumerable:!1,configurable:!0}),t}();ye.ImageData=ge;var xe={};Object.defineProperty(xe,"__esModule",{value:!0}),xe.location=void 0,xe.location={href:""};var Te={};Object.defineProperty(Te,"__esModule",{value:!0}),Te.navigator=void 0;var _e=i.platform.getSystemInfoSync(),Ee=_e.platform,be=void 0===Ee?"":Ee,Ae=_e.language,Se=be.toLowerCase().includes("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Re="Mozilla/5.0 (".concat(Se,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Ae);Te.navigator={platform:be,language:Ae,appVersion:"5.0 (".concat(Se,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Re};var Ce={};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce._OffscreenCanvas=void 0;var Me=i,Oe=st,Pe=function(t,e){var r;return void 0===t&&(t=0),void 0===e&&(e=0),(0,Oe.isMiniGame)()?((r=Me.platform.createCanvas()).width=t,r.height=e):r=Me.platform.createOffscreenCanvas({width:t,height:e}),r};Ce._OffscreenCanvas=Pe;var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.performance=void 0;var we=function(){function t(){}return t.now=function(){return Date.now()},t.clearMarks=function(){},t.clearMeasures=function(){},t.clearResourceTimings=function(){},t.getEntries=function(){},t.getEntriesByName=function(){},t.getEntriesByType=function(){},t.mark=function(){},t.measure=function(){},t.setResourceTimingBufferSize=function(){},t.toJSON=function(){},t.eventCounts=0,t.timeOrigin=0,t}();Ie.performance=we;var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.cancelAnimationFrame=Ne.requestAnimationFrame=void 0;var Le=st,Fe=0;Ne.requestAnimationFrame=function(t){var e=(0,Le.getCanvas)();return e.requestAnimationFrame?e.requestAnimationFrame(t):function(t){var e=Date.now(),r=Math.max(Fe+23,e);return setTimeout((function(){t(Fe=r)}),r-e)}(t)},Ne.cancelAnimationFrame=function(t){var e=(0,Le.getCanvas)();return e.cancelAnimationFrame?e.cancelAnimationFrame(t):clearTimeout(t)};var De={};Object.defineProperty(De,"__esModule",{value:!0}),De.TextDecoder=void 0;var Ve=function(){function t(){}return t.prototype.decode=function(t){for(var e=t instanceof ArrayBuffer?new Uint8Array(t):t,r="",i=0,n=e.length;i<n;i++)r+=String.fromCharCode(e[i]);try{return decodeURIComponent(encodeURIComponent(r))}catch(t){return r}},t}();De.TextDecoder=Ve;var Be={};Object.defineProperty(Be,"__esModule",{value:!0}),Be.URL=void 0;var Ue=ce,ke=function(){function t(t,e){void 0===e&&(e=""),0!=t.indexOf("http://")&&0!=t.indexOf("https://")?(e=e.substring(0,e.lastIndexOf("/")+1),t=t.startsWith("./")?t.substring(2):t,this.href=e+t):this.href=t}return t.createObjectURL=function(t){var e=t.buffers[0],r="object"==typeof t.type?t.type.type:t.type,i=function(t){for(var e="",r=new Uint8Array(t),i=r.byteLength,n=0;n<i;n++)e+=String.fromCharCode(r[n]);return(0,Ue.btoa)(e)}(e);return"data:".concat(r,";base64,")+i},t.revokeObjectURL=function(){},t}();Be.URL=ke;var ze={},Ge={};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.isInstanceOf=void 0;var Xe="web"===("undefined"!=typeof my?my.renderTarget:void 0)&&"function"!=typeof getApp;Ge.isInstanceOf=function(t,e){var r=t instanceof e;return!(!Xe||!function(t){if("function"==typeof t&&"string"==typeof t.name){var e=void 0;switch(t.name){case"Object":e=Object;break;case"Array":e=Array;break;case"String":e=String;break;case"Number":e=Number;break;case"Date":e=Date;break;case"Function":e=Function;break;case"Boolean":e=Boolean;break;case"ArrayBuffer":e="undefined"!=typeof ArrayBuffer?ArrayBuffer:void 0;break;case"Promise":e="undefined"!=typeof Promise?Promise:void 0}return e===t}return!1}(e)||Object.prototype.toString.call(t)!=="[object "+e.name+"]")||r};var He=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ze,"__esModule",{value:!0}),ze.XMLHttpRequest=void 0;var je=Ge,We=i,Ye=O,Ze=new WeakMap,qe=new WeakMap,Ke=new WeakMap,Qe={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Je(t,e){void 0===e&&(e={}),e.target=e.target||this,"function"==typeof this["on".concat(t)]&&this["on".concat(t)].call(this,e)}function $e(t,e){void 0===e&&(e={}),this.readyState=t,e.readyState=t,Je.call(this,"readystatechange",e)}var tr=function(t){function e(){var e=t.call(this)||this;return e.runtime=We.platform.getSystemInfoSync().platform,e.onabort=null,e.onerror=null,e.onload=null,e.onloadstart=null,e.onprogress=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null,e.readyState=0,e.response=null,e.responseText=null,e.responseType="text",e.dataType="string",e.responseXML=null,e.status=0,e.statusText="",e.upload={},e.withCredentials=!1,Ze.set(e,{"content-type":"application/x-www-form-urlencoded"}),qe.set(e,{}),e}return He(e,t),e.prototype.abort=function(){var t=Ke.get(this);t&&t.abort()},e.prototype.getAllResponseHeaders=function(){var t=qe.get(this);return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")},e.prototype.getResponseHeader=function(t){return qe.get(this)[t]},e.prototype.open=function(t,r){this._method=t,this._url=r,$e.call(this,e.OPENED)},e.prototype.overrideMimeType=function(){},e.prototype.send=function(t){var r=this;if(void 0===t&&(t=""),this.readyState!==e.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");var i=this._url,n=Ze.get(this),o=this.responseType,a=this.dataType;Qe[o]&&!n["content-type"]&&(n["content-type"]=Qe[o]);var s=function(t){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(t)}(i),u=void 0;"arraybuffer"===o?a="arrayBuffer":u="utf8","json"===o&&(a="json",o="text"),delete this.response,this.response=null;var c=!1,h=function(t){var i=t.data,n=t.statusCode,o=t.header;if(!c){if(c=!0,n=void 0===n?200:n,"string"!=typeof i&&!(0,je.isInstanceOf)(i,ArrayBuffer)&&"json"!==a)try{i=JSON.stringify(i)}catch(t){}r.status=n,o&&qe.set(r,o),Je.call(r,"loadstart"),$e.call(r,e.HEADERS_RECEIVED),$e.call(r,e.LOADING),r.response=i,(0,je.isInstanceOf)(i,ArrayBuffer)?Object.defineProperty(r,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):r.responseText=i,$e.call(r,e.DONE),Je.call(r,"load"),Je.call(r,"loadend")}},l=function(t){var e=t.message||t.errorMessage||t.errMsg;c||(c=!0,-1!==e.indexOf("abort")?Je.call(r,"abort"):Je.call(r,"error",{message:e}),Je.call(r,"loadend"),s&&console.warn(e))};if(s){var f=We.platform.getFileSystemManager(),d={filePath:i,success:h,fail:l};return u&&(d.encoding=u),void f.readFile(d)}var p="arraybuffer"===o&&"ios"===this.runtime&&e.useFetchPatch;We.platform.request({data:t,url:i,method:this._method.toUpperCase(),header:n,dataType:a,responseType:o,enableCache:!1,success:h,fail:l}),p&&setTimeout((function(){We.platform.request({data:t,url:i,method:this._method,header:n,dataType:a,responseType:o,enableCache:!0,success:h,fail:l})}),e.fetchPatchDelay)},e.prototype.setRequestHeader=function(t,e){var r=Ze.get(this);r[t]=e,Ze.set(this,r)},e.prototype.addEventListener=function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(t){void 0===t&&(t={}),t.target=t.target||r,e.call(r,t)})},e.prototype.removeEventListener=function(t,e){this["on"+t]===e&&(this["on"+t]=null)},e}(Ye.EventTarget);ze.XMLHttpRequest=tr,tr.UNSEND=0,tr.OPENED=1,tr.HEADERS_RECEIVED=2,tr.LOADING=3,tr.DONE=4,tr.useFetchPatch=!1,tr.fetchPatchDelay=200;var er={};Object.defineProperty(er,"__esModule",{value:!0}),er.WebGLRenderingContext=void 0,er.WebGLRenderingContext={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444};var rr={};Object.defineProperty(rr,"__esModule",{value:!0}),rr.WebGL2RenderingContext=void 0,rr.WebGL2RenderingContext={};var ir={},nr=function(t){null==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,t.constructor==Array?this.init_by_array(t,t.length):this.init_seed(t)};nr.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},nr.prototype.init_by_array=function(t,e){var r,i,n;for(this.init_seed(19650218),r=1,i=0,n=this.N>e?this.N:e;n;n--){var o=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1664525*((4294901760&o)>>>16)<<16)+1664525*(65535&o))+t[i]+i,this.mt[r]>>>=0,i++,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1),i>=e&&(i=0)}for(n=this.N-1;n;n--){o=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1566083941*((4294901760&o)>>>16)<<16)+1566083941*(65535&o))-r,this.mt[r]>>>=0,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1)}this.mt[0]=2147483648},nr.prototype.random_int=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_seed(5489),r=0;r<this.N-this.M;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^t>>>1^e[1&t];for(;r<this.N-1;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},nr.prototype.random_int31=function(){return this.random_int()>>>1},nr.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},nr.prototype.random=function(){return this.random_int()*(1/4294967296)},nr.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},nr.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var or=new nr(Math.random()*Number.MAX_SAFE_INTEGER),ar=function(t){var e=t.length;for(;e--;)t[e]=Math.floor(256*or.random());return t};var sr=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ir,"__esModule",{value:!0}),ir.crypto=void 0;var ur=sr(ar);ir.crypto={getRandomValues:ur.default},function(t){var e=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),r=this&&this.__exportStar||function(t,r){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(r,i)||e(r,t,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(u,t),r(i,t),r(oe,t),r(ce,t),r(de,t),r(l,t),r(tt,t),r(me,t),r(h,t),r(C,t),r(At,t),r(O,t),r(f,t),r(Z,t),r(Y,t),r($,t),r(ye,t),r(xe,t),r(Te,t),r(Ce,t),r(Ie,t),r(st,t),r(M,t),r(Ne,t),r(p,t),r(De,t),r(Be,t),r(ze,t),r(er,t),r(rr,t),r(ir,t)}(s),function(t){var e=this&&this.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),r=this&&this.__exportStar||function(t,r){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(r,i)||e(r,t,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.window=void 0;var i=s;t.window={innerWidth:i.screen.availWidth,innerHeight:i.screen.availHeight,setTimeout:setTimeout,clearTimeout:clearTimeout,atob:i.atob,btoa:i.btoa,devicePixelRatio:i.devicePixelRatio,document:i.document,navigator:i.navigator,location:i.location,screen:i.screen,Blob:i.Blob,Event:i.Event,EventTarget:i.EventTarget,Node:i.Node,Element:i.Element,HTMLElement:i.HTMLElement,HTMLCanvasElement:i.HTMLCanvasElement,HTMLImageElement:i.HTMLImageElement,HTMLMediaElement:i.HTMLMediaElement,HTMLAudioElement:i.HTMLAudioElement,HTMLVideoElement:i.HTMLVideoElement,Image:i.Image,ImageData:i.ImageData,requestAnimationFrame:i.requestAnimationFrame,cancelAnimationFrame:i.cancelAnimationFrame,XMLHttpRequest:i.XMLHttpRequest,performance:i.performance,URL:i.URL,WebGLRenderingContext:i.WebGLRenderingContext,WebGL2RenderingContext:i.WebGL2RenderingContext,TextDecoder:i.TextDecoder,addEventListener:function(t,e,r){void 0===r&&(r={}),i.document.addEventListener(t,e,r)},removeEventListener:function(t,e){i.document.removeEventListener(t,e)},dispatchEvent:function(t){i.document.dispatchEvent(t)}},r(s,t)}(r);var cr,hr=t({__proto__:null,default:e(r)},[r]);function lr(t,e,r,i,n,o,a){try{var s=t[o](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(i,n)}function fr(t){return function(){var e=this,r=arguments;return new Promise((function(i,n){var o=t.apply(e,r);function a(t){lr(o,i,n,a,s,"next",t)}function s(t){lr(o,i,n,a,s,"throw",t)}a(void 0)}))}}function dr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function pr(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return dr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?dr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function mr(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):mr(t,e)}function vr(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function yr(t,e,r,i){var n,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(o<3?n(a):o>3?n(e,r,a):n(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a}function gr(t,e){var r,i,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}"function"==typeof SuppressedError&&SuppressedError;var xr=new Uint8Array(16);function Tr(){if(!cr&&!(cr=void 0!==r.crypto&&r.crypto.getRandomValues&&r.crypto.getRandomValues.bind(r.crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return cr(xr)}for(var _r=[],Er=0;Er<256;++Er)_r.push((Er+256).toString(16).slice(1));var br={randomUUID:void 0!==r.crypto&&r.crypto.randomUUID&&r.crypto.randomUUID.bind(r.crypto)};function Ar(t,e,r){if(br.randomUUID&&!e&&!t)return br.randomUUID();var i=(t=t||{}).random||(t.rng||Tr)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){r=r||0;for(var n=0;n<16;++n)e[r+n]=i[n];return e}return function(t,e){return void 0===e&&(e=0),_r[t[e+0]]+_r[t[e+1]]+_r[t[e+2]]+_r[t[e+3]]+"-"+_r[t[e+4]]+_r[t[e+5]]+"-"+_r[t[e+6]]+_r[t[e+7]]+"-"+_r[t[e+8]]+_r[t[e+9]]+"-"+_r[t[e+10]]+_r[t[e+11]]+_r[t[e+12]]+_r[t[e+13]]+_r[t[e+14]]+_r[t[e+15]]}(i)}function Sr(t,e){return t.includes(e)||t.push(e),t}function Rr(t,e){var r=t.indexOf(e);return r>-1&&t.splice(r,1),t}function Cr(t,e,r,i){if(void 0===i&&(i=1),t.buffer.byteLength<t.BYTES_PER_ELEMENT*e){var n=Math.ceil(e*i);Number.isNaN(r)||(n=Math.min(n,r));var o=new ArrayBuffer(t.BYTES_PER_ELEMENT*n),a=new t.constructor(o);return a.set(t),a}return t}var Mr=2*Math.PI,Or=Math.PI/180,Pr=180/Math.PI,Ir=1e-6;function wr(t,e){return Math.abs(t-e)<Ir||t===1/0&&e===1/0||t===-1/0&&e===-1/0}var Nr=function(t,e,r){return(1-r)*t+r*e};function Lr(t,e,r){var i=isNaN(e)?-1/0:e,n=isNaN(r)?1/0:r,o=Math.min(i,n),a=Math.max(i,n);return Math.min(Math.max(t,o),a)}var Fr=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.setZero=function(){return this.x=0,this.y=0,this},e.setFromNumber=function(t){return this.x=t,this.y=t,this},e.setFromArray=function(t,e){var r,i;return void 0===e&&(e=0),this.x=null!=(r=t[e])?r:0,this.y=null!=(i=t[e+1])?i:0,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},e.clone=function(){return new t(this.x,this.y)},e.setElement=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:console.error("index is out of range: "+t)}return this},e.getElement=function(t){switch(t){case 0:return this.x;case 1:return this.y;default:console.error("index is out of range: "+t)}return 0},e.add=function(t){return"number"==typeof t?(this.x+=t,this.y+=t):mr(t,Array)?(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},e.subtract=function(t){return"number"==typeof t?(this.x-=t,this.y-=t):mr(t,Array)?(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},e.subtractVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},e.multiply=function(t){return"number"==typeof t?(this.x*=t,this.y*=t):mr(t,Array)?(this.x*=t[0],this.y*=t[1]):(this.x*=t.x,this.y*=t.y),this},e.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this},e.divide=function(t){return"number"==typeof t?(this.x/=t,this.y/=t):mr(t,Array)?(this.x/=t[0],this.y/=t[1]):(this.x/=t.x,this.y/=t.y),this},e.scale=function(t){return this.x*=t,this.y*=t,this},e.sum=function(){return this.x+this.y},e.min=function(t){return"number"==typeof t?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y)),this},e.max=function(t){return"number"==typeof t?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y)),this},e.clamp=function(t,e){return this.max(t).min(e)},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.normalize=function(){return this.divide(this.length()||1)},e.setLength=function(t){return this.normalize().multiply(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},e.lerpVectors=function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this},e.dot=function(t){return this.x*t.x+this.y*t.y},e.cross=function(t){return this.x*t.y-this.y*t.x},e.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)},e.distanceSquared=function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},e.equals=function(t){return this.x===t.x&&this.y===t.y},e.isZero=function(){var t=Ir,e=this.x,r=this.y;return Math.abs(e)<=t&&Math.abs(r)<=t},e.toArray=function(){return[this.x,this.y]},e.fill=function(t,e){void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this},t.fromNumber=function(e){return(new t).setFromNumber(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t}();Fr.ONE=new Fr(1,1),Fr.ZERO=new Fr(0,0);var Dr=function(){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.x=t,this.y=e,this.z=r}var e=t.prototype;return e.set=function(t,e,r){return this.x=t,this.y=e,this.z=r,this},e.setZero=function(){return this.x=0,this.y=0,this.z=0,this},e.setFromNumber=function(t){return this.x=t,this.y=t,this.z=t,this},e.setFromArray=function(t,e){var r,i,n;return void 0===e&&(e=0),this.x=null!=(r=t[e])?r:0,this.y=null!=(i=t[e+1])?i:0,this.z=null!=(n=t[e+2])?n:0,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.clone=function(){return new t(this.x,this.y,this.z)},e.setElement=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:console.error("index is out of range: "+t)}return this},e.getElement=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:console.error("index is out of range: "+t)}return 0},e.add=function(t){return"number"==typeof t?(this.x+=t,this.y+=t,this.z+=t):mr(t,Array)?(this.x+=t[0],this.y+=t[1],this.z+=t[2]):(this.x+=t.x,this.y+=t.y,this.z+=t.z),this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},e.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},e.subtract=function(t){return"number"==typeof t?(this.x-=t,this.y-=t,this.z-=t):mr(t,Array)?(this.x-=t[0],this.y-=t[1],this.z-=t[2]):(this.x-=t.x,this.y-=t.y,this.z-=t.z),this},e.subtractVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},e.multiply=function(t){return"number"==typeof t?(this.x*=t,this.y*=t,this.z*=t):mr(t,Array)?(this.x*=t[0],this.y*=t[1],this.z*=t[2]):(this.x*=t.x,this.y*=t.y,this.z*=t.z),this},e.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},e.divide=function(t){return"number"==typeof t?(this.x/=t,this.y/=t,this.z/=t):mr(t,Array)?(this.x/=t[0],this.y/=t[1],this.z/=t[2]):(this.x/=t.x,this.y/=t.y,this.z/=t.z),this},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.sum=function(){return this.x+this.y+this.z},e.min=function(t){return"number"==typeof t?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t),this.z=Math.min(this.z,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z)),this},e.max=function(t){return"number"==typeof t?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),this.z=Math.max(this.z,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z)),this},e.clamp=function(t,e){return this.max(t).min(e)},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},e.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.normalize=function(){return this.divide(this.length()||1)},e.setLength=function(t){return this.normalize().multiply(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},e.lerpVectors=function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.cross=function(t){return this.crossVectors(this,t)},e.crossVectors=function(t,e){var r=t.x,i=t.y,n=t.z,o=e.x,a=e.y,s=e.z;return this.x=i*s-n*a,this.y=n*o-r*s,this.z=r*a-i*o,this},e.reflect=function(t){return this.subtract(t.clone().multiply(2*this.dot(t)))},e.distance=function(t){return Math.sqrt(this.distanceSquared(t))},e.distanceSquared=function(t){var e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},e.isZero=function(){var t=Ir,e=this,r=e.x,i=e.y,n=e.z;return Math.abs(r)<=t&&Math.abs(i)<=t&&Math.abs(n)<=t},e.toArray=function(){return[this.x,this.y,this.z]},e.toVector2=function(){return new Fr(this.x,this.y)},e.fill=function(t,e){void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this},e.applyEuler=function(t,e){return t.rotateVector3(this,e)},e.applyQuaternion=function(t,e){return t.rotateVector3(this,e)},e.applyMatrix=function(t,e){return t.transformPoint(this,e)},e.applyNormalMatrix=function(t,e){return t.transformNormal(this,e)},e.applyProjectionMatrix=function(t,e){return t.projectPoint(this,e)},t.fromNumber=function(e){return(new t).setFromNumber(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t}();Dr.X=new Dr(1,0,0),Dr.Y=new Dr(0,1,0),Dr.Z=new Dr(0,0,1),Dr.ONE=new Dr(1,1,1),Dr.ZERO=new Dr(0,0,0);var Vr=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=r,this.w=i}var e=t.prototype;return e.set=function(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this},e.setZero=function(){return this.x=0,this.y=0,this.z=0,this.w=0,this},e.setFromNumber=function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},e.setFromArray=function(t,e){var r,i,n,o;return void 0===e&&(e=0),this.x=null!=(r=t[e])?r:0,this.y=null!=(i=t[e+1])?i:0,this.z=null!=(n=t[e+2])?n:0,this.w=null!=(o=t[e+3])?o:0,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.clone=function(){return new t(this.x,this.y,this.z,this.w)},e.setElement=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:console.error("index is out of range: "+t)}return this},e.getElement=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:console.error("index is out of range: "+t)}return 0},e.add=function(t){return"number"==typeof t?(this.x+=t,this.y+=t,this.z+=t,this.w+=t):mr(t,Array)?(this.x+=t[0],this.y+=t[1],this.z+=t[2],this.w+=t[3]):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w),this},e.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},e.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},e.subtract=function(t){return"number"==typeof t?(this.x-=t,this.y-=t,this.z-=t,this.w-=t):mr(t,Array)?(this.x-=t[0],this.y-=t[1],this.z-=t[2],this.w-=t[3]):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w),this},e.subtractVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},e.multiply=function(t){return"number"==typeof t?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):mr(t,Array)?(this.x*=t[0],this.y*=t[1],this.z*=t[2],this.w*=t[3]):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w),this},e.multiplyVectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this},e.divide=function(t){return"number"==typeof t?(this.x/=t,this.y/=t,this.z/=t,this.w/=t):mr(t,Array)?(this.x/=t[0],this.y/=t[1],this.z/=t[2],this.w/=t[3]):(this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w),this},e.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.sum=function(){return this.x+this.y+this.z+this.w},e.min=function(t){return"number"==typeof t?(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t),this.z=Math.min(this.z,t),this.w=Math.min(this.w,t)):(this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w)),this},e.max=function(t){return"number"==typeof t?(this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),this.z=Math.max(this.z,t),this.w=Math.max(this.w,t)):(this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w)),this},e.clamp=function(t,e){return this.max(t).min(e)},e.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},e.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},e.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},e.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this.w=Math.abs(this.w),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.normalize=function(){return this.divide(this.length()||1)},e.setLength=function(t){return this.normalize().multiply(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},e.lerpVectors=function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this.w=t.w+(e.w-t.w)*r,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},e.isZero=function(){var t=Ir,e=this,r=e.x,i=e.y,n=e.z,o=e.w;return Math.abs(r)<=t&&Math.abs(i)<=t&&Math.abs(n)<=t&&Math.abs(o)<=t},e.toArray=function(){return[this.x,this.y,this.z,this.w]},e.toVector3=function(){return new Dr(this.x,this.y,this.z)},e.fill=function(t,e){void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w},e.random=function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this},e.applyMatrix=function(t,e){return t.transformVector4(this,e)},t.fromNumber=function(e){return(new t).setFromNumber(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t}();Vr.ONE=new Vr(1,1,1,1),Vr.ZERO=new Vr(0,0,0,0);var Br=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),this.r=t,this.g=e,this.b=r,this.a=i}var e=t.prototype;return e.set=function(t,e,r,i){return this.r=t,this.g=e,this.b=r,this.a=i,this},e.setZero=function(){return this.r=0,this.g=0,this.b=0,this.a=0,this},e.setFromNumber=function(t){return this.r=t,this.g=t,this.b=t,this.a=t,this},e.setFromVector4=function(t){return this.r=t.x,this.g=t.y,this.b=t.z,this.a=t.w,this},e.setFromArray=function(t,e){var r,i,n,o;return void 0===e&&(e=0),this.r=null!=(r=t[e])?r:0,this.g=null!=(i=t[e+1])?i:0,this.b=null!=(n=t[e+2])?n:0,this.a=null!=(o=t[e+3])?o:0,this},e.setFromHSV=function(t,e,r,i){void 0===i&&(i=1);var n=r*e,o=t/60,a=n*(1-Math.abs(o%2-1)),s=0,u=0,c=0;o>=0&&o<=1?(s=n,u=a):o>=1&&o<=2?(s=a,u=n):o>=2&&o<=3?(u=n,c=a):o>=3&&o<=4?(u=a,c=n):o>=4&&o<=5?(s=a,c=n):o>=5&&o<=6&&(s=n,c=a);var h=r-n;return this.set(s+h,u+h,c+h,i)},e.setFromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return this;var e=parseInt(t.substring(1,3),16)/255,r=parseInt(t.substring(3,5),16)/255,i=parseInt(t.substring(5,7),16)/255,n=9===t.length?parseInt(t.substring(7,9),16)/255:1;return this.set(e,r,i,n)},e.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},e.clone=function(){return new t(this.r,this.g,this.b,this.a)},e.setElement=function(t,e){switch(t){case 0:this.r=e;break;case 1:this.g=e;break;case 2:this.b=e;break;case 3:this.a=e;break;default:console.error("index is out of range: "+t)}return this},e.getElement=function(t){switch(t){case 0:return this.r;case 1:return this.g;case 2:return this.b;case 3:return this.a;default:console.error("index is out of range: "+t)}return 0},e.add=function(t){return"number"==typeof t?(this.r+=t,this.g+=t,this.b+=t,this.a+=t):mr(t,Array)?(this.r+=t[0],this.g+=t[1],this.b+=t[2],this.a+=t[3]):(this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a),this},e.subtract=function(t){return"number"==typeof t?(this.r-=t,this.g-=t,this.b-=t,this.a-=t):mr(t,Array)?(this.r-=t[0],this.g-=t[1],this.b-=t[2],this.a-=t[3]):(this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a),this},e.multiply=function(t){return"number"==typeof t?(this.r*=t,this.g*=t,this.b*=t,this.a*=t):mr(t,Array)?(this.r*=t[0],this.g*=t[1],this.b*=t[2],this.a*=t[3]):(this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a),this},e.divide=function(t){return"number"==typeof t?(this.r/=t,this.g/=t,this.b/=t,this.a/=t):mr(t,Array)?(this.r/=t[0],this.g/=t[1],this.b/=t[2],this.a/=t[3]):(this.r/=t.r,this.g/=t.g,this.b/=t.b,this.a/=t.a),this},e.scale=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},e.min=function(t){return"number"==typeof t?(this.r=Math.min(this.r,t),this.g=Math.min(this.g,t),this.b=Math.min(this.b,t),this.a=Math.min(this.a,t)):(this.r=Math.min(this.r,t.r),this.g=Math.min(this.g,t.g),this.b=Math.min(this.b,t.b),this.a=Math.min(this.a,t.a)),this},e.max=function(t){return"number"==typeof t?(this.r=Math.max(this.r,t),this.g=Math.max(this.g,t),this.b=Math.max(this.b,t),this.a=Math.max(this.a,t)):(this.r=Math.max(this.r,t.r),this.g=Math.max(this.g,t.g),this.b=Math.max(this.b,t.b),this.a=Math.max(this.a,t.a)),this},e.clamp=function(t,e){return this.max(t).min(e)},e.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this.a+=(t.a-this.a)*e,this},e.luminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.equals=function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a},e.toLinear=function(){return this.r=t.gammaToLinear(this.r),this.g=t.gammaToLinear(this.g),this.b=t.gammaToLinear(this.b),this},e.toGamma=function(){return this.r=t.linearToGamma(this.r),this.g=t.linearToGamma(this.g),this.b=t.linearToGamma(this.b),this},e.toArray=function(){return[this.r,this.g,this.b,this.a]},e.toVector4=function(){return new Vr(this.r,this.g,this.b,this.a)},e.toHSV=function(){var e=this,r=e.r,i=e.g,n=e.b,o=e.a,a=Math.max(r,i,n),s=Math.min(r,i,n),u=a-s,c=0,h=0;return 0!==a&&(h=u/a),a!=s&&(a==r?(c=(i-n)/u,i<n&&(c+=6)):a==i?c=(n-r)/u+2:a==n&&(c=(r-i)/u+4),c*=60),new t(c,h,a,o)},e.toHexString=function(e){void 0===e&&(e=!0);var r=t.ToHex(Math.round(255*this.r)),i=t.ToHex(Math.round(255*this.g)),n=t.ToHex(Math.round(255*this.b)),o=t.ToHex(Math.round(255*this.a));return e?"#"+r+i+n+o:"#"+r+i+n},e.fill=function(t,e){void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t[e+3]=this.a},t.fromNumber=function(e){return(new t).setFromNumber(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t.fromHexString=function(e){return(new t).setFromHexString(e)},t.fromHSV=function(e,r,i,n){return void 0===n&&(n=1),(new t).setFromHSV(e,r,i,n)},t.gammaToLinear=function(t){return t<=0?0:t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},t.linearToGamma=function(t){return t<=0?0:t<.0031308?12.92*t:t<1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},t.ToHex=function(t){var e=t.toString(16);return t<=15?("0"+e).toUpperCase():e.toUpperCase()},t}();function Ur(t,e){var r=[0,0,0,0];if(li(t)){t=t.replace(/[\s\t\r\n]/g,"");var i=/rgba?\(([.\d]+),([.\d]+),([.\d]+),?([.\d]+)?\)/.exec(t);if(i){var n=+i[4];r=[+i[1],+i[2],+i[3],isNaN(n)?255:255*n]}else/^#[a-f\d]{3}$/i.test(t)?r=[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),255]:(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))&&(r=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),255])}else mr(t,Array)&&(r=[t[0],t[1],t[2],isNaN(t[3])?255:t[3]]);if(e)for(var o=0;o<4;o++)r[o]/=255;return r}function kr(t,e,r){if(t.length){for(var i,n=1;n<=t.length-1;n++){var o=t[n-1],a=t[n];if(o.time<=e&&e<=a.time){i=Gr(o.color.toArray(),a.color.toArray(),(e-o.time)/(a.time-o.time));break}}return i||(i=t[t.length-1].color.toArray()),r?i.map((function(t){return t/255})):i}return[0,0,0,0]}function zr(t){var e=[];if(mr(t,Array)?t.forEach((function(t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4];e.push({time:Xr(r),color:new Br(i,n,o,a)})})):Object.keys(t).forEach((function(r){var i=t[r],n=(new Br).setFromArray(Ur(i));e.push({time:Xr(r),color:n})})),(e=e.sort((function(t,e){return t.time-e.time}))).length){0!==e[0].time&&e.unshift({time:0,color:e[0].color.clone()});var r=e[e.length-1];1!==r.time&&e.push({time:1,color:r.color.clone()})}return e}function Gr(t,e,r,i){var n=[],o=1-r;if(i)for(var a=0;a<4;a++)n[a]=t[a]*o+e[a]*r;else{for(var s=0;s<3;s++)n[s]=Math.round(Math.sqrt(t[s]*t[s]*o+e[s]*e[s]*r));n[3]=Math.round(t[3]*o+e[3]*r)}return n}function Xr(t){var e=/^(-)?([\d+.]+)%$/.exec(t);return e?+e[2]/100*(e[1]?-1:1):+t}function Hr(){if("object"==typeof r.screen&&"object"==typeof r.document){var t=Math.max(r.document.documentElement.clientWidth,r.window.innerWidth||0),e=r.screen.width/t;return Math.min(2*e,2)}return 1}Br.BLACK=new Br(0,0,0,1),Br.BLUE=new Br(0,0,1,1),Br.CLEAR=new Br(0,0,0,0),Br.CYAN=new Br(0,1,1,1),Br.GRAY=new Br(.5,.5,.5,1),Br.GREEN=new Br(0,1,0,1),Br.MAGENTA=new Br(1,0,1,1),Br.RED=new Br(1,0,0,1),Br.WHITE=new Br(1,1,1,1),Br.YELLOW=new Br(1,.92,.016,1),exports.OrderType=void 0;var jr,Wr=void 0!==r.window;function Yr(){return!!r.navigator.platform&&/iPad|iPhone|iPod/.test(r.navigator.platform)}function Zr(){return/\b[Aa]ndroid\b/.test(r.navigator.userAgent)}function qr(){return/\bOpenHarmony\b/.test(r.navigator.userAgent)}function Kr(){return Zr()||qr()||/\b(iPad|iPhone|iPod)\b/.test(r.navigator.userAgent)}function Qr(){var t;return"undefined"!=typeof my&&"web"===(null==(t=my)?void 0:t.renderTarget)}function Jr(){return"miniprogram"===r.window.__wxjs_environment}function $r(t){li(t)&&(t=Ur(t));for(var e=t,r={width:1,height:1,data:new Uint8Array(4)},i=r.data,n=0;n<4;n++)i[n]=e[n];return r}function ti(t){var e={width:128,height:1,data:new Uint8Array(512)},r=e.data,i=zr(t);if(i.length){r.set(i[0].color.toArray(),0);for(var n=1;n<127;n++){for(var o=n/128,a=void 0,s=void 0,u=0;u<i.length&&(a=i[u],s=i[u+1],!(a.time<=o&&s.time>o));u++);var c=Gr(a.color.toArray(),s.color.toArray(),(o-a.time)/(s.time-a.time));r.set(c,4*n)}r.set(i[i.length-1].color.toArray(),508)}return e}function ei(t,e){void 0===e&&(e=2);var r=t.length;if(r<=1||1===e)return t;if(r<=30){for(var i=1;i<r;i++)ii(t,i,e);return t}return ni(t,e)}function ri(t,e,r){return void 0===r&&(r=2),t.includes(e)||(t.push(e),1===t.length||1!==r&&ii(t,t.length-1,r)),t}function ii(t,e,r){var i=t[e];if(2!==r)for(;e>=1&&t[e-1].priority<i.priority&&(t[e]=t[e-1],0!=--e););else for(;e>=1&&t[e-1].priority>i.priority&&(t[e]=t[e-1],0!=--e););t[e]=i}function ni(t,e,r,i){if(void 0===r&&(r=0),void 0===i&&(i=t.length-1),r>=i)return t;for(var n,o=t[r],a=r,s=i;a<s;){if(2===e){for(;t[s].priority>o.priority&&s>=a;)s--;for(;t[a].priority<=o.priority&&a<s;)a++}else{for(;t[s].priority<o.priority&&s>=a;)s--;for(;t[a].priority>=o.priority&&a<s;)a++}var u;u=[t[s],t[a]],t[a]=u[0],t[s]=u[1]}return n=[t[a],t[r]],t[r]=n[0],t[a]=n[1],ni(t,e,r,a-1),ni(t,e,s+1,i),t}function oi(t,e){if(void 0===e&&(e="item doesn't exist"),null==t)throw new Error(e)}function ai(t){return/^[^\d.][\w-]*$/.test(t)}(jr=exports.OrderType||(exports.OrderType={}))[jr.none=1]="none",jr[jr.ascending=2]="ascending",jr[jr.descending=3]="descending";var si;function ui(t){return["%c[Galacean Effects]","color: #AA0100",""+t]}exports.DestroyOptions=void 0;var ci={error:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n;(n=console).error.apply(n,[].concat(ui(t),[r])),null==si||si("error",t,r)},info:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n;(n=console).debug.apply(n,[].concat(ui(t))),null==si||si("info",t,r)},warn:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n;(n=console).warn.apply(n,[].concat(ui(t))),null==si||si("warn",t,r)},register:function(t){t&&di(t)&&(si=t)}};function hi(){}function li(t){return"string"==typeof t}!function(t){t[t.destroy=0]="destroy",t[t.keep=1]="keep",t[t.force=0]="force"}(exports.DestroyOptions||(exports.DestroyOptions={}));var fi=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function di(t){return"[object Function]"===Object.prototype.toString.call(t)}function pi(t){return"[object Object]"===Object.prototype.toString.call(t)}function mi(t){if(null===t||"object"!=typeof t)return!1;if("[object Object]"!==Object.prototype.toString.call(t))return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;var r=Object.prototype.hasOwnProperty.call(e,"constructor")&&e.constructor;return"function"==typeof r&&Function.prototype.toString.call(r)===Function.prototype.toString.call(Object)}function vi(t){var e;return"object"==typeof t&&null!==t&&"CANVAS"===(null==(e=t.tagName)?void 0:e.toUpperCase())}function yi(t,e){return t+Math.random()*(e-t)}function gi(){throw new Error("Destroyed item cannot be used again.")}function xi(){return Ar().replace(/-/g,"")}function Ti(t,e,i){void 0===e&&(e="base64File"),void 0===i&&(i="");for(var n=t.split(",")[1]||t,o=r.atob(n),a=[],s=0;s<o.length;s+=512){for(var u=o.slice(s,s+512),c=new Array(u.length),h=0;h<u.length;h++)c[h]=u.charCodeAt(h);var l=new Uint8Array(c);a.push(l)}var f=new r.Blob(a,{type:i});return new File([f],e,{type:i})}function _i(t,e){e.forEach((function(e){Object.getOwnPropertyNames(e.prototype).forEach((function(r){var i=Object.getOwnPropertyDescriptor(e.prototype,r);if(!i)throw new Error("Cannot find property descriptor of class "+e);Object.defineProperty(t.prototype,r,i)}))}))}var Ei={},bi=[],Ai={};function Si(t,e,r){Ai[t]&&ci.error("Duplicate registration for plugin "+t+"."),Ai[t]=r,Ei[t]=e,Sr(bi,t)}var Ri=function(){function t(t){var e={},r=[];bi.forEach((function(t){var i=Ei[t];r.includes(i)||(r.push(i),e[t]=i)}));for(var i,n=pr(t);!(i=n()).done;){var o=i.value;if(!Ei[o])throw new Error("The plugin '"+o+"' not found."+Mi(o))}this.plugins=Object.keys(e).map((function(t){var e=new Ei[t];return e.name=t,e})).sort((function(t,e){return t.order-e.order}))}var e=t.prototype;return e.initializeComposition=function(t,e){this.plugins.forEach((function(r){return r.onCompositionConstructed(t,e)}))},e.destroyComposition=function(t){this.plugins.forEach((function(e){return e.onCompositionDestroyed(t)}))},e.resetComposition=function(t,e){this.plugins.forEach((function(r){return r.onCompositionReset(t,e)}))},e.processRawJSON=function(t,e){var r=this;return fr((function(){return gr(this,(function(i){return[2,r.callStatic("processRawJSON",t,e)]}))}))()},e.processAssets=function(t,e){var r=this;return fr((function(){return gr(this,(function(i){return[2,r.callStatic("processAssets",t,e)]}))}))()},e.precompile=function(t,e){for(var r,i=pr(this.plugins);!(r=i()).done;)r.value.precompile(t,e)},e.loadResources=function(t,e){var r=this;return fr((function(){return gr(this,(function(i){return[2,r.callStatic("prepareResource",t,e)]}))}))()},e.callStatic=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n=this;return fr((function(){var e,i,o,a,s,u,c;return gr(this,(function(h){for(e=[],i=n.plugins,o=0;o<i.length;o++)a=i[o],s=Ei[a.name],t in s&&e.push(Promise.resolve(null==(c=s[t])?void 0:(u=c).call.apply(u,[].concat([s],r))));return[2,Promise.all(e)]}))}))()},t}(),Ci={"alipay-downgrade":"@galacean/effects-plugin-alipay-downgrade",downgrade:"@galacean/effects-plugin-downgrade","editor-gizmo":"@galacean/effects-plugin-editor-gizmo",model:"@galacean/effects-plugin-model",video:"@galacean/effects-plugin-multimedia",audio:"@galacean/effects-plugin-multimedia","orientation-transformer":"@galacean/effects-plugin-orientation-transformer","rich-text":"@galacean/effects-plugin-rich-text",spine:"@galacean/effects-plugin-spine"};function Mi(t){var e=Ci[t];return e?"\nPlease follow the commands below to proceed\n1 npm Install Pluginnpm i "+e+"@latest --save\n2Import Pluginimport '"+e+"'":""}var Oi,Pi,Ii,wi,Ni,Li,Fi,Di,Vi,Bi,Ui,ki,zi,Gi,Xi=function(){function t(){this.order=100,this.name=""}var e=t.prototype;return e.precompile=function(t,e){},e.onCompositionConstructed=function(t,e){},e.onCompositionItemLifeBegin=function(t,e){},e.onCompositionItemLifeEnd=function(t,e){},e.onCompositionItemRemoved=function(t,e){},e.onCompositionReset=function(t,e){},e.onCompositionWillReset=function(t,e){},e.onCompositionDestroyed=function(t){},e.onCompositionUpdate=function(t,e){},e.prepareRenderFrame=function(t,e){return!1},e.postProcessFrame=function(t,e){},t}();function Hi(t,e){return Hi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Hi(t,e)}function ji(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Hi(t,e)}!function(t){t["1_0"]="1.0",t["1_1"]="1.1",t["1_2"]="1.2",t["1_3"]="1.3",t["1_5"]="1.5",t["1_8"]="1.8",t["2_0"]="2.0",t["2_1"]="2.1",t["2_2"]="2.2",t["2_3"]="2.3",t["2_4"]="2.4",t["3_0"]="3.0",t["3_1"]="3.1",t["3_2"]="3.2",t["3_3"]="3.3",t["3_4"]="3.4",t["3_5"]="3.5",t.LATEST="3.5"}(Oi||(Oi={})),function(t){t.S="S",t.APlus="A+",t.A="A",t.BPlus="B+",t.B="B"}(Pi||(Pi={})),function(t){t[t.ALPHA=0]="ALPHA",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.BRIGHTNESS=3]="BRIGHTNESS",t[t.SUBTRACTION=4]="SUBTRACTION",t[t.STRONG_LIGHT=5]="STRONG_LIGHT",t[t.WEAK_LIGHT=6]="WEAK_LIGHT",t[t.SUPERPOSITION=7]="SUPERPOSITION"}(Ii||(Ii={})),function(t){t[t.DOUBLE=1032]="DOUBLE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK"}(wi||(wi={})),function(t){t[t.OBSCURED=2]="OBSCURED",t[t.REVERSE_OBSCURED=3]="REVERSE_OBSCURED"}(Ni||(Ni={})),function(t){t[t.NONE=0]="NONE",t[t.SPHERE=1]="SPHERE",t[t.CONE=2]="CONE",t[t.HEMISPHERE=3]="HEMISPHERE",t[t.CIRCLE=4]="CIRCLE",t[t.DONUT=5]="DONUT",t[t.RECTANGLE=6]="RECTANGLE",t[t.RECTANGLE_EDGE=7]="RECTANGLE_EDGE",t[t.EDGE=8]="EDGE",t[t.TEXTURE=9]="TEXTURE"}(Li||(Li={})),function(t){t[t.GYROSCOPE=0]="GYROSCOPE",t[t.SPINE=1]="SPINE"}(Fi||(Fi={})),function(t){t[t.CLICK=0]="CLICK",t[t.MESSAGE=1]="MESSAGE",t[t.DRAG=2]="DRAG"}(Di||(Di={})),function(t){t[t.NONE=0]="NONE",t[t.NOTIFY=1]="NOTIFY",t[t.RESUME_PLAYER=2]="RESUME_PLAYER",t[t.REMOVE=3]="REMOVE",t[t.PAUSE=4]="PAUSE"}(Vi||(Vi={})),function(t){t.base="0",t.sprite="1",t.particle="2",t.null="3",t.interact="4",t.plugin="5",t.camera="6",t.composition="7",t.spine="spine",t.mesh="mesh",t.tree="tree",t.text="text",t.light="light",t.skybox="skybox",t.effect="effect",t.shape="shape",t.postProcessVolume="postProcessVolume",t.node="node",t.video="video",t.audio="audio",t.richtext="richtext"}(Bi||(Bi={})),function(t){t[t.BILLBOARD=0]="BILLBOARD",t[t.MESH=1]="MESH",t[t.VERTICAL_BILLBOARD=2]="VERTICAL_BILLBOARD",t[t.HORIZONTAL_BILLBOARD=3]="HORIZONTAL_BILLBOARD"}(Ui||(Ui={})),function(t){t[t.PARTICLE_ORIGIN_CENTER=0]="PARTICLE_ORIGIN_CENTER",t[t.PARTICLE_ORIGIN_LEFT_TOP=1]="PARTICLE_ORIGIN_LEFT_TOP",t[t.PARTICLE_ORIGIN_LEFT_CENTER=2]="PARTICLE_ORIGIN_LEFT_CENTER",t[t.PARTICLE_ORIGIN_LEFT_BOTTOM=3]="PARTICLE_ORIGIN_LEFT_BOTTOM",t[t.PARTICLE_ORIGIN_CENTER_TOP=4]="PARTICLE_ORIGIN_CENTER_TOP",t[t.PARTICLE_ORIGIN_CENTER_BOTTOM=5]="PARTICLE_ORIGIN_CENTER_BOTTOM",t[t.PARTICLE_ORIGIN_RIGHT_TOP=6]="PARTICLE_ORIGIN_RIGHT_TOP",t[t.PARTICLE_ORIGIN_RIGHT_CENTER=7]="PARTICLE_ORIGIN_RIGHT_CENTER",t[t.PARTICLE_ORIGIN_RIGHT_BOTTOM=8]="PARTICLE_ORIGIN_RIGHT_BOTTOM"}(ki||(ki={})),function(t){t.Opaque="Opaque",t.Transparent="Transparent"}(zi||(zi={})),function(t){t.Both="Both",t.Back="Back",t.Front="Front"}(Gi||(Gi={}));var Wi,Yi,Zi,qi,Ki,Qi,Ji,$i,tn,en,rn,nn,on,an,sn,un,cn,hn;!function(t){t[t.portrait=1]="portrait",t[t.landscape=0]="landscape"}(Wi||(Wi={})),function(t){t[t.CONSTANT=0]="CONSTANT",t[t.CONSTANT_VEC2=1]="CONSTANT_VEC2",t[t.CONSTANT_VEC3=2]="CONSTANT_VEC3",t[t.CONSTANT_VEC4=3]="CONSTANT_VEC4",t[t.RANDOM=4]="RANDOM",t[t.LINE=5]="LINE",t[t.CURVE=6]="CURVE",t[t.BEZIER_PATH=7]="BEZIER_PATH",t[t.RGBA_COLOR=8]="RGBA_COLOR",t[t.GRADIENT_COLOR=9]="GRADIENT_COLOR",t[t.SHAPE_POINTS=10]="SHAPE_POINTS",t[t.SHAPE_SPLITS=11]="SHAPE_SPLITS",t[t.LINEAR_PATH=12]="LINEAR_PATH",t[t.COLORS=13]="COLORS",t[t.BINARY=20]="BINARY",t[t.BEZIER_CURVE=21]="BEZIER_CURVE",t[t.BEZIER_CURVE_PATH=22]="BEZIER_CURVE_PATH",t[t.BEZIER_CURVE_QUAT=23]="BEZIER_CURVE_QUAT",t[t.COLOR_CURVE=24]="COLOR_CURVE",t[t.VECTOR4_CURVE=25]="VECTOR4_CURVE",t[t.VECTOR2_CURVE=26]="VECTOR2_CURVE",t[t.VECTOR3_CURVE=27]="VECTOR3_CURVE"}(Yi||(Yi={})),function(t){t[t.AUTO=0]="AUTO",t[t.EASE=1]="EASE",t[t.EASE_IN=2]="EASE_IN",t[t.EASE_OUT=3]="EASE_OUT",t[t.LINE=4]="LINE",t[t.HOLD=5]="HOLD",t[t.LINE_OUT=6]="LINE_OUT"}(Zi||(Zi={})),function(t){t[t.destroy=0]="destroy",t[t.restart=5]="restart",t[t.forward=2]="forward",t[t.freeze=4]="freeze"}(qi||(qi={})),function(t){t[t.none=0]="none",t[t.removeParticle=1]="removeParticle"}(Ki||(Ki={})),function(t){t[t.RANDOM=0]="RANDOM",t[t.UNIDIRECTIONAL_CYCLE=1]="UNIDIRECTIONAL_CYCLE",t[t.BIDIRECTIONAL_CYCLE=2]="BIDIRECTIONAL_CYCLE",t[t.UNIFORM_BURST=3]="UNIFORM_BURST"}(Qi||(Qi={})),function(t){t.point="point",t.spot="spot",t.directional="directional",t.ambient="ambient"}(Ji||(Ji={})),function(t){t[t.box=2]="box",t[t.sphere=3]="sphere"}($i||($i={})),function(t){t.orthographic="orthographic",t.perspective="perspective"}(tn||(tn={})),function(t){t.unlit="unlit",t.pbr="pbr",t.hair="hair"}(en||(en={})),function(t){t[t.opaque=100]="opaque",t[t.masked=101]="masked",t[t.translucent=102]="translucent",t[t.additive=103]="additive"}(rn||(rn={})),function(t){t.none="none",t.uv="uv",t.normal="normal",t.basecolor="basecolor",t.alpha="alpha",t.metallic="metallic",t.roughness="roughness",t.ao="ao",t.emissive="emissive",t.diffuse="diffuse"}(nn||(nn={})),function(t){t[t.visible=0]="visible",t[t.display=1]="display",t[t.clip=2]="clip",t[t.ellipsis=3]="ellipsis"}(on||(on={})),function(t){t[t.autoWidth=0]="autoWidth",t[t.autoHeight=1]="autoHeight",t[t.fixed=2]="fixed"}(an||(an={})),function(t){t[t.top=0]="top",t[t.middle=1]="middle",t[t.bottom=2]="bottom"}(sn||(sn={})),function(t){t[t.left=0]="left",t[t.middle=1]="middle",t[t.right=2]="right"}(un||(un={})),function(t){t.normal="normal",t.bold="bold",t.lighter="lighter"}(cn||(cn={})),function(t){t.normal="normal",t.italic="italic",t.oblique="oblique"}(hn||(hn={}));var ln,fn,dn,pn,mn,vn,yn,gn,xn,Tn,_n,En,bn,An={WhiteTexture:"whitetexture00000000000000000000",TransparentTexture:"transparenttexture00000000000000000000",PBRShader:"pbr00000000000000000000000000000",UnlitShader:"unlit000000000000000000000000000"};!function(t){t[t.Solid=0]="Solid",t[t.GradientLinear=1]="GradientLinear",t[t.GradientRadial=2]="GradientRadial",t[t.GradientAngular=3]="GradientAngular",t[t.Texture=4]="Texture"}(ln||(ln={})),function(t){t[t.Fill=0]="Fill",t[t.Fit=1]="Fit",t[t.Crop=2]="Crop",t[t.Tile=3]="Tile"}(fn||(fn={})),function(t){t[t.Custom=0]="Custom",t[t.Rectangle=1]="Rectangle",t[t.Ellipse=2]="Ellipse",t[t.Polygon=3]="Polygon",t[t.Star=4]="Star"}(dn||(dn={})),function(t){t[t.Butt=0]="Butt",t[t.Round=1]="Round",t[t.Square=2]="Square"}(pn||(pn={})),function(t){t[t.Round=0]="Round",t[t.Bevel=1]="Bevel",t[t.Miter=2]="Miter"}(mn||(mn={})),function(t){t.AnimationClipNodeData="AnimationClipNodeData",t.BlendNodeData="BlendNodeData",t.ApplyAdditiveNodeData="ApplyAdditiveNodeData",t.LayerBlendNodeData="LayerBlendNodeData",t.StateMachineNodeData="StateMachineNodeData",t.TransitionNodeData="TransitionNodeData",t.StateNodeData="StateNodeData",t.ConstFloatNodeData="ConstFloatNodeData",t.ConstBoolNodeData="ConstBoolNodeData",t.ControlParameterBoolNodeData="ControlParameterBoolNodeData",t.ControlParameterFloatNodeData="ControlParameterFloatNodeData",t.ControlParameterTriggerNodeData="ControlParameterTriggerNodeData",t.NotNodeData="NotNodeData",t.AndNodeData="AndNodeData",t.OrNodeData="OrNodeData",t.EqualNodeData="EqualNodeData",t.GreaterNodeData="GreaterNodeData",t.LessNodeData="LessNodeData"}(vn||(vn={})),function(t){t.video="video",t.image="image"}(yn||(yn={})),function(t){t.video="video",t.audio="audio"}(gn||(gn={})),function(t){t.VFXItemData="VFXItemData",t.Material="Material",t.Shader="Shader",t.Geometry="Geometry",t.Texture="Texture",t.Image="Image",t.AnimationClip="AnimationClip",t.BinaryAsset="BinaryAsset",t.TrackAsset="TrackAsset",t.TimelineAsset="TimelineAsset",t.ObjectBindingTrack="ObjectBindingTrack",t.TransformTrack="TransformTrack",t.SpriteColorTrack="SpriteColorTrack",t.ActivationTrack="ActivationTrack",t.SubCompositionTrack="SubCompositionTrack",t.FloatPropertyTrack="FloatPropertyTrack",t.ColorPropertyTrack="ColorPropertyTrack",t.Vector2PropertyTrack="Vector2PropertyTrack",t.Vector3PropertyTrack="Vector3PropertyTrack",t.Vector4PropertyTrack="Vector4PropertyTrack",t.TransformPlayableAsset="TransformPlayableAsset",t.SpriteColorPlayableAsset="SpriteColorPlayableAsset",t.ActivationPlayableAsset="ActivationPlayableAsset",t.SubCompositionPlayableAsset="SubCompositionPlayableAsset",t.FloatPropertyPlayableAsset="FloatPropertyPlayableAsset",t.ColorPropertyPlayableAsset="ColorPropertyPlayableAsset",t.Vector2PropertyPlayableAsset="Vector2PropertyPlayableAsset",t.Vector3PropertyPlayableAsset="Vector3PropertyPlayableAsset",t.Vector4PropertyPlayableAsset="Vector4PropertyPlayableAsset",t.MeshComponent="MeshComponent",t.SkyboxComponent="SkyboxComponent",t.LightComponent="LightComponent",t.CameraComponent="CameraComponent",t.ModelPluginComponent="ModelPluginComponent",t.TreeComponent="TreeComponent",t.AnimationComponent="AnimationComponent",t.SpineComponent="SpineComponent",t.VideoComponent="VideoComponent",t.AudioComponent="AudioComponent",t.RichTextComponent="RichTextComponent",t.OrientationComponent="OrientationComponent",t.ShapeComponent="ShapeComponent",t.SpriteComponent="SpriteComponent",t.ParticleSystem="ParticleSystem",t.InteractComponent="InteractComponent",t.CameraController="CameraController",t.PostProcessVolume="PostProcessVolume",t.EffectComponent="EffectComponent",t.TextComponent="TextComponent",t.AnimationGraphAsset="AnimationGraphAsset",t.CompositionComponent="CompositionComponent",t.FFDComponent="FFDComponent",t.Animator="Animator",t.TimelineClip="TimelineClip"}(xn||(xn={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Tn||(Tn={})),function(t){t[t.Float16=0]="Float16",t[t.Float32=1]="Float32",t[t.Int8=2]="Int8",t[t.Int16=3]="Int16",t[t.Int32=4]="Int32",t[t.UInt8=5]="UInt8",t[t.UInt16=6]="UInt16",t[t.UInt32=7]="UInt32"}(_n||(_n={})),function(t){t[t.None=-1]="None",t[t.UInt8=0]="UInt8",t[t.UInt16=1]="UInt16",t[t.UInt32=2]="UInt32"}(En||(En={})),function(t){t.Position="POSITION",t.Uv="TEXCOORD0",t.Uv2="TEXCOORD1",t.Normal="NORMAL",t.Tangent="TANGENT",t.Color="COLOR",t.Joints="JOINTS",t.Weights="WEIGHTS",t.PositionBS0="POSITION_BS0",t.PositionBS1="POSITION_BS1",t.PositionBS2="POSITION_BS2",t.PositionBS3="POSITION_BS3",t.PositionBS4="POSITION_BS4",t.PositionBS5="POSITION_BS5",t.PositionBS6="POSITION_BS6",t.PositionBS7="POSITION_BS7",t.NormalBS0="NORMAL_BS0",t.NormalBS1="NORMAL_BS1",t.NormalBS2="NORMAL_BS2",t.NormalBS3="NORMAL_BS3",t.TangentBS0="TANGENT_BS0",t.TangentBS1="TANGENT_BS1",t.TangentBS2="TANGENT_BS2",t.TangentBS3="TANGENT_BS3"}(bn||(bn={}));var Sn=Oi.LATEST,Rn=Object.freeze({__proto__:null,LATEST_VERSION:Sn,get RenderLevel(){return Pi},get BlendingMode(){return Ii},get SideMode(){return wi},get ObscuredMode(){return Ni},get ParticleEmitterShapeType(){return Li},get PluginType(){return Fi},get InteractType(){return Di},get InteractBehavior(){return Vi},get ItemType(){return Bi},get RenderMode(){return Ui},get ParticleOrigin(){return ki},get RenderType(){return zi},get RenderFace(){return Gi},get CameraClipMode(){return Wi},END_BEHAVIOR_DESTROY:0,END_BEHAVIOR_PAUSE:1,END_BEHAVIOR_FORWARD:2,END_BEHAVIOR_PAUSE_AND_DESTROY:3,END_BEHAVIOR_FREEZE:4,END_BEHAVIOR_RESTART:5,END_BEHAVIOR_DESTROY_CHILDREN:6,CAMERA_CLIP_MODE_VERTICAL:1,CAMERA_CLIP_MODE_NORMAL:0,MESSAGE_ITEM_PHRASE_BEGIN:2,MESSAGE_ITEM_PHRASE_END:1,get ValueType(){return Yi},get BezierKeyframeType(){return Zi},get JSONSceneVersion(){return Oi},get EndBehavior(){return qi},get ParticleInteractionBehavior(){return Ki},get ShapeArcMode(){return Qi},get LightType(){return Ji},get ModelBoundingType(){return $i},get CameraType(){return tn},get MaterialType(){return en},get MaterialBlending(){return rn},get RenderMode3D(){return nn},get TextOverflow(){return on},get TextSizeMode(){return an},get TextBaseline(){return sn},get TextAlignment(){return un},get TextWeight(){return cn},get FontStyle(){return hn},BuiltinObjectGUID:An,get FillType(){return ln},get TexturePaintScaleMode(){return fn},get ShapePrimitiveType(){return dn},get LineCap(){return pn},get LineJoin(){return mn},get NodeDataType(){return vn},get BackgroundType(){return yn},get MultimediaType(){return gn},get DataType(){return xn},get GeometryType(){return Tn},get VertexFormatType(){return _n},get IndexFormatType(){return En},get VertexBufferSemantic(){return bn}}),Cn=new Map,Mn=new Map,On={};function Pn(t){return On[t]}function In(t){return function(e,r){On[t]&&console.warn("Class "+t+" is already registered."),On[t]=e}}function wn(t,e){return function(t,e){return function(r,i){var n=function(t){var e=t.constructor;return Cn.get(e)||Cn.set(e,{}),Cn.get(e)}(r);n&&(n[i]||(n[i]={type:t,sourceName:e}))}}(t,e)}function Nn(t){var e=t.constructor;if(Mn.get(e))return Mn.get(e);var r={};Mn.set(e,r);for(var i=t,n=e;n;){var o=Cn.get(n);for(var a in o)r[a]=o[a];var s=Object.getPrototypeOf(i);if((n=Object.getPrototypeOf(s).constructor)===Object)break;i=s}return r}var Ln=function(){function t(t){this.engine=t,this.guid=xi(),this.defination={},this.engine.addInstance(this)}var e=t.prototype;return e.getInstanceId=function(){return this.guid},e.setInstanceId=function(t){this.engine.removeInstance(this.guid),this.guid=t,this.engine.addInstance(this)},e.toData=function(){},e.fromData=function(t){void 0!==t.id&&this.setInstanceId(t.id)},e.dispose=function(){this.engine.removeInstance(this.guid)},t.is=function(e){return mr(e,t)&&"guid"in e},t}(),Fn=function(){function t(){this.resources=[]}return t.prototype.getResource=function(t){return this.resources[t]},t}(),Dn={};function Vn(t){return function(e,r){Dn[t]&&console.warn("NodeData Class "+t+" is already registered."),Dn[t]=e}}function Bn(t){return Dn[t]}var Un,kn=-1,zn=function(){function t(){this.initializationCount=0,this.lastUpdateID=-1}var e=t.prototype;return e.getNodeData=function(){return this.asset},e.isValid=function(){return!0},e.isInitialized=function(){return this.initializationCount>0},e.initialize=function(t){this.isInitialized()?this.initializationCount++:this.initializeInternal(t)},e.shutdown=function(t){if(!this.isInitialized())throw new Error("Node not initialized!");0==--this.initializationCount&&this.shutdownInternal(t)},e.isNodeActive=function(t){return this.lastUpdateID===t},e.isUpdated=function(t){return this.isNodeActive(t.updateID)},e.markNodeActive=function(t){this.lastUpdateID=t.updateID},e.initializeInternal=function(t){this.initializationCount++},e.shutdownInternal=function(t){if(this.isInitialized())throw new Error("Node still initialized!");this.lastUpdateID=-1},t}(),Gn=function(){function t(){}var e=t.prototype;return e.load=function(t){this.index=t.index},e.createNode=function(t,e){var r=new t;return e.nodes[this.index]=r,r.asset=this,r},t}(),Xn=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).duration=0,e.previousTime=0,e.currentTime=0,e}ji(e,t);var r=e.prototype;return r.getCurrentTime=function(){return this.currentTime},r.getPreviousTime=function(){return this.previousTime},r.getDuration=function(){return this.duration},r.getDebugInfo=function(){return{duration:this.duration,currentTime:this.currentTime,previousTime:this.previousTime}},r.initializeInternal=function(e){t.prototype.initializeInternal.call(this,e),this.previousTime=0,this.currentTime=this.previousTime,this.duration=0},e}(zn),Hn=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.setValue=function(t){},e}(zn),jn=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Hn),Wn=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Hn);exports.AnimationGraphAsset=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).nodeDatas=[],e.graphDataSet=new Fn,e.controlParameterIDs=[],e.parameterLookupMap=new Map,e.rootNodeIndex=kn,e}return ji(e,t),e.prototype.fromData=function(t){var r=t,i=r.nodeDatas;this.rootNodeIndex=r.rootNodeIndex,this.controlParameterIDs=r.controlParameterIDs;for(var n=r.controlParameterIDs.length,o=0;o<n;o++)this.parameterLookupMap.set(r.controlParameterIDs[o],o);this.nodeDatas=[];for(var a=0;a<i.length;a++)this.nodeDatas[a]=e.createNodeData(i[a].type),this.nodeDatas[a].load(i[a]);this.graphDataSet=new Fn,this.graphDataSet.resources=[];for(var s,u=pr(r.graphDataSet.resources);!(s=u()).done;){var c=s.value,h=this.engine.findObject(c);this.graphDataSet.resources.push(h)}},e.createNodeData=function(t){var e=Bn(t);if(e)return new e;throw new Error("Unknown node type: "+t+".")},e}(Ln),exports.AnimationGraphAsset=yr([In("AnimationGraphAsset")],exports.AnimationGraphAsset),function(t){t[t.Active=0]="Active",t[t.Inactive=1]="Inactive"}(Un||(Un={}));var Yn=function(){function t(){this.deltaTime=0,this.updateID=0,this.branchState=0}return t.prototype.update=function(t){this.deltaTime=t,this.updateID++,this.branchState=0},t}(),Zn=function(){function t(){this.nodeDatas=[],this.nodes=[]}return t.prototype.getNode=function(t){return this.nodes[t]?this.nodes[t]:this.nodeDatas[t]?(this.nodeDatas[t].instantiate(this),this.nodes[t]):null},t}();function qn(){return qn=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},qn.apply(this,arguments)}exports.AnimationClipNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).playRate=1,e.loopAnimation=!0,e.dataSlotIndex=-1,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){this.createNode(Qn,t).animation=t.dataSet.getResource(this.dataSlotIndex)},r.load=function(e){t.prototype.load.call(this,e);var r=qn({playRate:1,loopAnimation:!0},e);this.dataSlotIndex=e.dataSlotIndex,this.playRate=r.playRate,this.loopAnimation=r.loopAnimation},e}(Gn),exports.AnimationClipNodeData=yr([Vn(vn.AnimationClipNodeData)],exports.AnimationClipNodeData);var Kn,Qn=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).animation=null,e.animatable=null,e}ji(e,t);var r=e.prototype;return r.evaluate=function(t,e){if(!this.animatable)return e;this.markNodeActive(t);var r=this.getNodeData();this.previousTime=this.currentTime,this.currentTime=this.previousTime+t.deltaTime/this.duration*r.playRate,r.loopAnimation?this.currentTime>1&&(this.currentTime=this.currentTime%1):this.currentTime=Lr(this.currentTime,0,1);var i=this.currentTime*this.duration;return this.animatable.getPose(i,e.pose),e},r.initializeInternal=function(e){var r,i;t.prototype.initializeInternal.call(this,e),this.duration=null!=(i=null==(r=this.animation)?void 0:r.duration)?i:0,this.previousTime=this.currentTime=0,this.animation&&(this.animatable=new Jn(e.skeleton,this.animation))},e}(Xn);!function(t){t[t.Position=0]="Position",t[t.Scale=1]="Scale",t[t.Rotation=2]="Rotation",t[t.Euler=3]="Euler"}(Kn||(Kn={}));var Jn=function(){function t(t,e){this.skeleton=t,this.animationClip=e,this.transformCurveInfos=[],this.floatCurveInfos=[],this.colorCurveInfos=[];for(var r,i=pr(e.positionCurves);!(r=i()).done;){var n=r.value;this.addTransformCurveInfo(n,0)}for(var o,a=pr(e.scaleCurves);!(o=a()).done;){var s=o.value;this.addTransformCurveInfo(s,1)}for(var u,c=pr(e.rotationCurves);!(u=c()).done;){var h=u.value;this.addTransformCurveInfo(h,2)}for(var l,f=pr(e.eulerCurves);!(l=f()).done;){var d=l.value;this.addTransformCurveInfo(d,3)}for(var p,m=pr(e.floatCurves);!(p=m()).done;){var v=p.value;this.addFloatCurveInfo(v)}for(var y,g=pr(e.colorCurves);!(y=g()).done;){var x=y.value;this.addColorCurveInfo(x)}}var e=t.prototype;return e.getPose=function(t,e){for(var r,i=Lr(t,0,this.animationClip.duration),n=pr(this.transformCurveInfos);!(r=n()).done;){var o=r.value,a=o.curve.keyFrames.getValue(i),s=e.parentSpaceTransforms[o.boneIndex];switch(o.type){case 0:s.position.copyFrom(a);break;case 1:s.scale.copyFrom(a);break;case 2:s.rotation.copyFrom(a);break;case 3:s.euler.copyFrom(a)}}for(var u,c=pr(this.floatCurveInfos);!(u=c()).done;){var h=u.value,l=h.curve.keyFrames.getValue(i);e.floatPropertyValues[h.animatedObjectIndex]=l}for(var f,d=pr(this.colorCurveInfos);!(f=d()).done;){var p=f.value,m=p.curve.keyFrames.getValue(i);e.colorPropertyValues[p.animatedObjectIndex]=m}},e.addTransformCurveInfo=function(t,e){var r=this.skeleton.pathToBoneIndex.get(t.path);void 0!==r&&this.transformCurveInfos.push({curve:t,boneIndex:r,type:e})},e.addFloatCurveInfo=function(t){var e=this.skeleton.pathToObjectIndex.get(t.path+t.className+t.property);void 0!==e&&this.floatCurveInfos.push({curve:t,animatedObjectIndex:e})},e.addColorCurveInfo=function(t){var e=this.skeleton.pathToObjectIndex.get(t.path+t.className+t.property);void 0!==e&&this.colorCurveInfos.push({curve:t,animatedObjectIndex:e})},t}(),$n=function(){function t(t,e,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=1),this.x=t,this.y=e,this.z=r,this.w=i}var e=t.prototype;return e.set=function(t,e,r,i){return this.x=t,this.y=e,this.z=r,this.w=i,this},e.setFromEuler=function(t){return t.toQuaternion(this),this},e.setFromAxisAngle=function(e,r){var i=r/2,n=Math.sin(i),o=t.tempVec0;return o.copyFrom(e).normalize(),this.x=o.x*n,this.y=o.y*n,this.z=o.z*n,this.w=Math.cos(i),this},e.setFromVector4=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.setFromArray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},e.setFromRotationMatrix=function(t){var e=t.elements,r=e[0],i=e[4],n=e[8],o=e[1],a=e[5],s=e[9],u=e[2],c=e[6],h=e[10],l=r+a+h;if(l>0){var f=.5/Math.sqrt(l+1);this.w=.25/f,this.x=(c-s)*f,this.y=(n-u)*f,this.z=(o-i)*f}else if(r>a&&r>h){var d=2*Math.sqrt(1+r-a-h);this.w=(c-s)/d,this.x=.25*d,this.y=(i+o)/d,this.z=(n+u)/d,this.negate()}else if(a>h){var p=2*Math.sqrt(1+a-r-h);this.w=(n-u)/p,this.x=(i+o)/p,this.y=.25*p,this.z=(s+c)/p,this.negate()}else{var m=2*Math.sqrt(1+h-r-a);this.w=(o-i)/m,this.x=(n+u)/m,this.y=(s+c)/m,this.z=.25*m,this.negate()}return this},e.setFromUnitVectors=function(t,e){var r=t.dot(e)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this.x=-t.y,this.y=t.x,this.z=0,this.w=r):(this.x=0,this.y=-t.z,this.z=t.y,this.w=r)):(this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this.w=r),this.normalize()},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},e.clone=function(){return new t(this.x,this.y,this.z,this.w)},e.angleTo=function(t){return 2*Math.acos(Math.abs(Lr(this.dot(t),-1,1)))},e.rotateTowards=function(t,e){var r=this.angleTo(t);if(0===r)return this;var i=Math.min(1,e/r);return this.slerp(t,i),this},e.identity=function(){return this.set(0,0,0,1)},e.invert=function(){return this.conjugate()},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},e.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.normalize=function(){var t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},e.multiply=function(t){return this.multiplyQuaternions(this,t)},e.premultiply=function(t){return this.multiplyQuaternions(t,this)},e.multiplyQuaternions=function(t,e){var r=t.x,i=t.y,n=t.z,o=t.w,a=e.x,s=e.y,u=e.z,c=e.w;return this.x=r*c+o*a+i*u-n*s,this.y=i*c+o*s+n*a-r*u,this.z=n*c+o*u+r*s-i*a,this.w=o*c-r*a-i*s-n*u,this},e.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copyFrom(t);var r=this,i=r.x,n=r.y,o=r.z,a=r.w,s=a*t.w+i*t.x+n*t.y+o*t.z;if(s<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,s=-s):this.copyFrom(t),s>=1)return this.w=a,this.x=i,this.y=n,this.z=o,this;var u=1-s*s;if(u<=Number.EPSILON){var c=1-e;return this.w=c*a+e*this.w,this.x=c*i+e*this.x,this.y=c*n+e*this.y,this.z=c*o+e*this.z,this.normalize(),this}var h=Math.sqrt(u),l=Math.atan2(h,s),f=Math.sin((1-e)*l)/h,d=Math.sin(e*l)/h;return this.w=a*f+this.w*d,this.x=i*f+this.x*d,this.y=n*f+this.y*d,this.z=o*f+this.z*d,this},e.slerpQuaternions=function(t,e,r){this.copyFrom(t).slerp(e,r)},e.rotateVector3=function(t,e){var r=this,i=r.x,n=r.y,o=r.z,a=r.w,s=t.x,u=t.y,c=t.z,h=a*s+n*c-o*u,l=a*u+o*s-i*c,f=a*c+i*u-n*s,d=-i*s-n*u-o*c,p=null!=e?e:t;return p.x=h*a+d*-i+l*-o-f*-n,p.y=l*a+d*-n+f*-i-h*-o,p.z=f*a+d*-o+h*-n-l*-i,p},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},e.toArray=function(){return[this.x,this.y,this.z,this.w]},e.toVector4=function(t){return t.set(this.x,this.y,this.z,this.w)},e.toEuler=function(t){return t.setFromQuaternion(this)},e.toMatrix4=function(t){return t.compose(Dr.ZERO,this,Dr.ONE)},t.fromEuler=function(e){return(new t).setFromEuler(e)},t.fromAxisAngle=function(e,r){return(new t).setFromAxisAngle(e,r)},t.fromVector4=function(e){return(new t).setFromVector4(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t.fromRotationMatrix=function(e){return(new t).setFromRotationMatrix(e)},t.fromUnitVectors=function(e,r){return(new t).setFromUnitVectors(e,r)},t}();$n.tempVec0=new Dr;var to=new $n,eo=function(){},ro=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.blendVector3=function(t,e,r,i){i.x=t.x+(e.x-t.x)*r,i.y=t.y+(e.y-t.y)*r,i.z=t.z+(e.z-t.z)*r},r.blendQuaternion=function(t,e,r,i){i.copyFrom(t).slerp(e,r)},r.blendEuler=function(t,e,r,i){this.lerpEuler(t,e,r,i)},r.blendFloat=function(t,e,r){return t+(e-t)*r},r.blendColor=function(t,e,r,i){i.r=t.r+(e.r-t.r)*r,i.g=t.g+(e.g-t.g)*r,i.b=t.b+(e.b-t.b)*r,i.a=t.a+(e.a-t.a)*r},r.lerpEuler=function(t,e,r,i){i.x=this.lerpAngle(t.x,e.x,r),i.y=this.lerpAngle(t.y,e.y,r),i.z=this.lerpAngle(t.z,e.z,r)},r.normalizeAngle=function(t){return(t%360+360)%360},r.shortestAngleDiff=function(t,e){var r=this.normalizeAngle(e)-this.normalizeAngle(t);return r>180&&(r-=360),r<-180&&(r+=360),r},r.lerpAngle=function(t,e,r){var i=this.shortestAngleDiff(t,e);return this.normalizeAngle(t+i*r)},e}(eo),io=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.blendVector3=function(t,e,r,i){i.x=t.x+e.x*r,i.y=t.y+e.y*r,i.z=t.z+e.z*r},r.blendQuaternion=function(t,e,r,i){var n=to.copyFrom(t).multiply(e);i.copyFrom(t).slerp(n,r)},r.blendEuler=function(t,e,r,i){this.blendVector3(t,e,r,i)},r.blendFloat=function(t,e,r){return t+e*r},r.blendColor=function(t,e,r,i){i.r=t.r+e.r*r,i.g=t.g+e.g*r,i.b=t.b+e.b*r,i.a=t.a+e.a*r},e}(eo),no=function(){function t(){}return t.localBlend=function(e,r,i,n){t.localBlendInternal(e,r,i,n,t.normalBlendFunction)},t.additiveBlend=function(e,r,i,n){t.localBlendInternal(e,r,i,n,t.additiveBlendFunction)},t.localBlendInternal=function(t,e,r,i,n){for(var o=0;o<t.parentSpaceTransforms.length;o++){var a=t.parentSpaceTransforms[o],s=e.parentSpaceTransforms[o],u=i.parentSpaceTransforms[o],c=a.position,h=s.position,l=u.position;n.blendVector3(c,h,r,l);var f=a.rotation,d=s.rotation,p=u.rotation;n.blendQuaternion(f,d,r,p);var m=a.scale,v=s.scale,y=u.scale;n.blendVector3(m,v,r,y);var g=a.euler,x=s.euler,T=u.euler;n.blendEuler(g,x,r,T)}for(var _=0;_<t.floatPropertyValues.length;_++){var E=t.floatPropertyValues[_],b=e.floatPropertyValues[_];i.floatPropertyValues[_]=n.blendFloat(E,b,r)}for(var A=0;A<t.colorPropertyValues.length;A++){var S=t.colorPropertyValues[A],R=e.colorPropertyValues[A],C=i.colorPropertyValues[A];n.blendColor(S,R,r,C)}},t}();no.normalBlendFunction=new ro,no.additiveBlendFunction=new io;var oo=function(){function t(t){this.position=new Dr,this.rotation=new $n,this.scale=new Dr,this.euler=new Dr,t&&(this.position.copyFrom(t.position),this.rotation.copyFrom(t.quat),this.scale.copyFrom(t.scale),this.euler.copyFrom(t.rotation))}return t.prototype.copyFrom=function(t){return this.position.copyFrom(t.position),this.rotation.copyFrom(t.rotation),this.scale.copyFrom(t.scale),this.euler.copyFrom(t.euler),this},t}(),ao=function(){function t(t){this.skeleton=t,this.parentSpaceTransforms=[],this.floatPropertyValues=[],this.colorPropertyValues=[];for(var e,r=pr(t.parentSpaceTransforms);!(e=r()).done;){var i=e.value;this.parentSpaceTransforms.push((new oo).copyFrom(i))}for(var n,o=pr(t.defaultFloatPropertyValues);!(n=o()).done;){var a=n.value;this.floatPropertyValues.push(a)}for(var s,u=pr(t.defaultColorPropertyValues);!(s=u()).done;){var c=s.value;this.colorPropertyValues.push((new Br).copyFrom(c))}}var e=t.prototype;return e.setPosition=function(t,e){var r=this.skeleton.pathToBoneIndex.get(t);void 0!==r&&this.parentSpaceTransforms[r].position.copyFrom(e)},e.setRotation=function(t,e){var r=this.skeleton.pathToBoneIndex.get(t);void 0!==r&&this.parentSpaceTransforms[r].rotation.copyFrom(e)},e.setEuler=function(t,e){var r=this.skeleton.pathToBoneIndex.get(t);void 0!==r&&this.parentSpaceTransforms[r].euler.copyFrom(e)},e.setScale=function(t,e){var r=this.skeleton.pathToBoneIndex.get(t);void 0!==r&&this.parentSpaceTransforms[r].scale.copyFrom(e)},e.setFloat=function(t,e){var r=this.skeleton.pathToObjectIndex.get(t);void 0!==r&&(this.floatPropertyValues[r]=e)},e.copyFrom=function(t){for(var e=0;e<this.parentSpaceTransforms.length;e++)this.parentSpaceTransforms[e].copyFrom(t.parentSpaceTransforms[e]);for(var r=0;r<this.colorPropertyValues.length;r++)this.colorPropertyValues[r].copyFrom(t.colorPropertyValues[r]);for(var i=0;i<this.floatPropertyValues.length;i++)this.floatPropertyValues[i]=t.floatPropertyValues[i]},t}(),so=function(t){this.pose=new ao(t)};exports.ApplyAdditiveNodeData=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.instantiate=function(t){var e=this.createNode(uo,t);e.baseNode=t.getNode(this.baseNodeIndex),e.additiveNode=t.getNode(this.additiveNodeIndex),e.inputParameterValueNode=t.getNode(this.inputParameterValueNodeIndex)},r.load=function(e){t.prototype.load.call(this,e),this.baseNodeIndex=e.baseNodeIndex,this.additiveNodeIndex=e.additiveNodeIndex,this.inputParameterValueNodeIndex=e.inputParameterValueNodeIndex},e}(Gn),exports.ApplyAdditiveNodeData=yr([Vn(vn.ApplyAdditiveNodeData)],exports.ApplyAdditiveNodeData);var uo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).baseNode=null,e.additiveNode=null,e.inputParameterValueNode=null,e}ji(e,t);var r=e.prototype;return r.initializeInternal=function(e){var r,i,n;t.prototype.initializeInternal.call(this,e),this.baseNodeResult=new so(e.skeleton),this.additiveNodeResult=new so(e.skeleton),null==(r=this.baseNode)||r.initialize(e),null==(i=this.additiveNode)||i.initialize(e),null==(n=this.inputParameterValueNode)||n.initialize(e)},r.shutdownInternal=function(e){var r,i,n;null==(r=this.baseNode)||r.shutdown(e),null==(i=this.additiveNode)||i.shutdown(e),null==(n=this.inputParameterValueNode)||n.shutdown(e),t.prototype.shutdownInternal.call(this,e)},r.evaluate=function(t,e){if(!this.inputParameterValueNode)return e;this.markNodeActive(t);var r=this.inputParameterValueNode.getValue(t);return this.baseNode&&!this.additiveNode?(this.baseNode.evaluate(t,this.baseNodeResult),this.applyAdditive(this.baseNodeResult.pose,this.additiveNodeResult.pose,r,e.pose)):this.baseNode&&this.additiveNode&&(this.baseNode.evaluate(t,this.baseNodeResult),this.additiveNode.evaluate(t,this.additiveNodeResult),this.applyAdditive(this.baseNodeResult.pose,this.additiveNodeResult.pose,r,e.pose)),e},r.applyAdditive=function(t,e,r,i){no.additiveBlend(t,e,r,i)},e}(Xn);exports.BlendNodeData=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.instantiate=function(t){var e=this.createNode(co,t);e.source0=t.getNode(this.sourceNodeIndex0),e.source1=t.getNode(this.sourceNodeIndex1),e.inputParameterValueNode=t.getNode(this.inputParameterValueNodeIndex)},r.load=function(e){t.prototype.load.call(this,e),this.sourceNodeIndex0=e.sourceNodeIndex0,this.sourceNodeIndex1=e.sourceNodeIndex1,this.inputParameterValueNodeIndex=e.inputParameterValueNodeIndex},e}(Gn),exports.BlendNodeData=yr([Vn(vn.BlendNodeData)],exports.BlendNodeData);var co=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).source0=null,e.source1=null,e.inputParameterValueNode=null,e}ji(e,t);var r=e.prototype;return r.initializeInternal=function(e){var r,i,n;t.prototype.initializeInternal.call(this,e),this.source0Result=new so(e.skeleton),this.source1Result=new so(e.skeleton),null==(r=this.source0)||r.initialize(e),null==(i=this.source1)||i.initialize(e),null==(n=this.inputParameterValueNode)||n.initialize(e)},r.shutdownInternal=function(e){var r,i,n;null==(r=this.source0)||r.shutdown(e),null==(i=this.source1)||i.shutdown(e),null==(n=this.inputParameterValueNode)||n.shutdown(e),t.prototype.shutdownInternal.call(this,e)},r.evaluate=function(t,e){if(!this.inputParameterValueNode)return e;this.markNodeActive(t);var r=this.inputParameterValueNode.getValue(t);return this.source0&&!this.source1?(this.source0.evaluate(t,this.source0Result),this.localBlend(this.source0Result.pose,this.source1Result.pose,r,e.pose)):this.source0&&this.source1&&(this.source0.evaluate(t,this.source0Result),this.source1.evaluate(t,this.source1Result),this.localBlend(this.source0Result.pose,this.source1Result.pose,r,e.pose)),e},r.localBlend=function(t,e,r,i){no.localBlend(t,e,r,i)},e}(Xn);exports.AndNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).conditionNodeIndices=[],e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){for(var e,r=this.createNode(ho,t),i=pr(this.conditionNodeIndices);!(e=i()).done;){var n=e.value;r.conditionNodes.push(t.getNode(n))}},r.load=function(e){t.prototype.load.call(this,e),this.conditionNodeIndices=e.conditionNodeIndices},e}(Gn),exports.AndNodeData=yr([Vn(vn.AndNodeData)],exports.AndNodeData);var ho=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).conditionNodes=[],e.result=!1,e}ji(e,t);var r=e.prototype;return r.getValue=function(t){if(!this.isUpdated(t)){this.markNodeActive(t),this.result=!0;for(var e,r=pr(this.conditionNodes);!(e=r()).done;)if(!e.value.getValue(t)){this.result=!1;break}}return this.result},r.initializeInternal=function(e){t.prototype.initializeInternal.call(this,e);for(var r,i=pr(this.conditionNodes);!(r=i()).done;)r.value.initialize(e);this.result=!1},r.shutdownInternal=function(e){for(var r,i=pr(this.conditionNodes);!(r=i()).done;)r.value.shutdown(e);t.prototype.shutdownInternal.call(this,e)},e}(Wn);exports.OrNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).conditionNodeIndices=[],e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){for(var e,r=this.createNode(lo,t),i=pr(this.conditionNodeIndices);!(e=i()).done;){var n=e.value;r.conditionNodes.push(t.getNode(n))}},r.load=function(e){t.prototype.load.call(this,e),this.conditionNodeIndices=e.conditionNodeIndices},e}(Gn),exports.OrNodeData=yr([Vn(vn.OrNodeData)],exports.OrNodeData);var lo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).conditionNodes=[],e.result=!1,e}ji(e,t);var r=e.prototype;return r.getValue=function(t){if(!this.isUpdated(t)){this.markNodeActive(t),this.result=!1;for(var e,r=pr(this.conditionNodes);!(e=r()).done;)if(e.value.getValue(t)){this.result=!0;break}}return this.result},r.initializeInternal=function(e){t.prototype.initializeInternal.call(this,e);for(var r,i=pr(this.conditionNodes);!(r=i()).done;)r.value.initialize(e);this.result=!1},r.shutdownInternal=function(e){for(var r,i=pr(this.conditionNodes);!(r=i()).done;)r.value.shutdown(e);t.prototype.shutdownInternal.call(this,e)},e}(Wn);exports.NotNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).inputValueNodeIndex=kn,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){this.createNode(fo,t).inputValueNode=t.getNode(this.inputValueNodeIndex)},r.load=function(e){t.prototype.load.call(this,e),this.inputValueNodeIndex=e.inputValueNodeIndex},e}(Gn),exports.NotNodeData=yr([Vn(vn.NotNodeData)],exports.NotNodeData);var fo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).inputValueNode=null,e.result=!1,e}ji(e,t);var r=e.prototype;return r.getValue=function(t){return this.isUpdated(t)||(this.markNodeActive(t),this.inputValueNode&&(this.result=!this.inputValueNode.getValue(t))),this.result},r.initializeInternal=function(e){var r;t.prototype.initializeInternal.call(this,e),null==(r=this.inputValueNode)||r.initialize(e),this.result=!1},r.shutdownInternal=function(e){var r;null==(r=this.inputValueNode)||r.shutdown(e),t.prototype.shutdownInternal.call(this,e)},e}(Wn);exports.ConstFloatNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=0,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){this.createNode(po,t).value=this.value},r.load=function(e){t.prototype.load.call(this,e),this.value=e.value},e}(Gn),exports.ConstFloatNodeData=yr([Vn(vn.ConstFloatNodeData)],exports.ConstFloatNodeData);var po=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=0,e}return ji(e,t),e.prototype.getValue=function(t){return this.isUpdated(t)||this.markNodeActive(t),this.value},e}(jn);exports.ConstBoolNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=!0,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){this.createNode(mo,t).value=this.value},r.load=function(e){t.prototype.load.call(this,e),this.value=e.value},e}(Gn),exports.ConstBoolNodeData=yr([Vn(vn.ConstBoolNodeData)],exports.ConstBoolNodeData);var mo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=!0,e}return ji(e,t),e.prototype.getValue=function(t){return this.isUpdated(t)||this.markNodeActive(t),this.value},e}(Wn);exports.ControlParameterFloatNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=0,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){this.createNode(vo,t).setValue(this.value)},r.load=function(e){t.prototype.load.call(this,e),this.value=e.value},e}(Gn),exports.ControlParameterFloatNodeData=yr([Vn(vn.ControlParameterFloatNodeData)],exports.ControlParameterFloatNodeData);var vo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=0,e}ji(e,t);var r=e.prototype;return r.getValue=function(t){return this.isUpdated(t)||this.markNodeActive(t),this.value},r.setValue=function(t){this.value=t},e}(jn);exports.ControlParameterBoolNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=!1,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){this.createNode(yo,t).setValue(this.value)},r.load=function(e){t.prototype.load.call(this,e),this.value=e.value},e}(Gn),exports.ControlParameterBoolNodeData=yr([Vn(vn.ControlParameterBoolNodeData)],exports.ControlParameterBoolNodeData);var yo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=!1,e}ji(e,t);var r=e.prototype;return r.getValue=function(t){return this.isUpdated(t)||this.markNodeActive(t),this.value},r.setValue=function(t){this.value=t},e}(Wn);exports.ControlParameterTriggerNodeData=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.instantiate=function(t){this.createNode(go,t)},r.load=function(e){t.prototype.load.call(this,e)},e}(Gn),exports.ControlParameterTriggerNodeData=yr([Vn(vn.ControlParameterTriggerNodeData)],exports.ControlParameterTriggerNodeData);var go=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=!1,e}ji(e,t);var r=e.prototype;return r.getValue=function(t){return this.isUpdated(t)||this.markNodeActive(t),this.value},r.setValue=function(t){this.value=t},e}(Wn);exports.LayerBlendNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).baseNodeIndex=kn,e.layerDatas=[],e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){var e=this.createNode(xo,t);e.baseLayerNode=t.getNode(this.baseNodeIndex);for(var r,i=pr(this.layerDatas);!(r=i()).done;){var n=r.value;e.layers.push({inputNode:t.getNode(n.inputNodeIndex),weightValueNode:t.getNode(n.weightValueNodeIndex),weight:0})}},r.load=function(e){var r;if(t.prototype.load.call(this,e),this.baseNodeIndex=null!=(r=e.baseNodeIndex)?r:kn,e.layerDatas)for(var i,n=pr(e.layerDatas);!(i=n()).done;){var o=i.value;this.layerDatas.push(qn({inputNodeIndex:kn,weightValueNodeIndex:kn},o))}},e}(Gn),exports.LayerBlendNodeData=yr([Vn(vn.LayerBlendNodeData)],exports.LayerBlendNodeData);var xo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).baseLayerNode=null,e.layers=[],e}ji(e,t);var r=e.prototype;return r.initializeInternal=function(e){var r;t.prototype.initializeInternal.call(this,e),this.layerNodeResult=new so(e.skeleton),null==(r=this.baseLayerNode)||r.initialize(e);for(var i,n=pr(this.layers);!(i=n()).done;){var o,a,s=i.value;null==(o=s.inputNode)||o.initialize(e),null==(a=s.weightValueNode)||a.initialize(e)}},r.shutdownInternal=function(e){var r;null==(r=this.baseLayerNode)||r.shutdown(e);for(var i,n=pr(this.layers);!(i=n()).done;){var o,a,s=i.value;null==(o=s.inputNode)||o.shutdown(e),null==(a=s.weightValueNode)||a.shutdown(e)}t.prototype.shutdownInternal.call(this,e)},r.evaluate=function(t,e){return this.baseLayerNode&&this.baseLayerNode.isValid()?(this.markNodeActive(t),this.previousTime=this.baseLayerNode.getCurrentTime(),e=this.baseLayerNode.evaluate(t,e),this.currentTime=this.baseLayerNode.getCurrentTime(),this.duration=this.baseLayerNode.getDuration(),this.updateLayers(t,e),e):e},r.updateLayers=function(t,e){for(var r,i=pr(this.layers);!(r=i()).done;){var n=r.value;if(n.inputNode&&n.weightValueNode){this.layerNodeResult.pose.copyFrom(e.pose),n.inputNode.evaluate(t,this.layerNodeResult);var o=n.weightValueNode.getValue(t);no.localBlend(e.pose,this.layerNodeResult.pose,o,e.pose)}}return e},e}(Xn);exports.EqualNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).inputValueNodeIndex=kn,e.comparandValueNodeIndex=kn,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){var e=this.createNode(_o,t);e.inputValueNode=t.getNode(this.inputValueNodeIndex),e.comparandValueNode=t.getNode(this.comparandValueNodeIndex)},r.load=function(e){t.prototype.load.call(this,e),this.inputValueNodeIndex=e.inputValueNodeIndex,this.comparandValueNodeIndex=e.comparandValueNodeIndex},e}(Gn),exports.EqualNodeData=yr([Vn(vn.EqualNodeData)],exports.EqualNodeData);var To,_o=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).inputValueNode=null,e.comparandValueNode=null,e.result=!1,e}ji(e,t);var r=e.prototype;return r.initializeInternal=function(e){t.prototype.initializeInternal.call(this,e),this.inputValueNode&&this.inputValueNode.initialize(e),this.comparandValueNode&&this.comparandValueNode.initialize(e)},r.shutdownInternal=function(e){this.inputValueNode&&this.inputValueNode.shutdown(e),this.comparandValueNode&&this.comparandValueNode.shutdown(e),t.prototype.shutdownInternal.call(this,e)},r.getValue=function(t){if(!this.isUpdated(t)&&(this.markNodeActive(t),this.inputValueNode&&this.comparandValueNode)){var e=this.inputValueNode.getValue(t),r=this.comparandValueNode.getValue(t);this.result=e===r}return this.result},e}(Wn),Eo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).inputValueNodeIndex=kn,e.comparandValueNodeIndex=kn,e}return ji(e,t),e.prototype.load=function(e){t.prototype.load.call(this,e),this.inputValueNodeIndex=e.inputValueNodeIndex,this.comparandValueNodeIndex=e.comparandValueNodeIndex},e}(Gn);!function(t){t[t.GreaterThan=0]="GreaterThan",t[t.LessThan=1]="LessThan"}(To||(To={}));var bo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).inputValueNode=null,e.comparandValueNode=null,e.comparison=0,e.result=!1,e}ji(e,t);var r=e.prototype;return r.initializeInternal=function(e){t.prototype.initializeInternal.call(this,e),this.inputValueNode&&this.inputValueNode.initialize(e),this.comparandValueNode&&this.comparandValueNode.initialize(e)},r.shutdownInternal=function(e){this.inputValueNode&&this.inputValueNode.shutdown(e),this.comparandValueNode&&this.comparandValueNode.shutdown(e),t.prototype.shutdownInternal.call(this,e)},r.getValue=function(t){if(!this.isUpdated(t)&&(this.markNodeActive(t),this.inputValueNode&&this.comparandValueNode)){var e=this.inputValueNode.getValue(t),r=this.comparandValueNode.getValue(t);switch(this.comparison){case 0:this.result=e>r;break;case 1:this.result=e<r}}return this.result},e}(Wn);exports.GreaterNodeData=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.instantiate=function(t){var e=this.createNode(bo,t);e.comparison=0,e.inputValueNode=t.getNode(this.inputValueNodeIndex),e.comparandValueNode=t.getNode(this.comparandValueNodeIndex)},e}(Eo),exports.GreaterNodeData=yr([Vn(vn.GreaterNodeData)],exports.GreaterNodeData),exports.LessNodeData=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.instantiate=function(t){var e=this.createNode(bo,t);e.comparison=1,e.inputValueNode=t.getNode(this.inputValueNodeIndex),e.comparandValueNode=t.getNode(this.comparandValueNodeIndex)},e}(Eo),exports.LessNodeData=yr([Vn(vn.LessNodeData)],exports.LessNodeData),exports.StateMachineNodeData=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.instantiate=function(t){for(var e,r=this.createNode(Ao,t),i=pr(this.stateDatas);!(e=i()).done;){var n=e.value,o={stateNode:t.getNode(n.stateNodeIndex),transitions:[]};r.states.push(o);for(var a,s=pr(n.transitionDatas);!(a=s()).done;){var u=a.value,c={transitionNode:t.getNode(u.transitionNodeIndex),conditionNode:t.getNode(u.conditionNodeIndex),targetStateIndex:u.targetStateIndex};o.transitions.push(c)}}},r.load=function(e){t.prototype.load.call(this,e),this.stateDatas=e.stateDatas,this.defaultStateIndex=e.defaultStateIndex,this.machineName=e.machineName},e}(Gn),exports.StateMachineNodeData=yr([Vn(vn.StateMachineNodeData)],exports.StateMachineNodeData),exports.TransitionState=void 0;var Ao=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).states=[],e.activeTransition=null,e.activeStateIndex=kn,e}ji(e,t);var r=e.prototype;return r.getCurrentStateName=function(){return this.states[this.activeStateIndex].stateNode.getNodeData().stateName},r.evaluate=function(t,e){if(this.markNodeActive(t),null!==this.activeTransition&&this.activeTransition.isComplete(t)&&(this.activeTransition.shutdown(t),this.activeTransition=null),null===this.activeTransition){var r=this.states[this.activeStateIndex].stateNode;e=r.evaluate(t,e),this.duration=r.getDuration(),this.previousTime=r.getPreviousTime(),this.currentTime=r.getCurrentTime()}else e=this.activeTransition.evaluate(t,e),this.duration=this.activeTransition.getDuration(),this.previousTime=this.activeTransition.getPreviousTime(),this.currentTime=this.activeTransition.getCurrentTime();return t.branchState===Un.Active&&this.evaluateTransitions(t,e),e},r.evaluateTransitions=function(t,e){for(var r=this.states[this.activeStateIndex],i=kn,n=r.transitions.length,o=0;o<n;o++){var a=r.transitions[o];if(a.targetStateIndex===kn)throw new Error("Invalid target state index.");if(!this.states[a.targetStateIndex].stateNode.isTransitioning()){var s=!1;if(a.transitionNode.hasExitTime){var u=r.stateNode;u.getElapsedTimeInState()/u.getDuration()>a.transitionNode.exitTime&&(s=!0)}else null!==a.conditionNode&&a.conditionNode.getValue(t)&&(s=!0);if(s){i=o;break}}}if(i!==kn){var c=r.transitions[i];c.transitionNode.initialize(t),e=null!==this.activeTransition?c.transitionNode.startTransitionFromTransition(t,e,this.activeTransition,e):c.transitionNode.startTransitionFromState(t,e,this.states[this.activeStateIndex].stateNode,e),this.activeTransition=c.transitionNode,this.shutdownTransitionConditions(t),this.activeStateIndex=c.targetStateIndex,this.initializeTransitionConditions(t),this.duration=this.states[this.activeStateIndex].stateNode.getDuration(),this.previousTime=this.states[this.activeStateIndex].stateNode.getPreviousTime(),this.currentTime=this.states[this.activeStateIndex].stateNode.getCurrentTime()}},r.selectDefaultState=function(t){return this.getNodeData().defaultStateIndex},r.initializeInternal=function(e){t.prototype.initializeInternal.call(this,e),this.activeStateIndex=this.selectDefaultState(e);var r=this.states[this.activeStateIndex].stateNode;r.initialize(e),this.duration=r.getDuration(),this.previousTime=r.getPreviousTime(),this.currentTime=r.getCurrentTime(),this.initializeTransitionConditions(e)},r.shutdownInternal=function(e){null!==this.activeTransition&&this.activeTransition.shutdown(e),this.shutdownTransitionConditions(e),this.states[this.activeStateIndex].stateNode.shutdown(e),this.activeStateIndex=kn,this.activeTransition=null,t.prototype.shutdownInternal.call(this,e)},r.initializeTransitionConditions=function(t){for(var e,r=pr(this.states[this.activeStateIndex].transitions);!(e=r()).done;){var i=e.value;null!==i.conditionNode&&i.conditionNode.initialize(t)}},r.shutdownTransitionConditions=function(t){for(var e,r=pr(this.states[this.activeStateIndex].transitions);!(e=r()).done;){var i=e.value;null!==i.conditionNode&&i.conditionNode.shutdown(t)}},e}(Xn);!function(t){t[t.None=0]="None",t[t.TransitioningIn=1]="TransitioningIn",t[t.TransitioningOut=2]="TransitioningOut"}(exports.TransitionState||(exports.TransitionState={})),exports.StateNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).childNodeIndex=kn,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){this.createNode(So,t).childNode=t.getNode(this.childNodeIndex)},r.load=function(e){t.prototype.load.call(this,e),this.childNodeIndex=e.childNodeIndex,this.stateName=e.stateName},e}(Gn),exports.StateNodeData=yr([Vn(vn.StateNodeData)],exports.StateNodeData),exports.SourceType=void 0;var So=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).childNode=null,e.transitionState=0,e.elapsedTimeInState=0,e.isFirstStateUpdate=!1,e}ji(e,t);var r=e.prototype;return r.isTransitioning=function(){return 0!==this.transitionState},r.isTransitioningIn=function(){return 1===this.transitionState},r.isTransitioningOut=function(){return 2===this.transitionState},r.startTransitionIn=function(t){this.transitionState=1},r.startTransitionOut=function(t){this.transitionState=2},r.setTransitioningState=function(t){this.transitionState=t},r.getElapsedTimeInState=function(){return this.elapsedTimeInState},r.evaluate=function(t,e){return this.markNodeActive(t),null!==this.childNode&&this.childNode.isValid()&&(e=this.childNode.evaluate(t,e),this.duration=this.childNode.getDuration(),this.previousTime=this.childNode.getPreviousTime(),this.currentTime=this.childNode.getCurrentTime()),this.elapsedTimeInState+=t.deltaTime,this.isFirstStateUpdate=!1,e},r.initializeInternal=function(e){t.prototype.initializeInternal.call(this,e),this.transitionState=0,this.elapsedTimeInState=0,this.previousTime=this.currentTime=0,this.duration=0,null!==this.childNode&&(this.childNode.initialize(e),this.childNode.isValid()&&(this.duration=this.childNode.getDuration(),this.previousTime=this.childNode.getPreviousTime(),this.currentTime=this.childNode.getCurrentTime())),this.isFirstStateUpdate=!0},r.shutdownInternal=function(e){null!==this.childNode&&this.childNode.shutdown(e),this.transitionState=0,t.prototype.shutdownInternal.call(this,e)},e}(Xn);!function(t){t[t.State=0]="State",t[t.Transition=1]="Transition",t[t.CachedPose=2]="CachedPose"}(exports.SourceType||(exports.SourceType={})),exports.TransitionNodeData=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).duration=0,e.hasExitTime=!1,e.exitTime=.75,e.targetStateNodeIndex=kn,e}ji(e,t);var r=e.prototype;return r.instantiate=function(t){var e=this.createNode(Co,t);e.targetNode=t.getNode(this.targetStateNodeIndex),e.hasExitTime=this.hasExitTime,e.exitTime=this.exitTime},r.load=function(e){t.prototype.load.call(this,e),this.duration=e.duration,this.hasExitTime=e.hasExitTime,this.exitTime=e.exitTime,this.targetStateNodeIndex=e.targetStateNodeIndex},e}(Gn),exports.TransitionNodeData=yr([Vn(vn.TransitionNodeData)],exports.TransitionNodeData);var Ro,Co=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).hasExitTime=!1,e.exitTime=.75,e.transitionLength=0,e.transitionProgress=0,e.blendWeight=0,e.sourceNode=null,e.sourceType=0,e.blendedDuration=0,e}ji(e,t);var r=e.prototype;return r.evaluate=function(t,e){oi(this.sourceNode),this.markNodeActive(t),this.isSourceATransition()&&this.getSourceTransitionNode().isComplete(t)&&this.endSourceTransition(t),this.transitionProgress=this.transitionProgress+t.deltaTime/this.transitionLength,this.transitionProgress=Lr(this.transitionProgress,0,1),this.calculateBlendWeight();var r=this.sourceNodeResult,i=t.branchState;t.branchState=Un.Inactive,r=this.sourceNode.evaluate(t,r),t.branchState=i;var n=this.targetNode.evaluate(t,this.targetNodeResult),o=e;if(this.registerPoseTasksAndUpdateRootMotion(r,n,o),this.blendedDuration=Nr(this.sourceNode.getDuration(),this.targetNode.getDuration(),this.blendWeight),this.blendedDuration>0){var a=t.deltaTime/this.blendedDuration;this.previousTime=this.currentTime,this.currentTime=(this.currentTime+a)%1}else this.previousTime=this.currentTime=1;return this.duration=this.targetNode.getDuration(),o},r.isComplete=function(t){return this.transitionLength<=0||this.transitionProgress+t.deltaTime/this.transitionLength>=1},r.getProgressPercentage=function(){return this.transitionProgress},r.getSourceType=function(){return this.sourceType},r.isSourceATransition=function(){return 1===this.sourceType},r.isSourceAState=function(){return 0===this.sourceType},r.startTransitionFromState=function(t,e,r,i){return this.sourceNode=r,this.sourceType=0,this.initializeTargetStateAndUpdateTransition(t,e,i)},r.startTransitionFromTransition=function(t,e,r,i){return this.sourceNode=r,this.sourceType=1,this.initializeTargetStateAndUpdateTransition(t,e,i)},r.getSourceStateNode=function(){return this.sourceNode},r.getSourceTransitionNode=function(){return this.sourceNode},r.notifyNewTransitionStarting=function(t,e){if(this.isSourceATransition()){var r=this.getSourceTransitionNode().targetNode;r===e&&(this.sourceType=2,r.shutdown(t),this.sourceNode=null)}else this.isSourceAState()&&this.sourceNode===e&&(this.sourceType=2,this.sourceNode.shutdown(t),this.sourceNode=null);this.isSourceATransition()&&this.getSourceTransitionNode().notifyNewTransitionStarting(t,e)},r.initializeInternal=function(e){t.prototype.initializeInternal.call(this,e),this.sourceNodeResult=new so(e.skeleton),this.targetNodeResult=new so(e.skeleton),this.transitionLength=this.getNodeData().duration,this.transitionProgress=0,this.blendWeight=0},r.shutdownInternal=function(e){this.targetNode.setTransitioningState(exports.TransitionState.None),this.currentTime=1,this.sourceNode&&(this.isSourceATransition()&&this.endSourceTransition(e),this.sourceNode.shutdown(e),this.sourceNode=null),t.prototype.shutdownInternal.call(this,e)},r.endSourceTransition=function(t){var e,r=this.getSourceTransitionNode().targetNode;null==(e=this.sourceNode)||e.shutdown(t),this.sourceNode=r,this.sourceType=0,this.getSourceStateNode().setTransitioningState(exports.TransitionState.TransitioningOut)},r.initializeTargetStateAndUpdateTransition=function(t,e,r){this.markNodeActive(t);var i=this.targetNodeResult;return 0===this.sourceType&&this.getSourceStateNode().startTransitionOut(t),this.targetNode.initialize(t),this.targetNode.startTransitionIn(t),i=this.targetNode.evaluate(t,i),this.calculateBlendWeight(),this.registerPoseTasksAndUpdateRootMotion(e,i,r),this.previousTime=0,this.currentTime=0,this.blendedDuration=Nr(this.sourceNode.getDuration(),this.targetNode.getDuration(),this.blendWeight),this.duration=this.targetNode.getDuration(),r},r.calculateBlendWeight=function(){0===this.transitionLength?this.blendWeight=1:(this.blendWeight=this.transitionProgress,this.blendWeight=Lr(this.blendWeight,0,1))},r.registerPoseTasksAndUpdateRootMotion=function(t,e,r){var i=this.blendWeight;no.localBlend(t.pose,e.pose,i,r.pose)},e}(Xn);!function(t){t[t.Float=0]="Float",t[t.Color=1]="Color"}(Ro||(Ro={}));var Mo=function(){function t(t,e){this.rootBone=t,this.useEuler=!1,this.pathToObjectIndex=new Map,this.floatAnimatedObjects=[],this.defaultFloatPropertyValues=[],this.colorAnimatedObjects=[],this.defaultColorPropertyValues=[],this.animatedTransforms=[],this.parentSpaceTransforms=[],this.pathToBoneIndex=new Map;for(var r,i=pr(e.position);!(r=i()).done;){var n=r.value;this.addReferenceTransform(n)}for(var o,a=pr(e.rotation);!(o=a()).done;){var s=o.value;this.addReferenceTransform(s)}for(var u,c=pr(e.scale);!(u=c()).done;){var h=u.value;this.addReferenceTransform(h)}for(var l,f=pr(e.euler);!(l=f()).done;){var d=l.value;this.addReferenceTransform(d),this.useEuler=!0}for(var p=0;p<e.floats.length;p++){var m=e.floats[p];this.addRecordedProperty(m.path,m.className,m.property,0)}for(var v=0;v<e.colors.length;v++){var y=e.colors[v];this.addRecordedProperty(y.path,y.className,y.property,1)}}var e=t.prototype;return e.addReferenceTransform=function(t){if(!this.pathToBoneIndex.get(t)){var e=this.findTarget(t);e&&(this.parentSpaceTransforms.push(new oo(e.transform)),this.animatedTransforms.push(e.transform),this.pathToBoneIndex.set(t,this.parentSpaceTransforms.length-1))}},e.addRecordedProperty=function(t,e,r,i){var n=t+e+r;if(void 0===this.pathToObjectIndex.get(n)){var o=this.findTarget(t);if(o){var a;(a="VFXItem"===e?o:o.getComponent(Pn(e)))||console.error("The "+e+" Component was not found.");for(var s=r.split("."),u=s[s.length-1],c=a,h=0;h<s.length-1;h++){var l=c[s[h]];void 0===l&&console.error("The "+s[h]+" property of "+c+" was not found."),c=l}var f={target:a,propertyPath:r,directTarget:c,propertyName:u};switch(i){case 0:this.floatAnimatedObjects.push(f),this.defaultFloatPropertyValues.push(c[u]),this.pathToObjectIndex.set(n,this.floatAnimatedObjects.length-1);break;case 1:this.colorAnimatedObjects.push(f),this.defaultColorPropertyValues.push((new Br).copyFrom(c[u])),this.pathToObjectIndex.set(n,this.colorAnimatedObjects.length-1)}}}},e.findTarget=function(t){if(""===t)return this.rootBone;for(var e,r=t.split("/"),i=this.rootBone,n=pr(r);!(e=n()).done;){var o=e.value,a=i.find(o);if(!a)return null;i=a}return i},t}(),Oo=function(){function t(t,e){this.graphAsset=t,this.nodes=[],this.context=new Yn;for(var r,i={position:[],scale:[],rotation:[],euler:[],floats:[],colors:[]},n=pr(t.graphDataSet.resources);!(r=n()).done;){var o=r.value;if(o){for(var a,s=pr(o.positionCurves);!(a=s()).done;){var u=a.value;i.position.push(u.path)}for(var c,h=pr(o.rotationCurves);!(c=h()).done;){var l=c.value;i.rotation.push(l.path)}for(var f,d=pr(o.scaleCurves);!(f=d()).done;){var p=f.value;i.scale.push(p.path)}for(var m,v=pr(o.eulerCurves);!(m=v()).done;){var y=m.value;i.euler.push(y.path)}for(var g,x=pr(o.floatCurves);!(g=x()).done;){var T=g.value;i.floats.push(T)}for(var _,E=pr(o.colorCurves);!(_=E()).done;){var b=_.value;i.colors.push(b)}}}this.skeleton=new Mo(e,i),this.result=new so(this.skeleton),this.context.skeleton=this.skeleton;var A=new Zn;A.nodes=this.nodes,A.nodeDatas=t.nodeDatas,A.dataSet=t.graphDataSet;for(var S=0;S<t.nodeDatas.length;S++)A.nodes[S]||t.nodeDatas[S].instantiate(A);this.rootNode=this.nodes[t.rootNodeIndex]}var e=t.prototype;return e.evaluateGraph=function(t){this.context.update(t),this.rootNode.isInitialized()||this.resetGraphState(),this.rootNode&&(this.result=this.rootNode.evaluate(this.context,this.result));for(var e=0;e<this.getNumControlParameters();e++){var r=this.nodes[e];mr(r,go)&&r.setValue(!1)}return this.result},e.isInitialized=function(){return this.rootNode&&this.rootNode.isInitialized()},e.isNodeActive=function(t){return this.isControlParameter(t)||this.nodes[t].isNodeActive(this.context.updateID)},e.getStateMachineNode=function(t){for(var e,r=null,i=pr(this.nodes);!(e=i()).done;){var n=e.value;mr(n,Ao)&&n.getNodeData().machineName===t&&(r=n)}return r},e.resetGraphState=function(){this.rootNode.isInitialized()&&this.rootNode.shutdown(this.context),this.context.updateID++,this.rootNode.initialize(this.context)},e.getNumControlParameters=function(){return this.graphAsset.controlParameterIDs.length},e.getControlParameterIndex=function(t){var e=this.graphAsset.parameterLookupMap.get(t);return void 0!==e?e:(console.warn("Parameter '"+t+"' does not exist."),kn)},e.getControlParameterID=function(t){return this.graphAsset.controlParameterIDs[t]},e.setBool=function(t,e){this.setControlParameterValue(t,e)},e.setFloat=function(t,e){this.setControlParameterValue(t,e)},e.setTrigger=function(t){this.setControlParameterValue(t,!0)},e.resetTrigger=function(t){this.setControlParameterValue(t,!1)},e.getPoseNodeDebugInfo=function(t){return this.nodes[t].getDebugInfo()},e.getRuntimeNodeDebugValue=function(t){return this.nodes[t].getValue(this.context)},e.getNodeDebugInstance=function(t){return this.nodes[t]},e.isControlParameter=function(t){return t<this.getNumControlParameters()},e.setControlParameterValue=function(t,e){var r=this.getControlParameterIndex(t);r!==kn&&this.nodes[r].setValue(e)},t}();function Po(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Io(t,e,r){return e&&Po(t.prototype,e),r&&Po(t,r),t}var wo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).isAwakeCalled=!1,e.isStartCalled=!1,e.isEnableCalled=!1,e._enabled=!0,e}ji(e,t);var r=e.prototype;return r.onAwake=function(){},r.onEnable=function(){},r.onDisable=function(){},r.onStart=function(){},r.onUpdate=function(t){},r.onLateUpdate=function(t){},r.onDestroy=function(){},r.onApplyAnimationProperties=function(){},r.enable=function(){this.item.composition&&(this.item.composition.sceneTicking.addComponent(this),this.isEnableCalled=!0),this.onEnable()},r.disable=function(){this.onDisable(),this.item.composition&&(this.isEnableCalled=!1,this.item.composition.sceneTicking.removeComponent(this))},r.setVFXItem=function(t){this.item=t,t.isDuringPlay&&(this.isAwakeCalled||(this.onAwake(),this.isAwakeCalled=!0),t.isActive&&this.enabled&&(this.start(),this.enable()))},r.fromData=function(e){t.prototype.fromData.call(this,e)},r.dispose=function(){this.isEnableCalled&&this.disable(),this.isAwakeCalled&&(this.isAwakeCalled=!1,this.onDestroy()),this.item&&Rr(this.item.components,this),t.prototype.dispose.call(this)},r.start=function(){this.isStartCalled||(this.isStartCalled=!0,this.onStart())},Io(e,[{key:"transform",get:function(){return this.item.transform}},{key:"isActiveAndEnabled",get:function(){return this.item.isActive&&this.enabled}},{key:"enabled",get:function(){return this._enabled},set:function(t){this.enabled!==t&&(this._enabled=t,t?this.isActiveAndEnabled&&(this.enable(),this.isStartCalled||(this.onStart(),this.isStartCalled=!0)):this.isEnableCalled&&this.disable())}}]),e}(Ln);yr([wn()],wo.prototype,"item",void 0),yr([wn()],wo.prototype,"_enabled",void 0);var No=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.setVFXItem=function(e){t.prototype.setVFXItem.call(this,e)},r.dispose=function(){t.prototype.dispose.call(this)},e}(wo);exports.Animator=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).graphInstance=null,e.graphAsset=null,e}ji(e,t);var r=e.prototype;return r.setBool=function(t,e){this.graphInstance&&this.graphInstance.setBool(t,e)},r.setFloat=function(t,e){this.graphInstance&&this.graphInstance.setFloat(t,e)},r.setTrigger=function(t){this.graphInstance&&this.graphInstance.setTrigger(t)},r.resetTrigger=function(t){this.graphInstance&&this.graphInstance.resetTrigger(t)},r.getStateMachineNode=function(t){var e=null;return this.graphInstance&&(e=this.graphInstance.getStateMachineNode(t)),e},r.onStart=function(){this.graphAsset&&(this.graphInstance=new Oo(this.graphAsset,this.item))},r.onUpdate=function(t){if(this.graphInstance){for(var e=this.graphInstance.evaluateGraph(t/1e3),r=this.graphInstance.skeleton.animatedTransforms,i=0;i<r.length;i++){var n=e.pose.parentSpaceTransforms[i].position,o=e.pose.parentSpaceTransforms[i].rotation,a=e.pose.parentSpaceTransforms[i].scale,s=e.pose.parentSpaceTransforms[i].euler;r[i].setPosition(n.x,n.y,n.z),r[i].setScale(a.x,a.y,a.z),this.graphInstance.skeleton.useEuler?r[i].setRotation(s.x,s.y,s.z):r[i].setQuaternion(o.x,o.y,o.z,o.w)}for(var u=this.graphInstance.skeleton.floatAnimatedObjects,c=0;c<u.length;c++){var h=u[c],l=h.propertyName;h.directTarget[l]=e.pose.floatPropertyValues[c],mr(h.target,wo)&&h.target.onApplyAnimationProperties()}for(var f=this.graphInstance.skeleton.colorAnimatedObjects,d=0;d<f.length;d++){var p=f[d],m=p.propertyName;p.directTarget[m]=e.pose.colorPropertyValues[d],mr(p.target,wo)&&p.target.onApplyAnimationProperties()}}},r.fromData=function(t){this.graphAsset=this.engine.findObject(t.graphAsset)},e}(wo),exports.Animator=yr([In("Animator")],exports.Animator);var Lo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).materials=[],e._priority=0,e}ji(e,t);var r=e.prototype;return r.render=function(t){},r.onEnable=function(){var t;null==(t=this.item.composition)||t.renderFrame.addMeshToDefaultRenderPass(this)},r.onDisable=function(){var t;null==(t=this.item.composition)||t.renderFrame.removeMeshFromDefaultRenderPass(this)},Io(e,[{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"material",get:function(){return this.materials[0]},set:function(t){0===this.materials.length?this.materials.push(t):this.materials[0]=t}}]),e}(wo);yr([wn()],Lo.prototype,"materials",void 0),yr([wn()],Lo.prototype,"_priority",void 0);var Fo=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).meshCollider=new ec,e.getHitTestParams=function(t){var r=e.transform.getWorldMatrix();e.meshCollider.setGeometry(e.geometry,r);var i=e.meshCollider.getBoundingBoxData();if(i)return{type:i.type,triangles:i.area}},e}ji(e,t);var r=e.prototype;return r.render=function(t){for(var e=0;e<this.materials.length;e++){var r=this.materials[e];t.drawGeometry(this.geometry,this.transform.getWorldMatrix(),r,e)}},r.getBoundingBox=function(){var t=this.transform.getWorldMatrix();return this.meshCollider.setGeometry(this.geometry,t),this.meshCollider.getBoundingBox()},e}(Lo);yr([wn()],Fo.prototype,"geometry",void 0),exports.EffectComponent=function(t){function e(e){var r;return(r=t.call(this,e)||this).time=0,r.name="EffectComponent",r}ji(e,t);var r=e.prototype;return r.onStart=function(){this.item.getHitTestParams=this.getHitTestParams},r.onUpdate=function(t){var e,r=this.time,i=null!=(e=this.material.getVector4("_Time"))?e:new Vr;this.material.setVector4("_Time",i.set(r/20,r,2*r,3*r)),this.time+=t/1e3},r.fromData=function(e){t.prototype.fromData.call(this,e),this.material=this.materials[0]},e}(Fo),exports.EffectComponent=yr([In(xn.EffectComponent)],exports.EffectComponent),exports.PostProcessVolume=function(t){function e(e){var r;return(r=t.call(this,e)||this).bloom={threshold:0,intensity:0,active:!1},r.vignette={intensity:0,smoothness:0,roundness:0,active:!1},r.tonemapping={active:!1},r.colorAdjustments={brightness:0,saturation:0,contrast:0,active:!1},r}return ji(e,t),e.prototype.onStart=function(){var t=this.item.composition;t&&(t.renderFrame.globalVolume=this)},e}(wo),yr([wn()],exports.PostProcessVolume.prototype,"bloom",void 0),yr([wn()],exports.PostProcessVolume.prototype,"vignette",void 0),yr([wn()],exports.PostProcessVolume.prototype,"tonemapping",void 0),yr([wn()],exports.PostProcessVolume.prototype,"colorAdjustments",void 0),exports.PostProcessVolume=yr([In(xn.PostProcessVolume)],exports.PostProcessVolume);var Do=function(){function t(t,e,r,i,n,o,a,s,u,c,h,l,f,d,p,m){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=1),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),void 0===c&&(c=0),void 0===h&&(h=1),void 0===l&&(l=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=1),this.elements=[t,e,r,i,n,o,a,s,u,c,h,l,f,d,p,m]}var e=t.prototype;return e.set=function(t,e,r,i,n,o,a,s,u,c,h,l,f,d,p,m){var v=this.elements;return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=n,v[5]=o,v[6]=a,v[7]=s,v[8]=u,v[9]=c,v[10]=h,v[11]=l,v[12]=f,v[13]=d,v[14]=p,v[15]=m,this},e.setFromRowMajorData=function(t,e,r,i,n,o,a,s,u,c,h,l,f,d,p,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=r,v[12]=i,v[1]=n,v[5]=o,v[9]=a,v[13]=s,v[2]=u,v[6]=c,v[10]=h,v[14]=l,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this},e.setFromColumnVectors=function(t,e,r,i){return this.set(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,r.x,r.y,r.z,r.w,i.x,i.y,i.z,i.w)},e.setFromMatrix3=function(t){var e=t.elements;return this.set(e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1),this},e.setFromArray=function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[e+r];return this},e.setFromScale=function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)},e.setFromTranslation=function(t,e,r){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1)},e.setFromRotationX=function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,r,0,0,-r,e,0,0,0,0,1)},e.setFromRotationY=function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1)},e.setFromRotationZ=function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,r,0,0,-r,e,0,0,0,0,1,0,0,0,0,1)},e.setFromRotationAxis=function(e,r){var i=t.tempVec0;i.copyFrom(e).normalize();var n=Math.cos(r),o=Math.sin(r),a=1-n,s=i.x,u=i.y,c=i.z,h=a*s,l=a*u;return this.set(h*s+n,h*u+o*c,h*c-o*u,0,h*u-o*c,l*u+n,l*c+o*s,0,h*c+o*u,l*c-o*s,a*c*c+n,0,0,0,0,1)},e.setFromEuler=function(t){return t.toMatrix4(this),this},e.setFromQuaternion=function(t){return this.compose(Dr.ZERO,t,Dr.ONE)},e.setFromShear=function(t,e,r){return this.set(1,t,t,0,e,1,e,0,r,r,1,0,0,0,0,1)},e.setFromBasis=function(t,e,r){return this.set(t.x,t.y,t.z,0,e.x,e.y,e.z,0,r.x,r.y,r.z,0,0,0,0,1)},e.setZero=function(){for(var t=0;t<16;t++)this.elements[t]=0;return this},e.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},e.isIdentity=function(){var t=this.elements;return 1===t[0]&&0===t[4]&&0===t[8]&&0===t[12]&&0===t[1]&&1===t[5]&&0===t[9]&&0===t[13]&&0===t[2]&&0===t[6]&&1===t[10]&&0===t[14]&&0===t[3]&&0===t[7]&&0===t[11]&&1===t[15]},e.clone=function(){var e=this.elements;return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},e.copyFrom=function(t){return this.elements=[].concat(t.elements),this},e.getColumnVector=function(t,e){return e.set(this.elements[4*t],this.elements[4*t+1],this.elements[4*t+2],this.elements[4*t+3])},e.lookAt=function(e,r,i){var n=t.tempVec0,o=t.tempVec1,a=t.tempVec2;a.subtractVectors(e,r),a.normalize(),n.crossVectors(i,a),n.normalize(),o.crossVectors(a,n);var s=this.elements;return s[0]=n.x,s[1]=o.x,s[2]=a.x,s[3]=0,s[4]=n.y,s[5]=o.y,s[6]=a.y,s[7]=0,s[8]=n.z,s[9]=o.z,s[10]=a.z,s[11]=0,s[12]=-n.dot(e),s[13]=-o.dot(e),s[14]=-a.dot(e),s[15]=1,this},e.addScaledMatrix=function(t,e){for(var r=this.elements,i=t.elements,n=0;n<16;n++)r[n]+=i[n]*e;return this},e.multiply=function(t){if("number"==typeof t){for(var e=0;e<16;e++)this.elements[e]*=t;return this}return this.multiplyMatrices(this,t)},e.premultiply=function(t){return this.multiplyMatrices(t,this)},e.multiplyMatrices=function(t,e){var r=t.elements,i=e.elements,n=this.elements,o=r[0],a=r[4],s=r[8],u=r[12],c=r[1],h=r[5],l=r[9],f=r[13],d=r[2],p=r[6],m=r[10],v=r[14],y=r[3],g=r[7],x=r[11],T=r[15],_=i[0],E=i[4],b=i[8],A=i[12],S=i[1],R=i[5],C=i[9],M=i[13],O=i[2],P=i[6],I=i[10],w=i[14],N=i[3],L=i[7],F=i[11],D=i[15];return n[0]=o*_+a*S+s*O+u*N,n[4]=o*E+a*R+s*P+u*L,n[8]=o*b+a*C+s*I+u*F,n[12]=o*A+a*M+s*w+u*D,n[1]=c*_+h*S+l*O+f*N,n[5]=c*E+h*R+l*P+f*L,n[9]=c*b+h*C+l*I+f*F,n[13]=c*A+h*M+l*w+f*D,n[2]=d*_+p*S+m*O+v*N,n[6]=d*E+p*R+m*P+v*L,n[10]=d*b+p*C+m*I+v*F,n[14]=d*A+p*M+m*w+v*D,n[3]=y*_+g*S+x*O+T*N,n[7]=y*E+g*R+x*P+T*L,n[11]=y*b+g*C+x*I+T*F,n[15]=y*A+g*M+x*w+T*D,this},e.multiplyScalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},e.determinant=function(){var t=this.elements,e=t[0],r=t[4],i=t[8],n=t[12],o=t[1],a=t[5],s=t[9],u=t[13],c=t[2],h=t[6],l=t[10],f=t[14];return t[3]*(+n*s*h-i*u*h-n*a*l+r*u*l+i*a*f-r*s*f)+t[7]*(+e*s*f-e*u*l+n*o*l-i*o*f+i*u*c-n*s*c)+t[11]*(+e*u*h-e*a*f-n*o*h+r*o*f+n*a*c-r*u*c)+t[15]*(-i*a*c-e*s*h+e*a*l+i*o*h-r*o*l+r*s*c)},e.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},e.invert=function(){var t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],d=t[12],p=t[13],m=t[14],v=t[15],y=h*m*u-p*l*u+p*s*f-a*m*f-h*s*v+a*l*v,g=d*l*u-c*m*u-d*s*f+o*m*f+c*s*v-o*l*v,x=c*p*u-d*h*u+d*a*f-o*p*f-c*a*v+o*h*v,T=d*h*s-c*p*s-d*a*l+o*p*l+c*a*m-o*h*m,_=e*y+r*g+i*x+n*T;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var E=1/_;return t[0]=y*E,t[1]=(p*l*n-h*m*n-p*i*f+r*m*f+h*i*v-r*l*v)*E,t[2]=(a*m*n-p*s*n+p*i*u-r*m*u-a*i*v+r*s*v)*E,t[3]=(h*s*n-a*l*n-h*i*u+r*l*u+a*i*f-r*s*f)*E,t[4]=g*E,t[5]=(c*m*n-d*l*n+d*i*f-e*m*f-c*i*v+e*l*v)*E,t[6]=(d*s*n-o*m*n-d*i*u+e*m*u+o*i*v-e*s*v)*E,t[7]=(o*l*n-c*s*n+c*i*u-e*l*u-o*i*f+e*s*f)*E,t[8]=x*E,t[9]=(d*h*n-c*p*n-d*r*f+e*p*f+c*r*v-e*h*v)*E,t[10]=(o*p*n-d*a*n+d*r*u-e*p*u-o*r*v+e*a*v)*E,t[11]=(c*a*n-o*h*n-c*r*u+e*h*u+o*r*f-e*a*f)*E,t[12]=T*E,t[13]=(c*p*i-d*h*i+d*r*l-e*p*l-c*r*m+e*h*m)*E,t[14]=(d*a*i-o*p*i-d*r*s+e*p*s+o*r*m-e*a*m)*E,t[15]=(o*h*i-c*a*i+c*r*s-e*h*s-o*r*l+e*a*l)*E,this},e.extractBasis=function(t,e,r){var i=this.elements;return t.set(i[0],i[1],i[2]),e.set(i[4],i[5],i[6]),r.set(i[8],i[9],i[10]),this},e.compose=function(t,e,r,i){void 0===i&&(i=Dr.ZERO);var n=this.elements,o=e.x,a=e.y,s=e.z,u=e.w,c=-i.x,h=-i.y,l=-i.z,f=o+o,d=a+a,p=s+s,m=o*f,v=o*d,y=o*p,g=a*d,x=a*p,T=s*p,_=u*f,E=u*d,b=u*p,A=r.x,S=r.y,R=r.z;return n[0]=(1-(g+T))*A,n[1]=(v+b)*A,n[2]=(y-E)*A,n[3]=0,n[4]=(v-b)*S,n[5]=(1-(m+T))*S,n[6]=(x+_)*S,n[7]=0,n[8]=(y+E)*R,n[9]=(x-_)*R,n[10]=(1-(m+g))*R,n[11]=0,n[12]=c*n[0]+h*n[4]+l*n[8]-c+t.x,n[13]=c*n[1]+h*n[5]+l*n[9]-h+t.y,n[14]=c*n[2]+h*n[6]+l*n[10]-l+t.z,this},e.decompose=function(e,r,i){var n=t.tempVec0,o=this.elements,a=n.set(o[0],o[1],o[2]).length(),s=n.set(o[4],o[5],o[6]).length(),u=n.set(o[8],o[9],o[10]).length();this.determinant()<0&&(a=-a),e.x=o[12],e.y=o[13],e.z=o[14];var c=t.tempMat0;c.copyFrom(this);var h=1/a,l=1/s,f=1/u;return c.elements[0]*=h,c.elements[1]*=h,c.elements[2]*=h,c.elements[4]*=l,c.elements[5]*=l,c.elements[6]*=l,c.elements[8]*=f,c.elements[9]*=f,c.elements[10]*=f,r.setFromRotationMatrix(c),i.x=a,i.y=s,i.z=u,this},e.getTranslation=function(t){var e=this.elements;return t.set(e[12],e[13],e[14])},e.getScale=function(t){var e=this.elements;return t.set(Math.hypot(e[0],e[1],e[2]),Math.hypot(e[4],e[5],e[6]),Math.hypot(e[8],e[9],e[10]))},e.getTransform=function(){var t=new Dr,e=new $n,r=new Dr;return this.decompose(t,e,r),{translation:t,rotation:e,scale:r}},e.orthographic=function(t,e,r,i,n,o){var a=1/(e-t),s=1/(r-i),u=1/(o-n),c=-(e+t)*a,h=-(r+i)*s,l=-(o+n)*u;a*=2,s*=2,u*=-2;var f=this.elements;return f[0]=a,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=s,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=u,f[11]=0,f[12]=c,f[13]=h,f[14]=l,f[15]=1,this},e.perspective=function(t,e,r,i,n){var o=1/Math.tan(.5*t),a=1/(r-i),s=this.elements;return s[0]=n?o:o/e,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n?o*e:o,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=(i+r)*a,s[11]=-1,s[12]=0,s[13]=0,s[14]=2*i*r*a,s[15]=0,null!==i&&i!==1/0||(s[10]=-1,s[14]=-2*r),this},e.projectPoint=function(t,e){var r=t.x,i=t.y,n=t.z,o=this.elements,a=null!=e?e:t;a.x=o[0]*r+o[4]*i+o[8]*n+o[12],a.y=o[1]*r+o[5]*i+o[9]*n+o[13],a.z=o[2]*r+o[6]*i+o[10]*n+o[14];var s=o[3]*r+o[7]*i+o[11]*n+o[15];return a.multiply(1/s)},e.transformPoint=function(t,e){var r=t.x,i=t.y,n=t.z,o=this.elements,a=null!=e?e:t;return a.x=o[0]*r+o[4]*i+o[8]*n+o[12],a.y=o[1]*r+o[5]*i+o[9]*n+o[13],a.z=o[2]*r+o[6]*i+o[10]*n+o[14],a},e.transformNormal=function(t,e){var r=t.x,i=t.y,n=t.z,o=this.elements,a=null!=e?e:t;return a.x=o[0]*r+o[4]*i+o[8]*n,a.y=o[1]*r+o[5]*i+o[9]*n,a.z=o[2]*r+o[6]*i+o[10]*n,a.normalize()},e.transformVector4=function(t,e){var r=t.x,i=t.y,n=t.z,o=t.w,a=this.elements,s=null!=e?e:t;return s.x=a[0]*r+a[4]*i+a[8]*n+a[12]*o,s.y=a[1]*r+a[5]*i+a[9]*n+a[13]*o,s.z=a[2]*r+a[6]*i+a[10]*n+a[14]*o,s.w=a[3]*r+a[7]*i+a[11]*n+a[15]*o,s},e.equals=function(t){for(var e=this.elements,r=t.elements,i=0;i<16;i++)if(!wr(e[i],r[i]))return!1;return!0},e.toArray=function(){return[].concat(this.elements)},e.fill=function(t,e){void 0===e&&(e=0);var r=this.elements;t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15]},t.fromIdentity=function(){return new t(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.fromLookAt=function(e,r,i){return(new t).lookAt(e,r,i)},t.fromPerspective=function(e,r,i,n,o){return(new t).perspective(e,r,i,n,o)},t.fromColumnVectors=function(e,r,i,n){return(new t).setFromColumnVectors(e,r,i,n)},t.fromMatrix3=function(e){return(new t).setFromMatrix3(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t.fromScale=function(e,r,i){return(new t).setFromScale(e,r,i)},t.fromTranslation=function(e,r,i){return(new t).setFromTranslation(e,r,i)},t.fromRotationX=function(e){return(new t).setFromRotationX(e)},t.fromRotationY=function(e){return(new t).setFromRotationY(e)},t.fromRotationZ=function(e){return(new t).setFromRotationZ(e)},t.fromRotationAxis=function(e,r){return(new t).setFromRotationAxis(e,r)},t.fromEuler=function(e){return(new t).setFromEuler(e)},t.fromQuaternion=function(e){return(new t).setFromQuaternion(e)},t.fromShear=function(e,r,i){return(new t).setFromShear(e,r,i)},t.fromBasis=function(e,r,i){return(new t).setFromBasis(e,r,i)},t.fromRowMajorData=function(e,r,i,n,o,a,s,u,c,h,l,f,d,p,m,v){return new t(e,o,c,d,r,a,h,p,i,s,l,m,n,u,f,v)},t}();function Vo(t,e,r){var i;if(void 0===e&&(e="webgl"),"webgl2"===e&&((i=t.getContext("webgl2",r))||console.debug("WebGL2 context retrieval failed, falling back to WebGL context.")),i&&"webgl"!==e||(i=t.getContext("webgl",r)),!i)throw new Error("This browser does not support WebGL or the WebGL version is incorrect. Please check your WebGL version.");return i}function Bo(t){var e=t.getExtension("EXT_disjoint_timer_query_webgl2");if(e){var i=t.createQuery(),n=fr((function(){return gr(this,(function(o){return[2,new Promise((function(o,a){if(i){var s=t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),u=t.getParameter(e.GPU_DISJOINT_EXT);if(s&&!u){var c=t.getQueryParameter(i,t.QUERY_RESULT);o(c/1e3/1e3)}(s||u)&&(t.deleteQuery(i),i=null),null!==s&&i&&r.window.setTimeout((function(){n().then(o).catch}),1)}}))]}))}));if(!i)return;return{begin:function(){i&&t.beginQuery(e.TIME_ELAPSED_EXT,i)},end:function(){t.endQuery(e.TIME_ELAPSED_EXT)},getTime:n}}}Do.IDENTITY=new Do(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),Do.ZERO=new Do(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),Do.tempVec0=new Dr,Do.tempVec1=new Dr,Do.tempVec2=new Dr,Do.tempMat0=new Do,exports.ShaderType=void 0,exports.MaskMode=void 0,exports.TextureLoadAction=void 0,exports.TextureSourceType=void 0;var Uo=[],ko={},zo="WebGL Constants not in global, please check your environment";function Go(){"function"==typeof r.WebGL2RenderingContext?Ho(r.WebGL2RenderingContext):void 0!==r.WebGLRenderingContext?(Ho(r.WebGLRenderingContext),Ho(r.WebGLRenderingContext.prototype)):Wr?Uo.push(Yr()?"iOS16 lockdown mode, WebGL Constants not in global":zo):Uo.push(zo),Uo.length||"HALF_FLOAT"in ko||(ko.HALF_FLOAT=5131)}function Xo(t){return void 0!==r.WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name}function Ho(t){for(var e in t)/^[A-Z_]/.test(e)&&(ko[e]=t[e])}function jo(t){switch(t){case _n.Float32:return r.WebGLRenderingContext.FLOAT;case _n.Int16:return r.WebGLRenderingContext.SHORT;case _n.Int8:return r.WebGLRenderingContext.BYTE;case _n.UInt16:return r.WebGLRenderingContext.UNSIGNED_SHORT;case _n.UInt8:return r.WebGLRenderingContext.UNSIGNED_BYTE;default:return r.WebGLRenderingContext.FLOAT}}function Wo(t){switch(t){case Ii.ALPHA:case Ii.ADD:case Ii.SUBTRACTION:case Ii.STRONG_LIGHT:case Ii.WEAK_LIGHT:return 1;case Ii.SUPERPOSITION:return 2;case Ii.BRIGHTNESS:return 3;case Ii.MULTIPLY:return 0;default:return 1}}function Yo(t,e){switch(e){case void 0:case Ii.ALPHA:t.blendFunction=[ko.ONE,ko.ONE_MINUS_SRC_ALPHA,ko.ONE,ko.ONE_MINUS_SRC_ALPHA];break;case Ii.ADD:t.blendFunction=[ko.ONE,ko.ONE,ko.ONE,ko.ONE];break;case Ii.SUBTRACTION:t.blendFunction=[ko.ONE,ko.ONE,ko.ZERO,ko.ONE],t.blendEquation=[ko.FUNC_REVERSE_SUBTRACT,ko.FUNC_REVERSE_SUBTRACT];break;case Ii.SUPERPOSITION:t.blendFunction=[ko.ONE,ko.ONE,ko.ONE,ko.ONE];break;case Ii.MULTIPLY:t.blendFunction=[ko.DST_COLOR,ko.ONE_MINUS_SRC_ALPHA,ko.DST_COLOR,ko.ONE_MINUS_SRC_ALPHA];break;case Ii.BRIGHTNESS:t.blendFunction=[ko.ONE,ko.ONE_MINUS_SRC_ALPHA,ko.ONE,ko.ONE_MINUS_SRC_ALPHA];break;case Ii.STRONG_LIGHT:t.blendFunction=[ko.DST_COLOR,ko.DST_ALPHA,ko.ZERO,ko.ONE];break;case Ii.WEAK_LIGHT:t.blendFunction=[ko.DST_COLOR,ko.ZERO,ko.ZERO,ko.ONE];break;default:console.warn("BlendMode "+e+" not in specification, please set blend params separately.")}}function Zo(t,e){e===wi.DOUBLE?t.culling=!1:(t.culling=!0,t.frontFace=ko.CW,t.cullFace=e===wi.BACK?ko.BACK:ko.FRONT)}function qo(t,e){switch(e){case void 0:t.stencilTest=!1;break;case exports.MaskMode.MASK:t.stencilTest=!0,t.stencilFunc=[ko.ALWAYS,ko.ALWAYS],t.stencilOpZPass=[ko.REPLACE,ko.REPLACE];break;case exports.MaskMode.OBSCURED:t.stencilTest=!0,t.stencilFunc=[ko.EQUAL,ko.EQUAL];break;case exports.MaskMode.REVERSE_OBSCURED:t.stencilTest=!0,t.stencilFunc=[ko.NOTEQUAL,ko.NOTEQUAL];break;case exports.MaskMode.NONE:t.stencilTest=!1;break;default:console.warn("MaskMode "+e+" not in specification, please set stencil params seperately.")}}Uo.length||Go(),function(t){t[t.vertex=0]="vertex",t[t.fragment=1]="fragment"}(exports.ShaderType||(exports.ShaderType={})),function(t){t[t.NONE=0]="NONE",t[t.MASK=1]="MASK",t[t.OBSCURED=2]="OBSCURED",t[t.REVERSE_OBSCURED=3]="REVERSE_OBSCURED"}(exports.MaskMode||(exports.MaskMode={})),function(t){t[t.whatever=0]="whatever",t[t.clear=2]="clear"}(exports.TextureLoadAction||(exports.TextureLoadAction={})),function(t){t[t.none=0]="none",t[t.data=1]="data",t[t.image=2]="image",t[t.compressed=3]="compressed",t[t.video=4]="video",t[t.canvas=5]="canvas",t[t.framebuffer=6]="framebuffer",t[t.mipmaps=7]="mipmaps"}(exports.TextureSourceType||(exports.TextureSourceType={}));var Ko=function(){function t(){this.callbacks={}}var e=t.prototype;return e.downloadJSON=function(t,e,r){this.download(t,"json",e,r)},e.downloadBinary=function(t,e,r){this.download(t,"arraybuffer",e,r)},e.downloadBlob=function(t,e,r){this.download(t,"blob",e,r)},e.download=function(e,i,n,o){var a=this;if(void 0===i&&(i="json"),!this.start(e,n,o)){var s=new r.XMLHttpRequest,u=function(){a.finish(e,s.status,s.response)};s.responseType=i,s.addEventListener("load",(function(){200==s.status||0==s.status&&t.trustXHRStatusZero?a.finish(e,200,s.response):u()})),s.addEventListener("error",u),s.open("GET",e,!0),s.send()}},e.start=function(t,e,r){var i=this.callbacks[t];try{if(i)return!0;this.callbacks[t]=i=[]}finally{i.push(e,r)}},e.finish=function(e,r,i){var n=this.callbacks[e];delete this.callbacks[e];for(var o=200==r||0==r&&t.trustXHRStatusZero?[i]:[r,i],a=o.length-1,s=n.length;a<s;a+=2)n[a].apply(null,o)},t}();Ko.trustXHRStatusZero=!1;var Qo=!1,Jo=!1;function $o(t,e){return ta.apply(this,arguments)}function ta(){return(ta=fr((function(t,e){return gr(this,(function(r){switch(r.label){case 0:return!Qo&&e?[3,2]:[4,ia(t)];case 1:case 5:return[2,{image:r.sent(),url:t}];case 2:return r.trys.push([2,4,,6]),[4,ia(e)];case 3:return[2,{image:r.sent(),url:e}];case 4:return r.sent(),Qo=!0,[4,ia(t)];case 6:return[2]}}))}))).apply(this,arguments)}function ea(t,e){return ra.apply(this,arguments)}function ra(){return(ra=fr((function(t,e){return gr(this,(function(r){switch(r.label){case 0:return!Jo&&e?[3,2]:[4,ia(t)];case 1:case 5:return[2,{image:r.sent(),url:t}];case 2:return r.trys.push([2,4,,6]),[4,ia(e)];case 3:return[2,{image:r.sent(),url:e}];case 4:return r.sent(),Jo=!0,[4,ia(t)];case 6:return[2]}}))}))).apply(this,arguments)}function ia(t){return na.apply(this,arguments)}function na(){return(na=fr((function(t){var e,i;return gr(this,(function(n){if(e="",mr(t,r.HTMLImageElement)){if(t.complete)return[2,t];e=t.src}else mr(t,r.Blob)?(e=r.URL.createObjectURL(t),i=!0):"string"==typeof t&&(e=t);if(!e)throw new Error("Invalid url type: "+JSON.stringify(t)+".");return[2,new Promise((function(t,n){var o=new r.Image;/^data:/.test(e)||(o.crossOrigin="*"),o.onload=function(){return o.onload=null,i&&r.URL.revokeObjectURL(e),t(o)},o.onerror=function(t){return o.onerror=null,i&&r.URL.revokeObjectURL(e),n("Load image fail: "+e+", reason: "+JSON.stringify(t))},o.src=e}))]}))}))).apply(this,arguments)}function oa(t){return aa.apply(this,arguments)}function aa(){return(aa=fr((function(t){return gr(this,(function(e){return[2,new Promise((function(e,r){(new Ko).downloadBinary(t,e,(function(e,i){r("Couldn't load bins "+t+": status "+e+", "+i)}))}))]}))}))).apply(this,arguments)}function sa(){return(sa=fr((function(t){return gr(this,(function(e){return[2,new Promise((function(e,r){(new Ko).downloadBlob(t,e,(function(e,i){r("Couldn't load blob "+t+": status "+e+", "+i)}))}))]}))}))).apply(this,arguments)}function ua(t){return ca.apply(this,arguments)}function ca(){return(ca=fr((function(t){var e;return gr(this,(function(i){return e=r.document.createElement("video"),"string"==typeof t?e.src=t:e.srcObject=t,e.crossOrigin="anonymous",e.muted=!0,Zr()&&e.setAttribute("renderer","standard"),e.setAttribute("playsinline","playsinline"),[2,new Promise((function(t,r){var i=e.play().catch((function(t){r(t)}));i?i.then((function(){return t(e)})):e.addEventListener("loadeddata",(function r(){t(e),e.removeEventListener("loadeddata",r)}),!0),e.addEventListener("error",(function(t){r("Load video fail.")}))}))]}))}))).apply(this,arguments)}function ha(t,e){return la.apply(this,arguments)}function la(){return(la=fr((function(t,e){return gr(this,(function(r){switch(r.label){case 0:if(!Array.isArray(t))return[3,5];r.label=1;case 1:return r.trys.push([1,3,,5]),[4,e(t[0])];case 2:return[2,r.sent()];case 3:return r.sent(),[4,e(t[1])];case 4:return[2,r.sent()];case 5:return[2,e(t)]}}))}))).apply(this,arguments)}function fa(t,e,r){return da.apply(this,arguments)}function da(){return(da=fr((function(t,e,r,i){var n,o,a,s,u,c,h,l,f;return gr(this,(function(d){switch(d.label){case 0:return void 0===i&&(i=[]),34067!==t.target?[3,2]:(n=t.mipmaps,o=t.target,a=n.map((function(t){return Promise.all(t.map((function(t){return t.id?r[t.id]:pa(t,e)})))})),[4,Promise.all(a)]);case 1:return s=d.sent(),[2,qn({keepImageSource:!1},t,{mipmaps:s,sourceFrom:{target:o,type:exports.TextureSourceType.mipmaps}})];case 2:return u=t.mipmaps,c=t.target,h=u.map((function(t){return pa(t,e)})),[4,Promise.all(h)];case 3:return l=d.sent(),f=i[u[0][1][0]].url,[2,qn({keepImageSource:!1},t,{mipmaps:l,sourceType:exports.TextureSourceType.mipmaps,sourceFrom:{target:c,bin:f,type:exports.TextureSourceType.mipmaps,mipmaps:u.map((function(t){return[t[1][1],t[1][2]]}))}})];case 4:return[2]}}))}))).apply(this,arguments)}function pa(t,e){return ma.apply(this,arguments)}function ma(){return ma=fr((function(t,e){var i,n,o,a,s;return gr(this,(function(u){if(i=t[1],n=i[0],o=i[1],a=i[2],!(s=e[n]))throw new Error("Invalid bin pointer: "+JSON.stringify(t)+".");return[2,ia(new r.Blob([new Uint8Array(s,o,a)]))]}))})),ma.apply(this,arguments)}var va=1,ya=function(t){function e(e){var r;return(r=t.call(this,e)||this).destroyed=!1,r.id="Tex"+va++,r}ji(e,t);var r=e.prototype;return r.getWidth=function(){return this.width||0},r.getHeight=function(){return this.height||0},r.uploadCurrentVideoFrame=function(){},r.offloadData=function(){},r.reloadData=function(){},r.initialize=function(){},r.assembleOptions=function(t){var e=t.target,r=void 0===e?ko.TEXTURE_2D:e,i=t.format,n=void 0===i?ko.RGBA:i;return t.sourceType||(t.sourceType="image"in t?exports.TextureSourceType.image:"data"in t?exports.TextureSourceType.data:"video"in t?exports.TextureSourceType.video:0),qn({minFilter:ko.NEAREST,magFilter:ko.NEAREST,wrapS:ko.CLAMP_TO_EDGE,wrapT:ko.CLAMP_TO_EDGE,target:r,format:ko.RGBA,internalFormat:n,type:ko.UNSIGNED_BYTE},t)},e.fromImage=function(t,r,i){return fr((function(){var n,o;return gr(this,(function(a){switch(a.label){case 0:return[4,ia(t)];case 1:return n=a.sent(),(o=e.create(r,qn({sourceType:exports.TextureSourceType.image,image:n,target:ko.TEXTURE_2D,id:xi(),flipY:!0},i))).initialize(),[2,o]}}))}))()},e.fromVideo=function(t,r,i){return fr((function(){var n,o;return gr(this,(function(a){switch(a.label){case 0:return[4,ua(t)];case 1:return n=a.sent(),(o=e.create(r,qn({sourceType:exports.TextureSourceType.video,video:n,id:xi(),flipY:!0},i))).initialize(),[2,o]}}))}))()},Io(e,[{key:"isDestroyed",get:function(){return this.destroyed}}]),e}(Ln);function ga(t,e,r,i){var n,o,a=e.length/r/i;return o=n=4===a||0===a?ko.RGBA:3===a?ko.RGB:2===a?ko.LUMINANCE_ALPHA:ko.LUMINANCE,ya.createWithData(t,{data:e,width:r,height:i},{type:ko.HALF_FLOAT,format:n,internalFormat:o,wrapS:ko.CLAMP_TO_EDGE,wrapT:ko.CLAMP_TO_EDGE})}var xa={type:ko.UNSIGNED_BYTE,format:ko.RGBA,internalFormat:ko.RGBA,wrapS:ko.MIRRORED_REPEAT,wrapT:ko.MIRRORED_REPEAT,minFilter:ko.NEAREST,magFilter:ko.NEAREST};function Ta(t){return ya.create(t,qn({id:An.WhiteTexture,data:{width:1,height:1,data:new Uint8Array([255,255,255,255])},sourceType:exports.TextureSourceType.data},xa))}function _a(t){return ya.create(t,qn({id:An.TransparentTexture,data:{width:1,height:1,data:new Uint8Array([0,0,0,0])},sourceType:exports.TextureSourceType.data},xa))}var Ea=function(){function t(t,e,r){void 0===r&&(r=0),this.arrayBuffer=t,this.baseOffset=r;var i=new Uint8Array(this.arrayBuffer,this.baseOffset,12);if(171!==i[0]||75!==i[1]||84!==i[2]||88!==i[3]||32!==i[4]||49!==i[5]||49!==i[6]||187!==i[7]||13!==i[8]||10!==i[9]||26!==i[10]||10!==i[11])throw new Error("Texture missing KTX identifier.");var n=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(this.arrayBuffer,this.baseOffset+12,13*n),a=67305985===o.getUint32(0,!0);this.glType=o.getUint32(1*n,a),this.glTypeSize=o.getUint32(2*n,a),this.glFormat=o.getUint32(3*n,a),this.glInternalFormat=o.getUint32(4*n,a),this.glBaseInternalFormat=o.getUint32(5*n,a),this.pixelWidth=o.getUint32(6*n,a),this.pixelHeight=o.getUint32(7*n,a),this.pixelDepth=o.getUint32(8*n,a),this.numberOfArrayElements=o.getUint32(9*n,a),this.numberOfFaces=o.getUint32(10*n,a),this.numberOfMipmapLevels=o.getUint32(11*n,a),this.bytesOfKeyValueData=o.getUint32(12*n,a),this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0!==this.pixelHeight&&0===this.pixelDepth?0===this.numberOfArrayElements?this.numberOfFaces===e?0===this.glType?this.loadType=0:this.loadType=2:ci.warn("Number of faces expected "+e+", but found "+this.numberOfFaces+"."):ci.warn("Texture arrays not currently supported."):ci.warn("Only 2D textures currently supported.")}return t.prototype.mipmaps=function(t){for(var e=[],r=64+this.bytesOfKeyValueData,i=this.pixelWidth,n=this.pixelHeight,o=t?this.numberOfMipmapLevels:1,a=0;a<o;a++){for(var s=new Int32Array(this.arrayBuffer,this.baseOffset+r,1)[0],u=0;u<this.numberOfFaces;u++){var c=new Uint8Array(this.arrayBuffer,this.baseOffset+r+4,s);e.push({data:c,width:i,height:n}),r+=s+4,r+=3-(s+3)%4}i=Math.max(1,.5*i),n=Math.max(1,.5*n)}return e},t}();function ba(t){var e=new Ea(t,1),r=e.numberOfMipmapLevels,i=e.pixelWidth,n=e.pixelHeight,o=e.glType,a=e.numberOfFaces,s=e.glInternalFormat,u=e.glFormat,c=r>=Math.floor(Math.log2(Math.max(i,n))+1);return{sourceType:exports.TextureSourceType.compressed,type:o,target:6===a?ko.TEXTURE_CUBE_MAP:ko.TEXTURE_2D,internalFormat:s,format:u,mipmaps:e.mipmaps(c)}}var Aa,Sa=function(){function t(){this.reloadPending={}}var e=t.prototype;return e.reload=function(t){var e=this;return fr((function(){var r,i;return gr(this,(function(n){switch(n.label){case 0:return r=t.id,e.reloadPending[r]?[2]:t.sourceFrom?(e.reloadPending[r]=!0,[4,e.loadSource(t.sourceFrom)]):[3,2];case 1:return i=n.sent(),t.updateSource(i),e.reloadPending[r]=!1,[3,3];case 2:throw new Error("No source from.");case 3:return[2]}}))}))()},e.canOffloadTexture=function(t){if(t){var e=t.type;if(e===exports.TextureSourceType.compressed||e===exports.TextureSourceType.image){var r=t.target,i=t.map,n=t.url;return r===ko.TEXTURE_CUBE_MAP?"object"==typeof i&&!!i:li(n)&&n.length>0}if(e===exports.TextureSourceType.mipmaps){var o=t.bin,a=t.mipmaps,s=t.target,u=t.maps,c=t.urls;return o?a.length>0:s===ko.TEXTURE_CUBE_MAP?u.every((function(t){return"object"==typeof t&&t})):c.every((function(t){return li(t)&&t.length>0}))}}return!1},e.loadSource=function(t,e){var r=this;return fr((function(){var i,n,o,a,s,u,c,h,l,f,d,p,m,v,y,g,x;return gr(this,(function(T){switch(T.label){case 0:return i=t.type,n=t.target,o=t.map,a=t.url,s=t.bin,u=t.mipmaps,c=t.urls,h=t.maps,n!==ko.TEXTURE_CUBE_MAP||i===exports.TextureSourceType.mipmaps?[3,2]:[4,r.loadCubeMap(o)];case 1:return l=T.sent(),[2,qn({},e,{cube:l,target:ko.TEXTURE_CUBE_MAP,sourceType:exports.TextureSourceType.image,sourceFrom:{type:exports.TextureSourceType.image,map:qn({},o),target:ko.TEXTURE_CUBE_MAP}})];case 2:return i!==exports.TextureSourceType.image?[3,4]:[4,ia(a)];case 3:return f=T.sent(),[2,qn({},e,{image:f,sourceType:exports.TextureSourceType.image,sourceFrom:{type:i,url:a,target:ko.TEXTURE_2D}})];case 4:return i!==exports.TextureSourceType.video?[3,6]:[4,ua(a)];case 5:return d=T.sent(),[2,qn({},e,{video:d,sourceType:exports.TextureSourceType.video})];case 6:return i!==exports.TextureSourceType.compressed?[3,8]:[4,oa(a)];case 7:return[2,qn({},ba(T.sent()),e,{sourceFrom:{url:a,type:exports.TextureSourceType.compressed}})];case 8:return i!==exports.TextureSourceType.mipmaps?[3,17]:s?[4,oa(s)]:[3,13];case 9:return p=T.sent(),m=null!=n?n:ko.TEXTURE_2D,v=m===ko.TEXTURE_2D?u.slice():u.map((function(t){return t.slice()})),n!==ko.TEXTURE_CUBE_MAP?[3,11]:[4,Promise.all(u.map((function(t){return r.loadMipmapImages(t,p)})))];case 10:return y=T.sent(),[3,12];case 11:y=r.loadMipmapImages(u,p),T.label=12;case 12:return[2,qn({},e,{mipmaps:y,target:m,sourceType:exports.TextureSourceType.mipmaps,sourceFrom:{bin:s,mipmaps:v,target:m,type:exports.TextureSourceType.mipmaps}})];case 13:return n!==ko.TEXTURE_2D&&n?[3,15]:[4,Promise.all(c.map((function(t){return ia(t)})))];case 14:return g=T.sent(),[2,qn({},e,{mipmaps:g,target:ko.TEXTURE_2D,sourceType:exports.TextureSourceType.mipmaps,sourceFrom:{type:i,urls:c.slice(),target:ko.TEXTURE_2D}})];case 15:return n!==ko.TEXTURE_CUBE_MAP?[3,17]:[4,Promise.all(h.map((function(t){return r.loadCubeMap(t)})))];case 16:return x=T.sent(),[2,qn({},e,{mipmaps:x,target:ko.TEXTURE_CUBE_MAP,sourceType:exports.TextureSourceType.mipmaps,sourceFrom:{type:i,maps:h.map((function(t){return qn({},t)})),target:ko.TEXTURE_CUBE_MAP}})];case 17:throw new Error("Invalid resource type: "+i+".")}}))}))()},e.loadMipmapImages=function(t,e){return fr((function(){return gr(this,(function(i){return[2,Promise.all(t.map((function(t){return ia(new r.Blob([new Uint8Array(e,t[0],t[1])]))})))]}))}))()},e.loadCubeMap=function(t){return fr((function(){return gr(this,(function(e){return[2,Promise.all(t.map((function(t){return ia(t)})))]}))}))()},t}();function Ra(){return Aa||(Aa=new Sa),Aa}exports.MaterialRenderType=void 0;var Ca=function(){function t(t){this.destroyed=!1;var e=t.name,r=void 0===e?"defaultDataBlock":e;this.name=r}var e=t.prototype;return e.setUniformValues=function(t){var e=this;Object.keys(t).forEach((function(r){e.setUniformValue(r,t[r])}))},e.invalidAllFlags=function(){},e.updateUniformSubData=function(t,e,r){},t}();function Ma(t){return"object"==typeof t&&t&&void 0===t.length&&mr(t,ya)}!function(t){t[t.normal=0]="normal",t[t.transformFeedback=1]="transformFeedback"}(exports.MaterialRenderType||(exports.MaterialRenderType={})),exports.ShaderCompileResultStatus=void 0,exports.GLSLVersion=void 0;var Oa=1,Pa=function(t){function e(e,r){var i;if((i=t.call(this,e)||this).stringTags={},i.enabledMacros={},i.destroyed=!1,i.initialized=!1,i.shaderDirty=!0,r){var n=r.name,o=void 0===n?"Material"+Oa++:n,a=r.renderType,s=void 0===a?0:a,u=r.shader;i.name=o,i.renderType=s,i.shaderSource=u,i.props=r}else i.name="Material"+Oa++,i.renderType=0;return i}ji(e,t);var r=e.prototype;return r.initialize=function(){},r.createShaderVariant=function(){},r.use=function(t,e){},Io(e,[{key:"shader",get:function(){return this._shader},set:function(t){this._shader!==t&&(this._shader=t,this.shaderDirty=!0)}},{key:"mainTexture",get:function(){return this.getTexture("_MainTex")},set:function(t){this.setTexture("_MainTex",t)}},{key:"color",get:function(){return this.getColor("_Color")},set:function(t){this.setColor("_Color",t)}},{key:"blending",set:function(t){}},{key:"blendFunction",set:function(t){}},{key:"blendEquation",set:function(t){}},{key:"depthTest",set:function(t){}},{key:"depthMask",set:function(t){}},{key:"stencilTest",set:function(t){}},{key:"stencilRef",set:function(t){}},{key:"stencilFunc",set:function(t){}},{key:"stencilOpZPass",set:function(t){}},{key:"culling",set:function(t){}},{key:"frontFace",set:function(t){}},{key:"cullFace",set:function(t){}},{key:"blendColor",set:function(t){}},{key:"depthRange",set:function(t){}},{key:"depthFunc",set:function(t){}},{key:"polygonOffsetFill",set:function(t){}},{key:"polygonOffset",set:function(t){}},{key:"sampleAlphaToCoverage",set:function(t){}},{key:"stencilMask",set:function(t){}},{key:"stencilOpFail",set:function(t){}},{key:"stencilOpZFail",set:function(t){}}]),e}(Ln),Ia=function(){function t(t){this.engine=t,this.alphaMaskEnabled=!1,this.maskMode=exports.MaskMode.NONE,this.maskable=null,this.stencilClearAction={stencilAction:exports.TextureLoadAction.clear}}var e=t.prototype;return e.getRefValue=function(){return 1},e.setMaskOptions=function(t){var e=t.isMask,r=void 0!==e&&e,i=t.inverted,n=void 0!==i&&i,o=t.reference,a=t.alphaMaskEnabled,s=void 0!==a&&a;this.alphaMaskEnabled=s,r?this.maskMode=exports.MaskMode.MASK:(this.maskMode=n?exports.MaskMode.REVERSE_OBSCURED:exports.MaskMode.OBSCURED,this.maskable=this.engine.findObject(o))},e.drawStencilMask=function(t){this.maskable&&(t.clear(this.stencilClearAction),this.maskable.drawStencilMask(t))},t}();!function(t){t[t.noShader=0]="noShader",t[t.success=1]="success",t[t.fail=2]="fail",t[t.compiling=3]="compiling"}(exports.ShaderCompileResultStatus||(exports.ShaderCompileResultStatus={})),function(t){t.GLSL1="100",t.GLSL3="300 es"}(exports.GLSLVersion||(exports.GLSLVersion={}));var wa=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).source=r,i}return ji(e,t),e}(Ln);exports.Shader=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.createVariant=function(t){var e=[];if(t)for(var r,i=pr(Object.keys(t));!(r=i()).done;){var n=r.value;e.push([n,t[n]])}var o=this.engine.getShaderLibrary().createShader(this.shaderData,e);return o.shader=this,o},r.fromData=function(e){t.prototype.fromData.call(this,e),this.shaderData=e},e}(Ln),exports.Shader=yr([In(xn.Shader)],exports.Shader);var Na="effects-internal-copy",La="effects-internal-copy-mesh",Fa="\nprecision highp float;\nattribute vec2 aPos;\nvarying vec2 vTex;\nvoid main(){\n    gl_Position = vec4(aPos,0.,1.0);\n    vTex = (aPos + vec2(1.0))/2.;\n}",Da="precision mediump float;\nvarying vec2 vTex;\n\n#ifdef DEPTH_TEXTURE\nuniform sampler2D uDepth;\n#extension GL_EXT_frag_depth : enable\n#endif\nvoid main(){\n    #ifdef DEPTH_TEXTURE\n    gl_FragDepthEXT = texture2D(uDepth,vTex).r;\n    #endif\n}\n";function Va(t,e){return{name:Na,vertex:Fa,fragment:Da,glslVersion:2===t?exports.GLSLVersion.GLSL3:exports.GLSLVersion.GLSL1,macros:[["DEPTH_TEXTURE",!!e]],cacheId:La+ +e}}var Ba,Ua,ka={format:ko.RGBA,type:ko.UNSIGNED_BYTE,minFilter:ko.LINEAR,magFilter:ko.LINEAR,wrapS:ko.CLAMP_TO_EDGE,wrapT:ko.CLAMP_TO_EDGE},za=Symbol("dispose"),Ga=function(){function t(t){this.textureCache={},this.textureRef={},this.engine=t}var e=t.prototype;return e.requestColorAttachmentTexture=function(t){var e=this,r=t.width,i=t.height,n=t.name,o={sourceType:exports.TextureSourceType.framebuffer,data:{width:r,height:i},name:n},a=[n];Object.getOwnPropertyNames(ka).forEach((function(e){var r,i=null!=(r=t[e])?r:ka[e];o[e]=i,a.push(e,i)}));var s=a.join(":"),u=this.textureCache[s];if(u)this.textureRef[s]++;else{var c=this.engine;oi(c),u=ya.create(c,o),this.textureCache[s]=u,this.textureRef[s]=1,u[za]=u.dispose,u.dispose=function(){return e.removeTexture(s)}}return u},e.removeTexture=function(t){var e=this.textureRef[t];if(e<=1){e<0&&console.error("Ref count < 0.");var r=this.textureCache[t];r&&(r[za](),r.dispose=r[za]),delete this.textureCache[t],delete this.textureRef[t]}else this.textureRef[t]=e-1},e.dispose=function(){var t=this;Object.keys(this.textureCache).forEach((function(e){var r=t.textureCache[e];r[za](),r.dispose=r[za]})),this.textureCache={},this.textureRef={},this.engine=void 0},t}(),Xa=function(){function t(t){void 0===t&&(t={}),this.semantics=qn({},t)}var e=t.prototype;return e.toObject=function(){return qn({},this.semantics)},e.setSemantic=function(t,e){void 0===e?delete this.semantics[t]:this.semantics[t]=e},e.getSemanticValue=function(t,e){var r=this.semantics[t];return di(r)?r(e):r},e.hasSemanticValue=function(t){return t in this.semantics},e.dispose=function(){var t=this;Object.keys(this.semantics).forEach((function(e){delete t.semantics[e]}))},t}(),Ha=((Ba={})[ko.FLOAT]=Float32Array.BYTES_PER_ELEMENT,Ba[ko.INT]=Int32Array.BYTES_PER_ELEMENT,Ba[ko.SHORT]=Int16Array.BYTES_PER_ELEMENT,Ba[ko.BYTE]=Int8Array.BYTES_PER_ELEMENT,Ba),ja=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).name="",e.subMeshes=[],e}ji(e,t);var r=e.prototype;return r.initialize=function(){},r.flush=function(){},e}(Ln);function Wa(t){return t===ko.INT?new Int32Array(0):t===ko.SHORT?new Int16Array(0):new Float32Array(0)}!function(t){t[t.XYZ=0]="XYZ",t[t.XZY=1]="XZY",t[t.YXZ=2]="YXZ",t[t.YZX=3]="YZX",t[t.ZXY=4]="ZXY",t[t.ZYX=5]="ZYX"}(Ua||(Ua={}));var Ya=function(){function t(e,r,i,n){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=t.DEFAULT_ORDER),this.x=e,this.y=r,this.z=i,this.order=n}var e=t.prototype;return e.set=function(t,e,r,i){return void 0===i&&(i=this.order),this.x=t,this.y=e,this.z=r,this.order=i,this},e.setZero=function(t){return void 0===t&&(t=this.order),this.set(0,0,0,t)},e.setFromRotationMatrix4=function(t,e){void 0===e&&(e=this.order);var r=t.elements,i=r[0],n=r[4],o=r[8],a=r[1],s=r[5],u=r[9],c=r[2],h=r[6],l=r[10];switch(e){case Ua.XYZ:this.y=Math.asin(Lr(o,-1,1)),Math.abs(o)<.9999999?(this.x=Math.atan2(-u,l),this.z=Math.atan2(-n,i)):(this.x=Math.atan2(h,s),this.z=0);break;case Ua.YXZ:this.x=Math.asin(-Lr(u,-1,1)),Math.abs(u)<.9999999?(this.y=Math.atan2(o,l),this.z=Math.atan2(a,s)):(this.y=Math.atan2(-c,i),this.z=0);break;case Ua.ZXY:this.x=Math.asin(Lr(h,-1,1)),Math.abs(h)<.9999999?(this.y=Math.atan2(-c,l),this.z=Math.atan2(-n,s)):(this.y=0,this.z=Math.atan2(a,i));break;case Ua.ZYX:this.y=Math.asin(-Lr(c,-1,1)),Math.abs(c)<.9999999?(this.x=Math.atan2(h,l),this.z=Math.atan2(a,i)):(this.x=0,this.z=Math.atan2(-n,s));break;case Ua.YZX:this.z=Math.asin(Lr(a,-1,1)),Math.abs(a)<.9999999?(this.x=Math.atan2(-u,s),this.y=Math.atan2(-c,i)):(this.x=0,this.y=Math.atan2(o,l));break;case Ua.XZY:this.z=Math.asin(-Lr(n,-1,1)),Math.abs(n)<.9999999?(this.x=Math.atan2(h,s),this.y=Math.atan2(o,i)):(this.x=Math.atan2(-u,l),this.y=0);break;default:console.error("setFromRotationMatrix: unknown order: "+e)}return this.x*=Pr,this.y*=Pr,this.z*=Pr,this.order=e,this},e.setFromQuaternion=function(e,r){void 0===r&&(r=this.order);var i=t.tempMat0;return i.setFromQuaternion(e),this.setFromRotationMatrix4(i,r)},e.setFromVector3=function(t,e){return void 0===e&&(e=this.order),this.set(t.x,t.y,t.z,e)},e.setFromArray=function(t,e,r){var i,n,o,a;return void 0===e&&(e=0),void 0===r&&(r=this.order),this.x=null!=(i=t[e])?i:0,this.y=null!=(n=t[e+1])?n:0,this.z=null!=(o=t[e+2])?o:0,this.order=null!=(a=t[e+3])?a:r,this},e.clone=function(){return new t(this.x,this.y,this.z,this.order)},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this},e.add=function(t){return this.order!=t.order?(console.error("add euler with different order"),this):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},e.addEulers=function(t,e){return t.order!=e.order?(console.error("add euler with different order"),this):(this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.order=t.order,this)},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.reorder=function(t){var e=new $n;return e.setFromEuler(this),this.setFromQuaternion(e,t)},e.rotateVector3=function(e,r){return t.tempQuat0.setFromEuler(this).rotateVector3(e,r)},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order},e.toVector3=function(t){return t.set(this.x,this.y,this.z)},e.toArray=function(){return[this.x,this.y,this.z]},e.toQuaternion=function(t){var e=this,r=e.x,i=e.y,n=e.z,o=e.order,a=Math.cos(r*Or*.5),s=Math.cos(i*Or*.5),u=Math.cos(n*Or*.5),c=Math.sin(r*Or*.5),h=Math.sin(i*Or*.5),l=Math.sin(n*Or*.5);switch(o){case Ua.XYZ:t.set(c*s*u+a*h*l,a*h*u-c*s*l,a*s*l+c*h*u,a*s*u-c*h*l);break;case Ua.YXZ:t.set(c*s*u+a*h*l,a*h*u-c*s*l,a*s*l-c*h*u,a*s*u+c*h*l);break;case Ua.ZXY:t.set(c*s*u-a*h*l,a*h*u+c*s*l,a*s*l+c*h*u,a*s*u-c*h*l);break;case Ua.ZYX:t.set(c*s*u-a*h*l,a*h*u+c*s*l,a*s*l-c*h*u,a*s*u+c*h*l);break;case Ua.YZX:t.set(c*s*u+a*h*l,a*h*u+c*s*l,a*s*l-c*h*u,a*s*u-c*h*l);break;case Ua.XZY:t.set(c*s*u-a*h*l,a*h*u-c*s*l,a*s*l+c*h*u,a*s*u+c*h*l);break;default:console.error("unknown euler order: "+o)}return t},e.toMatrix4=function(t){var e=t.elements,r=this,i=r.x,n=r.y,o=r.z,a=r.order,s=Math.cos(i*Or),u=Math.sin(i*Or),c=Math.cos(n*Or),h=Math.sin(n*Or),l=Math.cos(o*Or),f=Math.sin(o*Or);if(a===Ua.XYZ){var d=s*l,p=s*f,m=u*l,v=u*f;e[0]=c*l,e[4]=-c*f,e[8]=h,e[1]=p+m*h,e[5]=d-v*h,e[9]=-u*c,e[2]=v-d*h,e[6]=m+p*h,e[10]=s*c}else if(a===Ua.YXZ){var y=c*l,g=c*f,x=h*l,T=h*f;e[0]=y+T*u,e[4]=x*u-g,e[8]=s*h,e[1]=s*f,e[5]=s*l,e[9]=-u,e[2]=g*u-x,e[6]=T+y*u,e[10]=s*c}else if(a===Ua.ZXY){var _=c*l,E=c*f,b=h*l,A=h*f;e[0]=_-A*u,e[4]=-s*f,e[8]=b+E*u,e[1]=E+b*u,e[5]=s*l,e[9]=A-_*u,e[2]=-s*h,e[6]=u,e[10]=s*c}else if(a===Ua.ZYX){var S=s*l,R=s*f,C=u*l,M=u*f;e[0]=c*l,e[4]=C*h-R,e[8]=S*h+M,e[1]=c*f,e[5]=M*h+S,e[9]=R*h-C,e[2]=-h,e[6]=u*c,e[10]=s*c}else if(a===Ua.YZX){var O=s*c,P=s*h,I=u*c,w=u*h;e[0]=c*l,e[4]=w-O*f,e[8]=I*f+P,e[1]=f,e[5]=s*l,e[9]=-u*l,e[2]=-h*l,e[6]=P*f+I,e[10]=O-w*f}else if(a===Ua.XZY){var N=s*c,L=s*h,F=u*c,D=u*h;e[0]=c*l,e[4]=-f,e[8]=h*l,e[1]=N*f+D,e[5]=s*l,e[9]=L*f-F,e[2]=F*f-L,e[6]=u*l,e[10]=D*f+N}else console.error("toMatrix4: Invalid order "+a);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,t},t.fromRotationMatrix4=function(e,r){return void 0===r&&(r=t.DEFAULT_ORDER),(new t).setFromRotationMatrix4(e,r)},t.fromQuaternion=function(e,r){return void 0===r&&(r=t.DEFAULT_ORDER),(new t).setFromQuaternion(e,r)},t.fromVector3=function(e,r){return void 0===r&&(r=t.DEFAULT_ORDER),(new t).setFromVector3(e,r)},t.fromArray=function(e,r,i){return void 0===r&&(r=0),void 0===i&&(i=t.DEFAULT_ORDER),(new t).setFromArray(e,r,i)},t}();Ya.DEFAULT_ORDER=Ua.ZYX,Ya.tempQuat0=new $n,Ya.tempMat0=new Do;var Za=function(){function t(t,e,r,i,n,o,a,s,u){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=1),this.elements=[t,e,r,i,n,o,a,s,u]}var e=t.prototype;return e.set=function(t,e,r,i,n,o,a,s,u){var c=this.elements;return c[0]=t,c[3]=i,c[6]=a,c[1]=e,c[4]=n,c[7]=s,c[2]=r,c[5]=o,c[8]=u,this},e.setFromRowMajorData=function(t,e,r,i,n,o,a,s,u){var c=this.elements;return c[0]=t,c[3]=e,c[6]=r,c[1]=i,c[4]=n,c[7]=o,c[2]=a,c[5]=s,c[8]=u,this},e.setFromColumnVectors=function(t,e,r){return this.set(t.x,t.y,t.z,e.x,e.y,e.z,r.x,r.y,r.z)},e.setFromMatrix4=function(t){var e=t.elements;return this.set(e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10])},e.setFromArray=function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[e+r];return this},e.setFromQuaternion=function(t){var e=t.x,r=t.y,i=t.z,n=t.w,o=e+e,a=r+r,s=i+i,u=e*o,c=e*a,h=e*s,l=r*a,f=r*s,d=i*s,p=n*o,m=n*a,v=n*s,y=this.elements;return y[0]=1-(l+d),y[1]=c+v,y[2]=h-m,y[3]=c-v,y[4]=1-(u+d),y[5]=f+p,y[6]=h+m,y[7]=f-p,y[8]=1-(u+l),this},e.setZero=function(){for(var t=0;t<9;t++)this.elements[t]=0;return this},e.identity=function(){return this.set(1,0,0,0,1,0,0,0,1)},e.clone=function(){var e=this.elements;return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},e.copyFrom=function(t){return this.elements=[].concat(t.elements),this},e.getColumnVector=function(t,e){return e.set(this.elements[3*t],this.elements[3*t+1],this.elements[3*t+2])},e.scale=function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},e.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),i=this.elements,n=i[0],o=i[3],a=i[6],s=i[1],u=i[4],c=i[7];return i[0]=e*n+r*s,i[3]=e*o+r*u,i[6]=e*a+r*c,i[1]=-r*n+e*s,i[4]=-r*o+e*u,i[7]=-r*a+e*c,this},e.translate=function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},e.multiply=function(t){if("number"==typeof t){for(var e=0;e<9;e++)this.elements[e]*=t;return this}return this.multiplyMatrices(this,t)},e.premultiply=function(t){return this.multiplyMatrices(t,this)},e.multiplyMatrices=function(t,e){var r=t.elements,i=e.elements,n=this.elements,o=r[0],a=r[3],s=r[6],u=r[1],c=r[4],h=r[7],l=r[2],f=r[5],d=r[8],p=i[0],m=i[3],v=i[6],y=i[1],g=i[4],x=i[7],T=i[2],_=i[5],E=i[8];return n[0]=o*p+a*y+s*T,n[3]=o*m+a*g+s*_,n[6]=o*v+a*x+s*E,n[1]=u*p+c*y+h*T,n[4]=u*m+c*g+h*_,n[7]=u*v+c*x+h*E,n[2]=l*p+f*y+d*T,n[5]=l*m+f*g+d*_,n[8]=l*v+f*x+d*E,this},e.determinant=function(){var t=this.elements,e=t[0],r=t[3],i=t[6],n=t[1],o=t[4],a=t[7],s=t[2],u=t[5],c=t[8];return e*(o*c-u*a)+n*(u*i-r*c)+s*(r*a-o*i)},e.invert=function(){var t=this.elements,e=t[0],r=t[3],i=t[6],n=t[1],o=t[4],a=t[7],s=t[2],u=t[5],c=t[8],h=c*o-u*a,l=u*i-c*r,f=a*r-o*i,d=e*h+n*l+s*f;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);var p=1/d;return t[0]=h*p,t[1]=(s*a-c*n)*p,t[2]=(u*n-s*o)*p,t[3]=l*p,t[4]=(c*e-s*i)*p,t[5]=(s*r-u*e)*p,t[6]=f*p,t[7]=(n*i-a*e)*p,t[8]=(o*e-n*r)*p,this},e.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},e.transformPoint=function(t,e){var r=t.x,i=t.y,n=t.z,o=this.elements,a=null!=e?e:t;return a.x=o[0]*r+o[3]*i+o[6]*n,a.y=o[1]*r+o[4]*i+o[7]*n,a.z=o[2]*r+o[5]*i+o[8]*n,a},e.transformNormal=function(t,e){return this.transformPoint(t,e).normalize()},e.equals=function(t){for(var e=this.elements,r=t.elements,i=0;i<9;i++)if(!wr(e[i],r[i]))return!1;return!0},e.toArray=function(){return[].concat(this.elements)},e.fill=function(t,e){void 0===e&&(e=0);var r=this.elements;t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8]},t.fromIdentity=function(){return new t(1,0,0,0,1,0,0,0,1)},t.fromColumnVectors=function(e,r,i){return(new t).setFromColumnVectors(e,r,i)},t.fromMatrix4=function(e){return(new t).setFromMatrix4(e)},t.fromArray=function(e,r){return void 0===r&&(r=0),(new t).setFromArray(e,r)},t.fromQuaternion=function(e){return(new t).setFromQuaternion(e)},t.fromRowMajorData=function(e,r,i,n,o,a,s,u,c){return new t(e,n,s,r,o,u,i,a,c)},t}(),qa=function(){function t(t,e){void 0===t&&(t=Dr.ZERO),void 0===e&&(e=Dr.X),this.origin=new Dr,this.direction=new Dr,this.origin.copyFrom(t),this.direction.copyFrom(e).normalize()}var e=t.prototype;return e.set=function(t,e){return this.origin.copyFrom(t),this.direction.copyFrom(e).normalize(),this},e.clone=function(){return new t(this.origin,this.direction)},e.copyFrom=function(t){return this.set(t.origin,t.direction)},e.recast=function(e){return this.origin.copyFrom(this.at(e,t.tempVec0)),this},e.at=function(t,e){var r=e||new Dr;return r.copyFrom(this.origin),r.addScaledVector(this.direction,t)},e.equals=function(t){return this.origin.equals(t.origin)&&this.direction.equals(t.direction)},e.applyMatrix=function(t){return this.origin.applyProjectionMatrix(t),this.direction.applyNormalMatrix(t),this},e.intersectBox=function(t,e){var r,i,n,o,a,s,u=this.origin,c=u.x,h=u.y,l=u.z,f=this.direction,d=f.x,p=f.y,m=f.z,v=t.min,y=v.x,g=v.y,x=v.z,T=t.max,_=T.x,E=T.y,b=T.z,A=1/d,S=1/p,R=1/m;if(A>=0?(r=(y-c)*A,i=(_-c)*A):(r=(_-c)*A,i=(y-c)*A),S>=0?(n=(g-h)*S,o=(E-h)*S):(n=(E-h)*S,o=(g-h)*S),!(r>o||n>i||((n>r||r!=r)&&(r=n),(o<i||i!=i)&&(i=o),(n>r||r!=r)&&(r=n),(o<i||i!=i)&&(i=o),R>=0?(a=(x-l)*R,s=(b-l)*R):(a=(b-l)*R,s=(x-l)*R),r>s||a>i||((a>r||r!=r)&&(r=a),(s<i||i!=i)&&(i=s),i<0))))return r>=0?this.at(r,e):this.at(i,e)},e.intersectPlane=function(t,e){var r=t.normal,i=t.distance,n=r.dot(this.direction);if(0===n)return 0===r.dot(this.origin)+i?(e||new Dr).copyFrom(this.origin):void 0;var o=-(this.origin.dot(r)+i)/n;return o>=0?this.at(o,e):void 0},e.intersectSphere=function(e,r){var i=e.center,n=t.tempVec0.subtractVectors(i,this.origin),o=n.dot(this.direction),a=n.dot(n)-o*o,s=e.radius*e.radius;if(!(a>s)){var u=Math.sqrt(s-a),c=o-u,h=o+u;if(!(h<0))return c>=0?this.at(c,r):this.at(h,r)}},e.intersectTriangle=function(e,r,i){var n,o=e.p0,a=e.p1,s=e.p2,u=t.tempVec0.subtractVectors(a,o),c=t.tempVec1.subtractVectors(s,o),h=t.tempVec2.subtractVectors(this.origin,o),l=t.tempVec3.crossVectors(u,c),f=this.direction.dot(l);if(f>0){if(i)return;n=1}else{if(!(f<0))return;n=-1,f=-f}c.crossVectors(h,c);var d=n*this.direction.dot(c);if(!(d<0)){u.cross(h);var p=n*this.direction.dot(u);if(!(p<0||d+p>f)){var m=-n*h.dot(l);if(!(m<0))return this.at(m/f,r)}}},t}();qa.tempVec0=new Dr,qa.tempVec1=new Dr,qa.tempVec2=new Dr,qa.tempVec3=new Dr,exports.RenderPassAttachmentStorageType=void 0,exports.TextureStoreAction=void 0;var Ka=function(){function t(t,e){void 0===t&&(t=new Dr(1/0,1/0,1/0)),void 0===e&&(e=new Dr(-1/0,-1/0,-1/0)),this.min=t.clone(),this.max=e.clone()}var e=t.prototype;return e.set=function(t,e){return this.min.copyFrom(t),this.max.copyFrom(e),this},e.setFromArray=function(t){for(var e=Number(1/0),r=Number(1/0),i=Number(1/0),n=-1/0,o=-1/0,a=-1/0,s=0,u=t.length;s<u;s+=3){var c=t[s],h=t[s+1],l=t[s+2];c<e&&(e=c),h<r&&(r=h),l<i&&(i=l),c>n&&(n=c),h>o&&(o=h),l>a&&(a=l)}return this.min.set(e,r,i),this.max.set(n,o,a),this},e.setFromPoints=function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},e.setFromCenterAndSize=function(t,e){var r=e.clone().multiply(.5);return this.min.copyFrom(t).subtract(r),this.max.copyFrom(t).add(r),this},e.setFromObject=function(t){return this.makeEmpty(),this.expandByObject(t)},e.clone=function(){return(new t).copyFrom(this)},e.copyFrom=function(t){return this.min.copyFrom(t.min),this.max.copyFrom(t.max),this},e.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=Number(1/0),this.max.x=this.max.y=this.max.z=-1/0,this},e.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},e.getCenter=function(t){return void 0===t&&(t=new Dr),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiply(.5)},e.getSize=function(t){return void 0===t&&(t=new Dr),this.isEmpty()?t.set(0,0,0):t.subtractVectors(this.max,this.min)},e.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},e.expandByVector=function(t){return this.min.subtract(t),this.max.add(t),this},e.expandByScalar=function(t){return this.min.add(-t),this.max.add(t),this},e.expandByBox=function(t){return this.min.min(t.min),this.max.max(t.max),this},e.expandByObject=function(e){e.updateWorldMatrix(!1,!1);var r=e.geometry;if(void 0!==r){null===r.boundingBox&&r.computeBoundingBox();var i=new t;i.copyFrom(r.boundingBox),i.applyMatrix4(e.matrixWorld),this.union(i)}for(var n=e.children,o=0,a=n.length;o<a;o++)this.expandByObject(n[o]);return this},e.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},e.containsBox=function(t){return this.min.x<=t.min.x&&this.max.x>=t.max.x&&this.min.y<=t.min.y&&this.max.y>=t.max.y&&this.min.z<=t.min.z&&this.max.z>=t.max.z},e.getParameter=function(t,e){return void 0===e&&(e=new Dr),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},e.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},e.intersectsSphere=function(t){var e=new Dr;return this.clampPoint(t.center,e),e.distanceSquared(t.center)<=t.radius*t.radius},e.clampPoint=function(t,e){return void 0===e&&(e=new Dr),e.copyFrom(t).clamp(this.min,this.max)},e.distanceToPoint=function(t){return t.clone().clamp(this.min,this.max).subtract(t).length()},e.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},e.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},e.applyMatrix4=function(t,e){if(void 0===e&&(e=new Dr),this.isEmpty())return this;var r=this.getOBBPoints(t,e);return this.setFromPoints(r),this},e.getOBBPoints=function(t,e){if(void 0===e&&(e=new Dr),this.isEmpty())return[];var r=[];return r[0]=new Dr(this.min.x,this.min.y,this.min.z),r[1]=new Dr(this.min.x,this.min.y,this.max.z),r[2]=new Dr(this.min.x,this.max.y,this.min.z),r[3]=new Dr(this.min.x,this.max.y,this.max.z),r[4]=new Dr(this.max.x,this.min.y,this.min.z),r[5]=new Dr(this.max.x,this.min.y,this.max.z),r[6]=new Dr(this.max.x,this.max.y,this.min.z),r[7]=new Dr(this.max.x,this.max.y,this.max.z),r.forEach((function(r){r.subtract(e),r.applyMatrix(t),r.add(e)})),r},e.getBoundingSphere=function(t){this.getCenter(t.center);var e=new Dr;return t.radius=.5*this.getSize(e).length(),t},e.translate=function(t){return this.min.add(t),this.max.add(t),this},e.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},t}(),Qa=function(){function t(t,e){void 0===t&&(t=Dr.ZERO),void 0===e&&(e=-1),this.center=t.clone(),this.radius=e}var e=t.prototype;return e.set=function(t,e){return this.center.copyFrom(t),this.radius=e,this},e.setFromPoints=function(t,e){var r=this.center;if(void 0!==e){r.copyFrom(e);for(var i=0,n=0;n<t.length;n++)i=Math.max(i,r.distanceSquared(t[n]));this.radius=Math.sqrt(i)}else{var o=(new Ka).setFromPoints(t);o.getCenter(r),this.radius=o.getSize().length()/2}return this},e.copyFrom=function(t){return this.center.copyFrom(t.center),this.radius=t.radius,this},e.isEmpty=function(){return this.radius<0},e.makeEmpty=function(){return this.center.set(0,0,0),this.radius=-1,this},e.containsPoint=function(t){return t.distanceSquared(this.center)<=this.radius*this.radius},e.distanceToPoint=function(t){return t.distance(this.center)-this.radius},e.intersectsSphere=function(t){var e=this.radius+t.radius;return t.center.distanceSquared(this.center)<=e*e},e.intersectsBox=function(t){return t.intersectsSphere(this)},e.clampPoint=function(t,e){var r=this.center.distanceSquared(t);return void 0===e&&(e=new Dr),e.copyFrom(t),r>this.radius*this.radius&&(e.subtract(this.center).normalize(),e.multiply(this.radius).add(this.center)),e},e.getBoundingBox=function(t){return void 0===t&&(t=new Ka),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},e.applyMatrix4=function(t){var e=t.elements,r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10],o=Math.sqrt(Math.max(r,i,n));return this.center.applyMatrix(t),this.radius=this.radius*o,this},e.translate=function(t){return this.center.add(t),this},e.expandByPoint=function(t){var e=(new Dr).subtractVectors(t,this.center),r=e.lengthSquared();if(r>this.radius*this.radius){var i=Math.sqrt(r),n=.5*(i-this.radius);this.center.add(e.multiply(n/i)),this.radius+=n}return this},e.union=function(t){var e=new Dr,r=new Dr;return r.subtractVectors(t.center,this.center).normalize().multiply(t.radius),this.expandByPoint(e.copyFrom(t.center).add(r)),this.expandByPoint(e.copyFrom(t.center).subtract(r)),this},e.intersect=function(t){var e=(new Dr).subtractVectors(this.center,t.center),r=e.length();return r>this.radius+t.radius?this.makeEmpty():(this.center=this.center.add(e.normalize().multiply(r/2)),this.radius=this.radius+t.radius-r,this)},e.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius},e.clone=function(){return(new t).copyFrom(this)},t}(),Ja=Object.freeze({__proto__:null,get EulerOrder(){return Ua},Euler:Ya,Quaternion:$n,Vector2:Fr,Vector3:Dr,Vector4:Vr,Matrix3:Za,Matrix4:Do,Ray:qa,PI2:Mr,DEG2RAD:Or,RAD2DEG:Pr,NumberEpsilon:Ir,isZero:function(t){return isNaN(t)||Math.abs(t)<Ir},isEqual:wr,damp:function(t,e,r,i){return Nr(t,e,1-Math.exp(-r*i))},lerp:Nr,degToRad:function(t){return t*Or},radToDeg:function(t){return t*Pr},clamp:Lr,Color:Br,Box3:Ka,Sphere:Qa}),$a=1,ts=function(t){function e(e,r){var i;if((i=t.call(this,e)||this).destroyed=!1,i.visible=!0,r){var n=r.material,o=r.geometry,a=r.name,s=void 0===a?"<unnamed>":a,u=r.priority,c=void 0===u?0:u,h=r.worldMatrix,l=void 0===h?Do.fromIdentity():h;i.id="Mesh"+$a++,i.name=s,i.geometry=o,i.material=n,i.priority=c,i.worldMatrix=l}else i.id="Mesh"+$a++,i.name="<unnamed>",i.worldMatrix=Do.fromIdentity(),i._priority=0;return i}ji(e,t);var r=e.prototype;return r.setVisible=function(t){this.visible=t},r.getVisible=function(){return this.visible},r.render=function(t){this.isDestroyed||this.getVisible()&&t.drawGeometry(this.geometry,this.worldMatrix,this.material)},r.firstGeometry=function(){return this.geometry},r.setMaterial=function(t,e){e!==exports.DestroyOptions.keep&&this.material.dispose(),this.material=t},r.restore=function(){},r.dispose=function(e){this.destroyed||((null==e?void 0:e.geometries)!==exports.DestroyOptions.keep&&this.geometry.dispose(),(null==e?void 0:e.material)!==exports.DestroyOptions.keep&&this.material.dispose(),this.destroyed=!0,void 0!==this.engine&&this.engine.removeMesh(this),t.prototype.dispose.call(this))},Io(e,[{key:"isDestroyed",get:function(){return this.destroyed}}]),e}(Lo);!function(t){t[t.none=0]="none",t[t.color=1]="color",t[t.stencil_8_opaque=2]="stencil_8_opaque",t[t.depth_16_opaque=3]="depth_16_opaque",t[t.depth_stencil_opaque=4]="depth_stencil_opaque",t[t.depth_16_texture=5]="depth_16_texture",t[t.depth_24_stencil_8_texture=6]="depth_24_stencil_8_texture"}(exports.RenderPassAttachmentStorageType||(exports.RenderPassAttachmentStorageType={})),function(t){t[t.store=0]="store",t[t.clear=2]="clear"}(exports.TextureStoreAction||(exports.TextureStoreAction={})),exports.RenderPassDestroyAttachmentType=void 0;var es=function(){function t(t,e){if(this.destroyed=!1,e){var r=e.texture,i=e.size;if(mr(r,ya))this.texture=r,this.externalTexture=!0;else if(r){var n=r.wrapT,o=r.wrapS,a=r.minFilter,s=r.magFilter,u=r.internalFormat,c=r.format,h=void 0===c?ko.RGBA:c,l=r.type,f=void 0===l?ko.UNSIGNED_BYTE:l;this.externalTexture=!1,this.textureOptions={size:i,format:h,type:f,internalFormat:u||h,wrapT:n,wrapS:o,minFilter:a,magFilter:s,name:e.name},this.texture=ya.create(t,qn({},this.textureOptions,{sourceType:exports.TextureSourceType.framebuffer,data:{width:i[0],height:i[1]}}))}}}return t.prototype.dispose=function(){this.destroyed||(this.texture.dispose(),this.destroyed=!0)},Io(t,[{key:"isDestroyed",get:function(){return this.destroyed}},{key:"storageType",get:function(){return 1}},{key:"size",get:function(){var t=this.texture;return t?[t.getWidth(),t.getHeight()]:[0,0]}},{key:"width",get:function(){return this.texture.getWidth()||0}},{key:"height",get:function(){return this.texture.getHeight()||0}}]),t}();!function(t){t[t.force=0]="force",t[t.keep=1]="keep",t[t.keepExternal=2]="keepExternal",t[t.destroy=0]="destroy"}(exports.RenderPassDestroyAttachmentType||(exports.RenderPassDestroyAttachmentType={}));var rs=1,is=function(){function t(t,e){this.attachments=[],this.destroyed=!1,this.initialized=!1;var r=e.name,i=void 0===r?"RenderPass_"+rs++:r,n=e.clearAction,o=e.semantics,a=e.depthStencilAttachment,s=e.storeAction,u=e.priority,c=void 0===u?0:u,h=e.meshOrder,l=void 0===h?exports.OrderType.ascending:h,f=e.meshes,d=void 0===f?[]:f,p=e.delegate,m=void 0===p?{}:p;this.name=i,this.renderer=t,this.priority=c,this.meshOrder=l,this.meshes=ei(d.slice(),this.meshOrder),this.depthStencilType=(null==a?void 0:a.storageType)||0,this.clearAction=qn({},n),this.storeAction=qn({colorAction:0,depthAction:0,stencilAction:0},s),this.semantics=new Xa(o),this.options=e,this.delegate=m,this.setViewportOptions(e)}var e=t.prototype;return e.addMesh=function(t){ri(this.meshes,t,this.meshOrder)},e.removeMesh=function(t){Rr(this.meshes,t)},e.setMeshes=function(t){var e;return this.meshes.length=0,(e=this.meshes).splice.apply(e,[].concat([0,0],t)),ei(this.meshes,this.meshOrder),this.meshes},e.getInitAttachments=function(){return this.attachments.length>0?this.attachments:this.options.attachments},e.configure=function(t){if(this.framebuffer)t.setFramebuffer(this.framebuffer);else{var e=this.getViewport(),r=e[0],i=e[1],n=e[2],o=e[3];t.setViewport(r,i,n,o)}},e.execute=function(t){t.clear(this.clearAction),t.renderMeshes(this.meshes),t.clear(this.storeAction)},e.frameCleanup=function(t){},e.resetColorAttachments=function(t){var e=this;if(t.length||this.resetAttachments({attachments:[]}),this.attachments.length){var r=t.map((function(t){return t.updateSource({sourceType:exports.TextureSourceType.framebuffer}),new es(e.renderer.engine,{texture:t})}));this.attachments.forEach((function(t){return!t.externalTexture&&t.dispose()})),this.attachments=r,this.framebuffer&&(this.framebuffer.bind(),this.framebuffer.resetColorTextures(t.map((function(t){return t}))))}else this.resetAttachments({attachments:t.map((function(t){return{texture:t}}))})},e.resetAttachments=function(t){this.options=t,this.setViewportOptions(t),this.renderer&&this._resetAttachments()},e.setViewportOptions=function(t){if(t.viewport){if(this.isCustomViewport=!0,this.viewportScale=1,this.customViewport=t.viewport.slice(0,4),this.framebuffer){var e=this.customViewport;this.framebuffer.isCustomViewport=!1,this.framebuffer.resize(e[0],e[1],e[2],e[3])}}else this.isCustomViewport=!1,this.viewportScale=t.viewportScale||1,this.framebuffer&&(this.framebuffer.isCustomViewport=!0,this.framebuffer.viewportScale=this.viewportScale)},e._resetAttachments=function(){var t,e,r=this,i=this.renderer,n=this.options;this.attachments.length&&(this.attachments.forEach((function(t){return!t.externalTexture&&t.dispose()})),this.attachments.length=0,null==(e=this.framebuffer)||e.dispose({depthStencilAttachment:2}),this.framebuffer=null);var o=this.viewportScale,a=this.isCustomViewport?this.customViewport:[0,0,i.getWidth()*o,i.getHeight()*o],s=[a[2],a[3]],u=this.name;if(null==(t=n.attachments)?void 0:t.length){var c=n.attachments.map((function(t,e){var i;return new es(r.renderer.engine,qn({size:s,name:(null==(i=t.texture)?void 0:i.name)||u+"##color_"+e},t))}));this.attachments=c;var h=Ls.create({storeAction:this.storeAction,name:u,viewport:a,viewportScale:this.viewportScale,isCustomViewport:this.isCustomViewport,attachments:c.map((function(t){return t.texture})),depthStencilAttachment:n.depthStencilAttachment||{storageType:0}},i);h.bind(),h.unbind(),this.framebuffer=h}else this.attachments.length=0},e.getViewport=function(){var t,e=(null==(t=this.framebuffer)?void 0:t.viewport)||this.customViewport;if(e)return e;var r=this.renderer,i=this.viewportScale;return r?[0,0,r.getWidth()*i,r.getHeight()*i]:[0,0,0,0]},e.getDepthAttachment=function(){var t=this.framebuffer;if(t){var e=t.getDepthTexture(),r=e?this.getDepthTexture(e,t.externalStorage):void 0;return{storageType:t.depthStencilStorageType,storage:t.depthStorage,texture:r}}},e.getStencilAttachment=function(){var t=this.framebuffer;if(t){var e=t.getStencilTexture(),r=e?this.getDepthTexture(e,t.externalStorage):void 0;return{storageType:t.depthStencilStorageType,storage:t.stencilStorage,texture:r}}},e.getDepthTexture=function(t,e){if(!this.depthTexture){var r,i=null==(r=this.options.depthStencilAttachment)?void 0:r.texture,n=t===i?i:t;return e||(this.depthTexture=n),n}return this.depthTexture},e.getStencilTexture=function(t,e){if(!this.stencilTexture){var r,i=null==(r=this.options.depthStencilAttachment)?void 0:r.texture,n=t===i?i:t;return e||(this.stencilTexture=n),n}return this.stencilTexture},e.initialize=function(t){return this.initialized||(this._resetAttachments(),this.initialized=!0),this},e.dispose=function(t){if(!this.destroyed){var e=(null==t?void 0:t.meshes)||void 0;e!==exports.DestroyOptions.keep&&this.meshes.forEach((function(t){t.dispose(e)})),this.meshes.length=0;var r=(null==t?void 0:t.colorAttachment)?t.colorAttachment:0;this.attachments.forEach((function(t){t.externalTexture&&2===r||1===r||t.dispose()})),this.attachments.length=0,(null==t?void 0:t.semantics)!==exports.DestroyOptions.keep&&this.semantics.dispose(),this.destroyed=!0;var i,n,o=(null==t?void 0:t.depthStencilAttachment)?t.depthStencilAttachment:0,a=this.framebuffer;a&&(a.dispose({depthStencilAttachment:o}),a.externalStorage&&2===o||1===o||(null==(i=this.stencilTexture)||i.dispose(),null==(n=this.depthTexture)||n.dispose())),this.options=this.renderer=null,this.initialize=gi}},Io(t,[{key:"isDestroyed",get:function(){return this.destroyed}},{key:"viewport",get:function(){return this.getViewport()}},{key:"stencilAttachment",get:function(){return this.getStencilAttachment()}},{key:"depthAttachment",get:function(){return this.getDepthAttachment()}}]),t}(),ns="precision highp float;attribute vec2 aUV;attribute vec3 aPos;varying vec2 vTexCoord;varying vec3 vParams;varying vec4 vColor;uniform vec2 _Size;uniform vec3 _Scale;uniform vec4 _Color;uniform vec4 _TexParams;uniform vec4 _TexOffset;uniform mat4 effects_MatrixVP;uniform mat4 effects_ObjectToWorld;uniform mat4 effects_MatrixV;void main(){vec4 texParams=_TexParams;vTexCoord=vec2(aUV.xy*_TexOffset.zw+_TexOffset.xy);vColor=_Color;vParams=vec3(texParams.w,texParams.y,texParams.x);if(texParams.z==1.0){vec4 pos=vec4(aPos.xy*_Size,aPos.z,1.0);gl_Position=effects_MatrixVP*effects_ObjectToWorld*pos;}else{mat4 view=effects_MatrixV;vec3 camRight=vec3(view[0][0],view[1][0],view[2][0]);vec3 camUp=vec3(view[0][1],view[1][1],view[2][1]);vec3 worldPosition=vec3(effects_ObjectToWorld*vec4(0.0,0.0,0.0,1.0));vec3 vertexPosition=worldPosition+camRight*aPos.x*_Size.x*_Scale.x+camUp*aPos.y*_Size.y*_Scale.y;gl_Position=effects_MatrixVP*vec4(vertexPosition,1.0);}}",os="precision highp float;varying vec4 vColor;varying vec2 vTexCoord;varying vec3 vParams;uniform sampler2D _MainTex;vec4 blendColor(vec4 color,vec4 vc,float mode){vec4 ret=color*vc;float alpha=ret.a;if(mode==1.){ret.rgb*=alpha;}else if(mode==2.){ret.rgb*=alpha;ret.a=dot(ret.rgb,vec3(0.33333333));}else if(mode==3.){alpha=color.r*alpha;ret=vec4(vc.rgb*alpha,alpha);}return ret;}void main(){vec4 color=vec4(0.);\n#ifdef TRANSPARENT_VIDEO\nfloat halfX=vTexCoord.x*0.5;vec2 uv_rgb=vec2(halfX,vTexCoord.y);vec2 uv_alpha=vec2(halfX+0.5,vTexCoord.y);vec3 rgb=texture2D(_MainTex,uv_rgb).rgb;float alpha=max(texture2D(_MainTex,uv_alpha).r,1e-5);vec4 texColor=vec4(rgb/alpha,alpha);\n#else\nvec4 texColor=texture2D(_MainTex,vTexCoord.xy);\n#endif\ncolor=blendColor(texColor,vColor,floor(0.5+vParams.y));\n#ifdef ALPHA_CLIP\nif(color.a<0.04){discard;}\n#endif\ncolor.a=clamp(color.a,0.0,1.0);gl_FragColor=color;}",as="#version 100\nprecision mediump float;\n#define PATICLE_SHADER 1\nvarying float vLife;varying vec2 vTexCoord;varying vec4 vColor;uniform vec3 emissionColor;uniform float emissionIntensity;uniform sampler2D uMaskTex;uniform vec4 uColorParams;uniform vec2 uTexOffset;\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\n#ifdef USE_SPRITE\nvarying vec4 vTexCoordBlend;\n#endif\nvarying float vSeed;\n#ifdef PREVIEW_BORDER\nuniform vec4 uPreviewColor;\n#endif\n#ifdef USE_SPRITE\nvec4 getTextureColor(sampler2D tex,vec2 texCoord){if(vTexCoordBlend.w>0.){return mix(texture2D(tex,texCoord),texture2D(tex,vTexCoordBlend.xy+texCoord),vTexCoordBlend.z);}return texture2D(tex,texCoord);}\n#else\n#define getTextureColor texture2D\n#endif\n#ifndef WEBGL2\n#define round(a) floor(0.5+a)\n#endif\nvec4 blendColor(vec4 color,vec4 vc,float mode){vec4 ret=color*vc;float alpha=ret.a;if(mode==1.){ret.rgb*=alpha;}else if(mode==2.){ret.rgb*=alpha;ret.a=dot(ret.rgb,vec3(0.33333333));}else if(mode==3.){alpha=color.r*alpha;ret=vec4(vc.rgb*alpha,alpha);}return ret;}\n#ifdef PREVIEW_BORDER\nvoid main(){gl_FragColor=uPreviewColor;}\n#else\nvoid main(){vec4 color=vec4(1.0);vec4 tempColor=vColor;vec2 texOffset=uTexOffset;if(vLife<0.){discard;}if(uColorParams.x>0.0){color=getTextureColor(uMaskTex,vTexCoord);}\n#ifdef COLOR_OVER_LIFETIME\n#ifndef ENABLE_VERTEX_TEXTURE\ntempColor*=texture2D(uColorOverLifetime,vec2(vLife,0.));\n#endif\n#endif\ncolor=blendColor(color,tempColor,round(uColorParams.y));if(color.a<=0.01&&uColorParams.w>0.){float _at=texture2D(uMaskTex,vTexCoord+texOffset).a+texture2D(uMaskTex,vTexCoord+texOffset*-1.).a;if(_at<=0.02){discard;}}vec3 emission=emissionColor*pow(2.0,emissionIntensity);color=vec4(pow(pow(color.rgb,vec3(2.2))+emission,vec3(1.0/2.2)),color.a);gl_FragColor=color;}\n#endif\n",ss="#version 100\nprecision mediump float;\n#define SHADER_VERTEX 1\n#define PATICLE_SHADER 1\n#ifdef SHADER_VERTEX\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n#define CURVE_VALUE_ARRAY uVCurveValues\n#define CURVE_VALUE_COUNT VERT_CURVE_VALUE_COUNT\n#define FRAG_CURVE_VALUE_COUNT 0\n#else\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n#define CURVE_VALUE_ARRAY uFCurveValues\n#define CURVE_VALUE_COUNT FRAG_CURVE_VALUE_COUNT\n#define VERT_CURVE_VALUE_COUNT 0\n#endif\n#if CURVE_VALUE_COUNT > 0\n#if LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n#endif\n#else\n#define lookup_curve(i) vec4(0.)\n#endif\n#ifdef WEBGL2\n#define ITR_END (count + 1)\n#else\n#define ITR_END MAX_C\n#endif\n#define NONE_CONST_INDEX 1\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#endif\n#ifdef SHADER_VERTEX\n#define MAX_C VERT_MAX_KEY_FRAME_COUNT\n#else\n#define MAX_C FRAG_MAX_KEY_FRAME_COUNT\n#endif\nmat4 cubicBezierMatrix=mat4(1.0,-3.0,3.0,-1.0,0.0,3.0,-6.0,3.0,0.0,0.0,3.0,-3.0,0.0,0.0,0.0,1.0);float cubicBezier(float t,float y1,float y2,float y3,float y4){vec4 tVec=vec4(1.0,t,t*t,t*t*t);vec4 yVec=vec4(y1,y2,y3,y4);vec4 result=tVec*cubicBezierMatrix*yVec;return result.x+result.y+result.z+result.w;}float binarySearchT(float x,float x1,float x2,float x3,float x4){float left=0.0;float right=1.0;float mid=0.0;float computedX;for(int i=0;i<8;i++){mid=(left+right)*0.5;computedX=cubicBezier(mid,x1,x2,x3,x4);if(abs(computedX-x)<0.0001){break;}else if(computedX>x){right=mid;}else{left=mid;}}return mid;}float valueFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);for(int i=0;i<ITR_END;i+=2){if(i>=count){break;}vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return k0.y;}if(i==int(frameCount-2.)&&time>=k1.x){return k1.y;}if(time>=k0.x&&time<=k1.x){float t=(time-k0.x)/(k1.x-k0.x);float nt=binarySearchT(time,k0.x,k0.z,k1.z,k1.x);return cubicBezier(nt,k0.y,k0.w,k1.w,k1.y);}}}float evaluteLineSeg(float t,vec2 p0,vec2 p1){return p0.y+(p1.y-p0.y)*(t-p0.x)/(p1.x-p0.x);}float valueFromLineSegs(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);int end=start+count;for(int i=0;i<ITR_END;i++){if(i>count){return lookup_curve(i).w;}vec4 seg=lookup_curve(i+start);vec2 p0=seg.xy;vec2 p1=seg.zw;if(time>=p0.x&&time<=p1.x){return evaluteLineSeg(time,p0,p1);}vec2 p2=lookup_curve(i+start+1).xy;if(time>p1.x&&time<=p2.x){return evaluteLineSeg(time,p1,p2);}}return lookup_curve(0).y;}float getValueFromTime(float time,vec4 value){float type=value.x;if(type==0.){return value.y;}if(type==1.){return mix(value.y,value.z,time/value.w);}if(type==3.){return valueFromLineSegs(time,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed);}if(type==5.){return valueFromBezierCurveFrames(time,value.z,value.w);}return 0.;}float calculateMovement(float t,vec2 p1,vec2 p2,vec2 p3,vec2 p4){float movement=0.0;float h=(t-p1.x)*0.05;for(int i=0;i<=20;i++){float t=float(i)*h;float nt=binarySearchT(t,p1.x,p2.x,p3.x,p4.x);float y=cubicBezier(nt,p1.y,p2.y,p3.y,p4.y);float weight=(i==0||i==20)? 1.0 :(mod(float(i),2.)!=0.)? 4.0 : 2.0;movement+=weight*y;}movement*=h/3.;return movement;}float integrateFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i+=2){vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return ret;}vec2 p1=vec2(k0.x,k0.y);vec2 p2=vec2(k0.z,k0.w);vec2 p3=vec2(k1.z,k1.w);vec2 p4=vec2(k1.x,k1.y);if(time>=k1.x){ret+=calculateMovement(k1.x,p1,p2,p3,p4);}if(time>=k0.x&&time<k1.x){return ret+calculateMovement(time,p1,p2,p3,p4);}}return ret;}float integrateByTimeLineSeg(float t,vec2 p0,vec2 p1){float t0=p0.x;float t1=p1.x;float y0=p0.y;float y1=p1.y;vec4 tSqr=vec4(t,t,t0,t0);tSqr=tSqr*tSqr;vec4 a=vec4(2.*t,3.,-t0,3.)*tSqr;float t1y0=t1*y0;vec4 b=vec4(y0-y1,t0*y1-t1y0,2.*y0+y1,t1y0);float r=dot(a,b);return r/(t0-t1)*0.16666667;}float integrateLineSeg(float time,vec2 p0,vec2 p1){float h=time-p0.x;float y0=p0.y;return(y0+y0+(p1.y-y0)*h/(p1.x-p0.x))*h/2.;}float integrateFromLineSeg(float time,float frameStart,float frameCount){if(time==0.){return 0.;}int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i++){if(i>count){return ret;}vec4 ks=lookup_curve(i+start);vec2 k0=ks.xy;vec2 k1=ks.zw;if(time>k0.x&&time<=k1.x){return ret+integrateLineSeg(time,k0,k1);}ret+=integrateLineSeg(k1.x,k0,k1);vec2 k2=lookup_curve(i+start+1).xy;if(time>k1.x&&time<=k2.x){return ret+integrateLineSeg(time,k1,k2);}ret+=integrateLineSeg(k2.x,k1,k2);}return ret;}float integrateByTimeFromLineSeg(float time,float frameStart,float frameCount){if(time==0.){return 0.;}int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i++){if(i>count){return ret;}vec4 ks=lookup_curve(i+start);vec2 k0=ks.xy;vec2 k1=ks.zw;if(time>k0.x&&time<=k1.x){return ret+integrateByTimeLineSeg(time,k0,k1);}ret+=integrateByTimeLineSeg(k1.x,k0,k1);vec2 k2=lookup_curve(i+start+1).xy;if(time>k1.x&&time<=k2.x){return ret+integrateByTimeLineSeg(time,k1,k2);}ret+=integrateByTimeLineSeg(k2.x,k1,k2);}return ret;}float getIntegrateFromTime0(float t1,vec4 value){float type=value.x;if(type==0.){return value.y*t1;}if(type==1.){vec2 p0=vec2(0.,value.y);vec2 p1=vec2(value.w,value.z);return integrateLineSeg(t1,p0,p1);}if(type==3.){return integrateFromLineSeg(t1,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed)*t1;}if(type==5.){return integrateFromBezierCurveFrames(t1,value.z,value.w);}return 0.;}float getIntegrateByTimeFromTime(float t0,float t1,vec4 value){float type=value.x;if(type==0.){return value.y*(t1*t1-t0*t0)/2.;}else if(type==1.){vec2 p0=vec2(0.,value.y);vec2 p1=vec2(value.w,value.z);return integrateByTimeLineSeg(t1,p0,p1)-integrateByTimeLineSeg(t0,p0,p1);}if(type==3.){return integrateByTimeFromLineSeg(t1,value.y,value.z)-integrateByTimeFromLineSeg(t0,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed)*(t1*t1-t0*t0)/2.;}if(type==5.){return integrateFromBezierCurveFrames(t1,value.z,value.w)-integrateFromBezierCurveFrames(t0,value.z,value.w);}return 0.;}const float d2r=3.141592653589793/180.;attribute vec3 aPos;attribute vec4 aOffset;attribute vec4 aColor;attribute vec3 aDirX;attribute vec3 aDirY;attribute vec3 aTranslation;attribute vec3 aRotation0;attribute vec3 aRotation1;attribute vec3 aRotation2;attribute vec3 aLinearMove;\n#ifdef USE_SPRITE\nattribute vec3 aSprite;uniform vec4 uSprite;struct UVDetail{vec2 uv0;vec3 uv1;};UVDetail getSpriteUV(vec2 uv,float lifeTime);varying vec4 vTexCoordBlend;\n#endif\n#ifdef FINAL_TARGET\nuniform vec3 uFinalTarget;uniform vec4 uForceCurve;\n#endif\nuniform mat4 effects_ObjectToWorld;uniform mat4 effects_MatrixV;uniform mat4 effects_MatrixVP;uniform vec4 uParams;uniform vec4 uOpacityOverLifetimeValue;\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\nuniform vec4 uOrbXByLifetimeValue;uniform vec4 uOrbYByLifetimeValue;uniform vec4 uOrbZByLifetimeValue;uniform vec3 uOrbCenter;uniform vec4 uSizeByLifetimeValue;\n#ifdef SIZE_Y_BY_LIFE\nuniform vec4 uSizeYByLifetimeValue;\n#endif\nvarying float vLife;varying vec4 vColor;varying vec2 vTexCoord;vec3 calOrbitalMov(float _life,float _dur){vec3 orb=vec3(0.0);\n#ifdef AS_ORBITAL_MOVEMENT\n#define FUNC(a) getValueFromTime(_life,a)\n#else\n#define FUNC(a) getIntegrateFromTime0(_life,a) * _dur\n#endif\n#if ORB_VEL_X\norb.x=FUNC(uOrbXByLifetimeValue);\n#endif\n#if ORB_VEL_Y\norb.y=FUNC(uOrbYByLifetimeValue);\n#endif\n#if ORB_VEL_Z\norb.z=FUNC(uOrbZByLifetimeValue);\n#endif\n#undef FUNC\nreturn orb;}mat3 mat3FromRotation(vec3 rotation){vec3 sinR=sin(rotation*d2r);vec3 cosR=cos(rotation*d2r);return mat3(cosR.z,-sinR.z,0.,sinR.z,cosR.z,0.,0.,0.,1.)*mat3(cosR.y,0.,sinR.y,0.,1.,0.,-sinR.y,0,cosR.y)*mat3(1.,0.,0.,0,cosR.x,-sinR.x,0.,sinR.x,cosR.x);}\n#ifdef USE_SPRITE\nUVDetail getSpriteUV(vec2 uv,float lifeTime){float t=fract(clamp((lifeTime-aSprite.x)/aSprite.y,0.0,1.)*aSprite.z);float frame=uSprite.z*t;float frameIndex=max(ceil(frame)-1.,0.);float row=floor((frameIndex+0.1)/uSprite.x);float col=frameIndex-row*uSprite.x;vec2 retUV=(vec2(col,row)+uv)/uSprite.xy;UVDetail ret;if(uSprite.w>0.){float blend=frame-frameIndex;float frameIndex1=min(ceil(frame),uSprite.z-1.);float row1=floor((frameIndex1+0.1)/uSprite.x);float col1=frameIndex1-row1*uSprite.x;vec2 coord=(vec2(col1,row1)+uv)/uSprite.xy-retUV;ret.uv1=vec3(coord.x,1.-coord.y,blend);}ret.uv0=vec2(retUV.x,1.-retUV.y);return ret;}\n#endif\nvoid main(){float time=uParams.x-aOffset.z;float dur=aOffset.w;if(time<0.||time>dur){gl_Position=vec4(-3.,-3.,-3.,1.);}else{float life=clamp(time/dur,0.0,1.0);vLife=life;\n#ifdef USE_SPRITE\nUVDetail uvD=getSpriteUV(aOffset.xy,time);vTexCoord=uvD.uv0;vTexCoordBlend=vec4(uvD.uv1,uSprite.w);\n#else\nvTexCoord=aOffset.xy;\n#endif\nvColor=aColor;\n#ifdef COLOR_OVER_LIFETIME\n#ifdef ENABLE_VERTEX_TEXTURE\nvColor*=texture2D(uColorOverLifetime,vec2(life,0.));\n#endif\n#endif\nvColor.a*=clamp(getValueFromTime(life,uOpacityOverLifetimeValue),0.,1.);vec3 size=vec3(vec2(getValueFromTime(life,uSizeByLifetimeValue)),1.0);\n#ifdef SIZE_Y_BY_LIFE\nsize.y=getValueFromTime(life,uSizeYByLifetimeValue);\n#endif\nmat3 aRotation=mat3(aRotation0,aRotation1,aRotation2);vec3 point=aRotation*(aDirX*size.x+aDirY*size.y);vec3 _pos=aPos+aTranslation;\n#if ORB_VEL_X + ORB_VEL_Y + ORB_VEL_Z\n_pos=mat3FromRotation(calOrbitalMov(life,dur))*(_pos-uOrbCenter);_pos+=uOrbCenter;\n#endif\n_pos.xyz+=aLinearMove;\n#ifdef FINAL_TARGET\nfloat force=getValueFromTime(life,uForceCurve);vec4 pos=vec4(mix(_pos,uFinalTarget,force),1.);\n#else\nvec4 pos=vec4(_pos,1.0);\n#endif\n#if RENDER_MODE == 1\npos.xyz+=point;pos=effects_ObjectToWorld*pos;\n#elif RENDER_MODE == 3\npos=effects_ObjectToWorld*pos;pos.xyz+=effects_MatrixV[0].xyz*point.x+effects_MatrixV[2].xyz*point.y;\n#elif RENDER_MODE == 2\npos=effects_ObjectToWorld*pos;pos.xy+=point.xy;\n#elif RENDER_MODE == 0\npos=effects_ObjectToWorld*pos;pos.xyz+=effects_MatrixV[0].xyz*point.x+effects_MatrixV[1].xyz*point.y;\n#endif\ngl_Position=effects_MatrixVP*pos;vSeed=aSeed;gl_PointSize=6.0;}}",us="#version 100\nprecision mediump float;\n#define SHADER_VERTEX 1\n#ifdef SHADER_VERTEX\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n#define CURVE_VALUE_ARRAY uVCurveValues\n#define CURVE_VALUE_COUNT VERT_CURVE_VALUE_COUNT\n#define FRAG_CURVE_VALUE_COUNT 0\n#else\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n#define CURVE_VALUE_ARRAY uFCurveValues\n#define CURVE_VALUE_COUNT FRAG_CURVE_VALUE_COUNT\n#define VERT_CURVE_VALUE_COUNT 0\n#endif\n#if CURVE_VALUE_COUNT > 0\n#if LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n#endif\n#else\n#define lookup_curve(i) vec4(0.)\n#endif\n#ifdef WEBGL2\n#define ITR_END (count + 1)\n#else\n#define ITR_END MAX_C\n#endif\n#define NONE_CONST_INDEX 1\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#endif\n#ifdef SHADER_VERTEX\n#define MAX_C VERT_MAX_KEY_FRAME_COUNT\n#else\n#define MAX_C FRAG_MAX_KEY_FRAME_COUNT\n#endif\nmat4 cubicBezierMatrix=mat4(1.0,-3.0,3.0,-1.0,0.0,3.0,-6.0,3.0,0.0,0.0,3.0,-3.0,0.0,0.0,0.0,1.0);float cubicBezier(float t,float y1,float y2,float y3,float y4){vec4 tVec=vec4(1.0,t,t*t,t*t*t);vec4 yVec=vec4(y1,y2,y3,y4);vec4 result=tVec*cubicBezierMatrix*yVec;return result.x+result.y+result.z+result.w;}float binarySearchT(float x,float x1,float x2,float x3,float x4){float left=0.0;float right=1.0;float mid=0.0;float computedX;for(int i=0;i<8;i++){mid=(left+right)*0.5;computedX=cubicBezier(mid,x1,x2,x3,x4);if(abs(computedX-x)<0.0001){break;}else if(computedX>x){right=mid;}else{left=mid;}}return mid;}float valueFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);for(int i=0;i<ITR_END;i+=2){if(i>=count){break;}vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return k0.y;}if(i==int(frameCount-2.)&&time>=k1.x){return k1.y;}if(time>=k0.x&&time<=k1.x){float t=(time-k0.x)/(k1.x-k0.x);float nt=binarySearchT(time,k0.x,k0.z,k1.z,k1.x);return cubicBezier(nt,k0.y,k0.w,k1.w,k1.y);}}}float evaluteLineSeg(float t,vec2 p0,vec2 p1){return p0.y+(p1.y-p0.y)*(t-p0.x)/(p1.x-p0.x);}float valueFromLineSegs(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);int end=start+count;for(int i=0;i<ITR_END;i++){if(i>count){return lookup_curve(i).w;}vec4 seg=lookup_curve(i+start);vec2 p0=seg.xy;vec2 p1=seg.zw;if(time>=p0.x&&time<=p1.x){return evaluteLineSeg(time,p0,p1);}vec2 p2=lookup_curve(i+start+1).xy;if(time>p1.x&&time<=p2.x){return evaluteLineSeg(time,p1,p2);}}return lookup_curve(0).y;}float getValueFromTime(float time,vec4 value){float type=value.x;if(type==0.){return value.y;}if(type==1.){return mix(value.y,value.z,time/value.w);}if(type==3.){return valueFromLineSegs(time,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed);}if(type==5.){return valueFromBezierCurveFrames(time,value.z,value.w);}return 0.;}attribute vec4 aPos;attribute vec3 aDir;attribute vec3 aInfo;attribute vec4 aColor;attribute float aTime;\n#ifdef ATTR_TRAIL_START\nattribute float aTrailStart;\n#else\nuniform float uTrailStart[64];attribute float aTrailStartIndex;\n#endif\nuniform mat4 effects_MatrixInvV;uniform mat4 effects_ObjectToWorld;uniform mat4 effects_MatrixVP;uniform vec4 uTextureMap;uniform float uTime;uniform vec4 uParams;uniform vec4 uColorParams;uniform vec4 uOpacityOverLifetimeValue;uniform vec4 uWidthOverTrail;\n#ifdef COLOR_OVER_TRAIL\nuniform sampler2D uColorOverTrail;\n#endif\n#ifdef COLOR_OVER_LIFETIME\nuniform sampler2D uColorOverLifetime;\n#endif\nvarying float vLife;varying vec2 vTexCoord;varying vec4 vColor;void main(){vec4 _pa=effects_MatrixVP*vec4(aPos.xyz,1.);vec4 _pb=effects_MatrixVP*vec4(aPos.xyz+aDir,1.);vec2 dir=normalize(_pb.xy/_pb.w-_pa.xy/_pa.w);vec2 screen_xy=vec2(-dir.y,dir.x);vec4 pos=effects_ObjectToWorld*vec4(aPos.xyz,1.);\n#ifdef ATTR_TRAIL_START\nfloat ts=aTrailStart;\n#else\nfloat ts=uTrailStart[int(aTrailStartIndex)];\n#endif\nfloat trail=(ts-aInfo.y)/uParams.y;float width=aPos.w*getValueFromTime(trail,uWidthOverTrail)/max(abs(screen_xy.x),abs(screen_xy.y));pos.xyz+=(effects_MatrixInvV[0].xyz*screen_xy.x+effects_MatrixInvV[1].xyz*screen_xy.y)*width;float time=min((uTime-aTime)/aInfo.x,1.0);gl_Position=effects_MatrixVP*pos;vColor=aColor;\n#ifdef COLOR_OVER_LIFETIME\n#ifdef ENABLE_VERTEX_TEXTURE\nvColor*=texture2D(uColorOverLifetime,vec2(time,0.));\n#endif\n#endif\n#ifdef COLOR_OVER_TRAIL\nvColor*=texture2D(uColorOverTrail,vec2(trail,0.));\n#endif\nvColor.a*=clamp(getValueFromTime(time,uOpacityOverLifetimeValue),0.,1.);vLife=time;vTexCoord=uTextureMap.xy+vec2(trail,aInfo.z)*uTextureMap.zw;vSeed=aSeed;}",cs="precision highp float;attribute vec2 aPos;varying vec2 uv;void main(){gl_Position=vec4(aPos,0.,1.0);uv=(aPos+vec2(1.0))/2.;}",hs="precision highp float;\n#define HALF_MAX 60000.0\n#define ACEScc_MIDGRAY 0.4135884\nvarying vec2 uv;uniform sampler2D _GaussianTex;uniform sampler2D _SceneTex;uniform float _BloomIntensity;uniform float _Brightness;uniform float _Saturation;uniform float _Contrast;uniform bool _UseBloom;uniform bool _UseToneMapping;uniform vec3 _VignetteColor;uniform vec2 _VignetteCenter;uniform float _VignetteIntensity;uniform float _VignetteSmoothness;uniform float _VignetteRoundness;mat3 LinearToACES=mat3(0.59719,0.07600,0.02840,0.35458,0.90834,0.13383,0.04823,0.01566,0.83777);mat3 ACESToLinear=mat3(1.60475,-0.10208,-0.00327,-0.53108,1.10813,-0.07276,-0.07367,-0.00605,1.07602);float log10(float x){return log(x)/log(10.0);}vec3 log10(vec3 v){return vec3(log10(v.x),log10(v.y),log10(v.z));}vec3 LinearToLogC(vec3 x){return 0.244161*log10(5.555556*x+0.047996)+0.386036;}vec3 LogCToLinear(vec3 x){return(pow(vec3(10.0),(x-0.386036)/0.244161)-0.047996)/5.555556;}vec3 rrt_and_odt_fit(vec3 col){vec3 a=col*(col+0.0245786)-0.000090537;vec3 b=col*(0.983729*col+0.4329510)+0.238081;return a/b;}vec3 ACESToneMapping(vec3 col){vec3 aces=LinearToACES*col;aces=rrt_and_odt_fit(aces);col=ACESToLinear*aces;return col;}vec3 LinearToSrgb(vec3 c){return mix(1.055*pow(c,vec3(1./2.4))-0.055,12.92*c,step(c,vec3(0.0031308)));}vec3 GammaCorrection(vec3 c){return pow(c,vec3(1.0/2.2));}vec3 ApplyVignette(vec3 inputColor,vec2 uv,vec2 center,float intensity,float roundness,float smoothness,vec3 color){vec2 dist=abs(uv-center)*intensity;dist.x*=roundness;float vfactor=pow(clamp((1.0-dot(dist,dist)),0.0,1.0),smoothness);return inputColor*mix(color,vec3(1.0),vfactor);}void main(){vec4 hdrColor=texture2D(_SceneTex,uv);hdrColor.rgb=pow(hdrColor.rgb,vec3(2.2));vec3 finalColor=hdrColor.rgb;if(_UseBloom){vec4 bloomColor=texture2D(_GaussianTex,uv);bloomColor.rgb*=_BloomIntensity;finalColor+=bloomColor.rgb;}if(_VignetteIntensity>0.0){finalColor=ApplyVignette(finalColor,uv,_VignetteCenter,_VignetteIntensity,_VignetteRoundness,_VignetteSmoothness,_VignetteColor);}finalColor=finalColor*_Brightness;vec3 colorLog=LinearToLogC(finalColor);colorLog=(colorLog-ACEScc_MIDGRAY)*_Contrast+ACEScc_MIDGRAY;finalColor=LogCToLinear(colorLog);finalColor=max(finalColor,0.0);float luminance=0.2125*finalColor.r+0.7154*finalColor.g+0.0721*finalColor.b;vec3 luminanceColor=vec3(luminance,luminance,luminance);finalColor=(finalColor-luminanceColor)*_Saturation+luminanceColor;finalColor=max(finalColor,0.0);if(_UseToneMapping){finalColor=max(vec3(0.0),ACESToneMapping(finalColor));}float alpha=min(hdrColor.a,1.0);gl_FragColor=vec4(clamp(GammaCorrection(finalColor),0.0,1.0),alpha);}",ls="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform vec2 _TextureSize;vec3 GaussH(sampler2D tex,vec2 uv){vec3 color=vec3(0.0);float offsets[9];offsets[0]=-4.0;offsets[1]=-3.0;offsets[2]=-2.0;offsets[3]=-1.0;offsets[4]=0.0;offsets[5]=1.0;offsets[6]=2.0;offsets[7]=3.0;offsets[8]=4.0;float weights[9];weights[0]=0.01621622;weights[1]=0.05405405;weights[2]=0.12162162;weights[3]=0.19459459;weights[4]=0.22702703;weights[5]=0.19459459;weights[6]=0.12162162;weights[7]=0.05405405;weights[8]=0.01621622;for(int i=0;i<9;i++){vec2 offset=vec2(offsets[i]*2.0*(1.0/_TextureSize.x),0);color+=texture2D(tex,uv+offset).rgb*weights[i];}return color;}void main(){vec3 color=GaussH(_MainTex,uv);gl_FragColor=vec4(color,1.0);}",fs="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform vec2 _TextureSize;vec3 GaussV(sampler2D tex,vec2 uv){vec3 color=vec3(0.0);float offsets[5];offsets[0]=-3.23076923;offsets[1]=-1.38461538;offsets[2]=0.0;offsets[3]=1.38461538;offsets[4]=3.23076923;float weights[5];weights[0]=0.07027027;weights[1]=0.31621622;weights[2]=0.22702703;weights[3]=0.31621622;weights[4]=0.07027027;for(int i=0;i<5;i++){vec2 offset=vec2(0,offsets[i]*(1.0/_TextureSize.y));color+=texture2D(tex,uv+offset).rgb*weights[i];}return color;}void main(){vec3 color=GaussV(_MainTex,uv);gl_FragColor=vec4(color,1.0);}",ds="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform sampler2D _GaussianDownTex;uniform vec2 _GaussianDownTextureSize;float GaussWeight2D(float x,float y,float sigma){float PI=3.14159265358;float E=2.71828182846;float sigma_2=pow(sigma,2.0);float a=-(x*x+y*y)/(2.0*sigma_2);return pow(E,a)/(2.0*PI*sigma_2);}vec3 GaussNxN(sampler2D tex,vec2 uv,vec2 stride,float sigma){vec3 color=vec3(0.,0.,0.);const int r=1;float weight=0.0;for(int i=-r;i<=r;i++){for(int j=-r;j<=r;j++){float w=GaussWeight2D(float(i),float(j),sigma);vec2 coord=uv+vec2(i,j)*stride;color+=texture2D(tex,coord).rgb*w;weight+=w;}}color/=weight;return color;}void main(){vec3 lowResColor=GaussNxN(_MainTex,uv,0.5/_GaussianDownTextureSize,1.0);vec3 highResColor=GaussNxN(_GaussianDownTex,uv,1.0/_GaussianDownTextureSize,1.0);vec3 color=mix(highResColor,lowResColor,0.7);gl_FragColor=vec4(color,1.0);}",ps="precision highp float;varying vec2 uv;uniform sampler2D _MainTex;uniform float _Threshold;void main(){vec4 mainTex=texture2D(_MainTex,uv);mainTex.rgb=pow(mainTex.rgb,vec3(2.2));float brightness=max(mainTex.r,max(mainTex.g,mainTex.b));float w=max(0.0,brightness-_Threshold)/max(brightness,0.00001);mainTex.rgb*=w;mainTex.rgb*=mainTex.a;gl_FragColor=vec4(mainTex.rgb,1.0);}",ms={},vs=function(){function t(){}return t.registerInclude=function(t,e){ms[t]&&ci.warn('The "'+t+'" shader include already exist.'),ms[t]=e},t.unRegisterInclude=function(t){delete ms[t]},t.unRegisterAllIncludes=function(){Object.keys(ms).forEach((function(e){t.unRegisterInclude(e)}))},t.genFinalShaderCode=function(e){var r=e.level,i=e.shaderType,n=e.shader,o=e.macros,a=e.removeVersion,s=t.genMacroString(r,o),u=t.genShaderVersion(r),c=t.parseIncludes(n),h=t.isVersion300(c);return c=t.removeWebGLVersion(c),2!==r||h||(c=t.convertTo300(c,i===exports.ShaderType.fragment)),a?s+c:u+s+c},t.convertTo300=function(e,r){if(e=(e=(e=e.replace(/\bvarying\b/g,r?"in":"out")).replace(/\btexture(2D|Cube)\b/g,"texture")).replace(/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,""),r){if(e=(e=(e=e.replace(/\btexture(2D|Cube)LodEXT\b/g,"textureLod")).replace(/\btexture(2D|Cube)GradEXT\b/g,"textureGrad")).replace(/\bgl_FragDepthEXT\b/g,"gl_FragDepth"),!t.has300Output(e))if(/\bgl_FragData\[.+?\]/g.test(e)){var i=(e=e.replace(/\bgl_FragColor\b/g,"gl_FragData[0]")).match(/\bgl_FragData\[.+?\]/g);i&&(e=t.replaceMRTShader(e,i))}else e=(e=e.replace(/void\s+?main\s*\(/g,"out vec4 glFragColor;\nvoid main(")).replace(/\bgl_FragColor\b/g,"glFragColor")}else e=e.replace(/\battribute\b/g,"in");return e},t.parseIncludes=function(t,e){var r;for(void 0===e&&(e=/#include <(.+)>/gm);null!==(r=e.exec(t));){var i=r[1],n=ms[i];if(void 0===n)throw new Error("Can't find include shader name "+i);t=t.replace(r[0],n)}return t},t.genMacroString=function(t,e,r){void 0===r&&(r=!0);var i=[],n="WEBGL"+t;return i.push("#ifndef "+n),i.push("#define "+n),i.push("#endif"),r&&i.push("#define GE_RUNTIME"),e&&e.length&&e.forEach((function(t){var e=t[0],r=t[1];!0===r?i.push("#define "+e):Number.isFinite(r)&&i.push("#define "+e+" "+r)})),i.length?i.join("\n")+"\n":""},t.genShaderVersion=function(t){return 1===t?"#version 100\n":"#version 300 es\n"},t.isVersion300=function(t){var e=t.match(/#version\s+\b\d{3}\b\s*(es)?/);return(e?e[0]:"").includes("300")},t.removeWebGLVersion=function(t){var e=t.match(/#version\s+\b\d{3}\b\s*(es)?/);return e?t.replace(e[0],""):t},t.has300Output=function(t){return/\bout\s+(?:\w+\s+)?(?:vec4)\s+(?:\w+)\s*;/.test(t)},t.replaceMRTShader=function(t,e){for(var r=new Set,i="",n=0;n<e.length;n++){var o=e[n].match(/\bgl_FragData\[(.+?)\]/);o&&r.add(o[1])}return r.forEach((function(t){i+="layout(location="+t+") out vec4 fragOutColor"+t+";\n"})),i+="void main(",(t=t.replace(/\bgl_FragData\[(.+?)\]/g,"fragOutColor$1")).replace(/void\s+?main\s*\(/g,i)},t}(),ys=function(t){function e(e,r){var i,n=(i=t.call(this,e,r)||this).renderer.engine,o=ja.create(n,{mode:ko.TRIANGLE_STRIP,attributes:{aPos:{type:ko.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),a=Pa.create(n,{shader:{vertex:cs,fragment:ps,glslVersion:exports.GLSLVersion.GLSL1}});return a.blending=!1,a.depthTest=!1,a.culling=!1,i.screenMesh=ts.create(n,{geometry:o,material:a,priority:0}),i.priority=5e3,i}ji(e,t);var r=e.prototype;return r.configure=function(t){this.mainTexture=t.getFramebuffer().getColorTextures()[0],this.sceneTextureHandle.texture=this.mainTexture,t.setFramebuffer(this.framebuffer)},r.execute=function(t){var e,r,i;t.clear({colorAction:exports.TextureStoreAction.clear,depthAction:exports.TextureStoreAction.clear,stencilAction:exports.TextureStoreAction.clear}),this.screenMesh.material.setTexture("_MainTex",this.mainTexture);var n=null!=(i=null==(r=t.renderingData.currentFrame.globalVolume)||null==(e=r.bloom)?void 0:e.threshold)?i:1;this.screenMesh.material.setFloat("_Threshold",n),t.renderMeshes([this.screenMesh])},e}(is),gs=function(t){function e(e,r,i){var n;(n=t.call(this,e,i)||this).type=r;var o=n.renderer.engine,a="PostProcess",s=ja.create(o,{name:a,mode:ko.TRIANGLE_STRIP,attributes:{aPos:{type:ko.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),u={vertex:cs,fragment:"H"===r?ls:fs,glslVersion:exports.GLSLVersion.GLSL1},c=Pa.create(o,{name:a,shader:u});return c.blending=!1,c.depthTest=!1,c.culling=!1,n.screenMesh=ts.create(o,{name:a,geometry:s,material:c,priority:0}),n.priority=5e3,n}ji(e,t);var r=e.prototype;return r.configure=function(t){this.mainTexture=t.getFramebuffer().getColorTextures()[0],t.setFramebuffer(this.framebuffer)},r.execute=function(t){t.clear({colorAction:exports.TextureStoreAction.clear,depthAction:exports.TextureStoreAction.clear,stencilAction:exports.TextureStoreAction.clear}),this.screenMesh.material.setTexture("_MainTex",this.mainTexture),this.screenMesh.material.setVector2("_TextureSize",As(this.mainTexture)),t.renderMeshes([this.screenMesh]),"V"===this.type&&(this.gaussianResult.texture=t.getFramebuffer().getColorTextures()[0])},e}(is),xs=function(t){function e(e,r){var i,n="PostProcess",o=(i=t.call(this,e,r)||this).renderer.engine,a=ja.create(o,{name:n,mode:ko.TRIANGLE_STRIP,attributes:{aPos:{type:ko.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),s={vertex:cs,fragment:ds},u=Pa.create(o,{name:n,shader:s});return u.blending=!1,u.depthTest=!1,u.culling=!1,i.screenMesh=ts.create(o,{name:n,geometry:a,material:u,priority:0}),i.priority=5e3,i}ji(e,t);var r=e.prototype;return r.configure=function(t){this.mainTexture=t.getFramebuffer().getColorTextures()[0],t.setFramebuffer(this.framebuffer)},r.execute=function(t){t.clear({colorAction:exports.TextureStoreAction.clear,depthAction:exports.TextureStoreAction.clear,stencilAction:exports.TextureStoreAction.clear}),this.screenMesh.material.setTexture("_MainTex",this.mainTexture),this.screenMesh.material.setTexture("_GaussianDownTex",this.gaussianDownSampleResult.texture),this.screenMesh.material.setVector2("_GaussianDownTextureSize",As(this.gaussianDownSampleResult.texture)),t.renderMeshes([this.screenMesh])},e}(is),Ts=function(t){function e(e,r){var i,n="PostProcess",o=(i=t.call(this,e,{})||this).renderer.engine;i.sceneTextureHandle=r||new es(o);var a=ja.create(o,{name:n,mode:ko.TRIANGLE_STRIP,attributes:{aPos:{type:ko.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),s=Pa.create(o,{name:n,shader:{vertex:cs,fragment:hs,glslVersion:exports.GLSLVersion.GLSL1}});return s.blending=!1,s.depthTest=!1,s.culling=!1,i.screenMesh=ts.create(o,{name:n,geometry:a,material:s,priority:0}),i.priority=5e3,i}ji(e,t);var r=e.prototype;return r.configure=function(t){this.mainTexture=t.getFramebuffer().getColorTextures()[0],this.sceneTextureHandle.texture||(this.sceneTextureHandle.texture=this.mainTexture),t.setFramebuffer(null)},r.execute=function(t){t.clear({colorAction:exports.TextureStoreAction.clear,depthAction:exports.TextureStoreAction.clear,stencilAction:exports.TextureStoreAction.clear});var e=t.renderingData.currentFrame.globalVolume,r=qn({threshold:0,intensity:0,active:!1},null==e?void 0:e.bloom),i=qn({intensity:0,smoothness:0,roundness:0,active:!1},null==e?void 0:e.vignette),n=qn({brightness:0,saturation:0,contrast:0,active:!1},null==e?void 0:e.colorAdjustments),o=qn({active:!1},null==e?void 0:e.tonemapping);this.screenMesh.material.setTexture("_SceneTex",this.sceneTextureHandle.texture),this.screenMesh.material.setFloat("_Brightness",Math.pow(2,n.brightness)),this.screenMesh.material.setFloat("_Saturation",.01*n.saturation+1),this.screenMesh.material.setFloat("_Contrast",.01*n.contrast+1),this.screenMesh.material.setInt("_UseBloom",Number(r.active)),r.active&&(this.screenMesh.material.setTexture("_GaussianTex",this.mainTexture),this.screenMesh.material.setFloat("_BloomIntensity",r.intensity)),i.intensity>0&&(this.screenMesh.material.setFloat("_VignetteIntensity",i.intensity),this.screenMesh.material.setFloat("_VignetteSmoothness",i.smoothness),this.screenMesh.material.setFloat("_VignetteRoundness",i.roundness),this.screenMesh.material.setVector2("_VignetteCenter",new Fr(.5,.5)),this.screenMesh.material.setVector3("_VignetteColor",new Dr(0,0,0))),this.screenMesh.material.setInt("_UseToneMapping",Number(o.active)),t.renderMeshes([this.screenMesh])},e}(is),_s="_effects_default_",Es=1,bs=function(){function t(t){var e;this.renderQueue=[],this.destroyed=!1,this.renderPassInfoMap=new WeakMap;var r=t.camera,i=t.keepColorBuffer,n=t.renderer,o=t.editorTransform,a=void 0===o?[1,1,0,0]:o,s=t.globalVolume,u=t.postProcessingEnabled,c=void 0!==u&&u,h=t.clearAction,l=void 0===h?{colorAction:exports.TextureLoadAction.whatever,stencilAction:exports.TextureLoadAction.clear,depthAction:exports.TextureLoadAction.whatever}:h,f=n.engine;s&&(this.globalVolume=s),this.globalUniforms=new Rs;var d,p=[],m={};if(this.renderer=n,c){if(!this.renderer.engine.gpuCapability.detail.halfFloatTexture)throw new Error("Half float texture is not supported.");var v=ko.HALF_FLOAT;p=[{texture:{format:ko.RGBA,type:v,magFilter:ko.LINEAR,minFilter:ko.LINEAR}}],d={storageType:exports.RenderPassAttachmentStorageType.depth_stencil_opaque},m={colorAction:exports.TextureLoadAction.clear,stencilAction:exports.TextureLoadAction.clear,depthAction:exports.TextureLoadAction.clear}}this.drawObjectPass=new is(n,{name:_s,priority:1e3,meshOrder:exports.OrderType.ascending,depthStencilAttachment:d,attachments:p,clearAction:m});var y=[this.drawObjectPass];if(this.setRenderPasses(y),c){var g=new es(f),x=[0,0,this.renderer.getWidth()/2,this.renderer.getHeight()/2],T=new Array(7),_=ko.HALF_FLOAT,E=new ys(n,{name:"BloomThresholdPass",attachments:[{texture:{format:ko.RGBA,type:_,minFilter:ko.LINEAR,magFilter:ko.LINEAR}}]});E.sceneTextureHandle=g,this.addRenderPass(E);for(var b=0;b<7;b++){T[b]=new es(f);var A=new gs(n,"H",{name:"GaussianDownPassH"+b,viewport:x,attachments:[{texture:{format:ko.RGBA,type:_,minFilter:ko.LINEAR,magFilter:ko.LINEAR}}]}),S=new gs(n,"V",{name:"GaussianDownPassV"+b,viewport:x,attachments:[{texture:{format:ko.RGBA,type:_,minFilter:ko.LINEAR,magFilter:ko.LINEAR}}]});S.gaussianResult=T[b],this.addRenderPass(A),this.addRenderPass(S),x[2]/=2,x[3]/=2}x[2]*=4,x[3]*=4;for(var R=0;R<6;R++){var C=new xs(n,{name:"GaussianUpPass"+R,viewport:x,attachments:[{texture:{format:ko.RGBA,type:_,minFilter:ko.LINEAR,magFilter:ko.LINEAR}}]});C.gaussianDownSampleResult=T[5-R],this.addRenderPass(C),x[2]*=2,x[3]*=2}var M=new Ts(n,g);this.addRenderPass(M)}this.semantics=new Xa(t.semantics),this.clearAction=l,this.name="RenderFrame"+Es++;var O=y[0];this.camera=r,this.keepColorBuffer=i,this.renderPassInfoMap.set(O,{listStart:0,listEnd:0,renderPass:O,intermedia:!1}),this.editorTransform=Vr.fromArray(a),t.clearAction||this.resetClearActions(),this.passTextureCache=new Ga(f);var P=f.gpuCapability,I=P.detail,w=Va(P.level,I.readableDepthStencilTextures&&I.writableFragDepth);null==(e=this.renderer.getShaderLibrary())||e.addShader(w)}var e=t.prototype;return e.addMeshToDefaultRenderPass=function(t){this.drawObjectPass.addMesh(t)},e.removeMeshFromDefaultRenderPass=function(t){this.drawObjectPass.removeMesh(t)},e.dispose=function(t){(null==t?void 0:t.semantics)!==exports.DestroyOptions.keep&&this.semantics.dispose();var e,r,i=(null==t?void 0:t.passes)?t.passes:void 0;i!==exports.DestroyOptions.keep&&this._renderPasses.forEach((function(t){t.dispose(i)})),this.passTextureCache.dispose(),this._renderPasses.length=0,this.resource&&(this.resource.color_a.dispose(),this.resource.color_b.dispose(),null==(r=this.resource.depthStencil)||null==(e=r.texture)||e.dispose(),this.resource.finalCopyRP.dispose(),this.resource.resRP.dispose(),this.resource=null),this.destroyed=!0},e.resetRenderPassDefaultAttachment=function(t,e){for(var r,i=this.resource,n=i.color_a,o=i.color_b,a=e;a<t.length;a++){var s,u,c=t[a],h=null==(s=c.attachments[0])?void 0:s.texture;if(h&&r===h){var l=h===n?o:n;c.resetColorAttachments([l])}(h=null==(u=c.attachments[0])?void 0:u.texture)&&(r=h)}},e.findMeshRenderPassIndex=function(t){var e=-1;return this.renderPasses.every((function(r,i){return!r.name.startsWith(_s)||!r.meshes.includes(t)||(e=i,!1)})),e},e.addToRenderPass=function(t,e){var r=this.renderPassInfoMap.get(t),i=e.priority;r&&(0===t.meshes.length?r.listStart=r.listEnd=i:i<r.listStart?r.listStart=i:i>r.listEnd&&(r.listEnd=i),t.addMesh(e))},e.getRPAttachments=function(t,e){if(1===(null==t?void 0:t.length)){var r,i=t[0],n=i.texture,o=i.persistent,a=n.format,s=null!=(r=null==e?void 0:e.getInitAttachments())?r:[];if(a===ko.RGBA&&!o){var u=this.resource.color_a;return 0===s.length?[{texture:u}]:[{texture:s[0].texture===u?this.resource.color_b:u}]}}return t},e.resetClearActions=function(){var t=this.renderPasses.length>1?exports.TextureLoadAction.clear:exports.TextureLoadAction.whatever;this.clearAction.stencilAction=t,this.clearAction.depthAction=t,this.clearAction.colorAction=t,this.keepColorBuffer&&(this.clearAction.colorAction=exports.TextureLoadAction.whatever)},e.setRenderPasses=function(t){var e=this;void 0!==this.renderer&&t.forEach((function(t){return t.initialize(e.renderer)})),this._renderPasses=t.slice()},e.addRenderPass=function(t){void 0!==this.renderer&&t.initialize(this.renderer),this._renderPasses.push(t)},e.createResource=function(){var t=this.renderer.engine;if(!this.resource){var e,r=t.gpuCapability,i=r.detail,n=r.level,o=this.renderer.getWidth(),a=this.renderer.getHeight(),s=2===n?ko.LINEAR:ko.NEAREST,u=ya.create(t,{sourceType:exports.TextureSourceType.framebuffer,format:ko.RGBA,name:"frame_a",minFilter:s,magFilter:s}),c=ya.create(t,{sourceType:exports.TextureSourceType.framebuffer,format:ko.RGBA,data:{width:o,height:a},minFilter:s,magFilter:s,name:"frame_b"}),h=i.readableDepthStencilTextures&&i.writableFragDepth?exports.RenderPassAttachmentStorageType.depth_24_stencil_8_texture:exports.RenderPassAttachmentStorageType.depth_stencil_opaque,l=new is(this.renderer,{depthStencilAttachment:{storageType:h},attachments:[{texture:u}]}).initialize(this.renderer),f=new Ss(this.renderer,{name:"effects-final-copy",priority:1600,clearAction:{depthAction:exports.TextureLoadAction.clear,stencilAction:exports.TextureLoadAction.clear,colorAction:exports.TextureLoadAction.clear},meshOrder:exports.OrderType.ascending,meshes:[this.createCopyMesh({blend:!0,depthTexture:null==(e=l.getDepthAttachment())?void 0:e.texture})]});this.resource={color_a:l.attachments[0].texture,color_b:c,finalCopyRP:f,depthStencil:l.depthAttachment,resRP:l}}},e.createCopyMesh=function(t){var e,r=Na,i=this.renderer.engine,n=ja.create(i,{name:r,mode:ko.TRIANGLE_STRIP,attributes:{aPos:{type:ko.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),o=Va(i.gpuCapability.level,!!(null==t?void 0:t.depthTexture));null==(e=this.renderer.getShaderLibrary())||e.addShader(o);var a=Pa.create(i,{uniformValues:{uDepth:null==t?void 0:t.depthTexture},name:r,shader:o});return a.blending=!1,a.depthTest=!1,a.culling=!1,(null==t?void 0:t.blend)&&(a.blending=!0,a.blendFunction=[ko.SRC_ALPHA,ko.ONE_MINUS_SRC_ALPHA,ko.SRC_ALPHA,ko.ONE_MINUS_SRC_ALPHA]),ts.create(i,{name:r,geometry:n,material:a,priority:0})},e.removeRenderPass=function(t){Rr(this._renderPasses,t)},Io(t,[{key:"renderPasses",get:function(){return this._renderPasses.slice()}},{key:"isDestroyed",get:function(){return this.destroyed}}]),t}();function As(t){return t?new Fr(t.getWidth(),t.getHeight()):new Fr}exports.COMPRESSED_TEXTURE=void 0,exports.FilterMode=void 0,exports.RenderTextureFormat=void 0;var Ss=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.configure=function(t){var e=t.getFramebuffer();e&&(this.prePassTexture=e.getColorTextures()[0]),t.setFramebuffer(null)},r.execute=function(t){t.clear(this.clearAction),this.meshes[0].material.setTexture("uFilterSource",this.prePassTexture),this.meshes[0].material.setVector2("uFilterSourceSize",As(this.prePassTexture)),t.renderMeshes(this.meshes),this.storeAction&&t.clear(this.storeAction)},e}(is),Rs=function(){this.floats={},this.ints={},this.vector3s={},this.vector4s={},this.matrices={},this.samplers=[],this.uniforms=[]},Cs=function(){function t(t){this.size=[0,0],this.multiSample=1,this.destroyed=!1;var e=t.storageType,r=t.format,i=t.attachment;this.storageType=e,this.format=r,this.attachment=i}return Io(t,[{key:"isDestroyed",get:function(){return this.destroyed}}]),t}(),Ms="function"==typeof r.WebGL2RenderingContext,Os=function(){function t(t){this.setupCapability(t)}var e=t.prototype;return e.setupCapability=function(t){var e,i=Ms&&mr(t,r.WebGL2RenderingContext)?2:1,n=2===i,o=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),a=t.getExtension("WEBGL_depth_texture"),s=!!t.getExtension("OES_texture_half_float_linear"),u=!!t.getExtension("OES_texture_float_linear");this.level=i,this.type=n?"webgl2":"webgl",this.vaoExt=t.getExtension("OES_vertex_array_object"),this.glAsyncCompileExt=t.getExtension("KHR_parallel_shader_compile"),this.UNSIGNED_INT_24_8=t.UNSIGNED_INT_24_8,this.drawBufferExtension=t.getExtension("WEBGL_draw_buffers"),a&&(this.UNSIGNED_INT_24_8=a.UNSIGNED_INT_24_8_WEBGL),n&&!s&&(s=Ps(t,t.HALF_FLOAT)),n&&!u&&(u=Ps(t,t.FLOAT)),this.internalFormatDepth16=n?t.DEPTH_COMPONENT16:t.DEPTH_COMPONENT,this.internalFormatDepth24_stencil8=n?t.DEPTH24_STENCIL8:t.DEPTH_STENCIL;var c=n||t.getExtension("OES_texture_float")?t.FLOAT:0,h=n?r.WebGL2RenderingContext.HALF_FLOAT:(null==(e=t.getExtension("OES_texture_half_float"))?void 0:e.HALF_FLOAT_OES)||0,l={floatTexture:c,halfFloatTexture:h,maxSample:n?t.getParameter(t.MAX_SAMPLES):1,maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVertexTextures:t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),maxFragmentTextures:t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),floatColorAttachment:n?!!t.getExtension("EXT_color_buffer_float"):c>0&&!!t.getExtension("WEBGL_color_buffer_float"),halfFloatColorAttachment:n?!!t.getExtension("EXT_color_buffer_float"):h>0&&!!t.getExtension("EXT_color_buffer_half_float"),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxShaderTexCount:t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),compressedTexture:Is(t),halfFloatLinear:s,floatLinear:u,maxTextureAnisotropy:o?t.getParameter(o.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,shaderTextureLod:n||!!t.getExtension("EXT_shader_texture_lod"),instanceDraw:n||!!t.getExtension("ANGLE_instanced_arrays"),drawBuffers:n||!!this.drawBufferExtension,asyncShaderCompile:!!this.glAsyncCompileExt,intIndexElementBuffer:!!t.getExtension("OES_element_index_uint"),standardDerivatives:n||!!t.getExtension("OES_standard_derivatives"),readableDepthStencilTextures:n||!!a,writableFragDepth:n||!!t.getExtension("EXT_frag_depth")};this.detail=l,o&&(this.textureMaxAnisotropyExt=o.TEXTURE_MAX_ANISOTROPY_EXT)},e.framebufferTexture2D=function(t,e,r,i,n){var o=this.drawBufferExtension;if(1===this.level&&!o&&r>0)throw new Error("Draw multiple color buffers not available.");var a=o?o["COLOR_ATTACHMENT"+r+"_WEBGL"]:t["COLOR_ATTACHMENT"+r];a?t.framebufferTexture2D(e,a,i,n,0):console.error("Invalid color attachment index: "+r+".")},e.drawBuffers=function(t,e){var r=this.drawBufferExtension;if(1!==this.level||r){var i=e.map((function(e,i){return e?r?r["COLOR_ATTACHMENT"+i+"_WEBGL"]:t["COLOR_ATTACHMENT"+i]:t.NONE}));r?r.drawBuffersWEBGL(i):t.drawBuffers(i)}else if(e.length>1)throw new Error("Draw buffers not available.")},e.setTextureAnisotropic=function(t,e,r){var i=this.detail.maxTextureAnisotropy;i&&t.texParameterf(e,this.textureMaxAnisotropyExt,Math.min(i,r||4))},t}();function Ps(t,e){var r=t.createTexture(),i=!1;return t.getError(),t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.R16F,1,1,0,t.RED,e,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.getError()||(i=!0),t.deleteTexture(r),i}function Is(t){return t.getExtension("WEBGL_compressed_texture_astc")?2:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc")?1:0}!function(t){t[t.NONE=0]="NONE",t[t.PVRTC=1]="PVRTC",t[t.ASTC=2]="ASTC"}(exports.COMPRESSED_TEXTURE||(exports.COMPRESSED_TEXTURE={})),function(t){t[t.Nearest=0]="Nearest",t[t.Linear=1]="Linear"}(exports.FilterMode||(exports.FilterMode={})),function(t){t[t.RGBA32=0]="RGBA32",t[t.RGBAHalf=1]="RGBAHalf"}(exports.RenderTextureFormat||(exports.RenderTextureFormat={}));var ws,Ns,Ls=function(){function t(){}var e=t.prototype;return e.resize=function(t,e,r,i){},e.resetColorTextures=function(t){},e.unbind=function(){},e.bind=function(){},e.getDepthTexture=function(){},e.getStencilTexture=function(){},e.getColorTextures=function(){return[]},e.dispose=function(t){},Io(t,[{key:"stencilStorage",get:function(){}},{key:"depthStorage",get:function(){}}]),t}(),Fs=function(){function t(){}var e=t.prototype;return e.setGlobalFloat=function(t,e){},e.setGlobalInt=function(t,e){},e.setGlobalVector4=function(t,e){},e.setGlobalVector3=function(t,e){},e.setGlobalMatrix=function(t,e){},e.getFramebuffer=function(){return null},e.setFramebuffer=function(t){},e.setViewport=function(t,e,r,i){},e.resize=function(t,e){},e.clear=function(t){},e.getWidth=function(){return 0},e.getHeight=function(){return 0},e.addLostHandler=function(t){},e.addRestoreHandler=function(t){},e.lost=function(t){},e.restore=function(){},e.getShaderLibrary=function(){},e.renderRenderFrame=function(t){},e.renderMeshes=function(t){},e.drawGeometry=function(t,e,r,i){},e.getTemporaryRT=function(t,e,r,i,n,o){return null},e.dispose=function(t){},t}(),Ds=function(t){function e(e){var r;(r=t.call(this,e)||this).visible=!0,r.meshCollider=new ec,r._color=new Br(1,1,1,1),r.getHitTestParams=function(t){var e=Do.fromScale(r.transform.size.x,r.transform.size.y,1).premultiply(r.transform.getWorldMatrix()),i=r.interaction;if(t||i){r.meshCollider.setGeometry(r.geometry,e);var n,o=r.meshCollider.getBoundingBoxData();if(o)return{behavior:(null==(n=r.interaction)?void 0:n.behavior)||0,type:o.type,triangles:o.area,backfaceCulling:r.renderer.side===wi.FRONT}}},r.renderer={renderMode:Ui.MESH,blending:Ii.ALPHA,texture:r.engine.whiteTexture,occlusion:!1,transparentOcclusion:!1,side:wi.DOUBLE,mask:0},r.defaultGeometry=ja.create(r.engine,{attributes:{aPos:{type:ko.FLOAT,size:3,data:new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0])},aUV:{size:2,offset:0,releasable:!0,type:ko.FLOAT,data:new Float32Array([0,1,0,0,1,1,1,0])}},indices:{data:new Uint16Array([0,1,2,2,1,3]),releasable:!0},mode:ko.TRIANGLES,drawCount:6}),r.geometry=r.defaultGeometry;var i=Pa.create(r.engine,{shader:{fragment:os,vertex:ns,shared:!0}});return r.material=i,r.material.setColor("_Color",new Br(1,1,1,1)),r.maskManager=new Ia(e),r}ji(e,t);var r=e.prototype;return r.setVisible=function(t){this.visible=t},r.getVisible=function(){return this.visible},r.setColor=function(t){mr(t,Br)?this._color.copyFrom(t):this._color.setFromArray(t),this.material.setColor("_Color",this._color)},r.setTexture=function(t){var e=this;return fr((function(){var r;return gr(this,(function(i){switch(i.label){case 0:return"string"!=typeof t?[3,2]:[4,ya.fromImage(t,e.item.engine)];case 1:return r=i.sent(),[3,3];case 2:r=t,i.label=3;case 3:return e.renderer.texture=r,e.material.setTexture("_MainTex",r),[2]}}))}))()},r.render=function(t){this.getVisible()&&(this.maskManager.drawStencilMask(t),this.draw(t))},r.drawStencilMask=function(t){if(this.isActiveAndEnabled){var e=this.material.colorMask;this.material.colorMask=!1,this.draw(t),this.material.colorMask=e}},r.onStart=function(){this.item.getHitTestParams=this.getHitTestParams},r.getBoundingBox=function(){var t=this.transform.getWorldMatrix();return this.meshCollider.setGeometry(this.geometry,t),this.meshCollider.getBoundingBox()},r.configureMaterial=function(t){var e=t.side,r=t.occlusion,i=t.blending,n=t.mask,o=t.texture,a=this.maskManager.maskMode,s=this.material;s.blending=!0,s.depthTest=!0,s.depthMask=r,s.stencilRef=void 0!==n?[n,n]:void 0,Yo(s,i),qo(s,a),Zo(s,e),s.shader.shaderData.properties='_MainTex("_MainTex",2D) = "white" {}',s.setVector4("_TexOffset",new Vr(0,0,1,1)),s.setTexture("_MainTex",o);var u=Wo(i),c=new Vr;return c.x=t.occlusion?+t.transparentOcclusion:1,c.y=u,c.z=t.renderMode,c.w=a,s.setVector4("_TexParams",c),0===c.x||this.maskManager.alphaMaskEnabled?s.enableMacro("ALPHA_CLIP"):s.disableMacro("ALPHA_CLIP"),s},r.draw=function(t){for(var e=0;e<this.materials.length;e++){var r=this.materials[e];r.setVector2("_Size",this.transform.size),this.renderer.renderMode!==Ui.BILLBOARD&&this.renderer.renderMode!==Ui.VERTICAL_BILLBOARD&&this.renderer.renderMode!==Ui.HORIZONTAL_BILLBOARD||r.setVector3("_Scale",this.transform.scale),t.drawGeometry(this.geometry,this.transform.getWorldMatrix(),r,e)}},r.fromData=function(e){t.prototype.fromData.call(this,e);var r,i,n,o,a=e,s=null!=(r=a.renderer)?r:{},u=a.mask;u&&this.maskManager.setMaskOptions(u),this.renderer={renderMode:null!=(i=s.renderMode)?i:Ui.MESH,blending:null!=(n=s.blending)?n:Ii.ALPHA,texture:s.texture?this.engine.findObject(s.texture):this.engine.whiteTexture,occlusion:!!s.occlusion,transparentOcclusion:!!s.transparentOcclusion||this.maskManager.maskMode===exports.MaskMode.MASK,side:null!=(o=s.side)?o:wi.DOUBLE,mask:this.maskManager.getRefValue()},this.configureMaterial(this.renderer)},Io(e,[{key:"color",get:function(){return this._color},set:function(t){this.setColor(t)}}]),e}(Lo),Vs=(ws=new Float32Array(1),Ns=new Int32Array(ws.buffer),function(t){ws[0]=t;var e=Ns[0],r=e>>16&32768,i=e>>12&2047,n=e>>23&255;return n<103?r:n>142?(r|=31744,r|=(255==n?0:1)&&8388607&e):n<113?r|=((i|=2048)>>114-n)+(i>>113-n&1):(r|=n-112<<10|i>>1,r+=1&i)}),Bs=function(){function t(t){if(Number.isInteger(t))this.data=new Uint16Array(t);else if(t&&"object"==typeof t&&Number.isInteger(t.length))for(var e=this.data=new Uint16Array(t.length),r=0;r<e.length;r++)e[r]=Vs(t[r])}return t.prototype.set=function(t,e){for(var r=0;r<t.length;r++)this.data[r+e]=Vs(t[r])},t}();var Us,ks=new Ya,zs=new Do;function Gs(t,e,r,i,n,o,a){var s=t,u=i/n,c=i,h=e.speedOverLifetime;h&&(c=h.getIntegrateValue(0,i,n));var l=e.gravityModifier?e.gravityModifier.getIntegrateByTime(0,i):0;s.copyFrom(o),s.addScaledVector(a,c),s.addScaledVector(r,l);var f=e.linearVelOverLifetime||{},d=e.orbitalVelOverLifetime||{};if(d.enabled){var p=new Dr;d.center&&p.setFromArray(d.center);var m=s.clone().subtract(p),v=d.asRotation,y=["x","y","z"].map((function(t){var e=d[t];return e?v?e.getValue(u):e.getIntegrateValue(0,i,n):0}));ks.setFromArray(y).negate(),zs.setFromEuler(ks);var g=zs.transformPoint(m);s.addVectors(p,g)}if(f.enabled){var x=f.asMovement,T=f.x,_=f.y,E=f.z;if(T){var b=x?T.getValue(u):T.getIntegrateValue(0,i,n);s.x=s.x+b}if(_){var A=x?_.getValue(u):_.getIntegrateValue(0,i,n);s.y=s.y+A}if(E){var S=x?E.getValue(u):E.getIntegrateValue(0,i,n);s.z=s.z+S}}return s}function Xs(t){return Array.isArray(t)?[t[0],t[1],t[2]]:[0,0,0]}function Hs(t,e){for(var r=0,i=t.length;r<i;r++)t[r]=e;return t}function js(t,e,r){if(e&&r)for(var i=0,n=e.length;i<n;i++)t[i]=e[i]*r[i];else if(e){if(t!==e)for(var o=0;o<e.length;o++)t[o]=e[o]}else if(r&&t!==r)for(var a=0;a<r.length;a++)t[a]=r[a];return t}var Ws=((Us={})[ki.PARTICLE_ORIGIN_CENTER]=[0,0],Us[ki.PARTICLE_ORIGIN_CENTER_BOTTOM]=[0,-.5],Us[ki.PARTICLE_ORIGIN_CENTER_TOP]=[0,.5],Us[ki.PARTICLE_ORIGIN_LEFT_TOP]=[-.5,.5],Us[ki.PARTICLE_ORIGIN_LEFT_CENTER]=[-.5,0],Us[ki.PARTICLE_ORIGIN_LEFT_BOTTOM]=[-.5,-.5],Us[ki.PARTICLE_ORIGIN_RIGHT_CENTER]=[.5,0],Us[ki.PARTICLE_ORIGIN_RIGHT_BOTTOM]=[.5,-.5],Us[ki.PARTICLE_ORIGIN_RIGHT_TOP]=[.5,.5],Us);function Ys(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}function Zs(t,e,r){var i=r.position,n=new Dr(t,e,0),o=new Dr;return r.getInverseViewProjectionMatrix().projectPoint(n,o),o.subtract(i),new qa(i,o)}function qs(t,e,r){var i=t.x,n=t.y,o=t.z,a=new Dr(i-e,n+r,o),s=new Dr(i-e,n-r,o),u=new Dr(i+e,n-r,o),c=new Dr(i+e,n+r,o);return[{p0:a,p1:s,p2:u},{p0:a.clone(),p1:u.clone(),p2:c}]}function Ks(t,e,r){return void 0===r&&(r=1e-6),Math.abs(t-e)<r}function Qs(t,e){void 0===e&&(e=2);var r=Math.pow(10,e);return Math.floor(t*r)/r}var Js={pointIndexCache:{xIndex:0,yIndex:0},getPointInCurve:function(t){t[0];var e=t[1],r=this.getPointIndexInCurve(t,this.pointIndexCache),i=r.xIndex,n=r.yIndex,o=e[i],a=e[n];return new Fr(o,a)},getPointIndexInCurve:function(t,e){var r=t[0],i=t[2],n=r===Zi.LINE||r===Zi.EASE_OUT?0:r===Zi.EASE_IN||r===Zi.EASE||r===Zi.HOLD&&i===Zi.EASE_IN?2:0;return e?(e.xIndex=n,e.yIndex=n+1,e):{xIndex:n,yIndex:n+1}},isLeftSideEase:function(t){var e=t[0];t[1];var r=t[2];return!(e!==Zi.HOLD||!this.isKeyframeTypeLeftSideEase(r))||this.isKeyframeTypeLeftSideEase(e)},isRightSideEase:function(t){var e=t[0];t[1];var r=t[2];return!(e!==Zi.HOLD||!this.isKeyframeTypeRightSideEase(r))||this.isKeyframeTypeRightSideEase(e)},isKeyframeTypeLeftSideEase:function(t){return[Zi.EASE,Zi.EASE_IN,Zi.AUTO].includes(t)},isKeyframeTypeRightSideEase:function(t){return[Zi.EASE,Zi.EASE_OUT,Zi.AUTO].includes(t)},isHoldInKeyframe:function(t){var e=t[0];t[1];var r=t[2];return e===Zi.HOLD&&[Zi.HOLD,Zi.LINE_OUT,Zi.EASE_OUT].includes(r)},isHoldOutKeyframe:function(t){var e=t[0];t[1];var r=t[2];return e===Zi.HOLD&&[Zi.HOLD,Zi.LINE,Zi.EASE_IN].includes(r)}},$s=function(t,e){this.points=t,this.totalLength=e},tu={},eu={},ru=.1;function iu(t,e){return 1-3*e+3*t}function nu(t,e){return 3*e-6*t}function ou(t){return 3*t}function au(t,e,r){return((iu(e,r)*t+nu(e,r))*t+ou(e))*t}function su(t,e,r){return 3*iu(e,r)*t*t+2*nu(e,r)*t+ou(e)}var uu=function(){function t(t,e,r,i){this.p1=t,this.p2=e,this.p3=r,this.p4=i,this.catching={lastPoint:0,lastAddedLength:0};var n=function(t,e,r,i){var n=Qs(e.x-t.x,3)+"_"+Qs(e.y-t.y,3)+"_"+Qs(e.z-t.z,3)+"&"+Qs(r.x-t.x,3)+"_"+Qs(r.y-t.y,3)+"_"+Qs(r.z-t.z,3)+"&"+Qs(i.x-t.x,3)+"_"+Qs(i.y-t.y,3)+"_"+Qs(i.z-t.z,3);if(eu[n])return{data:eu[n],interval:t};for(var o=[],a=null,s=0,u=0,c=0;c<300;c+=1){var h=new Dr,l=c/299;u=0,h.x=3*Math.pow(1-l,2)*l*(r.x-t.x)+3*(1-l)*Math.pow(l,2)*(i.x-t.x)+Math.pow(l,3)*(e.x-t.x),h.y=3*Math.pow(1-l,2)*l*(r.y-t.y)+3*(1-l)*Math.pow(l,2)*(i.y-t.y)+Math.pow(l,3)*(e.y-t.y),h.z=3*Math.pow(1-l,2)*l*(r.z-t.z)+3*(1-l)*Math.pow(l,2)*(i.z-t.z)+Math.pow(l,3)*(e.z-t.z),null!==a&&(u+=Math.pow(h.x-a.x,2),u+=Math.pow(h.y-a.y,2),u+=Math.pow(h.z-a.z,2)),a=h,s+=u=Math.sqrt(u),o[c]={partialLength:u,point:h}}var f=new $s(o,s);return eu[n]=f,{data:f,interval:new Dr(t.x,t.y,t.z)}}(t,e,r,i),o=n.data,a=n.interval;this.lengthData=o,this.interval=a,this.totalLength=o.totalLength}return t.prototype.getPointInPercent=function(t){var e=this.lengthData;if(0===t)return e.points[0].point.clone().add(this.interval);if(Ks(1-t,0))return e.points[299].point.clone().add(this.interval);if(Ks(e.totalLength,0))return this.p1.clone();var r=new Dr,i=Qs(e.totalLength*t,4),n=this.catching.lastAddedLength,o=this.catching.lastPoint;if(Ks(n,i))return e.points[o].point.clone().add(this.interval);var a=!0,s=1;for(i<n&&(s=-1);a;){if(i>=n){if(299===o){r.x=e.points[o].point.x,r.y=e.points[o].point.y,r.z=e.points[o].point.z;break}if(i<n+e.points[o+1].partialLength){var u=(i-n)/e.points[o+1].partialLength;r.x=e.points[o].point.x+(e.points[o+1].point.x-e.points[o].point.x)*u,r.y=e.points[o].point.y+(e.points[o+1].point.y-e.points[o].point.y)*u,r.z=e.points[o].point.z+(e.points[o+1].point.z-e.points[o].point.z)*u;break}}s>0&&o<299?(o+=s,n+=Qs(e.points[o].partialLength,5)):s<0&&o>0?(n-=Qs(e.points[o].partialLength,5),o+=s):a=!1}return this.catching.lastPoint=o,this.catching.lastAddedLength=n,r.add(this.interval),r},t}(),cu=function(){function t(t,e,r,i){this.p1=t,this.p2=e,this.p3=r,this.p4=i,this.temp=new $n,this.totalLength=0}return t.prototype.getPointInPercent=function(t){return 0===t?this.temp.copyFrom(this.p1):Ks(1-t,0)?this.temp.copyFrom(this.p2):(du.slerpFlat(this.temp,this.p1,this.p2,t),this.temp)},t}(),hu=function(){function t(t,e,r,i){this.precomputed=!1,this.control1=new Fr,this.control2=new Fr,this.weighted=!1,this.isConstant=!1,this.mSampleValues=new Array(11),void 0!==t&&void 0!==e&&void 0!==r&&void 0!==i?(this.control1.x=t,this.control1.y=e,this.control2.x=r,this.control2.y=i,this.weighted=!0):void 0!==t&&void 0!==e?(this.control1.x=1/3,this.control1.y=t,this.control2.x=2/3,this.control2.y=e):this.isConstant=!0}var e=t.prototype;return e.getValue=function(t){return this.isConstant?0:this.control1.x===this.control1.y&&this.control2.x===this.control2.y||0===t||1===t?t:this.weighted?(this.precomputed||this.precompute(),au(this.getTForX(t),this.control1.y,this.control2.y)):this.bezierInterpolate(0,this.control1.y,this.control2.y,1,t)},e.bezierInterpolate=function(t,e,r,i,n){var o=1-n,a=o*o,s=n*n;return t*(a*o)+e*a*n*3+r*o*s*3+i*(s*n)},e.calcSampleValues=function(){for(var t=0;t<11;++t)this.mSampleValues[t]=au(t*ru,this.control1.x,this.control2.x)},e.getTForX=function(t){for(var e=this.mSampleValues,r=0,i=1;10!==i&&e[i]<=t;++i)r+=ru;var n=r+(t-e[--i])/(e[i+1]-e[i])*ru,o=su(n,this.control1.x,this.control2.x);return o>=.001?function(t,e,r,i){for(var n=0;n<4;++n){var o=su(e,r,i);if(0===o)return e;e-=(au(e,r,i)-t)/o}return e}(t,n,this.control1.x,this.control2.x):0===o?n:function(t,e,r,i,n){var o,a,s=0;do{(o=au(a=e+(r-e)/2,i,n)-t)>0?r=a:e=a}while(Math.abs(o)>1e-7&&++s<10);return a}(t,r,r+ru,this.control1.x,this.control2.x)},e.precompute=function(){this.precomputed=!0,this.control1.x===this.control1.y&&this.control2.x===this.control2.y||this.calcSampleValues()},t}();function lu(t,e){var r=fu(t,e,!0),i=r.p0,n=r.p1,o=r.p2,a=r.p3;oi(o),oi(a);var s,u,c=a.x-i.x,h=a.y-i.y,l=Qs((n.x-i.x)/c,5),f=Qs((o.x-i.x)/c,5);Ks(h,0)?s=u=NaN:(s=Qs((n.y-i.y)/h,5),u=Qs((o.y-i.y)/h,5)),l<0&&(console.error("Invalid bezier points, x1 < 0",i,n,o,a),l=0),f<0&&(console.error("Invalid bezier points, x2 < 0",i,n,o,a),f=0),l>1&&(console.error("Invalid bezier points, x1 >= 1",i,n,o,a),l=1),f>1&&(console.error("Invalid bezier points, x2 >= 1",i,n,o,a),f=1);var d,p=("bez_"+l+"_"+s+"_"+f+"_"+u).replace(/\./g,"p");return tu[p]?d=tu[p]:(d=Ks(h,0)?new hu:new hu(l,s,f,u),tu[p]=d),{points:[i,n,o,a],timeInterval:c,valueInterval:h,curve:d}}function fu(t,e,r){var i=t[1],n=Js.isHoldOutKeyframe(t),o=Js.isHoldInKeyframe(e),a=!o&&Js.isRightSideEase(t),s=!n&&Js.isLeftSideEase(e);if(a&&!s&&!o){var u=new Fr(i[i.length-4],i[i.length-3]),c=new Fr(i[i.length-2],i[i.length-1]),h=Js.getPointInCurve(e),l=new Fr(h.x,h.y);return{type:"ease",p0:u,p1:c,p2:new Fr(l.x-(l.x-u.x)/10,l.y),p3:l}}if(!a&&s&&!n){var f=e[1],d=Js.getPointInCurve(t),p=new Fr(d.x,d.y),m=new Fr(f[0],f[1]),v=new Fr(f[2],f[3]);return{type:"ease",p0:p,p1:new Fr(p.x+(v.x-p.x)/10,p.y),p2:m,p3:v}}if(a&&s){var y=e[1];return{type:"ease",p0:new Fr(i[i.length-4],i[i.length-3]),p1:new Fr(i[i.length-2],i[i.length-1]),p2:new Fr(y[0],y[1]),p3:new Fr(y[2],y[3])}}var g=Js.getPointInCurve(t),x=Js.getPointInCurve(e);return n?x.y=g.y:o&&(g.y=x.y),r?{type:"ease",p0:g,p1:new Fr((x.x-g.x)/3+g.x,(x.y-g.y)/3+g.y),p2:new Fr((x.x-g.x)/3*2+g.x,(x.y-g.y)/3*2+g.y),p3:x,isHold:n||o,leftHoldLine:n,rightHoldLine:o}:{type:"line",p0:g,p1:x,isHold:n||o,leftHoldLine:n,rightHoldLine:o}}var du=function(){function t(){}return t.slerpFlat=function(t,e,r,i){var n=e.x,o=e.y,a=e.z,s=e.w,u=r.x,c=r.y,h=r.z,l=r.w;if(0===i)return t.x=n,t.y=o,t.z=a,void(t.w=s);if(1===i)return t.x=u,t.y=c,t.z=h,void(t.w=l);if(s!==l||n!==u||o!==c||a!==h){var f=1-i,d=n*u+o*c+a*h+s*l,p=d>=0?1:-1,m=1-d*d;if(m>Number.EPSILON){var v=Math.sqrt(m),y=Math.atan2(v,d*p);f=Math.sin(f*y)/v,i=Math.sin(i*y)/v}var g=i*p;if(n=n*f+u*g,o=o*f+c*g,a=a*f+h*g,s=s*f+l*g,f===1-i){var x=1/Math.sqrt(n*n+o*o+a*a+s*s);n*=x,o*=x,a*=x,s*=x}}t.x=n,t.y=o,t.z=a,t.w=s},t}(),pu="not_implement",mu=function(){function t(t){this.onCreate(t)}var e=t.prototype;return e.onCreate=function(t){throw new Error(pu)},e.getIntegrateValue=function(t,e,r){throw new Error(pu)},e.getIntegrateByTime=function(t,e){throw new Error(pu)},e.getValue=function(t){throw new Error(pu)},e.getMaxTime=function(){throw new Error(pu)},e.toUniform=function(t){throw new Error(pu)},e.map=function(t){throw new Error(pu)},e.scaleXCoord=function(t){return this},e.toData=function(){throw new Error(pu)},t.getAllData=function(t,e){for(var r=new(e?Bs:Float32Array)(4*t.index),i=0,n=0,o=t.curves;i<o.length;i++){var a=o[i].toData();r.set(a,n),n+=a.length}return e?r.data:r},t}(),vu=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.value=t},r.getIntegrateValue=function(t,e,r){return this.value*(e-t)},r.getIntegrateByTime=function(t,e){return.5*this.value*(e*e-t*t)},r.getValue=function(t){return this.value},r.toUniform=function(){return new Float32Array([0,this.value,0,0])},r.map=function(t){var e=this.value;return this.value=t(e),this},r.getMaxTime=function(){return 0},e}(mu),yu=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.items=t},r.getValue=function(t){var e=this.items;return e[Math.floor(Math.random()*e.length)]},r.map=function(t){return this.items=this.items.map(t),this},e}(mu),gu=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.min=t[0],this.max=t[1]},r.getValue=function(t,e){var r=null!=e?e:Math.random();return this.min+r*(this.max-this.min)},r.getIntegrateValue=function(t,e,r){var i=null!=r?r:1;return(this.min+i*(this.max-this.min))*(e-t)},r.toUniform=function(){return new Float32Array([4,this.min,this.max,0])},r.map=function(t){return this.min=t(this.min),this.max=t(this.max),this},e}(mu),xu=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.min=t[0],this.max=t[1]},r.getValue=function(t){for(var e=this.min,r=this.max,i=[],n=0;n<e.length;n++){var o=Math.random();i[n]=e[n]*(1-o)+r[n]*o}return i},r.map=function(t){return this.min=this.min.map(t),this.max=this.max.map(t),this},e}(mu),Tu=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.min=t[0],this.max=t[1],this.xCoord=1},r.getValue=function(t){return t/=this.xCoord,this.min*(1-t)+this.max*t},r.toUniform=function(){return new Float32Array([1,this.min,this.max,this.xCoord])},r.getIntegrateValue=function(t,e,r){void 0===r&&(r=1);var i=this.min,n=this.max,o=this.xCoord*r;return((i+e/o*(n-i)+i)*e-(i+t/o*(n-i)+i)*t)/2},r.getIntegrateByTime=function(t,e){return Cu(e,0,this.xCoord,this.min,this.max)-Cu(t,0,this.xCoord,this.min,this.max)},r.map=function(t){return this.min=t(this.min),this.max=t(this.max),this},r.scaleXCoord=function(t){return this.xCoord=t,this},e}(mu),_u=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.stops=zr(t)},r.getStops=function(){return this.stops},r.getValue=function(t){for(var e=this.stops,r=e.length-1,i=0;i<r;i++){var n=e[i],o=e[i+1];if(n.time<=t&&o.time>t){var a=(t-n.time)/(o.time-n.time);return Gr(n.color.toArray(),o.color.toArray(),a,!0)}}return e[r].color.toArray()},e}(mu),Eu=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.keys=t.map((function(t){return t.slice?t.slice(0,2):[t.time,t.value]})).sort((function(t,e){return t[0]-e[0]}));var e=this.keys[this.keys.length-1];e[0]<1&&this.keys.push([1,e[1]]);var r=this.keys[0];r[0]>0&&this.keys.unshift([0,r[1]]),this.isLineSeg=!0},r.getValue=function(t){var e=this.keys;if(t<e[0][0])return e[0][1];for(var r=e.length-1,i=0;i<r;i++){var n=e[i],o=e[i+1],a=n[0],s=o[0];if(t>=a&&t<=s){var u=(t-a)/(s-a),c=n[1];return c+u*(o[1]-c)}}return e[r][1]},r.getIntegrateValue=function(t,e,r){return void 0===r&&(r=1),(this.integrate(e,!1)-this.integrate(t,!1))*r},r.getIntegrateByTime=function(t,e){return this.integrate(e,!0)-this.integrate(t,!0)},r.integrate=function(t,e){var r=this.keys;if(t<=r[0][0])return 0;for(var i=0,n=r.length-1,o=e?Cu:Ru,a=0;a<n;a++){var s=r[a],u=r[a+1],c=s[0],h=u[0];if(t>c&&t<=h)return i+o(t,c,h,s[1],u[1]);i+=o(h,c,h,s[1],u[1])}return i},r.toData=function(){for(var t=this.keys,e=new Float32Array(4*Math.ceil(t.length/2)),r=0,i=0;r<t.length;r++,i+=2)e.set(t[r],i);return e.set(t[t.length-1],e.length-2),e},r.toUniform=function(t){var e=t.index,r=this.keys,i=Math.ceil(r.length/2);return t.lineSegCount+=i,t.curves.push(this),t.index+=i,t.max=Math.max(t.max,i),new Float32Array([3,e,i,0])},r.map=function(t){return this.keys.forEach((function(e){return e[1]=t(e[1])})),this},r.scaleXCoord=function(t){return this.keys.forEach((function(e){return e[0]=t*e[0]})),this},e}(mu),bu=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.keys=t[0],this.values=t[1]},r.getValue=function(t){for(var e=this.keys,r=this.values,i=0;i<e.length-1;i++){var n=e[i],o=e[i+1];if(n[0]<=t&&o[0]>=t){var a=o[1]-n[1],s=void 0;return s=0===a?(t-n[0])/(o[0]-n[0]):(Mu(t,n,o)-n[1])/a,this.calculateVec(i,s)}}return t<=e[0][0]?r[0].slice():r[r.length-1].slice()},r.calculateVec=function(t,e){for(var r=this.values[t],i=this.values[t+1],n=[0,0,0],o=0;o<r.length;o++)n[o]=r[o]*(1-e)+i[o]*e;return n},e}(mu),Au=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){var e=t[0],r=t[1],i=t[2];if(this.curveSegments={},i.length){for(var n=0;n<e.length-1;n++){var o=e[n],a=e[n+1],s=new Dr(r[n][0],r[n][1],r[n][2]),u=new Dr(r[n+1][0],r[n+1][1],r[n+1][2]),c=new Dr(i[2*n][0],i[2*n][1],i[2*n][2]),h=new Dr(i[2*n+1][0],i[2*n+1][1],i[2*n+1][2]),l=lu(o,a),f=l.points,d=l.curve,p=l.timeInterval,m=l.valueInterval,v=f[0],y=f[f.length-1],g=new uu(s,u,c,h);this.curveSegments[v.x+"&"+y.x]={points:f,timeInterval:p,valueInterval:m,easingCurve:d,pathCurve:g,timeStart:Number(v.x),timeEnd:Number(y.x)}}this.keyTimeData=Object.keys(this.curveSegments)}},r.getValue=function(t){var e=Qs(t,5),r=0,i=new Dr,n=this.keyTimeData;if(!n.length)return i;var o=this.curveSegments[n[0]].timeStart,a=this.curveSegments[n[n.length-1]].timeEnd;if(e<=o)return this.curveSegments[n[0]].pathCurve.getPointInPercent(0);if(e>=a)return this.curveSegments[n[n.length-1]].pathCurve.getPointInPercent(1);for(var s=0;s<n.length;s++){var u=this.curveSegments[n[s]].timeStart,c=this.curveSegments[n[s]].timeEnd;if(e>=Number(u)&&e<Number(c)){var h=this.curveSegments[n[s]].pathCurve;r=this.getPercValue(n[s],e),i=h.getPointInPercent(r)}}return i},r.getPercValue=function(t,e){var r=this.curveSegments[t],i=r.points[0],n=r.timeInterval,o=Qs((e-i.x)/n,4);return Lr(r.easingCurve.getValue(o),0,1)},r.getMaxTime=function(){var t=this.keyTimeData;return this.curveSegments[t[t.length-1]].timeEnd},e}(mu),Su=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){var e=t[0],r=t[1],i=t[2];if(this.curveSegments={},i.length)for(var n=0;n<e.length-1;n++){var o=e[n],a=e[n+1],s=$n.fromArray(r[n]),u=$n.fromArray(r[n+1]),c=$n.fromArray(i[2*n]),h=$n.fromArray(i[2*n+1]),l=lu(o,a),f=l.points,d=l.curve,p=l.timeInterval,m=l.valueInterval,v=f[0],y=f[f.length-1],g=new cu(s,u,c,h);this.curveSegments[v.x+"&"+y.x]={points:f,timeInterval:p,valueInterval:m,easingCurve:d,pathCurve:g}}},r.getValue=function(t){var e=0,r=Qs(t,5),i=Object.keys(this.curveSegments),n=Number(i[0].split("&")[0]),o=Number(i[i.length-1].split("&")[1]);if(r<=n)return this.curveSegments[i[0]].pathCurve.getPointInPercent(0);if(r>=o)return this.curveSegments[i[i.length-1]].pathCurve.getPointInPercent(1);for(var a=0;a<i.length;a++){var s=i[a].split("&"),u=s[0],c=s[1];if(r>=Number(u)&&r<Number(c)){var h=this.curveSegments[i[a]].pathCurve;return e=this.getPercValue(i[a],r),h.getPointInPercent(e)}}return this.curveSegments[i[0]].pathCurve.getPointInPercent(0)},r.getPercValue=function(t,e){var r=this.curveSegments[t],i=r.points[0],n=r.timeInterval,o=Qs((e-i.x)/n,4);return Lr(r.easingCurve.getValue(o),0,1)},r.getMaxTime=function(){var t=Object.keys(this.curveSegments);return Number(t[t.length-1].split("&")[1])},e}(mu);function Ru(t,e,r,i,n){var o=t-e;return(i+i+(n-i)*o/(r-e))*o/2}function Cu(t,e,r,i,n){var o=t*t,a=e*e;return(o*t*2*(i-n)+3*o*(e*n-r*i)-a*e*(2*i+n)+3*a*r*i)/(6*(e-r))}function Mu(t,e,r){var i=r[0]-e[0],n=e[3]*i,o=r[2]*i,a=(t-e[0])/i,s=a*a,u=s*a,c=u-2*s+a,h=u-s,l=-2*u+3*s;return(2*u-3*s+1)*e[1]+c*n+h*o+l*r[1]}function Ou(t,e){if(e){var r=e[0],i=e[1];if(r===Yi.CURVE){t.curves.push(i);var n=i.length;i[0][0]>0&&n++,i[i.length-1][0]<1&&n++,t.index+=n,t.max=Math.max(t.max,n),t.curveCount+=n}else if(r===Yi.LINE){var o=i.length;if(2===o&&0===i[0][0]&&1===i[1][0])return;i[0][0]>0&&o++,i[i.length-1][0]<1&&o++;var a=Math.ceil(o/2);t.lineSegCount+=a,t.curves.push(i),t.index+=a,t.max=Math.max(t.max,a)}else if(r===Yi.BEZIER_CURVE){var s=i.length-1;t.index+=2*s,t.curves.push(i),t.max=Math.max(t.max,2*s),t.curveCount+=2*s}}}function Pu(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Pu=function(){return!!t})()}function Iu(t,e,r){return Iu=Pu()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);var n=new(Function.bind.apply(t,i));return r&&Hi(n,r.prototype),n},Iu.apply(null,arguments)}exports.TangentMode=void 0,exports.WeightedMode=void 0;var wu=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=new Vr,e}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.xCurve=Gu(t[0]),this.yCurve=Gu(t[1]),this.zCurve=Gu(t[2]),this.wCurve=Gu(t[3])},r.getValue=function(t){var e=this.xCurve.getValue(t),r=this.yCurve.getValue(t),i=this.zCurve.getValue(t),n=this.wCurve.getValue(t);return this.value.set(e,r,i,n),this.value},r.getMaxTime=function(){return Math.max(this.xCurve.getMaxTime(),this.yCurve.getMaxTime(),this.zCurve.getMaxTime(),this.wCurve.getMaxTime())},e}(mu),Nu=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=new Dr,e}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.xCurve=Gu(t[0]),this.yCurve=Gu(t[1]),this.zCurve=Gu(t[2])},r.getValue=function(t){var e=this.xCurve.getValue(t),r=this.yCurve.getValue(t),i=this.zCurve.getValue(t);return this.value.set(e,r,i),this.value},r.getMaxTime=function(){return Math.max(this.xCurve.getMaxTime(),this.yCurve.getMaxTime(),this.zCurve.getMaxTime())},e}(mu),Lu=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=new Fr,e}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.xCurve=Gu(t[0]),this.yCurve=Gu(t[1])},r.getValue=function(t){var e=this.xCurve.getValue(t),r=this.yCurve.getValue(t);return this.value.set(e,r),this.value},r.getMaxTime=function(){return Math.max(this.xCurve.getMaxTime(),this.yCurve.getMaxTime())},e}(mu),Fu="editor",Du={"Item duration can't be less than 0":"https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#AOnQS","ValueType: 21/22 is not supported":"https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#smO1b"};!function(t){t[t.Cubic=0]="Cubic",t[t.Linear=1]="Linear",t[t.Constant=2]="Constant"}(exports.TangentMode||(exports.TangentMode={})),function(t){t[t.None=0]="None",t[t.In=1]="In",t[t.Out=2]="Out",t[t.Both=3]="Both"}(exports.WeightedMode||(exports.WeightedMode={}));var Vu=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.keyFrames=Uu(t);var e=this.keyFrames;this.curveMap={},this.keys=[],this.curveInfos=[];for(var r=0;r<e.length-1;r++){var i=Bu(e[r],e[r+1]),n=i.points,o=i.curve,a=i.timeInterval,s=i.valueInterval,u=n[0],c=n[n.length-1];this.keys.push([].concat(u.toArray(),n[1].toArray())),this.keys.push([].concat(c.toArray(),n[2].toArray()));var h={points:n,timeInterval:a,valueInterval:s,curve:o,timeStart:Number(u.x),timeEnd:Number(c.x)};this.curveMap[u.x+"&"+c.x]=h,this.curveInfos.push(h)}},r.getValue=function(t){var e=0,r=this.keyFrames.length;if(t<=this.keyFrames[0].time)e=this.keyFrames[0].value;else if(t<this.keyFrames[r-1].time)for(var i=0;i<this.keyFrames.length-1;i++){var n=this.keyFrames[i].time,o=this.keyFrames[i+1].time;if(t>=n&&t<o){var a=this.curveInfos[i],s=a.points[0],u=a.timeInterval,c=a.valueInterval,h=(t-s.x)/u,l=a.curve.getValue(h);e=s.y+c*l;break}}else t>=this.keyFrames[r-1].time&&(e=this.keyFrames[r-1].value);return e},r.getIntegrateValue=function(t,e,r){void 0===r&&(r=1);var i=(e-t)/r,n=0,o=Object.keys(this.curveMap);if(i<=this.curveMap[o[0]].timeStart)return 0;for(var a=0;a<o.length;a++){var s=this.curveMap[o[a]].timeStart,u=this.curveMap[o[a]].timeEnd;if(i>=Number(u)&&(n+=r*this.getCurveIntegrateValue(o[a],Number(u))),i>=Number(s)&&i<Number(u)){n+=r*this.getCurveIntegrateValue(o[a],i);break}}return n},r.getIntegrateByTime=function(t,e){return this.getIntegrateValue(0,e)-this.getIntegrateValue(0,t)},r.getCurveIntegrateValue=function(t,e){for(var r=this.curveMap[t],i=r.points[0],n=r.timeInterval,o=r.valueInterval,a=0,s=(e-i.x)/20,u=0;u<=20;u++){var c=u*s/n,h=i.y+o*r.curve.getValue(c);a+=0===u||20===u?h:u%2==1?4*h:2*h}return a*(s/3)},r.toUniform=function(t){var e=t.index,r=this.keys.length;return t.curves.push(this),t.index=e+r,t.max=Math.max(t.max,r),t.curveCount+=r,new Float32Array([5,e+1/r,e,r])},r.toData=function(){for(var t=this.keys,e=new Float32Array(4*t.length),r=0,i=0;r<t.length;r++,i+=4)e.set(t[r],i);return e},r.getMaxTime=function(){return this.keyFrames[this.keyFrames.length-1].time},e}(mu);function Bu(t,e){var r=new Fr(t.time,t.value),i=new Fr,n=new Fr,o=new Fr,a=2===t.weightedMode||3===t.weightedMode||1===e.weightedMode||3===e.weightedMode,s=2===t.tangentMode,u=(a?t.outWeight:1)*(e.time-t.time)/3;i.x=t.time+u,i.y=t.value+u*(s?0:t.outSlope);var c=(a?e.inWeight:1)*(e.time-t.time)/3;n.x=e.time-c,n.y=e.value-c*(s?0:e.inSlope),o.x=e.time,o.y=s?t.value:e.value,oi(n),oi(o);var h,l,f=o.x-r.x,d=o.y-r.y,p=Qs((i.x-r.x)/f,5),m=Qs((n.x-r.x)/f,5);Ks(d,0)?h=l=NaN:(h=Qs((i.y-r.y)/d,5),l=Qs((n.y-r.y)/d,5)),p<0&&(console.error("Invalid bezier points, x1 < 0",r,i,n,o),p=0),m<0&&(console.error("Invalid bezier points, x2 < 0",r,i,n,o),m=0),p>1&&(console.error("Invalid bezier points, x1 >= 1",r,i,n,o),p=1),m>1&&(console.error("Invalid bezier points, x2 >= 1",r,i,n,o),m=1);var v,y=("bez_"+p+"_"+h+"_"+m+"_"+l).replace(/\./g,"p");return tu[y]?v=tu[y]:(v=Ks(d,0)?new hu:a?new hu(p,h,m,l):new hu(h,l),tu[y]=v),{points:[r,i,n,o],timeInterval:f,valueInterval:d,curve:v}}function Uu(t){for(var e=t,r=[],i=[],n={x:0,y:0},o=0;o<e.length;o++){var a=e[o],s=fu(a,o+1<e.length?e[o+1]:e[o],!0),u=s.p0,c=s.p1,h=s.p2,l=s.p3;oi(h),oi(l);var f={leftControl:n,value:u,rightControl:c,tangentMode:0};a[0]===Zi.HOLD&&(f.tangentMode=2),i.push(f),n=h}for(var d=function(t,e){return(e.y-t.y)/(e.x-t.x+Ir)},p=0;p<i.length;p++){var m=i[p].leftControl,v=i[p].value,y=i[p].rightControl,g=0,x=0;p>0&&(g=d(m,v)),p<i.length-1&&(x=d(v,y));var T={time:v.x,value:v.y,inSlope:g,outSlope:x,inWeight:0,outWeight:0,tangentMode:i[p].tangentMode,weightedMode:3};r.push(T),p>0&&(T.inWeight=(v.x-m.x)/((v.x-i[p-1].value.x)/3)),p+1<i.length&&(T.outWeight=(y.x-v.x)/((i[p+1].value.x-v.x)/3))}return r}var ku,zu=((ku={})[Yi.RANDOM]=function(t){return mr(t[0],Array)?new xu(t):new gu(t)},ku[Yi.CONSTANT]=function(t){return new vu(t)},ku[Yi.CONSTANT_VEC2]=function(t){return new vu(t)},ku[Yi.CONSTANT_VEC3]=function(t){return new vu(t)},ku[Yi.CONSTANT_VEC4]=function(t){return new vu(t)},ku[Yi.RGBA_COLOR]=function(t){return new vu(t)},ku[Yi.COLORS]=function(t){return new yu(t.map((function(t){return Ur(t,!1)})))},ku[Yi.LINE]=function(t){return 2===t.length&&0===t[0][0]&&1===t[1][0]?new Tu([t[0][1],t[1][1]]):new Eu(t)},ku[Yi.GRADIENT_COLOR]=function(t){return new _u(t)},ku[Yi.LINEAR_PATH]=function(t){return new bu(t)},ku[Yi.BEZIER_CURVE]=function(t){return 1===t.length?new vu(t[0][1][1]):new Vu(t)},ku[Yi.BEZIER_CURVE_PATH]=function(t){return 1===t[0].length?new vu(Iu(Dr,[].concat(t[1][0]))):new Au(t)},ku[Yi.BEZIER_CURVE_QUAT]=function(t){return 1===t[0].length?new vu(Iu($n,[].concat(t[1][0]))):new Su(t)},ku[Yi.COLOR_CURVE]=function(t){return new Xu(t)},ku[Yi.VECTOR4_CURVE]=function(t){return new wu(t)},ku[Yi.VECTOR2_CURVE]=function(t){return new Lu(t)},ku[27]=function(t){return new Nu(t)},ku);function Gu(t){if(!t||!isNaN(+t))return new vu(t||0);if(mr(t,mu))return t;if(di(zu[t[0]]))return zu[t[0]](t[1]);throw new Error("ValueType: "+t[0]+" is not supported, see "+Du["ValueType: 21/22 is not supported"]+".")}exports.TexturePaintScaleMode=void 0;var Xu=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).value=new Br,e}ji(e,t);var r=e.prototype;return r.onCreate=function(t){this.rCurve=Gu(t[0]),this.gCurve=Gu(t[1]),this.bCurve=Gu(t[2]),this.aCurve=Gu(t[3])},r.getValue=function(t){var e=this.rCurve.getValue(t),r=this.gCurve.getValue(t),i=this.bCurve.getValue(t),n=this.aCurve.getValue(t);return this.value.set(e,r,i,n),this.value},r.getMaxTime=function(){return Math.max(this.rCurve.getMaxTime(),this.gCurve.getMaxTime(),this.bCurve.getMaxTime(),this.aCurve.getMaxTime())},e}(mu);!function(t){t[t.Fill=0]="Fill",t[t.Fit=1]="Fit",t[t.Crop=2]="Crop",t[t.Tile=3]="Tile"}(exports.TexturePaintScaleMode||(exports.TexturePaintScaleMode={})),exports.ShapeComponent=function(t){function e(e){var r;(r=t.call(this,e)||this).shapeDirty=!0,r.materialDirty=!0,r.graphicsPath=new jl,r.fills=[],r.strokeAttributes={width:1,alignment:.5,cap:pn.Butt,join:mn.Miter,miterLimit:10},r.strokeWidth=1,r.strokeCap=pn.Butt,r.strokeJoin=mn.Miter,r.strokes=[],r.meshCollider=new ec,r.fillMaterials=[],r.strokeMaterials=[],r.getHitTestParams=function(t){var e=Do.fromScale(r.transform.size.x,r.transform.size.y,1).premultiply(r.transform.getWorldMatrix());if(t){r.meshCollider.setGeometry(r.geometry,e);var i=r.meshCollider.getBoundingBoxData();if(i)return{behavior:0,type:i.type,triangles:i.area,backfaceCulling:r.rendererOptions.side===wi.FRONT}}},r.rendererOptions={renderMode:Ui.MESH,blending:Ii.ALPHA,texture:r.engine.whiteTexture,occlusion:!1,transparentOcclusion:!1,side:wi.DOUBLE,mask:0},r.maskManager=new Ia(r.engine);var i={type:ln.Solid,color:new Br(1,1,1,1)};r.strokes.push(i);var n={type:ln.Solid,color:new Br(1,1,1,1)};return r.fills.push(n),r.shapeAttributes={type:dn.Custom,points:[],easingIns:[],easingOuts:[],shapes:[]},r.geometry=ja.create(r.engine,{attributes:{aPos:{type:ko.FLOAT,size:3,data:new Float32Array([-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,-.5,0])},aUV:{size:2,offset:0,releasable:!0,type:ko.FLOAT,data:new Float32Array([0,1,0,0,1,1,1,0])}},indices:{data:new Uint16Array([0,1,2,2,1,3]),releasable:!0},mode:ko.TRIANGLES,drawCount:6}),r.geometry.subMeshes.push({offset:0,indexCount:0,vertexCount:0},{offset:0,indexCount:0,vertexCount:0}),r}ji(e,t);var r=e.prototype;return r.onStart=function(){this.item.getHitTestParams=this.getHitTestParams},r.onUpdate=function(t){this.shapeDirty&&(this.buildPath(this.shapeAttributes),this.buildGeometryFromPath(this.graphicsPath.shapePath),this.shapeDirty=!1),this.materialDirty&&(this.updateMaterials(),this.materialDirty=!1)},r.render=function(t){this.maskManager.drawStencilMask(t),this.draw(t)},r.drawStencilMask=function(t){if(this.isActiveAndEnabled){for(var e=!1,r=0;r<this.fillMaterials.length;r++)e=this.fillMaterials[r].colorMask,this.fillMaterials[r].colorMask=!1,t.drawGeometry(this.geometry,this.transform.getWorldMatrix(),this.fillMaterials[r],0),this.fillMaterials[r].colorMask=e;for(var i=0;i<this.strokeMaterials.length;i++)e=this.strokeMaterials[i].colorMask,this.strokeMaterials[i].colorMask=!1,t.drawGeometry(this.geometry,this.transform.getWorldMatrix(),this.strokeMaterials[i],1),this.strokeMaterials[i].colorMask=e}},r.draw=function(t){for(var e=0;e<this.fillMaterials.length;e++)t.drawGeometry(this.geometry,this.transform.getWorldMatrix(),this.fillMaterials[e],0);for(var r=0;r<this.strokeMaterials.length;r++)t.drawGeometry(this.geometry,this.transform.getWorldMatrix(),this.strokeMaterials[r],1)},r.getBoundingBox=function(){var t=this.transform.getWorldMatrix();return this.meshCollider.setGeometry(this.geometry,t),this.meshCollider.getBoundingBox()},r.buildGeometryFromPath=function(t){var e=t.shapePrimitives,r=[],i=[];if(this.fills.length>0)for(var n,o=pr(e);!(n=o()).done;){var a=n.value.shape,s=[],u=i.length,c=r.length/2;a.build(s),a.triangulate(s,r,c,i,u)}var h=i.length;if(this.strokes.length>0)for(var l,f=pr(e);!(l=f()).done;){var d=l.value.shape,p=[],m=r.length/2,v=this.strokeAttributes;v.cap=this.strokeCap,v.join=this.strokeJoin,v.width=this.strokeWidth;var y=!0;this.shapeAttributes.type===dn.Custom&&(y=d.closePath),d.build(p),Il(p,v,!1,y,r,2,m,i)}var g=i.length-h,x=r.length/2,T=this.geometry.getAttributeData("aPos"),_=this.geometry.getAttributeData("aUV"),E=this.geometry.getIndexData();(!T||T.length<3*x)&&(T=new Float32Array(3*x)),(!_||_.length<2*x)&&(_=new Float32Array(2*x)),(!E||E.length<i.length)&&(E=new Uint16Array(i.length));for(var b=Number.MAX_VALUE,A=Number.MAX_VALUE,S=Number.MIN_VALUE,R=Number.MIN_VALUE,C=0;C<x;C++){var M=3*C,O=2*C,P=r[O],I=r[O+1];T[M]=P,T[M+1]=I,T[M+2]=0,b=Math.min(b,P),A=Math.min(A,I),S=Math.max(S,P),R=Math.max(R,I)}for(var w=S-b,N=R-A,L=0;L<x;L++){var F=3*L,D=2*L;_[D]=(T[F]-b)/w,_[D+1]=(T[F+1]-A)/N}E.set(i),this.geometry.setAttributeData("aPos",T),this.geometry.setAttributeData("aUV",_),this.geometry.setIndexData(E),this.geometry.setDrawCount(i.length);var V=this.geometry.subMeshes[0],B=this.geometry.subMeshes[1];V.indexCount=h,B.offset=2*h,B.indexCount=g},r.buildPath=function(t){switch(this.graphicsPath.clear(),t.type){case dn.Custom:for(var e,r=this.shapeAttributes,i=r.points,n=r.easingIns,o=r.easingOuts,a=pr(r.shapes);!(e=a()).done;){var s=e.value,u=s.indexes,c=i[u[0].point];this.graphicsPath.moveTo(c.x,c.y);for(var h=1;h<u.length;h++){var l=u[h],f=u[h-1],d=i[l.point],p=i[f.point],m=o[f.easingOut],v=n[l.easingIn];this.graphicsPath.bezierCurveTo(m.x+p.x,m.y+p.y,v.x+d.x,v.y+d.y,d.x,d.y,1)}if(s.close){var y=u[0],g=u[u.length-1],x=i[y.point],T=i[g.point],_=o[g.easingOut],E=n[y.easingIn];this.graphicsPath.bezierCurveTo(_.x+T.x,_.y+T.y,E.x+x.x,E.y+x.y,x.x,x.y,1),this.graphicsPath.closePath()}}break;case dn.Ellipse:var b=t;this.graphicsPath.ellipse(0,0,b.xRadius,b.yRadius);break;case dn.Rectangle:var A=t;this.graphicsPath.rect(-A.width/2,-A.height/2,A.width,A.height,A.roundness);break;case dn.Star:var S=t;this.graphicsPath.polyStar(S.pointCount,S.outerRadius,S.innerRadius,S.outerRoundness,S.innerRoundness,exports.StarType.Star);break;case dn.Polygon:var R=t;this.graphicsPath.polyStar(R.pointCount,R.radius,R.radius,R.roundness,R.roundness,exports.StarType.Polygon)}},r.updateMaterials=function(){for(var t=0;t<this.fills.length;t++)this.updatePaintMaterial(this.fillMaterials[t],this.fills[t]);for(var e=0;e<this.strokes.length;e++)this.updatePaintMaterial(this.strokeMaterials[e],this.strokes[e])},r.updatePaintMaterial=function(t,e){if(t.setFloat("_FillType",e.type),e.type===ln.Solid)t.color=e.color;else if(e.type===ln.GradientLinear||e.type===ln.GradientAngular||e.type===ln.GradientRadial)this.updateGradientMaterial(t,e.gradientStops,e.startPoint,e.endPoint);else if(e.type===ln.Texture){t.setInt("_ImageScaleMode",e.scaleMode),t.setVector2("_ImageSize",new Fr(e.texture.getWidth(),e.texture.getHeight()));var r=this.getBoundingBox(),i=r.area[0].p1,n=r.area[1].p2;t.setVector2("_DestSize",new Fr(i.x-n.x,i.y-n.y)),t.setFloat("_ImageOpacity",e.opacity),t.setFloat("_ImageScalingFactor",e.scalingFactor),t.setTexture("_ImageTex",e.texture);var o=e.textureTransform;t.setMatrix3("_TextureTransform",(new Za).scale(o.scale.x,o.scale.y).rotate(o.rotation).translate(o.offset.x,o.offset.y).invert())}},r.updateGradientMaterial=function(t,e,r,i){for(var n,o=[],a=[],s=pr(e.stops);!(n=s()).done;){var u=n.value,c=u.color;o.push(new Vr(c.r,c.g,c.b,c.a)),a.push(u.time)}t.setVector4Array("_Colors",o),t.setFloats("_Stops",a),t.setInt("_StopsCount",a.length),t.setVector2("_StartPoint",r),t.setVector2("_EndPoint",i)},r.createMaterialFromRendererOptions=function(t){var e={shader:{vertex:"precision highp float;attribute vec3 aPos;attribute vec2 aUV;varying vec2 uv0;uniform mat4 effects_MatrixVP;uniform mat4 effects_MatrixInvV;uniform mat4 effects_ObjectToWorld;void main(){vec4 pos=vec4(aPos.xyz,1.0);uv0=aUV;gl_Position=effects_MatrixVP*effects_ObjectToWorld*pos;}",fragment:"precision highp float;\n#define _MAX_STOPS 8\n#define PI 3.14159265359\nuniform vec4 _Color;uniform vec4 _Colors[_MAX_STOPS];uniform float _Stops[_MAX_STOPS];uniform int _StopsCount;uniform float _FillType;uniform vec2 _StartPoint;uniform vec2 _EndPoint;uniform sampler2D _ImageTex;uniform vec2 _ImageSize;uniform vec2 _DestSize;uniform int _ImageScaleMode;uniform mat3 _TextureTransform;uniform float _ImageScalingFactor;uniform float _ImageOpacity;varying vec2 uv0;vec4 smoothMix(vec4 a,vec4 b,float t){return mix(a,b,smoothstep(0.0,1.0,t));}float calculateAngleRatio(vec2 v1,vec2 v2){float angle=atan(v2.y,v2.x)-atan(v1.y,v1.x);if(angle<0.0)angle+=2.0*PI;return angle/(2.0*PI);}vec2 applyTransform(mat3 m,vec2 uv){uv=uv-vec2(0.5,0.5);vec3 p=m*vec3(uv,1.0);p.xy=p.xy+vec2(0.5,0.5);return p.xy;}void main(){vec4 finalColor=vec4(1.0);if(_FillType==0.0){finalColor=_Color;}else if(_FillType==1.0||_FillType==2.0||_FillType==3.0){float t=0.0;if(_FillType==1.0){vec2 gradientVector=_EndPoint-_StartPoint;vec2 pixelVector=uv0-_StartPoint;float denom=max(dot(gradientVector,gradientVector),1e-6);t=clamp(dot(pixelVector,gradientVector)/denom,0.0,1.0);}else if(_FillType==2.0){float maxRadius=max(distance(_EndPoint,_StartPoint),0.001);t=clamp(distance(uv0,_StartPoint)/maxRadius,0.0,1.0);}else{vec2 center=_StartPoint;vec2 referenceVector=_EndPoint-center;vec2 targetVector=uv0-center;if(length(targetVector)>0.001){t=calculateAngleRatio(referenceVector,targetVector);}}finalColor=_Colors[0];for(int i=1;i<_MAX_STOPS;i++){if(i>=_StopsCount)break;float prevStop=_Stops[i-1];float currStop=_Stops[i];if(t>=prevStop&&t<=currStop){float localT=(t-prevStop)/max(currStop-prevStop,1e-6);finalColor=smoothMix(_Colors[i-1],_Colors[i],localT);break;}}}else if(_FillType==4.0){vec2 uv=uv0;float rSrc=_ImageSize.x/max(_ImageSize.y,1.0);float rDst=_DestSize.x/max(_DestSize.y,1.0);bool maskOutside=false;if(_ImageScaleMode==0){vec2 scale=vec2(1.0);if(rDst>rSrc){scale=vec2(1.0,rSrc/rDst);}else{scale=vec2(rDst/rSrc,1.0);}uv=(uv-0.5)*scale+0.5;uv=clamp(uv,0.0,1.0);}else if(_ImageScaleMode==1){vec2 scale=vec2(1.0);if(rDst>rSrc){scale=vec2(rSrc/rDst,1.0);}else{scale=vec2(1.0,rSrc/rDst);}uv=(uv-0.5)*scale+0.5;maskOutside=true;}else if(_ImageScaleMode==2){uv=applyTransform(_TextureTransform,uv0);maskOutside=true;}else if(_ImageScaleMode==3){float aspectFix=rDst/max(rSrc,1e-6);vec2 uvTile=(uv0-0.5)*vec2(aspectFix,1.0)+0.5;float s=max(abs(_ImageScalingFactor),1e-6);uv=fract(uvTile*s);}vec4 img=texture2D(_ImageTex,uv);if(maskOutside){if(uv.x<0.0||uv.x>1.0||uv.y<0.0||uv.y>1.0){img.a=0.0;}}img.a*=_ImageOpacity;finalColor=img;}finalColor.rgb*=finalColor.a;gl_FragColor=finalColor;}",glslVersion:exports.GLSLVersion.GLSL1}},r=Pa.create(this.engine,e),i=t,n=i.side,o=i.occlusion,a=i.blending,s=i.mask,u=i.texture,c=this.maskManager.maskMode;r.blending=!0,r.depthTest=!0,r.depthMask=o,r.stencilRef=void 0!==s?[s,s]:void 0,Yo(r,a),qo(r,c),Zo(r,n),r.shader.shaderData.properties='_ImageTex("_ImageTex",2D) = "white" {}',r.setVector4("_TexOffset",new Vr(0,0,1,1)),r.setTexture("_ImageTex",u);var h=Wo(a),l=new Vr;return l.x=i.occlusion?+i.transparentOcclusion:1,l.y=h,l.z=i.renderMode,l.w=c,r.setVector4("_TexParams",l),0===l.x||this.maskManager.alphaMaskEnabled?r.enableMacro("ALPHA_CLIP"):r.disableMacro("ALPHA_CLIP"),r},r.fromData=function(e){var r;t.prototype.fromData.call(this,e),this.shapeDirty=!0,e.mask&&this.maskManager.setMaskOptions(e.mask);var i,n,o,a,s,u=null!=(r=e.renderer)?r:{};this.rendererOptions={renderMode:Ui.MESH,blending:null!=(i=u.blending)?i:Ii.ALPHA,texture:u.texture?this.engine.findObject(u.texture):this.engine.whiteTexture,occlusion:!!u.occlusion,transparentOcclusion:!!u.transparentOcclusion||this.maskManager.maskMode===exports.MaskMode.MASK,side:null!=(n=u.side)?n:wi.DOUBLE,mask:this.maskManager.getRefValue()},this.strokeCap=null!=(o=e.strokeCap)?o:pn.Butt,this.strokeWidth=null!=(a=e.strokeWidth)?a:1,this.strokeJoin=null!=(s=e.strokeJoin)?s:mn.Miter,this.fills.length=0,this.fillMaterials.length=0;for(var c,h=pr(e.fills);!(c=h()).done;){var l=c.value;this.fills.push(this.createPaint(l)),this.fillMaterials.push(this.createMaterialFromRendererOptions(this.rendererOptions))}this.strokes.length=0,this.strokeMaterials.length=0;for(var f,d=pr(e.strokes);!(f=d()).done;){var p=f.value;this.strokes.push(this.createPaint(p)),this.strokeMaterials.push(this.createMaterialFromRendererOptions(this.rendererOptions))}switch(this.materials=[].concat(this.fillMaterials,this.strokeMaterials),e.type){case dn.Custom:for(var m,v=e,y={type:dn.Custom,points:[],easingIns:[],easingOuts:[],shapes:[]},g=pr(v.points);!(m=g()).done;){var x=m.value;y.points.push(new Fr(x.x,x.y))}for(var T,_=pr(v.easingIns);!(T=_()).done;){var E=T.value;y.easingIns.push(new Fr(E.x,E.y))}for(var b,A=pr(v.easingOuts);!(b=A()).done;){var S=b.value;y.easingOuts.push(new Fr(S.x,S.y))}y.shapes=v.shapes,this.shapeAttributes=y;break;case dn.Ellipse:var R=e,C={type:dn.Ellipse,xRadius:R.xRadius,yRadius:R.yRadius};this.shapeAttributes=C;break;case dn.Rectangle:var M=e,O={type:dn.Rectangle,width:M.width,height:M.height,roundness:M.roundness};this.shapeAttributes=O;break;case dn.Star:var P=e,I={type:dn.Star,pointCount:P.pointCount,innerRadius:P.innerRadius,outerRadius:P.outerRadius,innerRoundness:P.innerRoundness,outerRoundness:P.outerRoundness};this.shapeAttributes=I;break;case dn.Polygon:var w=e,N={type:dn.Polygon,pointCount:w.pointCount,radius:w.radius,roundness:w.roundness};this.shapeAttributes=N}},r.createPaint=function(t){var e;switch(t.type){case ln.Solid:e={type:t.type,color:(new Br).copyFrom(t.color)};break;case ln.GradientLinear:case ln.GradientAngular:case ln.GradientRadial:e={type:t.type,gradientStops:Gu(t.gradientStops),startPoint:(new Fr).copyFrom(t.startPoint),endPoint:(new Fr).copyFrom(t.endPoint)};break;case ln.Texture:var r,i,n,o=qn({offset:{x:0,y:0},rotation:0,scale:{x:1,y:1}},null!=(r=t.textureTransform)?r:{});e={type:t.type,texture:this.engine.findObject(t.texture),scaleMode:t.scaleMode,scalingFactor:null!=(i=t.scalingFactor)?i:1,opacity:null!=(n=t.opacity)?n:1,textureTransform:{offset:(new Fr).copyFrom(o.offset),rotation:o.rotation,scale:(new Fr).copyFrom(o.scale)}}}return e},r.onApplyAnimationProperties=function(){this.shapeDirty=!0,this.materialDirty=!0},Io(e,[{key:"shape",get:function(){return this.shapeAttributes}}]),e}(Lo),exports.ShapeComponent=yr([In("ShapeComponent")],exports.ShapeComponent),exports.Fake3DAnimationMode=void 0,exports.Fake3DComponent=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).loop=!1,e.amountOfMotion=1,e.animationLength=2,e.mode=1,e.startPositionX=0,e.startPositionY=0,e.startPositionZ=0,e.endPositionX=0,e.endPositionY=0,e.endPositionZ=0,e.amplitudeX=0,e.amplitudeY=0,e.amplitudeZ=0,e.phaseX=0,e.phaseY=0,e.phaseZ=0,e}ji(e,t);var r=e.prototype;return r.onStart=function(){this.effectComponent=this.item.getComponent(exports.EffectComponent)},r.onUpdate=function(t){this.updateFake3D()},r.updateFake3D=function(){if(this.effectComponent){var t=this.item.time%this.animationLength/this.animationLength,e=0,r=0,i=0;switch(this.mode){case 0:var n=Math.PI;e=Math.sin(2*n*(t+this.phaseX))*this.amplitudeX,r=Math.sin(2*n*(t+this.phaseY))*this.amplitudeY,i=Math.sin(2*n*(t+this.phaseZ))*this.amplitudeZ;break;case 1:var o=t;this.loop&&(o>.5&&(o=1-o),o*=2),e=this.startPositionX*(1-o)+o*this.endPositionX,r=this.startPositionY*(1-o)+o*this.endPositionY,i=this.startPositionZ*(1-o)+o*this.endPositionZ}var a=this.effectComponent.material;a.setFloat("_PosX",e*this.amountOfMotion),a.setFloat("_PosY",r*this.amountOfMotion),a.setFloat("_PosZ",i*this.amountOfMotion)}},e}(wo),yr([wn()],exports.Fake3DComponent.prototype,"loop",void 0),yr([wn()],exports.Fake3DComponent.prototype,"amountOfMotion",void 0),yr([wn()],exports.Fake3DComponent.prototype,"animationLength",void 0),yr([wn()],exports.Fake3DComponent.prototype,"mode",void 0),yr([wn()],exports.Fake3DComponent.prototype,"startPositionX",void 0),yr([wn()],exports.Fake3DComponent.prototype,"startPositionY",void 0),yr([wn()],exports.Fake3DComponent.prototype,"startPositionZ",void 0),yr([wn()],exports.Fake3DComponent.prototype,"endPositionX",void 0),yr([wn()],exports.Fake3DComponent.prototype,"endPositionY",void 0),yr([wn()],exports.Fake3DComponent.prototype,"endPositionZ",void 0),yr([wn()],exports.Fake3DComponent.prototype,"amplitudeX",void 0),yr([wn()],exports.Fake3DComponent.prototype,"amplitudeY",void 0),yr([wn()],exports.Fake3DComponent.prototype,"amplitudeZ",void 0),yr([wn()],exports.Fake3DComponent.prototype,"phaseX",void 0),yr([wn()],exports.Fake3DComponent.prototype,"phaseY",void 0),yr([wn()],exports.Fake3DComponent.prototype,"phaseZ",void 0),exports.Fake3DComponent=yr([In("Fake3DComponent")],exports.Fake3DComponent),function(t){t[t.Circular=0]="Circular",t[t.Linear=1]="Linear"}(exports.Fake3DAnimationMode||(exports.Fake3DAnimationMode={})),exports.CameraController=function(t){function e(e,r){var i;return i=t.call(this,e)||this,r&&i.fromData(r),i}ji(e,t);var r=e.prototype;return r.onUpdate=function(){if(this.item.composition&&this.item.transform.getValid()){var t=this.item.composition.camera;t.near=this.options.near,t.far=this.options.far,t.fov=this.options.fov,t.clipMode=this.options.clipMode,t.transform.parentTransform=this.transform.parentTransform,t.position=this.transform.position,t.setQuat(this.transform.getQuaternion().clone().conjugate())}},r.fromData=function(e){t.prototype.fromData.call(this,e),this.options=e.options},e}(wo),exports.CameraController=yr([In(xn.CameraController)],exports.CameraController),exports.HitTestType=void 0;var Hu=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Xi);!function(t){t[t.triangle=1]="triangle",t[t.box=2]="box",t[t.sphere=3]="sphere",t[t.custom=4]="custom"}(exports.HitTestType||(exports.HitTestType={}));var ju="click",Wu="touchstart",Yu="touchmove",Zu="touchend",qu=function(){function t(t,e){void 0===e&&(e=!1),this.target=t,this.allowPropagation=e,this.enabled=!0,this.handlers={},this.nativeHandlers={}}var e=t.prototype;return e.bindListeners=function(){var t,e,i,n,o,a=this;o=function(t){return t};var s,u="mousedown",c="mousemove",h="mouseup",l="mouseleave",f=function(t,e,i,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var u=0,c=0,h=r.performance.now();if(!a.target)return ci.warn("Trigger TouchEvent after EventSystem is disposed."),{x:e,y:i,vx:0,vy:c,dx:o,dy:s,ts:h,width:0,height:0,origin:t};var l=a.target,f=l.width,d=l.height;if(n){var p=h-n.ts;u=(o-n.dx)/p||0,c=(s-n.dy)/p||0,n={dx:o,dy:s,ts:h}}return{x:e,y:i,vx:u,vy:c,dx:o,dy:s,ts:h,width:f,height:d,origin:t}};Kr()&&(o=function(t){var e=t.touches,r=t.changedTouches;return e[0]||r[0]},u="touchstart",c="touchmove",h="touchend",l="touchcancel"),this.nativeHandlers=((s={})[u]=function(s){if(a.enabled){var u=o(s),c=Ku(u);t=c.x,e=c.y,n=i={clientX:u.clientX,clientY:u.clientY,ts:r.performance.now(),x:t,y:e},a.dispatchEvent(Wu,f(s,t,e))}},s[c]=function(r){if(i&&a.enabled){var n=Ku(o(r));t=n.x,e=n.y,a.dispatchEvent(Yu,f(r,t,e,t-i.x,e-i.y))}},s[h]=function(r){if(i&&a.enabled){!a.allowPropagation&&r.cancelable&&(r.preventDefault(),r.stopPropagation());var n=o(r),s=Ku(n),u=Math.abs(i.clientX-n.clientX)+Math.abs(i.clientY-n.clientY);t=s.x,e=s.y,u<4&&a.dispatchEvent(ju,f(r,t,e)),a.dispatchEvent(Zu,f(r,t,e,t-i.x,e-i.y))}i=0},s),this.nativeHandlers[l]=this.nativeHandlers[h],Object.keys(this.nativeHandlers).forEach((function(t){var e;null==(e=a.target)||e.addEventListener(String(t),a.nativeHandlers[t])}))},e.dispatchEvent=function(t,e){var r=this.handlers[t];null==r||r.forEach((function(t){return t(e)}))},e.addEventListener=function(t,e){var r=this.handlers[t];return r||(r=this.handlers[t]=[]),Sr(r,e),function(){Rr(r,e)}},e.removeEventListener=function(t,e){var r=this.handlers[t];r&&Rr(r,e)},e.dispose=function(){var t=this;this.target&&(this.handlers={},Object.keys(this.nativeHandlers).forEach((function(e){var r;null==(r=t.target)||r.removeEventListener(String(e),t.nativeHandlers[e])})),this.nativeHandlers={},this.target=null)},t}();function Ku(t){var e=t.target,r=t.clientX,i=t.clientY,n=e.getBoundingClientRect(),o=n.left,a=n.top;return{x:(r-o)/n.width*2-1,y:1-(i-a)/n.height*2}}var Qu=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Xi),Ju=1,$u=function(){function t(t,e,r){this.transform=e,this.engine=r,this.color=t.options.previewColor;var i=this.createMaterial(),n=this.createGeometry();this.mesh=this.createMesh(n,i),this.updateMesh()}var e=t.prototype;return e.updateMesh=function(){var t=this.mesh.material,e=t.getVector2("uSize").clone(),r=t.getVector4("uPos").clone(),i=new Dr,n=new $n,o=this.transform.scale.clone();this.transform.assignWorldTRS(i,n,o),e.x=o.x,e.y=o.y,r.x=i.x,r.y=i.y,r.z=i.z,t.setVector2("uSize",e),t.setVector4("uPos",r),t.setQuaternion("uQuat",n)},e.createMaterial=function(){var t,e=[["ENV_EDITOR",(null==(t=this.engine.renderer)?void 0:t.env)===Fu]],r=Gu(this.color).getValue(0),i={shader:{vertex:"\nprecision highp float;\n\nattribute vec2 aPoint;\nuniform vec4 uPos;\nuniform vec2 uSize;\nuniform vec4 uQuat;\nuniform vec4 uColor;\nuniform mat4 effects_ObjectToWorld;\nuniform mat4 effects_MatrixInvV;\nuniform mat4 effects_MatrixVP;\nvarying vec4 vColor;\n\nvec3 rotateByQuat(vec3 a, vec4 quat){\n  vec3 qvec = quat.xyz;\n  vec3 uv = cross(qvec, a);\n  vec3 uuv = cross(qvec, uv) * 2.;\n  return a +(uv * 2. * quat.w + uuv);\n}\n\nvoid main() {\n  vec4 _pos = uPos;\n  vec3 point = rotateByQuat(vec3(aPoint.xy * uSize, 0.),uQuat);\n  vec4 pos = vec4(_pos.xyz, 1.0);\n  pos = effects_ObjectToWorld * pos;\n  pos.xyz += effects_MatrixInvV[0].xyz * point.x+ effects_MatrixInvV[1].xyz * point.y;\n  gl_Position = effects_MatrixVP * pos;\n  vColor = uColor;\n}\n",fragment:"\nprecision highp float;\n\n#define fragColor gl_FragColor\n\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vColor*vColor.a;\n}\n",glslVersion:exports.GLSLVersion.GLSL1,macros:e}},n=Pa.create(this.engine,i);return n.blending=!0,n.depthTest=!1,n.setVector4("uPos",new Vr(0,0,0,0)),n.setVector2("uSize",new Fr(1,1)),n.setVector4("uColor",new Vr(r[0]/255,r[1]/255,r[2]/255,r[3])),n.setQuaternion("uQuat",new $n(0,0,0,0)),n},e.createGeometry=function(){var t=new Uint8Array([0,1,1,2,2,3,3,0]);return ja.create(this.engine,{attributes:{aPoint:{size:2,offset:0,stride:2*Float32Array.BYTES_PER_ELEMENT,data:new Float32Array([-.5,.5,.5,.5,.5,-.5,-.5,-.5])}},drawCount:t.length,indices:{data:t},mode:ko.LINES,maxVertex:4})},e.createMesh=function(t,e){return ts.create(this.engine,{name:"Interact_preview"+Ju++,priority:0,worldMatrix:Do.fromIdentity(),geometry:t,material:e})},t}();function tc(t,e){var r=1e-5*(e||1);return t&&Math.abs(t.vx||0)<r&&Math.abs(t.vy||0)<r}exports.InteractComponent=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).downgrade=.95,e.speed=25,e.dragRatio=[1,1],e.dragRange={dxRange:[0,0],dyRange:[0,0]},e.invalidBorderRange=0,e.invalidByBorderRange=!1,e.duringPlay=!1,e._interactive=!0,e.lastTime=-1,e.getHitTestParams=function(t){if(e.clickable){var r=e.item.props.content.options.behavior,i=e.getBoundingBox();return i?{type:i.type,triangles:i.area,behavior:r}:void 0}},e}ji(e,t);var r=e.prototype;return r.getDragRangeX=function(){return this.dragRange.dxRange},r.setDragRangeX=function(t,e){this.dragRange.dxRange=[t,e]},r.getDragRangeY=function(){return this.dragRange.dyRange},r.setDragRangeY=function(t,e){this.dragRange.dyRange=[t,e]},r.onStart=function(){var t=this.item.engine.renderer.env,e=this.interactData.options,r=e.type,i=e.showPreview;r===Di.CLICK&&(this.clickable=!0,i&&t===Fu&&(this.previewContent=new $u(this.item.props.content,this.transform,this.engine))),this.previewContent&&(this.previewContent.mesh.item=this.item,this.materials=this.previewContent.mesh.materials),this.item.getHitTestParams=this.getHitTestParams},r.onDisable=function(){t.prototype.onDisable.call(this),this.item&&this.item.composition&&(this.duringPlay&&!this.item.transform.getValid()&&this.item.composition.getSpeed()>0&&(this.item.composition.removeInteractiveItem(this.item,this.item.props.content.options.type),this.duringPlay=!1),this.clickable=!1,this.endDragTarget())},r.onEnable=function(){t.prototype.onEnable.call(this);var e=this.interactData.options.type,r=this.item.engine.renderer.env;if(e===Di.CLICK)this.clickable=!0;else if(e===Di.DRAG){var i=this.interactData.options,n=i.enableInEditor;if(r!==Fu||n){var o,a=(null!=(o=this.item.composition)?o:{}).event;a&&this.beginDragTarget(i,a)}}},r.onUpdate=function(t){var e;if(this.duringPlay=!0,this.lastTime<=this.item.time){if(this.item.time>=0&&this.lastTime<0){var r,i=this.item.props.content.options;null==(r=this.item.composition)||r.addInteractiveItem(this.item,i.type)}}else if(this.item.time>=0&&t>0){var n,o=this.item.props.content.options;null==(n=this.item.composition)||n.addInteractiveItem(this.item,o.type)}this.lastTime=this.item.time,null==(e=this.previewContent)||e.updateMesh(),this.dragEvent&&this.bouncingArg&&(this.bouncingArg.vx*=this.downgrade,this.bouncingArg.vy*=this.downgrade,this.bouncingArg.dy+=this.bouncingArg.vy,this.bouncingArg.dx+=this.bouncingArg.vx,tc(this.bouncingArg)?(this.dragEvent=null,this.bouncingArg=null):this.handleDragMove(this.dragEvent,this.bouncingArg))},r.render=function(t){this.previewContent&&this.previewContent.mesh.render(t)},r.onDestroy=function(){var t;null==(t=this.previewContent)||t.mesh.dispose()},r.endDragTarget=function(){},r.handleDragMove=function(t,e){if((null==t?void 0:t.cameraParam)&&this.canInteract()&&this.item.composition){var r,i,n=t.cameraParam,o=n.position,a=n.fov,s=e.dy,u=e.dx*e.width/e.height,c=o[2],h=Math.tan(a*Math.PI/180/2)*Math.abs(c),l=s*h,f=u*h,d=this.dragRange,p=d.dxRange,m=d.dyRange,v=o[0]-this.dragRatio[0]*f,y=o[1]-this.dragRatio[1]*l,g=p[0],x=p[1],T=m[0],_=m[1];v=Lr(v,g,x),y=Lr(y,T,_),v!==g&&v!==x&&g!==x&&(null==(r=e.origin)||r.preventDefault()),y!==T&&y!==_&&T!==_&&(null==(i=e.origin)||i.preventDefault()),this.item.composition.camera.position=new Dr(v,y,c)}},r.beginDragTarget=function(t,r){var i=this;if("camera"===t.target){var n,o={touchstart:function(t){var e;if(i.canInteract()&&(i.invalidByBorderRange=i.checkInvalidBorderRange({x:t.x,y:t.y}),!i.invalidByBorderRange)){i.dragEvent=null,i.bouncingArg=null;var r=null==(e=i.item.composition)?void 0:e.camera;n={x:t.x,y:t.y,cameraParam:{position:(null==r?void 0:r.position.toArray())||[0,0,8],fov:(null==r?void 0:r.fov)||60}}}},touchmove:function(t){i.invalidByBorderRange||(i.handleDragMove(n,t),i.bouncingArg=t)},touchend:function(t){if(i.canInteract()){var e=i.bouncingArg;!tc(e,3)&&e&&(e.vx*=i.speed,e.vy*=i.speed,i.dragEvent=qn({},n)),n=null}}};Object.keys(o).forEach((function(t){r.addEventListener(t,o[t])})),o.touchmove({dx:0,dy:0,width:1,height:1}),this.item.getComponent(e).endDragTarget=function(){Object.keys(o).forEach((function(t){r.removeEventListener(t,o[t])}))}}},r.getBoundingBox=function(){var t=this.transform.getWorldMatrix(),e=qs(Dr.ZERO,.5*this.transform.size.x,.5*this.transform.size.y);return e.forEach((function(e){t.transformPoint(e.p0),t.transformPoint(e.p1),t.transformPoint(e.p2)})),{type:exports.HitTestType.triangle,area:e}},r.fromData=function(e){if(t.prototype.fromData.call(this,e),this.interactData=e,e.options.type===Di.DRAG){var r=e.options;r.dxRange&&(this.dragRange.dxRange=r.dxRange),r.dyRange&&(this.dragRange.dyRange=r.dyRange)}},r.canInteract=function(){var t;return Boolean(null==(t=this.item.composition)?void 0:t.interactive)&&this._interactive},r.checkInvalidBorderRange=function(t){var e=this.invalidBorderRange;if(e){var r=0,i=0,n=0,o=0;if("number"==typeof e)r=e,i=e,n=e,o=e;else if(fi(e)){var a,s,u,c,h;r=void 0===(s=(a=e)[0])?0:s,i=void 0===(u=a[1])?0:u,n=void 0===(c=a[2])?0:c,o=void 0===(h=a[3])?0:h}if(t.x<o-1||t.x>1-i||t.y<r-1||t.y>1-n)return!0}return!1},Io(e,[{key:"interactive",get:function(){return this._interactive},set:function(t){this._interactive=t,t||(this.bouncingArg=null)}}]),e}(Lo),exports.InteractComponent=yr([In(xn.InteractComponent)],exports.InteractComponent),exports.PlayState=void 0;var ec=function(){function t(){this.triangles=[],this.worldMatrix=new Do,this.assemblyTriangles=function(t,e,r,i,n){for(var o=r;o<i;o+=3){var a=3*e[o],s=3*e[o+1],u=3*e[o+2],c={x:t[a],y:t[a+1],z:t[a+2]},h={x:t[s],y:t[s+1],z:t[s+2]},l={x:t[u],y:t[u+1],z:t[u+2]};n.push({p0:c,p1:h,p2:l})}}}var e=t.prototype;return e.getBoundingBoxData=function(){return this.applyWorldMatrix(this.boundingBoxData.area),this.boundingBoxData},e.getBoundingBox=function(){for(var t,e=-Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,n=Number.MAX_VALUE,o=pr(this.boundingBoxData.area);!(t=o()).done;){var a=t.value;e=Math.max(a.p0.x,a.p1.x,a.p2.x,e),r=Math.max(a.p0.y,a.p1.y,a.p2.y,r),i=Math.min(a.p0.x,a.p1.x,a.p2.x,i),n=Math.min(a.p0.y,a.p1.y,a.p2.y,n)}var s=[],u=new Dr(i,r,0),c=new Dr(e,r,0),h=new Dr(e,n,0),l=new Dr(i,n,0);return s.push({p0:u,p1:c,p2:h}),s.push({p0:u,p1:h,p2:l}),this.applyWorldMatrix(s),{type:exports.HitTestType.triangle,area:s}},e.setGeometry=function(t,e){this.triangles=this.geometryToTriangles(t);for(var r,i=[],n=pr(this.triangles);!(r=n()).done;){var o=r.value;i.push({p0:o.p0,p1:o.p1,p2:o.p2})}e&&this.worldMatrix.copyFrom(e),this.boundingBoxData={type:exports.HitTestType.triangle,area:i}},e.geometryToTriangles=function(t){var e=t.getIndexData(),r=t.getAttributeData("aPos"),i=[];if(!e||!r)return i;if(0===t.subMeshes.length)this.assemblyTriangles(r,e,0,e.length,i);else for(var n,o=pr(t.subMeshes);!(n=o()).done;){var a=n.value;if(void 0!==a.indexCount){var s=e.BYTES_PER_ELEMENT,u=a.offset/s,c=u+a.indexCount;this.assemblyTriangles(r,e,u,c,i)}}return i},e.applyWorldMatrix=function(t){var e=this;return t.forEach((function(t){t.p0=e.worldMatrix.transformPoint(t.p0,new Dr),t.p1=e.worldMatrix.transformPoint(t.p1,new Dr),t.p2=e.worldMatrix.transformPoint(t.p2,new Dr)})),t},t}(),rc=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).name="sprite",e}return ji(e,t),e}(Xi),ic=function(){function t(){this.onPlayablePlayFlag=!0,this.onPlayablePauseFlag=!1,this.duration=0,this.destroyed=!1,this.playState=0,this.time=0}var e=t.prototype;return e.play=function(){switch(this.playState){case 0:break;case 1:this.playState=0,this.onPlayablePlayFlag=!0,this.onPlayablePauseFlag=!1}},e.pause=function(){0===this.playState&&(this.playState=1,this.onPlayablePauseFlag=!0,this.onPlayablePlayFlag=!1)},e.setTime=function(t){this.time=t},e.getTime=function(){return this.time},e.setDuration=function(t){this.duration=t},e.getDuration=function(){return this.duration},e.getPlayState=function(){return this.playState},e.prepareFrame=function(t){},e.processFrame=function(t){},e.onPlayableDestroy=function(){},e.dispose=function(){this.destroyed||(this.onPlayableDestroy(),this.destroyed=!0)},t}(),nc=function(){function t(){this.context={deltaTime:0,output:this}}var e=t.prototype;return e.setUserData=function(t){this.userData=t},e.getUserData=function(){return this.userData},e.prepareFrame=function(){},e.processFrame=function(){},t}(),oc=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Ln);function ac(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}!function(t){t[t.Playing=0]="Playing",t[t.Paused=1]="Paused"}(exports.PlayState||(exports.PlayState={}));var sc=new $n,uc=1,cc=function(){function t(t,e){void 0===t&&(t={}),this.taggedProperties={},this.position=new Dr(0,0,0),this.quat=new $n(0,0,0,1),this.rotation=new Ya(0,0,0),this.scale=new Dr(1,1,1),this.anchor=new Dr(0,0,0),this.size=new Fr(1,1),this.children=[],this.worldMatrix=Do.fromIdentity(),this.localMatrix=Do.fromIdentity(),this.valid=!0,this.dirtyFlags={localData:!1,localMatrix:!1,worldMatrix:!1,parentMatrix:!1},this.worldTRSCache={position:new Dr(0,0,0),quat:new $n(0,0,0,1),scale:new Dr(1,1,1)},this.name="transform_"+uc++,t&&this.setTransform(t),e&&(this.parentTransform=e),void 0!==t.valid&&this.setValid(t.valid)}var e=t.prototype;return e.setPosition=function(t,e,r){this.position.x===t&&this.position.y===e&&this.position.z===r||(this.position.x=t,this.position.y=e,this.position.z=r,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.translate=function(t,e,r){0===t&&0===e&&0===r||(this.position.x+=t,this.position.y+=e,this.position.z+=r,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setRotation=function(t,e,r){this.rotation.x===t&&this.rotation.y===e&&this.rotation.z===r||(this.rotation.x=t,this.rotation.y=e,this.rotation.z=r,this.quat.setFromEuler(this.rotation),this.quat.conjugate(),this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setQuaternion=function(t,e,r,i){this.quat.x===t&&this.quat.y===e&&this.quat.z===r&&this.quat.w===i||(this.quat.x=t,this.quat.y=e,this.quat.z=r,this.quat.w=i,this.rotation.setFromQuaternion(this.quat),this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setScale=function(t,e,r){this.scale.x===t&&this.scale.y===e&&this.scale.z===r||(this.scale.x=t,this.scale.y=e,this.scale.z=r,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setSize=function(t,e){this.size.x===t&&this.size.y===e||(this.size.x=t,this.size.y=e,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.rotateByQuat=function(t){this.quat.multiply(t),this.rotation.setFromQuaternion(this.quat),this.dirtyFlags.localData=!0,this.dispatchValueChange()},e.scaleBy=function(t,e,r){this.scale.x*=t,this.scale.y*=e,this.scale.z*=r,this.dirtyFlags.localData=!0,this.dispatchValueChange()},e.setAnchor=function(t,e){this.anchor.x===t&&this.anchor.y===e||(this.anchor.x=t,this.anchor.y=e,this.dirtyFlags.localData=!0,this.dispatchValueChange())},e.setTransform=function(t,e){var r=t.position,i=t.rotation,n=t.scale,o=t.size,a=t.quat,s=t.name,u=t.anchor;if(s&&(this.name=s),r&&(mr(r,Dr)?this.setPosition(r.x,r.y,r.z):this.setPosition(r[0],r[1],r[2])),a)mr(a,$n)?this.setQuaternion(a.x,a.y,a.z,a.w):this.setQuaternion(a[0],a[1],a[2],a[3]);else if(i){var c=e?-1:1;mr(i,Ya)?this.setRotation(i.x*c,i.y*c,i.z*c):this.setRotation(i[0]*c,i[1]*c,i[2]*c)}n&&(mr(n,Dr)?this.setScale(n.x,n.y,n.z):this.setScale(n[0],n[1],n[2])),o&&this.setSize(o.x,o.y),u&&(mr(u,Fr)?this.setAnchor(u.x,u.y):this.setAnchor(u[0],u[1]))},e.addChild=function(t){Sr(this.children,t)},e.removeChild=function(t){Rr(this.children,t)},e.getRotation=function(){return t.getRotation(this.quat,new Ya)},e.getQuaternion=function(){return this.quat},e.updateLocalMatrix=function(){this.valid?(this.dirtyFlags.localData&&(this.localMatrix.compose(this.position,this.quat,this.scale,this.anchor),this.dirtyFlags.localMatrix=!0),this.dirtyFlags.localData=!1):this.localMatrix.isIdentity()||(this.localMatrix.identity(),this.dirtyFlags.localMatrix=!0)},e.getMatrix=function(){return this.updateLocalMatrix(),this.localMatrix},e.getParentMatrix=function(){return this.parent&&(this.parentMatrix=this.parent.getWorldMatrix(),this.dirtyFlags.parentMatrix=this.dirtyFlags.parentMatrix||this.parent.dirtyFlags.localMatrix||this.parent.dirtyFlags.worldMatrix),this.parentMatrix},e.getWorldMatrix=function(){var t=this.getMatrix(),e=this.getParentMatrix();return(this.dirtyFlags.localMatrix||this.dirtyFlags.parentMatrix)&&(e?this.worldMatrix.multiplyMatrices(e,t):this.worldMatrix.copyFrom(t),this.dirtyFlags.worldMatrix=!0,this.dirtyFlags.localMatrix=!1,this.dirtyFlags.parentMatrix=!1),this.worldMatrix},e.getWorldScale=function(){var t=this.worldTRSCache;return this.dirtyFlags.worldMatrix&&(this.getWorldMatrix().decompose(t.position,t.quat,t.scale),this.dirtyFlags.worldMatrix=!1),this.worldTRSCache.scale.clone()},e.getWorldPosition=function(){return this.updateTRSCache(),this.worldTRSCache.position.clone()},e.getWorldRotation=function(){return this.updateTRSCache(),t.getRotation(this.worldTRSCache.quat,new Ya)},e.assignWorldTRS=function(t,e,r){this.updateTRSCache(),t&&t.copyFrom(this.worldTRSCache.position),e&&e.copyFrom(this.worldTRSCache.quat),r&&r.copyFrom(this.worldTRSCache.scale)},e.cloneFromMatrix=function(t,e){t.decompose(this.position,this.quat,this.scale),this.rotation.setFromQuaternion(this.quat.clone().conjugate()),e&&e.copyFrom(this.scale),this.dirtyFlags.localData=!0,this.dispatchValueChange()},e.setValid=function(t){this.valid!==t&&(this.valid=t,t?this.dirtyFlags.localData=!0:(this.localMatrix.identity(),this.dirtyFlags.localMatrix=!0),this.dispatchValueChange())},e.getValid=function(){return this.valid},e.toData=function(){var t=this.taggedProperties;return t.position=this.position.clone(),t.eulerHint={x:this.rotation.x,y:this.rotation.y,z:this.rotation.z},t.scale=this.scale.clone(),t},e.fromData=function(t){var e={};e.position=(new Dr).copyFrom(t.position),t.quat?e.quat=new $n(t.quat.x,t.quat.y,t.quat.z,t.quat.w):e.rotation=new Ya(t.eulerHint.x,t.eulerHint.y,t.eulerHint.z),e.scale=(new Dr).copyFrom(t.scale),t.size&&(e.size=(new Fr).copyFrom(t.size)),t.anchor&&(e.anchor=(new Fr).copyFrom(t.anchor)),this.setTransform(e)},e.dispose=function(){},e.updateTRSCache=function(){var t=this.getWorldMatrix();if(this.dirtyFlags.worldMatrix){var e=this.worldTRSCache;t.decompose(e.position,e.quat,e.scale),this.dirtyFlags.worldMatrix=!1}},e.dispatchValueChange=function(){this.children.forEach((function(t){t.parentMatrixDirty=!0}))},t.getRotation=function(t,e){var r=sc.copyFrom(t);return r.conjugate(),e.setFromQuaternion(r)},Io(t,[{key:"parentTransform",get:function(){return this.parent},set:function(t){t&&this.parent!==t&&this!==t&&(this.parent&&this.parent.removeChild(this),t.addChild(this),this.parent=t,this.parentMatrixDirty=!0)}},{key:"parentMatrixDirty",get:function(){return this.dirtyFlags.parentMatrix},set:function(t){this.dirtyFlags.parentMatrix!==t&&(this.dirtyFlags.parentMatrix=t,this.dispatchValueChange())}}]),t}(),hc=new Dr(1,1,1),lc=function(){function t(t,e){void 0===e&&(e={}),this.name=t,this.transform=new cc,this.pixelWidth=0,this.pixelHeight=0,this.viewportMatrix=Do.fromIdentity(),this.viewMatrix=Do.fromIdentity(),this.projectionMatrix=Do.fromIdentity(),this.viewProjectionMatrix=Do.fromIdentity(),this.inverseViewMatrix=Do.fromIdentity(),this.dirty=!0;var r=e.near,i=void 0===r?.1:r,n=e.far,o=void 0===n?20:n,a=e.fov,s=void 0===a?60:a,u=e.aspect,c=void 0===u?1:u,h=e.clipMode,l=void 0===h?Wi.portrait:h,f=e.position,d=void 0===f?[0,0,8]:f,p=e.rotation,m=void 0===p?[0,0,0]:p,v=e.pixelWidth,y=void 0===v?0:v,g=e.pixelHeight,x=void 0===g?0:g,T=new Ya(m[0],m[1],m[2]),_=(new $n).setFromEuler(T);this.options={near:i,far:o,fov:s,aspect:c,clipMode:l},this.pixelWidth=y,this.pixelHeight=x,this.transform.setPosition(d[0],d[1],d[2]),this.transform.setQuaternion(_.x,_.y,_.z,_.w),this.dirty=!0,this.updateMatrix()}var e=t.prototype;return e.setTransform=function(t){this.transform.parentTransform=t.parentTransform,this.transform.cloneFromMatrix(t.getMatrix()),this.dirty=!0},e.setViewportMatrix=function(t){this.viewportMatrix=t.clone(),this.dirty=!0},e.getViewportMatrix=function(){return this.viewportMatrix},e.getViewMatrix=function(){return this.updateMatrix(),this.viewMatrix.clone()},e.getInverseViewMatrix=function(){return this.updateMatrix(),this.inverseViewMatrix.clone()},e.getProjectionMatrix=function(){return this.updateMatrix(),this.projectionMatrix.clone()},e.getInverseProjectionMatrix=function(){var t;return this.updateMatrix(),null==(t=this.inverseProjectionMatrix)?void 0:t.clone()},e.getViewProjectionMatrix=function(){return this.updateMatrix(),this.viewProjectionMatrix.clone()},e.getInverseViewProjectionMatrix=function(){return this.updateMatrix(),this.inverseViewProjectionMatrix||(this.inverseViewProjectionMatrix=this.viewProjectionMatrix.clone(),this.inverseViewProjectionMatrix.invert()),this.inverseViewProjectionMatrix.clone()},e.getModelViewProjection=function(t,e){return t.multiplyMatrices(this.viewProjectionMatrix,e)},e.getInverseVPRatio=function(t){var e=new Dr(this.position.x,this.position.y,t),r=this.getViewProjectionMatrix(),i=this.getInverseViewProjectionMatrix();if(!this.viewportMatrix.isIdentity()){var n=this.viewportMatrix.clone();i.premultiply(n),r.multiply(n.invert())}var o=r.projectPoint(e).z,a=i.projectPoint(new Dr(1,1,o)),s=a.x,u=a.y,c=i.projectPoint(new Dr(-1,-1,o)),h=c.x,l=c.y;return new Dr((s-h)/2,(u-l)/2,0)},e.setQuat=function(t){this.transform.getQuaternion().equals(t)||(this.transform.setQuaternion(t.x,t.y,t.z,t.w),this.dirty=!0)},e.getQuat=function(){return this.transform.quat.clone()},e.getOptions=function(){return qn({},this.options,{position:this.position.clone(),rotation:this.rotation.clone()})},e.copy=function(t){var e=t.near,r=t.far,i=t.fov,n=t.clipMode,o=t.aspect,a=t.position,s=t.rotation;this.near=e,this.far=r,this.fov=i,this.clipMode=n,this.aspect=o,this.position=a,this.rotation=s,this.updateMatrix()},e.updateMatrix=function(){if(this.dirty){var t,e=this.options,r=e.fov,i=e.aspect,n=e.near,o=e.far,a=e.clipMode;this.projectionMatrix.perspective(r*Or,i,n,o,a===Wi.portrait),this.projectionMatrix.premultiply(this.viewportMatrix),this.inverseViewMatrix.compose(this.position,this.getQuat(),hc),this.inverseViewMatrix.premultiply(null!=(t=this.transform.getParentMatrix())?t:Do.IDENTITY),this.viewMatrix.copyFrom(this.inverseViewMatrix).invert(),this.viewProjectionMatrix.multiplyMatrices(this.projectionMatrix,this.viewMatrix),this.inverseViewProjectionMatrix=null,this.dirty=!1}},e.worldToScreenPoint=function(t,e){this.updateMatrix();var r=null!=e?e:new Dr,i=this.getViewProjectionMatrix();return r.set(t.x,t.y,t.z),i.projectPoint(r,r),r.x=.5*(r.x+1)*this.pixelWidth,r.y=.5*(r.y+1)*this.pixelHeight,r.z=.5*(r.z+1),r},e.screenToWorldPoint=function(t,e){this.updateMatrix();var r=null!=e?e:new Dr,i=this.getInverseViewProjectionMatrix(),n=t.x/this.pixelWidth*2-1,o=t.y/this.pixelHeight*2-1,a=2*t.z-1;return r.set(n,o,a),i.projectPoint(r,r),r},Io(t,[{key:"near",get:function(){return this.options.near},set:function(t){this.options.near!==t&&(this.options.near=t,this.dirty=!0)}},{key:"far",get:function(){return this.options.far},set:function(t){this.options.far!==t&&(this.options.far=t,this.dirty=!0)}},{key:"fov",get:function(){return this.options.fov},set:function(t){this.options.fov!==t&&(this.options.fov=t,this.dirty=!0)}},{key:"aspect",get:function(){return this.options.aspect},set:function(t){this.options.aspect!==t&&(this.options.aspect=t,this.dirty=!0)}},{key:"clipMode",get:function(){return this.options.clipMode},set:function(t){void 0!==t&&this.options.clipMode!==t&&(this.options.clipMode=t,this.dirty=!0)}},{key:"position",get:function(){return this.transform.position.clone()},set:function(t){this.transform.position.equals(t)||(this.transform.setPosition(t.x,t.y,t.z),this.dirty=!0)}},{key:"worldPosition",get:function(){return this.transform.getWorldPosition()}},{key:"rotation",get:function(){return this.transform.rotation.clone()},set:function(t){this.transform.rotation.equals(t)||(this.transform.setRotation(t.x,t.y,t.z),this.dirty=!0)}}]),t}(),fc=function(){function t(t){var e=this;Object.keys(t).forEach((function(r){e[r]=t[r]}))}return t.prototype.generate=function(t){var e=dc(this.arc,this.arcMode,t)*Or,r=Math.cos(e)*this.radius,i=Math.sin(e)*this.radius,n=new Dr(r,i,0),o=Math.tan(this.angle*Or),a=n.clone().multiply(o);return a.z+=1,{position:n.multiply(yi(0,1)),direction:a.normalize()}},t}();function dc(t,e,r){if(e===Qi.RANDOM)t=yi(0,t);else if(e===Qi.UNIDIRECTIONAL_CYCLE){var i=r.index%(r.total+1);t=t/r.total*i}else if(e===Qi.BIDIRECTIONAL_CYCLE){var n=r.index/(r.total+1),o=n-Math.floor(n);t*=Math.floor(n)%2?1-o:o}else e===Qi.UNIFORM_BURST&&(t=t*r.burstIndex/r.burstCount);return t}var pc,mc=function(){function t(t){var e=this;Object.keys(t).forEach((function(r){e[r]=t[r]}))}return t.prototype.generate=function(t){var e=dc(this.arc,this.arcMode,t)*Or,r=new Dr(Math.cos(e),Math.sin(e),0),i=this.radius;return{direction:r,position:r.clone().multiply(i)}},t}(),vc=function(){function t(t){this._d=(t.width||1)/2,this._h=(t.height||1)/2}return t.prototype.generate=function(t){var e=yi(-this._d,this._d),r=yi(-this._h,this._h);return{direction:new Dr(0,0,1),position:new Dr(e,r,0)}},t}(),yc=function(){function t(t){this._d=(t.width||1)/2,this._h=(t.height||1)/2,this.arcMode=t.arcMode,this.arc=t.arc}return t.prototype.generate=function(t){var e=dc(this.arc,this.arcMode,t)*Or,r=new Dr(Math.cos(e),Math.sin(e),0),i=this._d,n=this._h,o=Math.atan2(n,i),a=Math.tan(e),s=new Dr;return e<o?s.set(i,i*a,0):e>=o&&e<Math.PI-o?s.set(n/a,n,0):e<Math.PI+o?s.set(-i,-i*a,0):e<2*Math.PI-o?s.set(-n/a,-n,0):s.set(i,i*a,0),{direction:r,position:s}},t}(),gc=function(){function t(t){this._d=t.width||1,this.arcMode=t.arcMode}return t.prototype.generate=function(t){var e=this.arcMode===Qi.UNIFORM_BURST?t.burstIndex%t.burstCount/(t.burstCount-1):yi(0,1);return{direction:new Dr(0,1,0),position:new Dr(this._d*(e-.5),0,0)}},t}(),xc=new Do,Tc=function(){function t(t){var e=this;Object.keys(t).forEach((function(r){e[r]=t[r]}))}return t.prototype.generate=function(t){var e=this.donutRadius,r=this.radius-e,i=yi(0,2*Math.PI),n=dc(this.arc,this.arcMode,t)*Or,o=xc.setFromRotationZ(n),a=new Dr(Math.cos(i),Math.sin(i),0),s=new Dr(r+Math.cos(i)*e,0,Math.sin(i)*e);return{direction:o.transformNormal(a),position:o.transformPoint(s)}},t}(),_c=new Do,Ec=function(){function t(t){var e=this;Object.keys(t).forEach((function(r){e[r]=t[r]}))}var e=t.prototype;return e.getHorizontalAngle=function(){return yi(-90,90)},e.generate=function(t){var e=dc(this.arc,this.arcMode,t)*Or,r=this.getHorizontalAngle()*Or,i=this.radius,n=new Dr(Math.cos(r),0,Math.sin(r)),o=_c.setFromRotationZ(e).transformNormal(n);return{position:o.clone().multiply(i),direction:o}},t}(),bc=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.getHorizontalAngle=function(){return yi(0,90)},e}(Ec),Ac=function(){function t(t){var e=t.detail||{anchors:[.5,.5],block:[0,0]};this.anchors=new Float32Array(e.anchors),this.width=t.width||1,this.height=t.height||1,this.block=e.block,this.arcMode=t.arcMode,this.random=Lr(t.random||0,0,1)}return t.prototype.generate=function(t){var e=this.anchors,r=e.length/2-1,i=Math.floor(dc(r,this.arcMode,t)),n=(e[2*i]+this.block[0]*this.random*Math.random())%1-.5,o=(e[2*i+1]+this.block[1]*this.random*Math.random())%1-.5,a=new Dr(n,o,0);return{position:new Dr(n*this.width,o*this.height,0),direction:a.normalize()}},t}(),Sc=function(){function t(){}return t.prototype.generate=function(){return{position:new Dr,direction:new Dr}},t}(),Rc=((pc={})[Li.NONE]=Sc,pc[Li.CONE]=fc,pc[Li.SPHERE]=Ec,pc[Li.HEMISPHERE]=bc,pc[Li.CIRCLE]=mc,pc[Li.DONUT]=Tc,pc[Li.RECTANGLE]=vc,pc[Li.EDGE]=gc,pc[Li.RECTANGLE_EDGE]=yc,pc[Li.TEXTURE]=Ac,pc);function Cc(t){if(!t)return new Sc;var e=qn({radius:1,arc:360,angle:0,arcMode:Qi.RANDOM},t),r=t.type,i=Rc[r];if(!i)throw new Error("Invalid shape: "+r+".");var n=new i(e);if(r!==Li.NONE){var o=t.alignSpeedDirection,a=t.upDirection,s=void 0===a?[0,0,1]:a;n.alignSpeedDirection=o,n.upDirection=Dr.fromArray(s).normalize()}return n}function Mc(t,e,r,i,n){var o,a;if(n===function(t,e,r,i){for(var n=0,o=e,a=r-i;o<r;o+=i)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}(t,e,r,i)>0)for(o=e;o<r;o+=i)a=Wc(o,t[o],t[o+1],a);else for(o=r-i;o>=e;o-=i)a=Wc(o,t[o],t[o+1],a);return a&&kc(a,a.next)&&(Yc(a),a=a.next),a}function Oc(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!kc(i,i.next)&&0!==Uc(i.prev,i,i.next))i=i.next;else{if(Yc(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function Pc(t){var e=t.prev,r=t,i=t.next;if(Uc(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Vc(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&Uc(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Ic(t,e,r,i){var n=t.prev,o=t,a=t.next;if(Uc(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,u=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,c=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,h=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,l=Fc(s,u,e,r,i),f=Fc(c,h,e,r,i),d=t.prevZ,p=t.nextZ;d&&d.z>=l&&p&&p.z<=f;){if(d!==t.prev&&d!==t.next&&Vc(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Uc(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==t.prev&&p!==t.next&&Vc(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Uc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=l;){if(d!==t.prev&&d!==t.next&&Vc(n.x,n.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Uc(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&Vc(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&Uc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function wc(t,e){return t.x-e.x}function Nc(t,e){if(e=function(t,e){var r,i=e,n=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>a){if(a=s,s===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===a)return r;var u,c=r,h=r.x,l=r.y,f=1/0;i=r;do{n>=i.x&&i.x>=h&&n!==i.x&&Vc(o<l?n:a,o,h,l,o<l?a:n,o,i.x,i.y)&&(u=Math.abs(o-i.y)/(n-i.x),Hc(i,t)&&(u<f||u===f&&(i.x>r.x||i.x===r.x&&Lc(r,i)))&&(r=i,f=u)),i=i.next}while(i!==c);return r}(t,e),e){var r=jc(e,t);Oc(e,e.next),Oc(r,r.next)}}function Lc(t,e){return Uc(t.prev,t,e.prev)<0&&Uc(e.next,t,t.next)<0}function Fc(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Dc(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Vc(t,e,r,i,n,o,a,s){return(n-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(n-a)*(i-s)>=0}function Bc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&zc(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Hc(t,e)&&Hc(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)&&(Uc(t.prev,t,e.prev)||Uc(t,e.prev,e))||kc(t,e)&&Uc(t.prev,t,t.next)>0&&Uc(e.prev,e,e.next)>0)}function Uc(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function kc(t,e){return t.x===e.x&&t.y===e.y}function zc(t,e,r,i){var n=Xc(Uc(t,e,r)),o=Xc(Uc(t,e,i)),a=Xc(Uc(r,i,t)),s=Xc(Uc(r,i,e));return n!==o&&a!==s||!(0!==n||!Gc(t,r,e))||!(0!==o||!Gc(t,i,e))||!(0!==a||!Gc(r,t,i))||!(0!==s||!Gc(r,e,i))}function Gc(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Xc(t){return t>0?1:t<0?-1:0}function Hc(t,e){return Uc(t.prev,t,t.next)<0?Uc(t,e,t.next)>=0&&Uc(t,t.prev,e)>=0:Uc(t,e,t.prev)<0||Uc(t,t.next,e)<0}function jc(t,e){var r=new Zc(t.i,t.x,t.y),i=new Zc(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function Wc(t,e,r,i){var n=new Zc(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Yc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Zc(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var qc=0;function Kc(t,e,r,i){r=r||2,qc=i||0;var n,o,a,s,u,c,h,l=e&&e.length,f=l?e[0]*r:t.length,d=Mc(t,0,f,r,!0),p=[];if(!d||d.next===d.prev)return p;if(l&&(d=function(t,e,r,i){var n,o,a,s=[];for(n=0,o=e.length;n<o;n++)(a=Mc(t,e[n]*i,n<o-1?e[n+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),s.push(Dc(a));for(s.sort(wc),n=0;n<s.length;n++)Nc(s[n],r),r=Oc(r,r.next);return r}(t,e,d,r)),t.length>80*r){n=a=t[0],o=s=t[1];for(var m=r;m<f;m+=r)(u=t[m])<n&&(n=u),(c=t[m+1])<o&&(o=c),u>a&&(a=u),c>s&&(s=c);h=0!==(h=Math.max(a-n,s-o))?1/h:0}return Qc(d,p,r,n,o,h),p}function Qc(t,e,r,i,n,o,a){if(t){!a&&o&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=Fc(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,o,a,s,u,c=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,i=r,s=0,e=0;e<c&&(s++,i=i.nextZ);e++);for(u=c;s>0||u>0&&i;)0!==s&&(0===u||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,u--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,c*=2}while(a>1)}(n)}(t,i,n,o);for(var s,u,c=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Ic(t,i,n,o):Pc(t))e.push(s.i/r+qc),e.push(t.i/r+qc),e.push(u.i/r+qc),Yc(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?Qc(t=Jc(Oc(t),e,r),e,r,i,n,o,2):2===a&&$c(t,e,r,i,n,o):Qc(Oc(t),e,r,i,n,o,1);break}}}function Jc(t,e,r){var i=t;do{var n=i.prev,o=i.next.next;!kc(n,o)&&zc(n,i,i.next,o)&&Hc(n,o)&&Hc(o,n)&&(e.push(n.i/r+qc),e.push(i.i/r+qc),e.push(o.i/r+qc),Yc(i),Yc(i.next),i=t=o),i=i.next}while(i!==t);return Oc(i)}function $c(t,e,r,i,n,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Bc(a,s)){var u=jc(a,s);return a=Oc(a,a.next),u=Oc(u,u.next),Qc(a,e,r,i,n,o),void Qc(u,e,r,i,n,o)}s=s.next}a=a.next}while(a!==t)}function th(t,e){for(var r=t.s,i=t.p,n=r[1],o=i[1],a=0,s=0;s<n.length;s++)a+=n[s].length-1;var u,c=new Float32Array(6*a),h=e.indexBase,l=void 0===h?0:h,f=e.uvTransform,d=0,p=0,m=0,v=1,y=1;f&&(p=f[0],m=f[1],u=f[4],v=u?f[3]:f[2],y=u?f[2]:f[3]);for(var g=[0,0],x=0===u?0:-Math.PI/2,T=0;T<n.length;T++)for(var _=n[T],E=o[T],b=o[T+1]||o[0],A=_,S=[0,0],R=0;R<A.length-1;R++)ih(S,A[R],E,b,E[4],E[5],b[2],b[3]),M(S[0],S[1]);var C=Kc(Array.from(c),null,6,l);return{aPoint:c,index:new Uint16Array(C)};function M(t,e){c[d++]=t/2,c[d++]=e/2,f?(g[0]=t,g[1]=e,rh(g,g,x),c[d++]=p+(g[0]+1)/2*v,c[d++]=m+(g[1]+1)/2*y):(c[d++]=(t+1)/2,c[d++]=(e+1)/2),d+=2}}function eh(t,e){for(var r=[],i=function(t){var e=[];return"gs"in t?t.gs.forEach((function(t){e.push({p:[Yi.SHAPE_POINTS,t.p],s:[Yi.SHAPE_SPLITS,t.s]})})):"g"in t?e.push({p:[Yi.SHAPE_POINTS,t.g.p],s:[Yi.SHAPE_SPLITS,t.g.s]}):e.push(t),e}(t),n=0,o=0,a=0,s=0;s<i.length;s++){var u=th(i[s],{indexBase:n,uvTransform:e});n+=u.aPoint.length/5,r.push(u),o+=u.aPoint.length,a+=u.index.length}if(1===r.length)return r[0];for(var c=new Float32Array(o),h=new Uint16Array(a),l=0,f=0,d=0;l<r[l];l++){var p=r[l];c.set(p.aPoint,f),f+=p.aPoint.length,h.set(p.index,d),d+=p.index.length}return{aPoint:c,index:h}}function rh(t,e,r){var i=Math.cos(r),n=Math.sin(r),o=e[0],a=e[1];return t[0]=i*o+n*a,t[1]=-n*o+i*a,t}function ih(t,e,r,i,n,o,a,s){var u=1-e,c=u*u*u,h=3*e*u*u,l=3*e*e*u,f=e*e*e;return t[0]=c*r[0]+h*n+l*a+f*i[0],t[1]=c*r[1]+h*o+l*s+f*i[1],t}var nh=function(){function t(t){var e=t.time,r=t.interval,i=t.count,n=t.cycles,o=t.probability;this.time=+e||0,this.interval=+r||1,this.count=mr(i,mu)?i:Gu(i),this.cycles=+n||1/0,this.probability=isNaN(o)?1:+o,this.reset()}var e=t.prototype;return e.getGeneratorOptions=function(t,e){if(t-this.time-this.now>this.interval*this.index&&this.internalCycles>0)return this.internalCycles--,this.index++,Math.random()<=this.probability?{index:this.index,total:1/this.interval,count:this.count.getValue(e),cycleIndex:this.cycles-this.internalCycles-1}:null},e.reset=function(){this.internalCycles=this.cycles,this.index=0,this.now=0},e.clone=function(){return new t({time:this.time,interval:this.interval,count:this.count,cycles:this.cycles,probability:this.probability})},t}(),oh=function(t){this.content=t},ah=function(){function t(t){this.sort=t,this.length=0}var e=t.prototype;return e.findNodeByContent=function(t){var e=this.first;if(e)do{if(t(e.content))return e}while(e=e.next)},e.insertNode=function(t,e){var r=t.next;t.next=e,e.pre=t,e.next=r,r&&(r.pre=e)},e.shiftNode=function(t){var e=new oh(t);if(this.length++,1===this.length)return this.first=this.last=e;for(var r=this.first;r;){if(!(this.sort(r.content,e.content)<=0))return r.pre?this.insertNode(r.pre,e):(this.first=e,e.next=r,r.pre=e),e;if(!r.next)return this.insertNode(r,e),this.last=e;r=r.next}},e.pushNode=function(t){var e=new oh(t);if(this.length++,1===this.length)return this.last=this.first=e;for(var r=this.last;r;){if(!(this.sort(e.content,r.content)<=0))return this.insertNode(r,e),r===this.last&&(this.last=e),e;if(this.first===r)return r.pre=e,e.next=r,this.first=e;r=r.pre}},e.removeNode=function(t){var e=this.first;if(this.length--,e===t){var r=this.first=e.next;r&&(r.pre=null)}else if((e=this.last)===t){var i=this.last=e.pre;i&&(i.next=null)}else if(t){var n=t.pre,o=t.next;n.next=o,o&&(o.pre=n)}t.pre=null,t.next=null},e.forEach=function(t,e){var r=this.first,i=0;if(r)do{t.call(e||this,r.content,i++)}while(r=r.next)},e.forEachReverse=function(t,e){var r=this.last,i=this.length-1;if(r)do{t.call(e||this,r.content,i--)}while(r=r.pre)},e.getNodeByIndex=function(t){var e=0,r=this.first;if(!r||t>=this.length||t<0)return null;for(;e<t;)r=r.next,e++;return r},t}(),sh="lookup_texture",uh="offscreen_canvas",ch={};function hh(t){return ch[t]}var lh=new Dr,fh=new Dr,dh=function(){function t(t,e){this.pointStart=[];var r,i=e.colorOverLifetime,n=e.colorOverTrail,o=e.maxTrailCount,a=e.opacityOverLifetime,s=void 0===a?Gu(1):a,u=e.widthOverTrail,c=e.name,h=e.occlusion,l=e.blending,f=e.maskMode,d=e.mask,p=e.textureMap,m=void 0===p?[0,0,1,1]:p,v=e.texture,y=e.transparentOcclusion,g=e.minimumVertexDistance,x=e.lifetime,T=e.matrix,_=t.gpuCapability,E=_.detail,b=_.level,A=Math.max(e.pointCountPerTrail,2),S={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},R=E.maxVertexTextures>0,C=(null!=(r=t.renderer)?r:{}).env,M={},O=[["ENABLE_VERTEX_TEXTURE",R],["LOOKUP_TEXTURE_CURVE",0],["ENV_EDITOR",C===Fu]],P=o>64,I=0;i&&(O.push(["COLOR_OVER_LIFETIME",!0]),I|=1,M.uColorOverLifetime=ya.createWithData(t,ti(i))),n&&(O.push(["COLOR_OVER_TRAIL",!0]),I|=4,M.uColorOverTrail=ya.createWithData(t,ti(n))),P?(O.push(["ATTR_TRAIL_START",1]),I|=8):M.uTrailStart=new Float32Array(o),M.uOpacityOverLifetimeValue=s.toUniform(S);var w=u.toUniform(S);O.push(["VERT_CURVE_VALUE_COUNT",S.index],["VERT_MAX_KEY_FRAME_COUNT",S.max]),M.uVCurveValues=mu.getAllData(S);var N={shader:{vertex:us,fragment:as,macros:O,glslVersion:1===b?exports.GLSLVersion.GLSL1:exports.GLSLVersion.GLSL3,shared:!0,name:"trail#"+c,cacheId:"-t:+"+I+"+"+S.index+"+"+S.max}},L=A*o*2,F=(A-1)*o,D=Float32Array.BYTES_PER_ELEMENT,V=12*D,B={attributes:{aColor:{size:4,stride:V,data:new Float32Array(12*L)},aSeed:{size:1,stride:V,offset:4*D,dataSource:"aColor"},aInfo:{size:3,stride:V,offset:5*D,dataSource:"aColor"},aPos:{size:4,stride:V,offset:8*D,dataSource:"aColor"},aTime:{size:1,data:new Float32Array(L)},aDir:{size:3,data:new Float32Array(3*L)}},indices:{data:new Uint16Array(6*L)},drawCount:6*F,name:"trail#"+c,bufferUsage:ko.DYNAMIC_DRAW};if(P)B.attributes.aTrailStart={size:1,data:new Float32Array(L)};else{var U=new Float32Array(L);B.attributes.aTrailStartIndex={size:1,data:U};for(var k=0;k<o;k++)for(var z=2*A,G=k*z,X=0;X<z;X++)U[G+X]=k}var H=Wo(l),j=Pa.create(t,N);j.blending=!0,j.depthMask=h,j.depthTest=!0,j.stencilRef=d?[d,d]:void 0,qo(j,f),Yo(j,l);var W=this.mesh=ts.create(t,{name:"MTrail_"+c,material:j,geometry:ja.create(t,B)}),Y=null!=v?v:ya.createWithData(t);Object.keys(M).map((function(t){var e=M[t];if(mr(e,ya))j.setTexture(t,e);else if("uTrailStart"===t)j.setFloats("uTrailStart",e);else if("uVCurveValues"===t){for(var r=[],i=0;i<e.length;i+=4){var n=new Vr(e[i],e[i+1],e[i+2],e[i+3]);r.push(n)}j.setVector4Array(t,r)}else j.setVector4(t,Vr.fromArray(e))})),j.setFloat("uTime",0),j.setVector4("uWidthOverTrail",Vr.fromArray(w)),j.setVector2("uTexOffset",new Fr(0,0)),j.setVector4("uTextureMap",Vr.fromArray(m)),j.setVector4("uParams",new Vr(0,A-1,0,0)),j.setTexture("uMaskTex",Y),j.setVector4("uColorParams",new Vr(v?1:0,+H,0,+(h&&!y))),this.maxTrailCount=o,this.pointCountPerTrail=A,this.checkVertexDistance=g>0,this.minimumVertexDistance=Math.pow(g||.001,2),this.useAttributeTrailStart=P,this.lifetime=x,T&&(this.mesh.worldMatrix=T),this.geometry=W.firstGeometry(),this.trailCursors=new Uint16Array(o)}var e=t.prototype;return e.addPoint=function(t,e,r){r=r||{};var i=this.trailCursors[t],n=this.pointCountPerTrail,o=this.geometry,a=n-1,s=i%n,u=(i-1)%n,c=(i-2)%n,h=this.getTrailPosition(t,u,lh);if(!(h&&this.checkVertexDistance&&(null==h?void 0:h.distanceSquared(e))<this.minimumVertexDistance)){var l=t*n+s,f=yh(h,e),d=r.time||this.time,p=[Math.random(),r.lifetime||this.lifetime,i],m=r.size||1,v=6*l,y=new Float32Array(6);y.set(f,0),y.set(f,3),o.setAttributeSubData("aDir",v,y),o.setAttributeSubData("aTime",2*l,new Float32Array([d,d]));var g=r.color||[1,1,1,1],x=new Float32Array(24),T=e.toArray();if(x.set(g,0),x.set(p,4),x[7]=0,x.set(T,8),x[11]=.5*m,x.set(g,12),x.set(p,16),x[19]=1,x.set(T,20),x[23]=-.5*m,o.setAttributeSubData("aColor",24*l,x),u>=0){var _=this.getTrailPosition(t,c,fh),E=new Float32Array(yh(_,h,e)),b=6*(t*n+u);o.setAttributeSubData("aDir",b,E),o.setAttributeSubData("aDir",b+3,E);var A=t*n*2,S=new Uint16Array([2*u+A,2*u+1+A,2*s+A,2*s+A,2*u+1+A,2*s+1+A]),R=6*(t*a+(i-1)%a);o.setIndexSubData(R,S)}i=++this.trailCursors[t];var C=this.mesh.material,M=C.getVector4("uParams"),O=p[2];if(this.useAttributeTrailStart){for(var P=2*n,I=new Float32Array(P),w=0;w<P;w++)I[w]=O;o.setAttributeSubData("aTrailStart",t*I.length,I)}else{var N=C.getFloats("uTrailStart");null!=N&&(N[t]=O,C.setFloats("uTrailStart",N))}M&&(M.y=Math.max(M.y,i-1)-Math.max(0,i-n),C.setVector4("uParams",M))}},e.getTrailPosition=function(t,e,r){var i=this.pointCountPerTrail;if(e>=0&&e<i){var n=24*(t*i+e)+8,o=this.geometry.getAttributeData("aColor");return oi(o),r.x=o[n],r.y=o[1+n],r.z=o[2+n],r}},e.clearAllTrails=function(){var t=this.geometry.getIndexData();oi(t),this.trailCursors=new Uint16Array(this.trailCursors.length),this.geometry.setIndexData(new Uint16Array(t.length))},e.minusTime=function(t){var e=this.geometry.getAttributeData("aTime");oi(e);for(var r=0;r<e.length;r++)e[r]-=t;this.geometry.setAttributeData("aTime",e),this.time-=t},e.clearTrail=function(t){if(0!==this.trailCursors[t]){var e=6*(this.pointCountPerTrail-1),r=this.geometry.getIndexData();oi(r),r.set(new Uint16Array(e),t*e),this.geometry.setIndexData(r),this.trailCursors[t]=0}},e.getPointStartPos=function(t){return this.pointStart[t]},e.setPointStartPos=function(t,e){this.pointStart[t]=e},e.onUpdate=function(t){},Io(t,[{key:"time",get:function(){return this.mesh.material.getFloat("uTime")||0},set:function(t){this.mesh.material.setFloat("uTime",null!=t?t:0)}}]),t}(),ph=new Dr,mh=new Dr,vh=new Dr;function yh(t,e,r){var i=ph;return t||r?(t?r?(mh.subtractVectors(e,t).normalize(),mh.subtractVectors(r,e),vh.copyFrom(mh).normalize(),i.addVectors(mh,vh)):i.subtractVectors(e,t):i.subtractVectors(r,e),i.normalize().toArray()):[0,0,0]}var gh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).lastTime=0,e}ji(e,t);var r=e.prototype;return r.start=function(t){var e=t.output.getUserData();!this.particleSystem&&mr(e,exports.VFXItem)&&(this.particleSystem=e.getComponent(exports.ParticleSystem),this.particleSystem&&(this.particleSystem.name=e.name))},r.processFrame=function(t){this.time>=0&&this.start(t);var e=this.particleSystem;e&&(this.time>=0&&this.time<e.item.duration&&e.isEnded()&&e.reset(),e.update(this.time-e.time)),this.lastTime=this.time},e}(ic),xh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){return new gh},e}(oc),Th={uSprite:"vec4",uParams:"vec4",uAcceleration:"vec4",uGravityModifierValue:"vec4",uOpacityOverLifetimeValue:"vec4",uRXByLifeTimeValue:"vec4",uRYByLifeTimeValue:"vec4",uRZByLifeTimeValue:"vec4",uLinearXByLifetimeValue:"vec4",uLinearYByLifetimeValue:"vec4",uLinearZByLifetimeValue:"vec4",uSpeedLifetimeValue:"vec4",uOrbXByLifetimeValue:"vec4",uOrbYByLifetimeValue:"vec4",uOrbZByLifetimeValue:"vec4",uSizeByLifetimeValue:"vec4",uSizeYByLifetimeValue:"vec4",uColorParams:"vec4",uFSprite:"vec4",uPreviewColor:"vec4",uVCurveValues:"vec4Array",uFCurveValues:"vec4",uFinalTarget:"vec3",uForceCurve:"vec4",uOrbCenter:"vec3",uTexOffset:"vec2",uPeriodValue:"vec4",uMovementValue:"vec4",uStrengthValue:"vec4",uWaveParams:"vec4"},_h=function(){function t(t,e){var r;this.particleCount=0,this.cachedRotationVector3=new Dr,this.cachedRotationMatrix=new Za,this.cachedLinearMove=new Dr,this.tempMatrix3=new Za,this.VERT_MAX_KEY_FRAME_COUNT=0;var i,n,o=(null!=(r=t.renderer)?r:{}).env,a=e.speedOverLifetime,s=e.colorOverLifetime,u=e.linearVelOverLifetime,c=e.orbitalVelOverLifetime,h=e.sizeOverLifetime,l=e.rotationOverLifetime,f=e.sprite,d=e.gravityModifier,p=e.maxCount,m=e.textureFlip,v=e.useSprite,y=e.name,g=e.gravity,x=e.forceTarget,T=e.side,_=e.occlusion,E=e.anchor,b=e.blending,A=e.maskMode,S=e.mask,R=e.transparentOcclusion,C=e.meshSlots,M=e.renderMode,O=void 0===M?0:M,P=e.diffuse,I=void 0===P?ya.createWithData(t):P,w=t.gpuCapability.detail,N=w.halfFloatTexture,L=w.maxVertexUniforms,F=[["RENDER_MODE",+O],["ENV_EDITOR",o===Fu]],D=t.gpuCapability.level,V={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},B={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},U=L>0,k={},z=0,G=0;this.useSprite=v,U&&F.push(["ENABLE_VERTEX_TEXTURE",!0]),a&&(F.push(["SPEED_OVER_LIFETIME",!0]),G|=2,k.uSpeedLifetimeValue=a.toUniform(V)),(null==f?void 0:f.animate)&&(F.push(["USE_SPRITE",!0]),G|=4,k.uFSprite=k.uSprite=new Float32Array([f.col,f.row,f.total,f.blend?1:0]),this.useSprite=!0),(null==s?void 0:s.color)&&(F.push(["COLOR_OVER_LIFETIME",!0]),G|=16,k.uColorOverLifetime=mr(s.color,ya)?s.color:ya.createWithData(t,ti(s.color))),(null==s?void 0:s.opacity)?k.uOpacityOverLifetimeValue=s.opacity.toUniform(V):k.uOpacityOverLifetimeValue=Gu(1).toUniform(V),["x","y","z"].forEach((function(t,e){var r=0,n=0;(null==u?void 0:u[t])&&(k["uLinear"+t.toUpperCase()+"ByLifetimeValue"]=u[t].toUniform(V),r=1,G|=1<<7+e,u.enabled=!0),F.push(["LINEAR_VEL_"+t.toUpperCase(),r]),(null==c?void 0:c[t])&&(k["uOrb"+t.toUpperCase()+"ByLifetimeValue"]=c[t].toUniform(V),n=1,G|=1<<10+e,i=!0,c.enabled=!0),F.push(["ORB_VEL_"+t.toUpperCase(),n])})),(null==u?void 0:u.asMovement)&&(F.push(["AS_LINEAR_MOVEMENT",!0]),G|=32),i&&((null==c?void 0:c.asRotation)&&(F.push(["AS_ORBITAL_MOVEMENT",!0]),G|=64),k.uOrbCenter=new Float32Array((null==c?void 0:c.center)||[0,0,0])),k.uSizeByLifetimeValue=null==h?void 0:h.x.toUniform(V),(null==h?void 0:h.separateAxes)&&(F.push(["SIZE_Y_BY_LIFE",1]),G|=16384,k.uSizeYByLifetimeValue=null==h||null==(n=h.y)?void 0:n.toUniform(V)),(null==l?void 0:l.z)&&(k.uRZByLifeTimeValue=l.z.toUniform(V),G|=32768,F.push(["ROT_Z_LIFETIME",1])),(null==l?void 0:l.x)&&(k.uRXByLifeTimeValue=l.x.toUniform(V),G|=65536,F.push(["ROT_X_LIFETIME",1])),(null==l?void 0:l.y)&&(k.uRYByLifeTimeValue=l.y.toUniform(V),G|=1<<17,F.push(["ROT_Y_LIFETIME",1])),(null==l?void 0:l.asRotation)&&(F.push(["ROT_LIFETIME_AS_MOVEMENT",1]),G|=1<<18),k.uGravityModifierValue=d.toUniform(V),x&&(F.push(["FINAL_TARGET",!0]),G|=1<<19,k.uFinalTarget=new Float32Array(x.target||[0,0,0]),k.uForceCurve=x.curve.toUniform(V)),N&&B.max?(G|=1<<20,k.uFCurveValueTexture=ga(t,mu.getAllData(B,!0),B.index,1)):k.uFCurveValues=mu.getAllData(B);var X=V.max+V.curves.length-32>L;if(2===D&&(V.max=-1,V.index=C?C[0]:bh(V.index),B.index>0&&(B.max=-1,B.index=C?C[1]:bh(B.index))),X&&N&&U){var H=ga(t,mu.getAllData(V,!0),V.index,1);k.uVCurveValueTexture=H,z=1}else k.uVCurveValues=mu.getAllData(V);var j=["-p:",O,G,V.index,V.max,B.index,B.max].join("+");F.push(["VERT_CURVE_VALUE_COUNT",V.index],["FRAG_CURVE_VALUE_COUNT",B.index],["VERT_MAX_KEY_FRAME_COUNT",V.max],["FRAG_MAX_KEY_FRAME_COUNT",B.max]),this.VERT_MAX_KEY_FRAME_COUNT=V.max;var W={shader:{fragment:as,vertex:"#define LOOKUP_TEXTURE_CURVE "+z+"\n"+ss,glslVersion:1===D?exports.GLSLVersion.GLSL1:exports.GLSLVersion.GLSL3,shared:!0,cacheId:j,macros:F,name:"particle#"+y}},Y=Wo(b);k.uTexOffset=new Float32Array(I?[1/I.getWidth(),1/I.getHeight()]:[0,0]),k.uMaskTex=I,k.uColorParams=new Float32Array([I?1:0,+Y,0,+(!!_&&!R)]),k.uParams=[0,0,0,0],k.uAcceleration=[(null==g?void 0:g[0])||0,(null==g?void 0:g[1])||0,(null==g?void 0:g[2])||0,0];var Z=Pa.create(t,W);Z.blending=!0,Z.depthTest=!0,Z.depthMask=!!_,Z.stencilRef=S?[S,S]:void 0,qo(Z,A),Yo(Z,b),Zo(Z,T),Object.keys(k).map((function(t){var e=k[t];if(mr(e,ya))Z.setTexture(t,e);else{var r=[];switch(Th[t]){case"vec4":Z.setVector4(t,Vr.fromArray(e));break;case"vec3":Z.setVector3(t,Dr.fromArray(e));break;case"vec2":Z.setVector2(t,Fr.fromArray(e));break;case"vec4Array":for(var i=0;i<e.length;i+=4){var n=new Vr(e[i],e[i+1],e[i+2],e[i+3]);r.push(n)}Z.setVector4Array(t,r),r.length=0;break;default:console.warn("Uniform "+t+"'s type not in typeMap.")}}})),Z.setVector3("emissionColor",new Dr(0,0,0)),Z.setFloat("emissionIntensity",0);var q=ja.create(t,function(t,e,r){var i=Float32Array.BYTES_PER_ELEMENT,n=12*i,o={aPos:{size:3,offset:0,stride:n,data:new Float32Array(0)},aVel:{size:3,offset:3*i,stride:n,dataSource:"aPos"},aDirX:{size:3,offset:6*i,stride:n,dataSource:"aPos"},aDirY:{size:3,offset:9*i,stride:n,dataSource:"aPos"},aRot:{size:3,offset:0,stride:8*i,data:new Float32Array(0)},aSeed:{size:1,offset:3*i,stride:8*i,dataSource:"aRot"},aColor:{size:4,offset:4*i,stride:8*i,dataSource:"aRot"},aOffset:{size:4,stride:4*i,data:new Float32Array(0)},aTranslation:{size:3,data:new Float32Array(0)},aLinearMove:{size:3,data:new Float32Array(0)},aRotation0:{size:3,offset:0,stride:9*i,data:new Float32Array(0)},aRotation1:{size:3,offset:3*i,stride:9*i,dataSource:"aRotation0"},aRotation2:{size:3,offset:6*i,stride:9*i,dataSource:"aRotation0"}};return e&&(o.aSprite={size:3,stride:3*i,data:new Float32Array(0)}),{attributes:o,indices:{data:new Uint16Array(0)},name:r,maxVertex:t}}(4*p,this.useSprite,"particle#"+y)),K=ts.create(t,{name:"MParticle_"+y,material:Z,geometry:q});this.anchor=E,this.mesh=K,this.geometry=K.firstGeometry(),this.forceTarget=x,this.sizeOverLifetime=h,this.speedOverLifetime=a,this.linearVelOverLifetime=u,this.orbitalVelOverLifetime=c,this.orbitalVelOverLifetime=c,this.gravityModifier=d,this.rotationOverLifetime=l,this.maxCount=p,this.textureOffsets=m?[0,0,1,0,0,1,1,1]:[0,1,0,0,1,1,1,0],this.time=0}var e=t.prototype;return e.getPointColor=function(t){var e=this.geometry.getAttributeData("aRot"),r=32*t+4;return oi(e),[e[r],e[r+1],e[r+2],e[r+3]]},e.clearPoints=function(){this.resetGeometryData(this.geometry),this.particleCount=0,this.geometry.setDrawCount(0),this.maxParticleBufferCount=0},e.resetGeometryData=function(t){for(var e=t.getAttributeNames(),r=t.getIndexData(),i=0;i<e.length;i++){var n=e[i],o=t.getAttributeData(n);o&&t.setAttributeData(n,new o.constructor(0))}t.setIndexData(new r.constructor(0))},e.onUpdate=function(t){var e=this.geometry.getAttributeData("aPos"),r=Math.ceil(e.length/12);this.applyTranslation(r,t),this.applyRotation(r,t),this.applyLinearMove(r,t)},e.minusTime=function(t){for(var e=this.geometry.getAttributeData("aOffset"),r=0;r<e.length;r+=4)e[r+2]-=t;this.geometry.setAttributeData("aOffset",e),this.time-=t},e.removePoint=function(t){t<this.particleCount&&this.geometry.setAttributeSubData("aOffset",16*t,new Float32Array(16))},e.setPoint=function(t,e){var r=this.maxCount;if(t<r){var i=t+1,n=4*i,o=this.geometry,a=i>this.maxParticleBufferCount,s=1;this.particleCount>300?s=(this.particleCount+100)/this.particleCount:this.particleCount>100?s=1.4:this.particleCount>0&&(s=2);var u={aPos:new Float32Array(48),aRot:new Float32Array(32),aOffset:new Float32Array(16),aTranslation:new Float32Array(12),aLinearMove:new Float32Array(12),aRotation0:new Float32Array(36)},c=this.useSprite;c&&(u.aSprite=new Float32Array(12));var h=new Dr,l=new $n,f=new Dr(1,1,1);e.transform.assignWorldTRS(h,l,f);var d,p=cc.getRotation(l,new Ya),m=h.toArray(),v=p.toArray(),y=this.textureOffsets,g=[0,0,e.delay,e.lifetime],x=[0,0,1,1],T=e.vel,_=e.color,E=[-.5,.5,-.5,-.5,.5,.5,.5,-.5],b=Math.random();c&&(d=e.sprite);for(var A=0;A<4;A++){var S=2*A,R=3*A,C=4*A,M=12*A,O=8*A;u.aPos.set(m,M),T.fill(u.aPos,M+3),u.aRot.set(v,O),u.aRot[O+3]=b,u.aRot.set(_,O+4),c&&u.aSprite.set(d,R);var P=e.uv||x;if(P){var I=c?1-y[S+1]:y[S+1];g[0]=P[0]+y[S]*P[2],g[1]=P[1]+I*P[3]}u.aOffset.set(g,C);for(var w=A+A,N=(E[w]-this.anchor.x)*f.x,L=(E[w+1]-this.anchor.y)*f.y,F=0;F<3;F++)u.aPos[M+6+F]=e.dirX.getElement(F)*N,u.aPos[M+9+F]=e.dirY.getElement(F)*L}var D=new Uint16Array([0,1,2,2,1,3].map((function(e){return e+4*t})));if(a){var V=Cr(o.getIndexData(),6*i,6*r,s);V.set(D,6*t),o.setIndexData(V),this.maxParticleBufferCount=V.length/6}else o.setIndexSubData(6*t,D);Object.keys(u).forEach((function(e){var i=u[e],c=o.getAttributeStride(e)/Float32Array.BYTES_PER_ELEMENT;if(a){var h=o.getAttributeData(e);oi(h);var l=Cr(h,n*c,4*r*c,s);l.set(i,i.length*t),o.setAttributeData(e,l)}else o.setAttributeSubData(e,i.length*t,i)})),this.particleCount=Math.max(i,this.particleCount),o.setDrawCount(6*this.particleCount)}},e.applyTranslation=function(t,e){var r=this.time,i=this.geometry.getAttributeData("aTranslation"),n=this.geometry.getAttributeData("aVel"),o=this.geometry.getAttributeData("aOffset");i.length<3*t&&(i=this.expandArray(i,3*t));for(var a=0,s=0,u=0,c=this.mesh.material.getVector4("uAcceleration"),h=this.mesh.material.getVector4("uGravityModifierValue"),l=0;l<t;l+=4){var f=12*l+3;a=n[f],s=n[f+1],u=n[f+2];var d=r-o[4*l+2],p=o[4*l+3];if(c&&h){var m=this.gravityModifier.getIntegrateValue(0,d,p),v=c.x*m,y=c.y*m,g=c.z*m;if(this.speedOverLifetime){var x=this.speedOverLifetime.getValue(d/p);a=a*x+v,s=s*x+y,u=u*x+g}else a+=v,s+=y,u+=g}var T=3*l;if(o[4*l+2]<r){var _=a*(e/1e3),E=s*(e/1e3),b=u*(e/1e3);i[T]+=_,i[T+1]+=E,i[T+2]+=b,i[T+3]+=_,i[T+4]+=E,i[T+5]+=b,i[T+6]+=_,i[T+7]+=E,i[T+8]+=b,i[T+9]+=_,i[T+10]+=E,i[T+11]+=b}}this.geometry.setAttributeData("aTranslation",i)},e.applyRotation=function(t,e){var r=this.geometry.getAttributeData("aRotation0"),i=this.geometry.getAttributeData("aOffset"),n=this.geometry.getAttributeData("aRot"),o=this.geometry.getAttributeData("aSeed"),a=this.time,s=this.cachedRotationMatrix;r.length<9*t&&(r=this.expandArray(r,9*t));for(var u=0;u<t;u+=4){var c=Lr((a-i[4*u+2])/i[4*u+3],0,1),h=8*u,l=this.cachedRotationVector3.set(n[h],n[h+1],n[h+2]),f=o[8*u+3],d=l;this.rotationOverLifetime?(this.rotationOverLifetime.x&&(mr(this.rotationOverLifetime.x,gu)?d.x+=this.rotationOverLifetime.x.getValue(c,f):d.x+=this.rotationOverLifetime.x.getValue(c)),this.rotationOverLifetime.y&&(mr(this.rotationOverLifetime.y,gu)?d.y+=this.rotationOverLifetime.y.getValue(c,f):d.y+=this.rotationOverLifetime.y.getValue(c)),this.rotationOverLifetime.z&&(mr(this.rotationOverLifetime.z,gu)?d.z+=this.rotationOverLifetime.z.getValue(c,f):d.z+=this.rotationOverLifetime.z.getValue(c))):s.setZero(),0===d.dot(d)&&s.identity();var p=Math.PI/180,m=d.x*p,v=d.y*p,y=d.z*p,g=Math.sin(m),x=Math.sin(v),T=Math.sin(y),_=Math.cos(m),E=Math.cos(v),b=Math.cos(y);s.set(b,-T,0,T,b,0,0,0,1),s.multiply(this.tempMatrix3.set(E,0,x,0,1,0,-x,0,E)),s.multiply(this.tempMatrix3.set(1,0,0,0,_,-g,0,g,_));var A=9*u,S=s.elements;r.set(S,A),u+4<=t&&(r.set(S,A+9),r.set(S,A+18),r.set(S,A+27))}this.geometry.setAttributeData("aRotation0",r)},e.applyLinearMove=function(t,e){var r=this.geometry.getAttributeData("aLinearMove"),i=this.geometry.getAttributeData("aOffset"),n=this.geometry.getAttributeData("aSeed"),o=this.time;r.length<3*t&&(r=this.expandArray(r,3*t));var a=this.cachedLinearMove;if(this.linearVelOverLifetime&&this.linearVelOverLifetime.enabled)for(var s=0;s<t;s+=4){var u=o-i[4*s+2],c=i[4*s+3],h=u/c,l=n[8*s+3];a.setZero(),this.linearVelOverLifetime.asMovement?(this.linearVelOverLifetime.x&&(mr(this.linearVelOverLifetime.x,gu)?a.x=this.linearVelOverLifetime.x.getValue(h,l):a.x=this.linearVelOverLifetime.x.getValue(h)),this.linearVelOverLifetime.y&&(mr(this.linearVelOverLifetime.y,gu)?a.y=this.linearVelOverLifetime.y.getValue(h,l):a.y=this.linearVelOverLifetime.y.getValue(h)),this.linearVelOverLifetime.z&&(mr(this.linearVelOverLifetime.z,gu)?a.z=this.linearVelOverLifetime.z.getValue(h,l):a.z=this.linearVelOverLifetime.z.getValue(h))):(this.linearVelOverLifetime.x&&(mr(this.linearVelOverLifetime.x,gu)?a.x=this.linearVelOverLifetime.x.getIntegrateValue(0,u,l):a.x=this.linearVelOverLifetime.x.getIntegrateValue(0,u,c)),this.linearVelOverLifetime.y&&(mr(this.linearVelOverLifetime.y,gu)?a.y=this.linearVelOverLifetime.y.getIntegrateValue(0,u,l):a.y=this.linearVelOverLifetime.y.getIntegrateValue(0,u,c)),this.linearVelOverLifetime.z&&(mr(this.linearVelOverLifetime.z,gu)?a.z=this.linearVelOverLifetime.z.getIntegrateValue(0,u,l):a.z=this.linearVelOverLifetime.z.getIntegrateValue(0,u,c)));var f=3*s;r[f]=a.x,r[f+1]=a.y,r[f+2]=a.z,r[f+3]=a.x,r[f+4]=a.y,r[f+5]=a.z,r[f+6]=a.x,r[f+7]=a.y,r[f+8]=a.z,r[f+9]=a.x,r[f+10]=a.y,r[f+11]=a.z}this.geometry.setAttributeData("aLinearMove",r)},e.expandArray=function(t,e){var r=new Float32Array(e);return r.set(t),r},t}(),Eh=[10,32,64,160];function bh(t){for(var e=0;e<Eh.length;e++){var r=Eh[e];if(r>t)return r}return t||Eh[0]}var Ah=function(t){function e(e,r,i){var n;(n=t.call(this,e)||this).name="ParticleSystemRenderer",r&&(n.particleMesh=new _h(e,r)),i&&(n.trailMesh=new dh(e,i));var o=[n.particleMesh.mesh];return n.materials.push(n.particleMesh.mesh.material),n.trailMesh&&(o.push(n.trailMesh.mesh),n.materials.push(n.trailMesh.mesh.material)),n.meshes=o,n}ji(e,t);var r=e.prototype;return r.onStart=function(){this._priority=this.item.renderOrder;for(var t,e=pr(this.meshes);!(t=e()).done;)t.value.onStart()},r.onUpdate=function(t){var e,r=this.particleMesh.time,i=null!=(e=this.particleMesh.mesh.material.getVector4("uParams"))?e:new Vr;this.particleMesh.mesh.material.setVector4("uParams",i.set(r,this.item.duration,0,0))},r.render=function(t){this.maskManager.drawStencilMask(t);for(var e,r=pr(this.meshes);!(e=r()).done;)e.value.render(t)},r.reset=function(){var t;this.particleMesh.clearPoints(),null==(t=this.trailMesh)||t.clearAllTrails()},r.updateTime=function(t,e){this.particleMesh.time=t,this.particleMesh.onUpdate(e),this.trailMesh&&(this.trailMesh.time=t,this.trailMesh.onUpdate(e))},r.minusTimeForLoop=function(t){var e;this.particleMesh.minusTime(t),null==(e=this.trailMesh)||e.minusTime(t)},r.updateWorldMatrix=function(t){this.particleMesh.mesh.worldMatrix=t,this.trailMesh&&(this.trailMesh.mesh.worldMatrix=t)},r.setVisible=function(t){var e;this.particleMesh.mesh.setVisible(t),null==(e=this.trailMesh)||e.mesh.setVisible(t)},r.getTextures=function(){var t=[],e=this.particleMesh.mesh.material.textures;if(Object.keys(e).forEach((function(r){t.push(e[r])})),this.trailMesh){var r=this.trailMesh.mesh.material.textures;Object.keys(r).forEach((function(e){t.push(r[e])}))}return t},r.setParticlePoint=function(t,e){this.particleMesh.setPoint(t,e)},r.removeParticlePoint=function(t){this.particleMesh.removePoint(t)},r.getParticlePointColor=function(t){return this.particleMesh.getPointColor(t)},r.hasTrail=function(){return void 0!==this.trailMesh},r.clearTrail=function(t){var e;null==(e=this.trailMesh)||e.clearTrail(t)},r.addTrailPoint=function(t,e,r){var i;null==(i=this.trailMesh)||i.addPoint(t,e,r)},r.setTrailStartPosition=function(t,e){var r;null==(r=this.trailMesh)||r.setPointStartPos(t,e)},r.getTrailStartPosition=function(t){return this.trailMesh.getPointStartPos(t)},e}(Lo);exports.ParticleSystem=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).destroyed=!1,i.getHitTestParams=function(t){var e=i.interaction;if(t||e)return{type:exports.HitTestType.custom,collect:function(t){return i.raycast({radius:(null==e?void 0:e.radius)||.4,multiple:!!(null==e?void 0:e.multiple),removeParticle:(null==e?void 0:e.behavior)===Ki.removeParticle,ray:t})}}},i.maskManager=new Ia(e),r&&i.fromData(r),i}ji(e,t);var r=e.prototype;return r.isFrozen=function(){return this.frozen},r.isEnded=function(){return this.ended},r.initEmitterTransform=function(){var t,e=this.item.transform.position.clone(),r=this.item.transform.rotation.clone(),i=this.props.emitterTransform&&this.props.emitterTransform.path;i&&(i[0]===Yi.CONSTANT_VEC3?e.add(i[1]):t=Gu(i)),this.basicTransform={position:e,rotation:r,path:t};var n=e.clone();if(t&&n.add(t.getValue(0)),this.transform.setPosition(n.x,n.y,n.z),this.options.particleFollowParent){var o=this.transform.getWorldMatrix();this.renderer.updateWorldMatrix(o)}},r.updateEmitterTransform=function(t){var e=this.basicTransform,r=e.path,i=e.position.clone();if(r){var n=this.item.duration;i.add(r.getValue(t/n))}if(this.transform.setPosition(i.x,i.y,i.z),this.options.particleFollowParent){var o=this.transform.getWorldMatrix();this.renderer.updateWorldMatrix(o)}},r.addParticle=function(t,e){var r,i=this.particleLink,n=[t.delay+t.lifetime,0,t.delay,t];if(i.length<e)r=n[1]=i.length;else{var o=i.first;i.removeNode(o),r=n[1]=o.content[1]}i.pushNode(n),this.renderer.setParticlePoint(r,t),this.clearPointTrail(r),this.transform.parentTransform&&this.renderer.setTrailStartPosition(r,this.transform.parentTransform.position.clone())},r.setVisible=function(t){this.renderer.setVisible(t)},r.getTextures=function(){return this.renderer.getTextures()},r.startEmit=function(){this.started&&!this.ended||(this.reset(),this.started=!0,this.ended=!1)},r.stop=function(){this.ended=!0,this.started=!1},r.reset=function(){this.renderer.reset(),this.time=0,this.loopStartTime=0,this.lastEmitTime=-1/this.emission.rateOverTime.getValue(0),this.generatedCount=0,this.particleLink=new ah((function(t,e){return t[0]-e[0]})),this.emission.bursts.forEach((function(t){return t.reset()})),this.frozen=!1,this.ended=!1,this.destroyed=!1},r.onStart=function(){this.startEmit(),this.initEmitterTransform()},r.onUpdate=function(t){this.update(t)},r.update=function(t){var e=this;if(this.started&&!this.frozen){var r=this.time+t/1e3,i=this.options,n=this.loopStartTime,o=this.emission;this.time=r,this.upDirectionWorld=null,this.renderer.updateTime(r,t);var a=this.particleLink,s=(r-n)/this.item.duration,u=this.timePassed,c=!1,h=function(){e.trails&&!c&&(c=!0,a.forEach((function(t){var r=t[0],i=t[1],n=t[2],o=t[3];r<u?e.clearPointTrail(i):u>n&&e.updatePointTrail(i,s,o,n)})))};if(this.ended){if(this.item.endBehavior!==qi.restart&&qi.destroy===this.item.endBehavior){var l=a.last;l&&l.content[0]<this.time&&(this.destroyed=!0)}}else{var f=this.item.duration,d=this.lifetime;if(u<f){var p=1/o.rateOverTime.getValue(d),m=Math.floor((u-this.lastEmitTime)/p),v=m,y=p/m,g=r,x=i.maxCount;this.updateEmitterTransform(u);for(var T=function(){var t=a.first;return e.emissionStopped||a.length===x&&t&&t.content[0]-n>u},_=0;_<v&&_<x&&!T();_++){var E=this.createPoint(d);E.delay+=g+_*y,this.addParticle(E,x),this.lastEmitTime=u}for(var b=o.bursts,A=(null==b?void 0:b.length)-1,S=0;A>=0&&S<x&&!T();A--){var R=b[A],C=!R.disabled&&R.getGeneratorOptions(u,d);if(C){var M=o.burstOffsets[A],O=M&&M[C.cycleIndex]||[0,0,0];R.once&&this.removeBurst(A);for(var P=0;P<C.count&&S<x;P++){var I;if(T())break;var w=this.initPoint(this.shape.generate({total:C.total,index:C.index,burstIndex:P,burstCount:C.count}));w.delay+=g,S++,(I=w.transform).translate.apply(I,[].concat(O)),this.addParticle(w,x)}}}}else this.item.endBehavior===qi.restart?(h(),this.loopStartTime=r-f,this.lastEmitTime-=f,this.time-=f,o.bursts.forEach((function(t){return t.reset()})),this.particleLink.forEach((function(t){t[0]-=f,t[2]-=f,t[3].delay-=f})),this.renderer.minusTimeForLoop(f)):(this.ended=!0,this.item.endBehavior===qi.freeze&&(this.frozen=!0))}h()}},r.drawStencilMask=function(t){if(this.isActiveAndEnabled){for(var e=[],r=0;r<this.renderer.meshes.length;r++){var i=this.renderer.meshes[r].material;e.push(i.colorMask),i.colorMask=!1}for(var n,o=pr(this.renderer.meshes);!(n=o()).done;)n.value.render(t);for(var a=0;a<this.renderer.meshes.length;a++)this.renderer.meshes[a].material.colorMask=e[a]}},r.onDestroy=function(){this.item&&this.item.composition&&this.meshes.forEach((function(t){return t.dispose()}))},r.getParticleBoxes=function(){var t=this.particleLink,e=this.renderer,r=[],i=this.particleCount,n=0;if(!t||!e)return r;for(var o=t.last,a=!1;!a;){var s=o.content[0],u=o.content[3];if(s>this.timePassed){var c=this.getPointPosition(u);r.push({center:c,size:u.transform.scale}),o.pre?o=o.pre:a=!0}++n>i&&(a=!0)}return r},r.raycast=function(t){var e=this.particleLink,r=this.renderer;if(e&&r){var i=e.last,n=[],o=new Dr,a=!1;if(i&&i.content)do{var s=i.content,u=s[0],c=s[1];s[2];var h=s[3];if(u>this.timePassed){var l=this.getPointPosition(h),f=t.ray,d=!1;f&&(d=!!f.intersectSphere({center:l,radius:t.radius},o)),d&&(t.removeParticle&&(r.removeParticlePoint(c),this.clearPointTrail(c),i.content=[0]),n.push(l),t.multiple||(a=!0))}}while((i=i.pre)&&!a);return n}},r.clearPointTrail=function(t){this.trails&&this.trails.dieWithParticles&&this.renderer.clearTrail(t)},r.updatePointTrail=function(t,e,r,i){var n=this.renderer;if(n.hasTrail()){var o=this.trails,a=this.getPointPosition(r),s=o.inheritParticleColor?n.getParticlePointColor(t):[1,1,1,1],u=r.transform.getWorldScale().toArray(),c=1,h=o.lifetime.getValue(e);if(o.sizeAffectsWidth&&(c*=u[0]),o.sizeAffectsLifetime&&(h*=u[0]),o.parentAffectsPosition&&this.transform.parentTransform){a.add(this.transform.parentTransform.position);var l=n.getTrailStartPosition(t);l&&a.subtract(l)}n.addTrailPoint(t,a,{color:s,lifetime:h,size:c,time:i})}},r.getPointPositionByIndex=function(t){var e=this.particleLink.getNodeByIndex(t);return e?this.getPointPosition(e.content[3]):(console.error("Get point error."),null)},r.getPointPosition=function(t){var e=t.transform,r=t.vel,i=t.lifetime,n=t.delay,o=t.gravity,a=void 0===o?[]:o,s=this.options.forceTarget,u=this.time-n,c=new Dr,h=Dr.fromArray(a);e.assignWorldTRS(c);var l=Gs(new Dr,this.options,h,u,i,c,r);if(s){var f=s.target||[0,0,0],d=s.curve.getValue(u/i),p=1-d;l.x=l.x*p+f[0]*d,l.y=l.y*p+f[1]*d,l.z=l.z*p+f[2]*d}return l},r.initPoint=function(t){var e=this.options,r=this.lifetime,i=this.shape,n=e.startSpeed.getValue(r),o=e.particleFollowParent?Do.IDENTITY:this.transform.getWorldMatrix(),a=t.position,s=o.transformPoint(a,new Dr),u=new cc({position:s,valid:!0}),c=t.direction;if(c=o.transformNormal(c,Sh).normalize(),e.startTurbulence&&e.turbulence){for(var h=0;h<3;h++)Ph.setElement(h,e.turbulence[h].getValue(r));Ih.setFromVector3(Ph.negate()),Nh.setFromEuler(Ih).transformNormal(c).normalize()}var l,f=Mh,d=Oh;i.alignSpeedDirection?(d.copyFrom(c),this.upDirectionWorld||(i.upDirection?this.upDirectionWorld=i.upDirection.clone():this.upDirectionWorld=Dr.Z.clone(),o.transformNormal(this.upDirectionWorld)),f.crossVectors(d,this.upDirectionWorld).normalize(),f.isZero()&&f.set(1,0,0)):(f.set(1,0,0),d.set(0,1,0));var p=this.textureSheetAnimation;p&&p.animate&&((l=wh)[0]=p.animationDelay.getValue(r),l[1]=p.animationDuration.getValue(r),l[2]=p.cycles.getValue(r));var m=Ch;e.start3DRotation?m.set(e.startRotationX.getValue(r),e.startRotationY.getValue(r),e.startRotationZ.getValue(r)):e.startRotation?m.set(0,0,e.startRotation.getValue(r)):m.set(0,0,0),u.setRotation(m.x,m.y,m.z);var v=e.startColor.getValue(r);3===v.length&&(v[3]=1);var y=Rh;if(e.start3DSize)y.x=e.startSizeX.getValue(r),y.y=e.startSizeY.getValue(r);else{var g=e.startSize.getValue(r),x=e.sizeAspect.getValue(r);y.x=g,y.y=0===x?0:g/x}var T=c.clone();if(T.multiply(n),!e.particleFollowParent){var _=new Dr;this.transform.assignWorldTRS(void 0,void 0,_),y.x*=_.x,y.y*=_.y}return u.setScale(y.x,y.y,1),{size:y,vel:T,color:v,delay:e.startDelay.getValue(r),lifetime:e.startLifetime.getValue(r),uv:Fh(this.uvs,!0),gravity:e.gravity,sprite:l,dirY:d,dirX:f,transform:u}},r.addBurst=function(t,e){var r=!1;if(this.emission.bursts.includes(t)||(this.emission.bursts.push(t),r=!0),r&&mr(e,Array)){var i=this.emission.bursts.indexOf(t);return this.emission.burstOffsets[i]=e,i}return-1},r.removeBurst=function(t){t<this.emission.bursts.length&&(this.emission.burstOffsets[t]=null,this.emission.bursts.splice(t,1))},r.createPoint=function(t){var e={total:this.emission.rateOverTime.getValue(t),index:this.generatedCount,burstIndex:0,burstCount:0};return this.generatedCount++,this.initPoint(this.shape.generate(e))},r.stopParticleEmission=function(){this.emissionStopped=!0},r.resumeParticleEmission=function(){this.emissionStopped=!1},r.getBoundingBox=function(){var t=this.getParticleBoxes();return{type:exports.HitTestType.sphere,area:t}},r.fromData=function(e){t.prototype.fromData.call(this,e);var r=e;this.props=r,this.destroyed=!1;var i,n,o,a,s,u=r.options,c=r.positionOverLifetime,h=void 0===c?{}:c,l=r.shape,f=null==h?void 0:h.gravityOverLifetime,d=Xs(null==h?void 0:h.gravity),p=r.textureSheetAnimation,m=p?{animationDelay:Gu(p.animationDelay||0),animationDuration:Gu(p.animationDuration||1),cycles:Gu(p.cycles||1),animate:p.animate,col:p.col,row:p.row,total:p.total||p.col*p.row}:void 0,v=!!(l&&l.turbulenceX||(null==l?void 0:l.turbulenceY)||(null==l?void 0:l.turbulenceZ));v&&(i=[Gu(null!=(n=l.turbulenceX)?n:0),Gu(null!=(o=l.turbulenceY)?o:0),Gu(null!=(a=l.turbulenceZ)?a:0)]),this.name="ParticleSystem",this.shape=Cc(l),this.emission={rateOverTime:Gu(r.emission.rateOverTime),burstOffsets:Lh(null!=(s=r.emission.burstOffsets)?s:[]),bursts:(r.emission.bursts||[]).map((function(t){return new nh(t)}))},this.textureSheetAnimation=m;var y,g,x=r.renderer||{},T=r.rotationOverLifetime;T&&((y={}).asRotation=!!T.asRotation,y.z=T.z?Gu(T.z):Gu(0),T.separateAxes&&(y.x=T.x&&Gu(T.x),y.y=T.y&&Gu(T.y))),(null==h?void 0:h.forceTarget)&&(g={target:h.target||[0,0,0],curve:Gu(h.forceCurve||[Yi.LINE,[[0,0],[1,1]]])});var _={x:h.linearX&&Gu(h.linearX||0),y:h.linearY&&Gu(h.linearY||0),z:h.linearZ&&Gu(h.linearZ||0),asMovement:h.asMovement},E={x:h.orbitalX&&Gu(h.orbitalX),y:h.orbitalY&&Gu(h.orbitalY),z:h.orbitalZ&&Gu(h.orbitalZ),center:h.orbCenter,asRotation:h.asRotation},b=r.sizeOverLifetime||{},A=r.colorOverLifetime,S=(null==b?void 0:b.separateAxes)?{separateAxes:!0,x:Gu(b.x),y:Gu(b.y)}:{separateAxes:!1,x:Gu(("size"in b?b.size:b.x)||1)};x.anchor=x.anchor||[0,0];var R,C=Fr.fromArray(x.anchor);this.options={particleFollowParent:!!u.particleFollowParent,startLifetime:Gu(u.startLifetime),startDelay:Gu(u.startDelay||0),startSpeed:Gu(h.startSpeed||0),startColor:Gu(u.startColor),looping:!1,maxCount:null!=(R=u.maxCount)?R:0,gravityModifier:Gu(f||0),gravity:d,start3DSize:!!u.start3DSize,startTurbulence:v,turbulence:i,speedOverLifetime:h.speedOverLifetime&&Gu(h.speedOverLifetime),linearVelOverLifetime:_,orbitalVelOverLifetime:E,forceTarget:g},u.startRotationZ&&(this.options.startRotation=Gu(u.startRotationZ||0)),(u.startRotationX||u.startRotationY)&&(this.options.start3DRotation=!0,this.options.startRotationX=Gu(u.startRotationX||0),this.options.startRotationY=Gu(u.startRotationY||0),this.options.startRotationZ=Gu(u.startRotationZ||0)),u.start3DSize?(this.options.startSizeX=Gu(u.startSizeX),this.options.startSizeY=Gu(u.startSizeY)):(this.options.startSize=Gu(u.startSize),this.options.sizeAspect=Gu(u.sizeAspect||1)),r.mask&&this.maskManager.setMaskOptions(r.mask);var M={meshSlots:u.meshSlots,name:this.name,matrix:Do.IDENTITY,shaderCachePrefix:"",renderMode:x.renderMode||Ui.BILLBOARD,side:x.side||wi.DOUBLE,gravity:d,blending:x.blending||Ii.ALPHA,rotationOverLifetime:y,gravityModifier:this.options.gravityModifier,linearVelOverLifetime:this.options.linearVelOverLifetime,orbitalVelOverLifetime:this.options.orbitalVelOverLifetime,speedOverLifetime:this.options.speedOverLifetime,sprite:m,occlusion:!!x.occlusion,transparentOcclusion:!!x.transparentOcclusion,maxCount:u.maxCount,mask:this.maskManager.getRefValue(),maskMode:this.maskManager.maskMode,forceTarget:g,diffuse:x.texture?this.engine.findObject(x.texture):void 0,sizeOverLifetime:S,anchor:C};if(A){var O=A.color,P=A.opacity;M.colorOverLifetime={},P&&(M.colorOverLifetime.opacity=Gu(A.opacity)),O&&(O[0]===Yi.GRADIENT_COLOR?M.colorOverLifetime.color=A.color[1]:O[0]===Yi.RGBA_COLOR?M.colorOverLifetime.color=ya.createWithData(this.engine,{data:new Uint8Array(O[1]),width:1,height:1}):mr(O,ya)&&(M.colorOverLifetime.color=O))}var I,w=[],N=[0,0,1,1];if(r.splits){var L=r.splits[0];N=(I=L[4])?[L[0],L[1],L[3],L[2]]:[L[0],L[1],L[2],L[3]]}if(m&&!m.animate)for(var F=I?m.row:m.col,D=I?m.col:m.row,V=m.total||F*D,B=0,U=0;U<F;U++)for(var k=0;k<D&&B<V;k++,B++)w.push([U*N[2]/F+N[0],k*N[3]/D+N[1],N[2]/F,N[3]/D]);else w.push(N);this.uvs=w,M.textureFlip=I;var z,G=r.trails;G&&(this.trails={lifetime:Gu(G.lifetime),dieWithParticles:!1!==G.dieWithParticles,sizeAffectsWidth:!!G.sizeAffectsWidth,sizeAffectsLifetime:!!G.sizeAffectsLifetime,inheritParticleColor:!!G.inheritParticleColor,parentAffectsPosition:!!G.parentAffectsPosition},G.mask&&this.maskManager.setMaskOptions(G.mask),z={name:"Trail",matrix:Do.IDENTITY,minimumVertexDistance:G.minimumVertexDistance||.02,maxTrailCount:u.maxCount,pointCountPerTrail:Math.round(G.maxPointPerTrail)||32,blending:G.blending,texture:G.texture?this.engine.findObject(G.texture):void 0,opacityOverLifetime:Gu(G.opacityOverLifetime||1),widthOverTrail:Gu(G.widthOverTrail||1),shaderCachePrefix:"",lifetime:this.trails.lifetime,occlusion:!!G.occlusion,transparentOcclusion:!!G.transparentOcclusion,textureMap:G.textureMap,mask:this.maskManager.getRefValue(),maskMode:this.maskManager.maskMode},G.colorOverLifetime&&G.colorOverLifetime[0]===Yi.GRADIENT_COLOR&&(z.colorOverLifetime=G.colorOverLifetime[1]),G.colorOverTrail&&G.colorOverTrail[0]===Yi.GRADIENT_COLOR&&(z.colorOverTrail=G.colorOverTrail[1])),this.renderer=new Ah(this.engine,M,z),this.renderer.item=this.item,this.renderer.maskManager=this.maskManager,this.meshes=this.renderer.meshes;var X,H=r.interaction;H&&(this.interaction={multiple:H.multiple,radius:null!=(X=H.radius)?X:.4,behavior:H.behavior}),this.item.getHitTestParams=this.getHitTestParams},Io(e,[{key:"timePassed",get:function(){return this.time-this.loopStartTime}},{key:"lifetime",get:function(){return this.timePassed/this.item.duration}},{key:"particleCount",get:function(){return this.particleLink.length}},{key:"maxParticles",get:function(){return this.options.maxCount},set:function(t){var e;this.options.maxCount=t,(null==(e=this.renderer)?void 0:e.particleMesh)&&(this.renderer.particleMesh.maxCount=t)}}]),e}(wo),exports.ParticleSystem=yr([In(xn.ParticleSystem)],exports.ParticleSystem);var Sh=new Dr,Rh=new Fr,Ch=new Ya,Mh=new Dr,Oh=new Dr,Ph=new Dr,Ih=new Ya,wh=[0,0,0],Nh=new Do;function Lh(t){var e={};return Array.isArray(t)&&t.forEach((function(t){var r=mr(t,Array),i=r?t[0]:t.index,n=e[i];n||(n=e[i]=[]),r?n.push(t.slice(1,4)):n.push([+t.x,+t.y,+t.z])})),e}function Fh(t,e){var r=Math.floor(Math.random()*t.length),i=t[r];return e||t.splice(r,1),i}var Dh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).clipPlayables=[],e.clipWeights=[],e}ji(e,t);var r=e.prototype;return r.processFrame=function(t){for(var e,r=pr(this.clipPlayables);!(e=r()).done;)e.value.processFrame(t);this.evaluate(t)},r.setClipWeight=function(t,e){if(mr(t,ic)){for(var r=0;r<this.clipPlayables.length;r++)if(this.clipPlayables[r]===t)return void(this.clipWeights[r]=e)}else this.clipWeights.length<t+1&&(this.clipWeights.length=t+1),this.clipWeights[t]=e},r.getClipWeight=function(t){return this.clipWeights[t]},r.getClipPlayable=function(t){return this.clipPlayables[t]},r.evaluate=function(t){},e}(ic),Vh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.evaluate=function(t){var e=t.output.getUserData();if(mr(e,exports.VFXItem)){for(var r=e,i=!1,n=0;n<this.clipPlayables.length;n++)if(this.getClipWeight(n)>0){i=!0;break}i?(r.transform.setValid(!0),r.setActive(!0)):(r.transform.setValid(!1),r.setActive(!1))}},e}(Dh),Bh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.processFrame=function(t){var e=t.output.getUserData();mr(e,exports.VFXItem)&&(e.time=this.time)},e}(ic),Uh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.processFrame=function(t){this.value=this.curve.getValue(this.time/this.getDuration())},e}(ic),kh=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).propertyPath="",e.propertyName="",e}ji(e,t);var r=e.prototype;return r.evaluate=function(t){var e=t.output.getUserData();if(e){this.directTarget||this.preparePath(e);var r=!1;if(this.propertyValue=this.directTarget[this.propertyName],void 0!==this.propertyValue&&null!==this.propertyValue){this.resetPropertyValue();for(var i=0;i<this.clipPlayables.length;i++){var n=this.getClipWeight(i);if(n>0){var o=this.getClipPlayable(i);if(!mr(o,Uh)){console.error("PropertyTrack added non-PropertyPlayableAsset");continue}var a=o.value;this.addWeightedValue(a,n),r=!0}}r&&(this.directTarget[this.propertyName]=this.propertyValue,mr(e,wo)&&e.onApplyAnimationProperties())}}},r.preparePath=function(t){for(var e=this.propertyPath.split("."),r=t,i=0;i<e.length-1;i++){var n=r[e[i]];void 0===n&&console.error("The "+e[i]+" property of "+t+" was not found"),r=n}e.length>0&&(this.propertyName=e[e.length-1]),this.directTarget=r},e}(Dh),zh=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.resetPropertyValue=function(){this.propertyValue.setZero()},r.addWeightedValue=function(t,e){var r=this.propertyValue;r.r+=t.r*e,r.g+=t.g*e,r.b+=t.b*e,r.a+=t.a*e},e}(kh),Gh=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.resetPropertyValue=function(){this.propertyValue=0},r.addWeightedValue=function(t,e){this.propertyValue+=t*e},e}(kh),Xh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.evaluate=function(t){},e}(Dh),Hh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.evaluate=function(t){},e}(Dh),jh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.processFrame=function(t){var e=t.output.getUserData();mr(e,exports.CompositionComponent)&&(e.time=this.getTime())},e}(ic),Wh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.evaluate=function(t){var e=t.output.getUserData();if(mr(e,exports.CompositionComponent)){for(var r=e,i=!1,n=0;n<this.clipPlayables.length;n++)if(this.getClipWeight(n)>0){i=!0;break}i?r.item.setActive(!0):r.item.setActive(!1)}},e}(Dh),Yh=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.evaluate=function(t){},e}(Dh),Zh=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.resetPropertyValue=function(){this.propertyValue.x=0,this.propertyValue.y=0,this.propertyValue.z=0,this.propertyValue.w=0},r.addWeightedValue=function(t,e){var r=this.propertyValue;r.x+=t.x*e,r.y+=t.y*e,r.z+=t.z*e,r.w+=t.w*e},e}(kh),qh=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.resetPropertyValue=function(){this.propertyValue.x=0,this.propertyValue.y=0,this.propertyValue.z=0},r.addWeightedValue=function(t,e){var r=this.propertyValue;r.x+=t.x*e,r.y+=t.y*e,r.z+=t.z*e},e}(kh),Kh=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.resetPropertyValue=function(){this.propertyValue.x=0,this.propertyValue.y=0},r.addWeightedValue=function(t,e){var r=this.propertyValue;r.x+=t.x*e,r.y+=t.y*e},e}(kh),Qh=new Ya,Jh=new Dr(1,1,1),$h=new Dr,tl=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.start=function(){var t=this.boundObject,e=t.transform.scale;this.originalTransform={position:t.transform.position.clone(),rotation:t.transform.getRotation().clone(),scale:new Dr(e.x,e.y,e.x)};var r,i=this.data.positionOverLifetime,n=this.data.rotationOverLifetime,o=this.data.sizeOverLifetime;if(i&&0!==Object.keys(i).length){this.positionOverLifetime=i,i.path&&(this.originalTransform.path=Gu(i.path));var a=i.linearX||i.linearY||i.linearZ;a&&(this.linearVelOverLifetime={x:i.linearX&&Gu(i.linearX),y:i.linearY&&Gu(i.linearY),z:i.linearZ&&Gu(i.linearZ),asMovement:i.asMovement,enabled:!!a});var s=i.orbitalX||i.orbitalY||i.orbitalZ;s&&(this.orbitalVelOverLifetime={x:i.orbitalX&&Gu(i.orbitalX),y:i.orbitalY&&Gu(i.orbitalY),z:i.orbitalZ&&Gu(i.orbitalZ),center:Xs(i.orbCenter),asRotation:i.asRotation,enabled:!!s}),this.speedOverLifetime=i.speedOverLifetime&&Gu(i.speedOverLifetime)}if(o&&(o.separateAxes?(this.sizeSeparateAxes=!0,this.sizeXOverLifetime=Gu(o.x||1),this.sizeYOverLifetime=Gu(o.y||1),this.sizeZOverLifetime=Gu(o.z||1)):this.sizeXOverLifetime=Gu(o.size||1)),n&&(this.rotationOverLifetime={asRotation:n.asRotation,separateAxes:n.separateAxes,z:Gu(n.z||0)},n.separateAxes)){var u=this.rotationOverLifetime;u.x=Gu(n.x||0),u.y=Gu(n.y||0)}this.gravity=Dr.fromArray((null==i?void 0:i.gravity)||[]),this.gravityModifier=Gu(null!=(r=null==i?void 0:i.gravityOverLifetime)?r:0),this.direction=(null==i?void 0:i.direction)?Dr.fromArray(i.direction).normalize():new Dr,this.startSpeed=(null==i?void 0:i.startSpeed)||0,this.velocity=this.direction.clone(),this.velocity.multiply(this.startSpeed)},r.processFrame=function(t){if(!this.boundObject){var e=t.output.getUserData();mr(e,exports.VFXItem)&&(this.boundObject=e,this.start())}this.boundObject&&this.boundObject.composition&&this.sampleAnimation()},r.sampleAnimation=function(){var t=this,e=this.boundObject,r=this.getDuration(),i=this.time/r;if(i=i<0?0:i>1?1:i,this.sizeXOverLifetime){Jh.x=this.sizeXOverLifetime.getValue(i),this.sizeSeparateAxes?(Jh.y=this.sizeYOverLifetime.getValue(i),Jh.z=this.sizeZOverLifetime.getValue(i)):Jh.z=Jh.y=Jh.x;var n=this.originalTransform.scale;e.transform.setScale(Jh.x*n.x,Jh.y*n.y,Jh.z*n.z)}if(this.rotationOverLifetime){var o=function(e){return t.rotationOverLifetime.asRotation?e.getValue(i):e.getIntegrateValue(0,i,r)},a=o(this.rotationOverLifetime.z),s=this.rotationOverLifetime.separateAxes;Qh.x=s?o(this.rotationOverLifetime.x):0,Qh.y=s?o(this.rotationOverLifetime.y):0,Qh.z=a;var u=Qh.addEulers(this.originalTransform.rotation,Qh);e.transform.setRotation(u.x,u.y,u.z)}if(this.positionOverLifetime){var c=$h;Gs(c,this,this.gravity,this.time,r,this.originalTransform.position,this.velocity),this.originalTransform.path&&c.add(this.originalTransform.path.getValue(i)),e.transform.setPosition(c.x,c.y,c.z)}},e}(ic);exports.TransformPlayableAsset=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.createPlayable=function(){var t=new tl;return t.data=this.transformAnimationData,t},r.fromData=function(t){this.transformAnimationData=t},e}(oc),exports.TransformPlayableAsset=yr([In(xn.TransformPlayableAsset)],exports.TransformPlayableAsset),exports.TrackType=void 0;var el=function(){function t(){this.start=0,this.duration=0}return t.prototype.toLocalTime=function(t){var e=t-this.start,r=this.duration;return e-r>0&&(this.endBehavior===qi.restart?e%=r:this.endBehavior===qi.freeze&&(e=Math.min(r,e))),e},t}();exports.TrackAsset=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).trackType=0,e.clipSeed=0,e.clips=[],e.children=[],e}ji(e,t);var r=e.prototype;return r.updateAnimatedObject=function(t){return t},r.createTrackMixer=function(){return new Dh},r.createOutput=function(){return new nc},r.createPlayableGraph=function(t){return this.createMixerPlayableGraph(t)},r.createMixerPlayableGraph=function(t){for(var e,r=[],i=pr(this.clips);!(e=i()).done;){var n=e.value;r.push(n)}return this.compileClips(r,t)},r.compileClips=function(t,e){for(var r,i=this.createTrackMixer(),n=pr(t);!(r=n()).done;){var o=r.value,a=this.createClipPlayable(o);a.setDuration(o.duration);var s=new rl(o,a,i);e.push(s),i.clipPlayables.push(a),i.setClipWeight(a,0)}return i},r.createPlayable=function(){return new ic},r.getChildTracks=function(){return this.children},r.addChild=function(t){this.children.push(t),t.parent=this},r.createClip=function(t,e){var r=new el;return r.asset=new t(this.engine),r.name=e||"TimelineClip"+r.id,this.addClip(r),r},r.getClips=function(){return this.clips},r.findClip=function(t){for(var e,r=pr(this.clips);!(e=r()).done;){var i=e.value;if(i.name===t)return i}},r.addClip=function(t){t.id=(this.clipSeed++).toString(),this.clips.push(t)},r.createClipPlayable=function(t){return t.asset.createPlayable()},r.fromData=function(e){t.prototype.fromData.call(this,e);for(var r,i=pr(this.children);!(r=i()).done;)r.value.parent=this},e}(oc),yr([wn(el)],exports.TrackAsset.prototype,"clips",void 0),yr([wn()],exports.TrackAsset.prototype,"children",void 0),exports.TrackAsset=yr([In(xn.TrackAsset)],exports.TrackAsset),function(t){t[t.MasterTrack=0]="MasterTrack",t[t.ObjectTrack=1]="ObjectTrack"}(exports.TrackType||(exports.TrackType={}));var rl=function(){function t(t,e,r){this.clip=t,this.playable=e,this.parentMixer=r}var e=t.prototype;return e.getParticleSystem=function(){return this.particleSystem||mr(this.parentMixer.trackInstance.boundObject,exports.VFXItem)&&(this.particleSystem=this.parentMixer.trackInstance.boundObject.getComponent(exports.ParticleSystem)),this.particleSystem},e.evaluateAt=function(t){var e=this.clip,r=1,i=!1,n=!1,o=this.parentMixer.trackInstance.boundObject;t>=e.start+e.duration&&e.endBehavior===qi.destroy?mr(o,exports.VFXItem)&&exports.VFXItem.isParticle(o)&&this.getParticleSystem()&&!this.getParticleSystem().destroyed?r=1:(r=0,i=!0):t-this.clip.start>=0?(r=1,n=!0):t<e.start&&(r=0),n&&this.playable.getPlayState()!==exports.PlayState.Playing&&this.playable.play(),this.parentMixer.setClipWeight(this.playable,r);var a=e.toLocalTime(t);this.playable.setTime(a),i&&this.playable.getPlayState()===exports.PlayState.Playing&&this.playable.pause()},Io(t,[{key:"enable",set:function(t){t?this.playable.play():(this.parentMixer.setClipWeight(this.playable,0),this.playable.pause())}}]),t}();exports.ActivationTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){return new Vh},e}(exports.TrackAsset),exports.ActivationTrack=yr([In(xn.ActivationTrack)],exports.ActivationTrack);var il=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).propertyNames=[],e.path="",e}return ji(e,t),e.prototype.fromData=function(e){t.prototype.fromData.call(this,e);var r=this.path.split(".");this.propertyNames=r},e}(exports.TrackAsset);yr([wn()],il.prototype,"path",void 0),exports.FloatPropertyTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){var t=new Gh;return t.propertyPath=this.path,t},e}(il),exports.FloatPropertyTrack=yr([In(xn.FloatPropertyTrack)],exports.FloatPropertyTrack),exports.SpriteColorTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){return new Hh},e}(exports.TrackAsset),exports.SpriteColorTrack=yr([In(xn.SpriteColorTrack)],exports.SpriteColorTrack),exports.SubCompositionTrack=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.updateAnimatedObject=function(t){if(!mr(t,exports.VFXItem))throw new Error("SubCompositionTrack needs to be set under the VFXItem track.");return t.getComponent(exports.CompositionComponent)},r.createTrackMixer=function(){return new Wh},e}(exports.TrackAsset),exports.SubCompositionTrack=yr([In(xn.SubCompositionTrack)],exports.SubCompositionTrack),exports.TransformTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){return new Yh},e}(exports.TrackAsset),exports.TransformTrack=yr([In(xn.TransformTrack)],exports.TransformTrack),exports.MaterialTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.updateAnimatedObject=function(t){if(!mr(t,Lo))throw new Error("MaterialTrack: expected a RendererComponent bound object.");var e=t.materials;if(this.index>=e.length)throw new Error("MaterialTrack: material index "+this.index+" out of bounds (length="+e.length+").");return e[this.index]},e}(exports.TrackAsset),yr([wn()],exports.MaterialTrack.prototype,"index",void 0),exports.MaterialTrack=yr([In("MaterialTrack")],exports.MaterialTrack);var nl=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){return new Xh},e}(exports.TrackAsset);exports.Vector4PropertyTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){var t=new Zh;return t.propertyPath=this.path,t},e}(il),exports.Vector4PropertyTrack=yr([In(xn.Vector4PropertyTrack)],exports.Vector4PropertyTrack),exports.Vector3PropertyTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){var t=new qh;return t.propertyPath=this.path,t},e}(il),exports.Vector3PropertyTrack=yr([In(xn.Vector3PropertyTrack)],exports.Vector3PropertyTrack),exports.Vector2PropertyTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){var t=new Kh;return t.propertyPath=this.path,t},e}(il),exports.Vector2PropertyTrack=yr([In(xn.Vector2PropertyTrack)],exports.Vector2PropertyTrack),exports.ColorPropertyTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){var t=new zh;return t.propertyPath=this.path,t},e}(il),exports.ColorPropertyTrack=yr([In(xn.ColorPropertyTrack)],exports.ColorPropertyTrack),exports.ObjectBindingTrack=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.create=function(t,e){var r=e[this.getInstanceId()];if(mr(r,exports.VFXItem))for(var i,n=pr(this.getChildTracks());!(i=n()).done;){var o=i.value;if(mr(o,exports.ActivationTrack)){if(r.getComponent(exports.ParticleSystem))for(var a,s=t.createTrack(nl,this,"ParticleTrack"),u=pr(o.getClips());!(a=u()).done;){var c=a.value,h=s.createClip(xh);h.start=c.start,h.duration=c.duration,h.endBehavior=c.endBehavior}if(r.getComponent(exports.SpriteComponent))for(var l,f=t.createTrack(gl,this,"SpriteComponentTimeTrack"),d=pr(o.getClips());!(l=d()).done;){var p=l.value,m=f.createClip(Tl);m.start=p.start,m.duration=p.duration,m.endBehavior=p.endBehavior}if(r.getComponent(exports.EffectComponent))for(var v,y=t.createTrack(xl,this,"EffectComponentTimeTrack"),g=pr(o.getClips());!(v=g()).done;){var x=v.value,T=y.createClip(Tl);T.start=x.start,T.duration=x.duration,T.endBehavior=x.endBehavior}break}}},e}(exports.TrackAsset),exports.ObjectBindingTrack=yr([In(xn.ObjectBindingTrack)],exports.ObjectBindingTrack),exports.ActivationPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){return new Bh},e}(oc),exports.ActivationPlayableAsset=yr([In(xn.ActivationPlayableAsset)],exports.ActivationPlayableAsset),exports.ColorPropertyPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){var t=new Uh;return t.curve=Gu(this.curveData),t.value=t.curve.getValue(0),t},e}(oc),yr([wn()],exports.ColorPropertyPlayableAsset.prototype,"curveData",void 0),exports.ColorPropertyPlayableAsset=yr([In(xn.ColorPropertyPlayableAsset)],exports.ColorPropertyPlayableAsset),exports.FloatPropertyPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){var t=new Uh;return t.curve=Gu(this.curveData),t.value=t.curve.getValue(0),t},e}(oc),yr([wn()],exports.FloatPropertyPlayableAsset.prototype,"curveData",void 0),exports.FloatPropertyPlayableAsset=yr([In(xn.FloatPropertyPlayableAsset)],exports.FloatPropertyPlayableAsset),exports.SubCompositionPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){return new jh},e}(oc),exports.SubCompositionPlayableAsset=yr([In(xn.SubCompositionPlayableAsset)],exports.SubCompositionPlayableAsset),exports.Vector4PropertyPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){var t=new Uh;return t.curve=Gu(this.curveData),t.value=t.curve.getValue(0),t},e}(oc),yr([wn()],exports.Vector4PropertyPlayableAsset.prototype,"curveData",void 0),exports.Vector4PropertyPlayableAsset=yr([In(xn.Vector4PropertyPlayableAsset)],exports.Vector4PropertyPlayableAsset),exports.Vector3ropertyPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){var t=new Uh;return t.curve=Gu(this.curveData),t.value=t.curve.getValue(0),t},e}(oc),yr([wn()],exports.Vector3ropertyPlayableAsset.prototype,"curveData",void 0),exports.Vector3ropertyPlayableAsset=yr([In(xn.Vector3PropertyPlayableAsset)],exports.Vector3ropertyPlayableAsset),exports.Vector2PropertyPlayableAsset=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){var t=new Uh;return t.curve=Gu(this.curveData),t.value=t.curve.getValue(0),t},e}(oc),yr([wn()],exports.Vector2PropertyPlayableAsset.prototype,"curveData",void 0),exports.Vector2PropertyPlayableAsset=yr([In(xn.Vector2PropertyPlayableAsset)],exports.Vector2PropertyPlayableAsset);var ol=function(){function t(t,e,r){this.children=[],this.trackAsset=t,this.mixer=e,this.output=r,this.mixer.trackInstance=this}return t.prototype.addChild=function(t){this.children.push(t)},t}();exports.TimelineAsset=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).tracks=[],e.cacheFlattenedTracks=null,e}ji(e,t);var r=e.prototype;return r.createTrack=function(t,e,r){var i=new t(this.engine);return i.name=r||t.name,e.addChild(i),this.invalidate(),i},r.invalidate=function(){this.cacheFlattenedTracks=null},r.addSubTracksRecursive=function(t,e){for(var r,i=pr(t.getChildTracks());!(r=i()).done;){var n=r.value;e.push(n)}for(var o,a=pr(t.getChildTracks());!(o=a()).done;){var s=o.value;this.addSubTracksRecursive(s,e)}},Io(e,[{key:"flattenedTracks",get:function(){if(!this.cacheFlattenedTracks){this.cacheFlattenedTracks=[];for(var t,e=pr(this.tracks);!(t=e()).done;){var r=t.value;this.cacheFlattenedTracks.push(r),this.addSubTracksRecursive(r,this.cacheFlattenedTracks)}}return this.cacheFlattenedTracks}}]),e}(Ln),yr([wn()],exports.TimelineAsset.prototype,"tracks",void 0),exports.TimelineAsset=yr([In(xn.TimelineAsset)],exports.TimelineAsset);var al=function(){function t(t,e){this.time=0,this.clips=[],this.masterTrackInstances=[];for(var r,i={},n=pr(e);!(r=n()).done;){var o=r.value;i[o.key.getInstanceId()]=o.value}for(var a,s=pr(t.tracks);!(a=s()).done;){var u=a.value;mr(u,exports.ObjectBindingTrack)&&u.create(t,i)}this.compileTracks(t.flattenedTracks,e)}var e=t.prototype;return e.setTime=function(t){this.time=t},e.getTime=function(){return this.time},e.evaluate=function(t){for(var e,r=this.getTime(),i=pr(this.clips);!(e=i()).done;)e.value.evaluateAt(r);for(var n,o=pr(this.masterTrackInstances);!(n=o()).done;){var a=n.value;this.tickTrack(a,t)}},e.compileTracks=function(t,e){for(var r,i=t,n={},o=pr(i);!(r=o()).done;){var a=r.value,s=a.createPlayableGraph(this.clips),u=a.createOutput(),c=new ol(a,s,u);n[a.getInstanceId()]=c,a.parent||this.masterTrackInstances.push(c)}for(var h,l=pr(i);!(h=l()).done;)for(var f,d=h.value,p=n[d.getInstanceId()],m=pr(d.getChildTracks());!(f=m()).done;){var v=n[f.value.getInstanceId()];p.addChild(v)}for(var y,g=pr(e);!(y=g()).done;){var x=y.value;n[x.key.getInstanceId()].boundObject=x.value}for(var T,_=pr(this.masterTrackInstances);!(T=_()).done;){var E=T.value;this.updateTrackAnimatedObject(E)}},e.tickTrack=function(t,e){var r=t.output.context;r.deltaTime=e,t.output.setUserData(t.boundObject);for(var i,n=pr(t.mixer.clipPlayables);!(i=n()).done;){var o=i.value;o.getPlayState()===exports.PlayState.Playing&&o.processFrame(r)}t.mixer.evaluate(r);for(var a,s=pr(t.children);!(a=s()).done;){var u=a.value;this.tickTrack(u,e)}},e.updateTrackAnimatedObject=function(t){for(var e,r=pr(t.children);!(e=r()).done;){var i=e.value;if(!i.boundObject){var n=i.trackAsset.updateAnimatedObject(t.boundObject);i.boundObject=n}this.updateTrackAnimatedObject(i)}},t}();exports.CompositionComponent=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).time=0,e.items=[],e.state=exports.PlayState.Playing,e.reusable=!1,e.sceneBindings=[],e}ji(e,t);var r=e.prototype;return r.onStart=function(){var t;this.timelineAsset||(this.timelineAsset=new exports.TimelineAsset(this.engine)),this.timelineInstance=new al(this.timelineAsset,this.sceneBindings),null==(t=this.item.composition)||t.refContent.push(this.item)},r.getReusable=function(){return this.reusable},r.pause=function(){this.state=exports.PlayState.Paused},r.resume=function(){this.state=exports.PlayState.Playing},r.onUpdate=function(t){if(this.state!==exports.PlayState.Paused){var e=this.time;this.timelineInstance.setTime(e),this.timelineInstance.evaluate(t/1e3)}},r.onEnable=function(){for(var t,e=pr(this.items);!(t=e()).done;)t.value.setActive(!0)},r.onDisable=function(){for(var t,e=pr(this.items);!(t=e()).done;)t.value.setActive(!1)},r.onDestroy=function(){this.item.composition&&this.items&&(this.items.forEach((function(t){return t.dispose()})),this.items.length=0)},r.hitTest=function(t,e,r,i,n,o){for(var a,s=function(o){var s=a.items[o];if(s.isActive&&s.transform.getValid()&&!exports.VFXItem.isComposition(s)&&!h(s)){var l=s.getHitTestParams(n);if(l){var f=!1,d=new Dr;if(l.type===exports.HitTestType.triangle)for(var p=l.triangles,m=l.backfaceCulling,v=0;v<p.length;v++){var y=p[v];if(t.intersectTriangle(y,d,m)){f=!0,u.push(d);break}}else if(l.type===exports.HitTestType.box){var g=l.center,x=l.size,T=g.clone().addScaledVector(x,.5),_=g.clone().addScaledVector(x,-.5);t.intersectBox({min:T,max:_},d)&&(f=!0,u.push(d))}else if(l.type===exports.HitTestType.sphere){var E=l.center,b=l.radius;t.intersectSphere({center:E,radius:b},d)&&(f=!0,u.push(d))}else if(l.type===exports.HitTestType.custom){var A=l.collect(t,new Fr(e,r));A&&A.length>0&&(A.forEach((function(t){u.push(t)})),f=!0)}if(f){var S={compContent:a.item,id:s.id,name:s.name,position:u[u.length-1],parentId:s.parentId,hitPositions:u,behavior:l.behavior};if(s.emit("click",S),i.push(S),c(S))return{v:i}}}}},u=[],c=(null==o?void 0:o.stop)||hi,h=(null==o?void 0:o.skip)||hi,l=(null==o?void 0:o.maxCount)||this.items.length,f=0;f<this.items.length&&i.length<l;f++){var d=(a=this,s(f));if("object"===vr(d))return d.v}return i},r.setChildrenRenderOrder=function(t){for(var r,i=pr(this.items);!(r=i()).done;){var n=r.value;n.renderOrder=t++;var o=n.getComponent(e);o&&(t=o.setChildrenRenderOrder(t))}return t},r.fromData=function(e){t.prototype.fromData.call(this,e)},e}(wo),yr([wn()],exports.CompositionComponent.prototype,"items",void 0),yr([wn()],exports.CompositionComponent.prototype,"sceneBindings",void 0),yr([wn()],exports.CompositionComponent.prototype,"timelineAsset",void 0),exports.CompositionComponent=yr([In("CompositionComponent")],exports.CompositionComponent),exports.Item=void 0;var sl=function(){var t=this,e=this;this.listeners={},this.off=function(e,r){t.listeners[e]&&(t.listeners[e]=t.listeners[e].filter((function(t){return t.listener!==r})))},this.on=function(e,r,i){return t.listeners[e]=t.listeners[e]||[],t.listeners[e].push({listener:r,options:i}),function(){return t.off(e,r)}},this.once=function(e,r){t.on(e,r,{once:!0})},this.emit=function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];var o;null==(o=e.listeners[t])||o.forEach((function(r){var n=r.listener,o=r.options;n.apply(void 0,[].concat(i)),(null==o?void 0:o.once)&&e.off(t,n)}))},this.getListeners=function(e){var r;return(null==(r=t.listeners[e])?void 0:r.map((function(t){return t.listener})))||[]}},ul=function(){function t(){this.update=new hl,this.lateUpdate=new ll}var e=t.prototype;return e.addComponent=function(t){t.onUpdate!==wo.prototype.onUpdate&&this.update.addComponent(t),t.onLateUpdate!==wo.prototype.onLateUpdate&&this.lateUpdate.addComponent(t)},e.removeComponent=function(t){t.onUpdate!==wo.prototype.onUpdate&&this.update.removeComponent(t),t.onLateUpdate!==wo.prototype.onLateUpdate&&this.lateUpdate.removeComponent(t)},e.clear=function(){this.update.clear(),this.lateUpdate.clear()},t}(),cl=function(){function t(){this.components=[],this.ticks=[]}var e=t.prototype;return e.tick=function(t){this.tickComponents(this.components,t);for(var e=0;e<this.ticks.length;e++)this.ticks[e](t)},e.tickComponents=function(t,e){},e.addComponent=function(t){this.components.includes(t)||this.components.push(t)},e.removeComponent=function(t){var e=this.components.indexOf(t);e>-1&&this.components.splice(e,1)},e.addTick=function(t,e){var r=t.bind(e);this.ticks.includes(r)||this.ticks.push(r)},e.clear=function(){this.components=[]},t}(),hl=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.tickComponents=function(t,e){for(var r,i=pr(t);!(r=i()).done;)r.value.onUpdate(e)},e}(cl),ll=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.tickComponents=function(t,e){for(var r,i=pr(t);!(r=i()).done;)r.value.onLateUpdate(e)},e}(cl),fl=function(t){function e(i,n){var o,a;(o=t.call(this)||this).sceneTicking=new ul,o.speed=1,o.isEnded=!1,o.loaderData={},o.refContent=[],o.startTime=0,o.postProcessingEnabled=!1,o.destroyed=!1,o.postLoaders=[],o.paused=!1,o.isEndCalled=!1,o._textures=[],o.videos=[];var s,u=i.reusable,c=void 0!==u&&u,h=i.speed,l=void 0===h?1:h,f=i.baseRenderOrder,d=void 0===f?0:f,p=i.renderer,m=i.event,v=i.width,y=i.height,g=i.handleItemMessage;o.renderer=p,o._textures=n.textures;for(var x,T=pr(Object.keys(n.assets));!(x=T()).done;){var _=x.value,E=n.assets[_];mr(E,r.HTMLVideoElement)&&o.videos.push(E)}o.postProcessingEnabled=null!=(s=null==(a=n.jsonScene.renderSettings)?void 0:a.postProcessingEnabled)&&s,o.getEngine().renderLevel=n.renderLevel,c&&(n.consumed=!0);for(var b,A=n.jsonScene.compositions[0],S=pr(n.jsonScene.compositions);!(b=S()).done;){var R=b.value;R.id===n.jsonScene.compositionId&&(A=R)}oi(A),o.rootItem=new exports.VFXItem(o.getEngine()),o.rootItem.setInstanceId(A.id),o.rootItem.name="rootItem",o.rootItem.duration=A.duration,o.rootItem.endBehavior=A.endBehavior,o.rootItem.composition=ac(o);for(var C,M,O,P,I=pr(A.components);!(C=I()).done;){var w=C.value,N=o.getEngine().findObject(w);o.rootItem.components.push(N),N.item=o.rootItem}return o.rootComposition=o.rootItem.getComponent(exports.CompositionComponent),o.width=v,o.height=y,o.renderOrder=d,o.id=A.id,o.startTime=null!=(M=A.startTime)?M:0,o.renderer=p,o.event=m,o.statistic={loadStart:null!=(O=n.startTime)?O:0,loadTime:null!=(P=n.totalTime)?P:0,compileTime:0,firstFrameTime:0},o.reusable=c,o.speed=l,o.name=A.name,o.pluginSystem=n.pluginSystem,o.pluginSystem.initializeComposition(ac(o),n),o.camera=new lc(o.name,qn({},null==A?void 0:A.camera,{aspect:v/y,pixelWidth:v,pixelHeight:y})),o.url=n.url,o.interactive=!0,o.handleItemMessage=g,o.createRenderFrame(),e.buildItemTree(o.rootItem),o.rootComposition.setChildrenRenderOrder(0),o.pluginSystem.resetComposition(ac(o),o.renderFrame),o}ji(e,t);var i=e.prototype;return i.getDuration=function(){return this.rootItem.duration},i.restart=function(){this.reset(),this.forwardTime(this.startTime)},i.setIndex=function(t){this.renderOrder=t},i.getIndex=function(){return this.renderOrder},i.setSpeed=function(t){this.speed=t},i.setVisible=function(t){this.rootItem.setVisible(t)},i.getSpeed=function(){return this.speed},i.play=function(){this.isEnded&&this.reusable&&this.restart(),this.rootComposition.isStartCalled?(this.setTime(this.time-this.startTime),this.resume()):(this.setTime(0),this.resume())},i.pause=function(){this.paused=!0,this.emit("pause")},i.getPaused=function(){return this.paused},i.resume=function(){this.paused=!1,this.isEnded&&this.reusable&&this.restart();var t=this.time;this.emit("play",{time:t})},i.gotoAndPlay=function(t){this.setTime(t),this.emit("goto",{time:t}),this.resume()},i.gotoAndStop=function(t){this.setTime(t),this.emit("goto",{time:t}),this.pause()},i.createRenderFrame=function(){this.renderFrame=new bs({camera:this.camera,renderer:this.renderer,keepColorBuffer:this.keepColorBuffer,globalVolume:this.globalVolume,postProcessingEnabled:this.postProcessingEnabled}),this.renderFrame.cachedTextures=this.textures},i.setTime=function(t){var e=this.speed,r=this.getPaused();r&&this.resume(),this.setSpeed(1),this.forwardTime(t+this.startTime),this.setSpeed(e),r&&(this.paused=!0)},i.addItem=function(t){this.items.push(t),t.setParent(this.rootItem)},i.getComponent=function(t){return this.rootItem.getComponent(t)},i.forwardTime=function(t){for(var e=1e3*t-1e3*this.time,r=e<0,i=Math.abs(e),n=r?-15:15;i>15;i-=15)this.update(n);this.update(r?-i:i)},i.reset=function(){this.isEnded=!1,this.isEndCalled=!1,this.rootComposition.time=0,this.pluginSystem.resetComposition(this,this.renderFrame)},i.prepareRender=function(){var t=this,e=this.renderFrame;this.postLoaders.length=0,this.pluginSystem.plugins.forEach((function(r){r.prepareRenderFrame(t,e)&&t.postLoaders.push(r)})),this.postLoaders.forEach((function(r){return r.postProcessFrame(t,e)}))},i.update=function(t){if(!this.getPaused()){this.rootItem.isDuringPlay||(this.rootItem.awake(),this.rootItem.beginPlay());var e=this.time;this.updateCompositionTime(t*this.speed/1e3);var r=1e3*(this.time-e);this.updatePluginLoaders(r),this.sceneTicking.update.tick(r),this.sceneTicking.lateUpdate.tick(r),this.updateCamera(),this.prepareRender(),this.isEnded&&!this.isEndCalled&&(this.isEndCalled=!0,this.emit("end",{composition:this})),this.shouldDispose()&&this.dispose()}},i.shouldDispose=function(){return this.isEnded&&this.rootItem.endBehavior===qi.destroy&&!this.reusable},i.updateCamera=function(){this.camera.updateMatrix()},i.updatePluginLoaders=function(t){var e=this;this.pluginSystem.plugins.forEach((function(r){return r.onCompositionUpdate(e,t)}))},i.updateCompositionTime=function(t){if(this.rootComposition.state!==exports.PlayState.Paused&&this.rootComposition.isActiveAndEnabled){var e=this.time+t-this.startTime;t<0&&e<0&&(e=0);var r=this.rootItem.duration,i=this.rootItem.endBehavior,n=!1;if(e>=r)switch(n=!0,i){case qi.restart:e%=r,this.restart();break;case qi.freeze:e=Math.min(r,e);case qi.forward:case qi.destroy:}this.rootComposition.time=e+this.startTime,this.isEnded!==n&&(n?this.isEnded=!0:(this.isEnded=!1,this.isEndCalled=!1))}},i.getItemByName=function(t){return this.rootItem.find(t)},i.getHitTestRay=function(t,e){var r=this.renderFrame.editorTransform,i=r.x,n=r.y;return Zs((t-r.z)/i,(e-r.w)/n,this.camera)},i.getEngine=function(){var t;return null==(t=this.renderer)?void 0:t.engine},i.hitTest=function(t,e,r,i){if(this.isDestroyed||!this.interactive)return[];var n=[],o=this.getHitTestRay(t,e);return this.refContent.forEach((function(a){var s;null==(s=a.getComponent(exports.CompositionComponent))||s.hitTest(o,t,e,n,r,i)})),n},i.addInteractiveItem=function(t,e){if(e===Di.MESSAGE)return this.handleItemMessage({name:t.name,phrase:2,id:t.id,compositionId:this.id}),t.emit("message",{name:t.name,phrase:2,id:t.id}),t.id},i.removeInteractiveItem=function(t,e){e===Di.MESSAGE&&(this.handleItemMessage({name:t.name,phrase:1,id:t.id,compositionId:this.id}),t.emit("message",{name:t.name,phrase:1,id:t.id}))},i.destroyItem=function(t){var e=this;t.type==Bi.composition?t.endBehavior!==qi.freeze&&t.getComponent(exports.CompositionComponent).items.forEach((function(t){return e.pluginSystem.plugins.forEach((function(r){return r.onCompositionItemRemoved(e,t)}))})):(Rr(this.items,t),this.pluginSystem.plugins.forEach((function(r){return r.onCompositionItemRemoved(e,t)})))},i.lost=function(t){this.videoState=this.textures.map((function(t){if("video"in t.source)return t.source.video.pause(),t.source.video.currentTime})),this.textures.map((function(t){return t.dispose()})),this.dispose()},i.dispose=function(){var t,e=this;if(!this.destroyed){this.destroyed=!0;for(var r,i=pr(this.textures);!(r=i()).done;)r.value.dispose();this._textures=[];for(var n,o=pr(this.videos);!(n=o()).done;){var a=n.value;a.pause(),a.removeAttribute("src"),a.load()}this.videos=[],this.rootItem.dispose(),this.renderFrame.dispose(),null==(t=this.pluginSystem)||t.destroyComposition(this),this.update=function(){ci.error("Update disposed composition: "+e.name+".")},this.dispose=hi,this.renderer.env!==Fu&&this.renderer.clear({stencilAction:exports.TextureLoadAction.clear,clearStencil:0,depthAction:exports.TextureLoadAction.clear,clearDepth:1,colorAction:exports.TextureLoadAction.clear,clearColor:[0,0,0,0]})}},i.setEditorTransform=function(t,e,r){this.renderFrame.editorTransform.set(t,t,e,r)},i.translateByPixel=function(t,e){this.renderer?this.rootItem.translateByPixel(t,e):console.warn("Renderer not assigned. Operation aborted.")},i.setPositionByPixel=function(t,e){this.renderer?this.rootItem.setPositionByPixel(t,e):console.warn("Renderer not assigned. Operation aborted.")},i.translate=function(t,e,r){this.rootItem.translate(t,e,r)},i.setPosition=function(t,e,r){this.rootItem.setPosition(t,e,r)},i.rotate=function(t,e,r){this.rootItem.rotate(t,e,r)},i.setRotation=function(t,e,r){this.rootItem.setRotation(t,e,r)},i.scale=function(t,e,r){this.rootItem.scale(t,e,r)},i.setScale=function(t,e,r){this.rootItem.setScale(t,e,r)},i.offloadTexture=function(){this.textureOffloaded||(this.textures.forEach((function(t){return t&&t.offloadData()})),this.textureOffloaded=!0)},i.reloadTexture=function(){var t=this;return fr((function(){return gr(this,(function(e){switch(e.label){case 0:return t.textureOffloaded?[4,Promise.all(t.textures.map((function(t){return null==t?void 0:t.reloadData()})))]:[3,2];case 1:e.sent(),t.textureOffloaded=!1,e.label=2;case 2:return[2]}}))}))()},e.buildItemTree=function(t){for(var e,r=new Map,i=t.getComponent(exports.CompositionComponent).items,n=pr(i);!(e=n()).done;){var o=e.value;r.set(o.id,o)}for(var a,s=pr(i);!(a=s()).done;){var u=a.value;if(void 0===u.parentId)u.setParent(t);else{var c=r.get(u.parentId);if(!c)throw new Error("The element references a non-existent element, please check the data.");u.setParent(c)}}},Io(e,[{key:"transform",get:function(){return this.rootItem.transform}},{key:"textures",get:function(){return this._textures}},{key:"items",get:function(){return this.rootComposition.items}},{key:"time",get:function(){return this.rootComposition.time}},{key:"isDestroyed",get:function(){return this.destroyed}},{key:"viewportMatrix",get:function(){return this.camera.getViewportMatrix()},set:function(t){this.camera.setViewportMatrix(t)}}]),e}(sl);exports.VFXItem=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).children=[],i.transform=new cc,i.time=-1,i.duration=0,i.endBehavior=qi.forward,i.type=Bi.base,i.components=[],i.isDuringPlay=!1,i.active=!0,i.visible=!0,i.listIndex=0,i.isEnabled=!1,i.eventProcessor=new sl,i.name="VFXItem",i.transform.name=i.name,i.transform.engine=e,r&&i.fromData(r),i}ji(e,t);var r=e.prototype;return r.on=function(t,e,r){this.eventProcessor.on(t,e,r)},r.off=function(t,e){this.eventProcessor.off(t,e)},r.once=function(t,e){this.eventProcessor.once(t,e)},r.emit=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n;(n=this.eventProcessor).emit.apply(n,[].concat([t],r))},r.getListeners=function(t){return this.eventProcessor.getListeners(t)},r.addComponent=function(t){var e=new t(this.engine);return this.components.push(e),e.setVFXItem(this),e},r.getComponent=function(t){for(var e,r,i=pr(this.components);!(r=i()).done;){var n=r.value;if(mr(n,t)){e=n;break}}return e},r.getComponents=function(t){for(var e,r=[],i=pr(this.components);!(e=i()).done;){var n=e.value;mr(n,t)&&r.push(n)}return r},r.setParent=function(t){(t!==this||t)&&(this.parent&&Rr(this.parent.children,this),this.parent=t,this.transform.parentTransform=t.transform,t.children.push(this),!this.composition&&t.composition&&(this.composition=t.composition),!this.isDuringPlay&&t.isDuringPlay&&(this.awake(),this.beginPlay()))},r.setColor=function(t,e,r,i){},r.setOpacity=function(t){},r.setActive=function(t){this.active!==!!t&&(this.active=!!t,this.onActiveChanged())},r.setVisible=function(t){for(var e,r=pr(this.components);!(e=r()).done;)e.value.enabled=t;this.visible=t},r.getVisible=function(){return this.visible},r.getWorldTransform=function(t){var e=null!=t?t:new cc({valid:!0});return e.cloneFromMatrix(this.transform.getWorldMatrix()),e},r.translate=function(t,e,r){this.transform.translate(t,e,r)},r.rotate=function(t,e,r){var i=new Ya(t,e,r),n=$n.fromEuler(i);n.conjugate(),this.transform.rotateByQuat(n)},r.scale=function(t,e,r){this.transform.scaleBy(t,e,r)},r.setPositionByPixel=function(t,e){if(this.composition){var r=this.transform.getWorldPosition().z,i=this.composition.camera.getInverseVPRatio(r),n=i.x,o=i.y,a=this.composition.renderer.getWidth()/2,s=this.composition.renderer.getHeight()/2;this.transform.setPosition((2*t/a-1)*n,(1-2*e/s)*o,r)}},r.setPosition=function(t,e,r){this.transform.setPosition(t,e,r)},r.setRotation=function(t,e,r){this.transform.setRotation(t,e,r)},r.setScale=function(t,e,r){this.transform.setScale(t,e,r)},r.getBoundingBox=function(){},r.getHitTestParams=function(t){},r.getCurrentPosition=function(){var t=new Dr;return this.transform.assignWorldTRS(t),t},r.find=function(t){var e;if(this.name===t)return this;var r=[];(e=r).push.apply(e,[].concat(this.children));for(var i=0;i<r.length;){var n,o=r[i];if(i++,o.name===t)return o;(n=r).push.apply(n,[].concat(o.children))}},r.duplicate=function(){var t=new Map;this.gatherPreviousObjectID(t),this.resetGUID();var e=this.engine.findObject({id:this.defination.id});return e.resetGUID(),this.resetGUID(t),this.composition&&e.setParent(this.composition.rootItem),e},r.beginPlay=function(){this.isDuringPlay=!0,this.composition&&this.active&&!this.isEnabled&&this.onEnable();for(var t,e=pr(this.children);!(t=e()).done;){var r=t.value;r.isDuringPlay||r.beginPlay()}},r.awake=function(){for(var t,e=pr(this.components);!(t=e()).done;){var r=t.value;r.isAwakeCalled||(r.onAwake(),r.isAwakeCalled=!0)}for(var i,n=pr(this.children);!(i=n()).done;)i.value.awake()},r.onActiveChanged=function(){this.isEnabled?this.onDisable():this.onEnable()},r.onEnable=function(){this.isEnabled=!0;for(var t,e=pr(this.components);!(t=e()).done;){var r=t.value;r.enabled&&!r.isStartCalled&&(r.onStart(),r.isStartCalled=!0)}for(var i,n=pr(this.components);!(i=n()).done;){var o=i.value;o.enabled&&!o.isEnableCalled&&o.enable()}},r.onDisable=function(){this.isEnabled=!1;for(var t,e=pr(this.components);!(t=e()).done;){var r=t.value;r.enabled&&r.isEnableCalled&&r.disable()}},r.fromData=function(r){t.prototype.fromData.call(this,r);var i=r.id,n=r.name,o=r.parentId,a=r.endBehavior,s=r.transform,u=r.duration,c=void 0===u?0:u,h=r.visible,l=void 0===h||h;if(this.props=r,this.type=r.type,this.id=i.toString(),this.name=n,s&&this.transform.fromData(s),this.transform.name=this.name,this.transform.engine=this.engine,this.parentId=o,this.duration=c,this.endBehavior=a,r.content||(r.content={options:{}}),c<0)throw new Error("Item duration can't be less than 0, see "+Du["Item duration can't be less than 0"]+".");if(r.components){this.components.length=0;for(var f,d=pr(r.components);!(f=d()).done;){var p=f.value,m=this.engine.findObject(p);this.components.push(m),mr(m,exports.ParticleSystem)&&(this.components.includes(m.renderer)||this.components.push(m.renderer))}}e.isComposition(this)&&this.instantiatePreComposition(),this.setVisible(l)},r.toData=function(){var t,e;if(this.defination.id=this.guid,this.defination.transform=this.transform.toData(),this.defination.dataType=xn.VFXItemData,"rootItem"!==(null==(t=this.parent)?void 0:t.name)&&(this.defination.parentId=null==(e=this.parent)?void 0:e.guid),!this.defination.components){this.defination.components=[];for(var r,i=pr(this.components);!(r=i()).done;){var n=r.value;mr(n,exports.EffectComponent)&&this.defination.components.push(n)}}this.defination.content={}},r.translateByPixel=function(t,e){if(this.composition){var r=this.composition.renderer.canvas.getBoundingClientRect(),i=r.width,n=r.height,o=this.transform.getWorldPosition().z,a=this.composition.camera.getInverseVPRatio(o),s=a.x,u=a.y;this.transform.translate(2*t*s/i,-2*e*u/n,0)}},r.dispose=function(){if(this.resetChildrenParent(),this.composition){this.composition.destroyItem(this);for(var e,r=pr(this.components.slice());!(e=r()).done;)e.value.dispose();this.components=[],this._composition=null,this.transform.setValid(!1)}t.prototype.dispose.call(this)},r.resetChildrenParent=function(){for(var t,e=pr(this.children);!(t=e()).done;){var r=t.value;this.parent&&r.setParent(this.parent)}var i;this.parent&&Rr(null==(i=this.parent)?void 0:i.children,this)},r.instantiatePreComposition=function(){var t=this.props.content.options.refId,e=this.engine.findEffectsObjectData(t);if(!e)throw new Error("Referenced precomposition with Id: "+t+" does not exist.");var r=e.components,i=this.getInstanceId();this.setInstanceId(e.id);for(var n,o=pr(r);!(n=o()).done;){var a=n.value,s=this.engine.findObject(a);if(s.item=this,this.components.push(s),s.setInstanceId(xi()),mr(s,exports.CompositionComponent))for(var u,c=pr(s.items);!(u=c()).done;){var h=u.value;h.setInstanceId(xi());for(var l,f=pr(h.components);!(l=f()).done;)l.value.setInstanceId(xi())}}this.setInstanceId(i),fl.buildItemTree(this)},r.resetGUID=function(t){var e,r=null!=(e=null==t?void 0:t.get(this))?e:xi();this.setInstanceId(r);for(var i,n=pr(this.components);!(i=n()).done;){var o,a=i.value,s=null!=(o=null==t?void 0:t.get(a))?o:xi();a.setInstanceId(s)}for(var u,c=pr(this.children);!(u=c()).done;)u.value.resetGUID(t)},r.gatherPreviousObjectID=function(t){t.set(this,this.getInstanceId());for(var e,r=pr(this.components);!(e=r()).done;){var i=e.value;t.set(i,i.getInstanceId())}for(var n,o=pr(this.children);!(n=o()).done;)n.value.gatherPreviousObjectID(t)},e.isComposition=function(t){return t.type===Bi.composition},e.isSprite=function(t){return t.type===Bi.sprite},e.isParticle=function(t){return t.type===Bi.particle},e.isNull=function(t){return t.type===Bi.null},e.isTree=function(t){return t.type===Bi.tree},e.isCamera=function(t){return t.type===Bi.camera},e.isAncestor=function(t,e){for(var r=e.parent;r;){if(r===t)return!0;r=r.parent}return!1},Io(e,[{key:"composition",get:function(){return this._composition},set:function(t){this._composition=t;for(var e,r=pr(this.children);!(e=r()).done;){var i=e.value;i.composition||(i.composition=t)}}},{key:"compositionReusable",get:function(){var t,e;return null!=(e=null==(t=this.composition)?void 0:t.reusable)&&e}},{key:"renderOrder",get:function(){return this.listIndex},set:function(t){if(this.listIndex!==t){this.listIndex=t;for(var e,r=pr(this.components);!(e=r()).done;){var i=e.value;mr(i,Lo)&&(i.priority=t)}}}},{key:"isActive",get:function(){return this.active},set:function(t){this.setActive(t)}},{key:"isVisible",get:function(){return this.visible}}]),e}(Ln),exports.VFXItem=yr([In(xn.VFXItemData)],exports.VFXItem),function(t){t.is=function(t,e){return t.type===e},t.isComposition=function(t){return t.type===Bi.composition},t.isParticle=function(t){return t.type===Bi.particle},t.isNull=function(t){return t.type===Bi.null}}(exports.Item||(exports.Item={}));var dl=[1,1,1,1],pl=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).renderColor=[1,1,1,1],e}ji(e,t);var r=e.prototype;return r.processFrame=function(t){var e=t.output.getUserData();if(mr(e,exports.VFXItem)){if(this.activeComponent||(this.activeComponent=this.getActiveComponent(e)),!this.activeMaterial){var r,i;this.activeMaterial=null==(r=this.activeComponent)?void 0:r.material;var n=null==(i=this.activeMaterial)?void 0:i.getColor("_Color");n&&(this.startColor=n.toArray())}var o,a,s,u=Hs(dl,1),c=this.time/this.getDuration(),h=this.opacityOverLifetime,l=this.colorOverLifetime;l&&(u=kr(l,c,!0),o=!0),h&&(u[3]*=h.getValue(c),o=!0),o&&(js(this.renderColor,u,this.startColor),null==(s=this.activeMaterial)||null==(a=s.getColor("_Color"))||a.setFromArray(this.renderColor))}},r.create=function(t){this.clipData=t;var e,r=t.colorOverLifetime;return r&&(this.opacityOverLifetime=Gu(null!=(e=r.opacity)?e:1),r.color&&r.color[0]===Yi.GRADIENT_COLOR&&(this.colorOverLifetime=zr(r.color[1]))),this},r.getActiveComponent=function(t){return t.getComponent(Ds)},e}(ic);exports.AnimationClip=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).duration=0,e.positionCurves=[],e.rotationCurves=[],e.eulerCurves=[],e.scaleCurves=[],e.floatCurves=[],e.colorCurves=[],e}ji(e,t);var r=e.prototype;return r.sampleAnimation=function(t,e){for(var r,i=Lr(e,0,this.duration),n=pr(this.positionCurves);!(r=n()).done;){var o=r.value,a=o.keyFrames.getValue(i),s=this.findTarget(t,o.path);null==s||s.transform.setPosition(a.x,a.y,a.z)}for(var u,c=pr(this.rotationCurves);!(u=c()).done;){var h=u.value,l=h.keyFrames.getValue(i),f=this.findTarget(t,h.path);null==f||f.transform.setQuaternion(l.x,l.y,l.z,l.w)}for(var d,p=pr(this.eulerCurves);!(d=p()).done;){var m=d.value,v=m.keyFrames.getValue(i),y=this.findTarget(t,m.path);null==y||y.transform.setRotation(v.x,v.y,v.z)}for(var g,x=pr(this.scaleCurves);!(g=x()).done;){var T=g.value,_=T.keyFrames.getValue(i),E=this.findTarget(t,T.path);null==E||E.transform.setScale(_.x,_.y,_.z)}},r.fromData=function(t){this.positionCurves.length=0,this.scaleCurves.length=0,this.rotationCurves.length=0,this.eulerCurves.length=0,this.floatCurves.length=0,this.colorCurves.length=0;var e=0;if(t.positionCurves)for(var r,i=pr(t.positionCurves);!(r=i()).done;){var n=r.value,o={path:n.path,keyFrames:Gu(n.keyFrames)};e=Math.max(e,o.keyFrames.getMaxTime()),this.positionCurves.push(o)}if(t.rotationCurves)for(var a,s=pr(t.rotationCurves);!(a=s()).done;){var u=a.value,c={path:u.path,keyFrames:Gu(u.keyFrames)};e=Math.max(e,c.keyFrames.getMaxTime()),this.rotationCurves.push(c)}if(t.eulerCurves)for(var h,l=pr(t.eulerCurves);!(h=l()).done;){var f=h.value,d={path:f.path,keyFrames:Gu(f.keyFrames)};e=Math.max(e,d.keyFrames.getMaxTime()),this.eulerCurves.push(d)}if(t.scaleCurves)for(var p,m=pr(t.scaleCurves);!(p=m()).done;){var v=p.value,y={path:v.path,keyFrames:Gu(v.keyFrames)};e=Math.max(e,y.keyFrames.getMaxTime()),this.scaleCurves.push(y)}if(t.floatCurves)for(var g,x=pr(t.floatCurves);!(g=x()).done;){var T=g.value,_={path:T.path,keyFrames:Gu(T.keyFrames),property:T.property,className:T.className};e=Math.max(e,_.keyFrames.getMaxTime()),this.floatCurves.push(_)}if(t.colorCurves)for(var E,b=pr(t.colorCurves);!(E=b()).done;){var A=E.value,S={path:A.path,keyFrames:Gu(A.keyFrames),property:A.property,className:A.className};e=Math.max(e,S.keyFrames.getMaxTime()),this.colorCurves.push(S)}void 0!==t.duration?this.duration=t.duration:this.duration=e},r.findTarget=function(t,e){for(var r,i=t,n=pr(e.split("."));!(r=n()).done;){for(var o,a=r.value,s=!1,u=pr(i.children);!(o=u()).done;){var c=o.value;if(c.name===a){i=c,s=!0;break}}if(!s)return}return i},e}(Ln),exports.AnimationClip=yr([In(xn.AnimationClip)],exports.AnimationClip);var ml=[[0,0,1,1,0]],vl=0;exports.SpriteColorPlayableAsset=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.createPlayable=function(){var t=new pl;return t.create(this.data),t},r.fromData=function(t){this.data=t},e}(oc),exports.SpriteColorPlayableAsset=yr([In(xn.SpriteColorPlayableAsset)],exports.SpriteColorPlayableAsset);var yl=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createTrackMixer=function(){return new Dh},e}(exports.TrackAsset),gl=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.updateAnimatedObject=function(t){return t.getComponent(exports.SpriteComponent)},e}(yl),xl=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.updateAnimatedObject=function(t){return t.getComponent(exports.EffectComponent)},e}(yl),Tl=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.createPlayable=function(){return new _l},e}(oc),_l=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e.prototype.processFrame=function(t){var e=t.output.getUserData();"time"in e&&(e.time=this.time)},e}(ic);function El(t){return t.maxVertexUniforms>=256?exports.maxSpriteMeshItemCount=32:t.maxVertexUniforms>=128?exports.maxSpriteMeshItemCount=16:void 0}exports.SpriteComponent=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).time=0,i.duration=0,i.loop=!0,i.splits=ml,i.name="MSprite"+vl++,r&&i.fromData(r),i}ji(e,t);var r=e.prototype;return r.onUpdate=function(t){var e=this,r=this.time,i=this.duration;r>i&&this.loop&&(r%=i);var n=Math.min(Math.max(r/i,0),1),o=this.textureSheetAnimation,a=this.renderer.texture.source.video;if(a&&(0===r?a.pause():a.play().catch((function(t){e.engine.renderErrors.add(t)})),this.renderer.texture.uploadCurrentVideoFrame()),o){var s,u,c,h,l,f=o.total||o.row*o.col,d=0,p=0,m=1,v=1;if(this.splits){var y=this.splits[0];u=y[4],d=y[0],p=y[1],u?(m=y[3],v=y[2]):(m=y[2],v=y[3])}if(u?(c=1/o.row*m,h=1/o.col*v):(c=1/o.col*m,h=1/o.row*v),o.animate){var g=Math.round(n*(f-1)),x=Math.floor(g/o.col),T=g-x*o.col;l=u?[c*x,h*(o.col-T)]:[c*T,h*(1+x)]}else l=[0,h];null==(s=this.material.getVector4("_TexOffset"))||s.setFromArray([d+l[0],v+p-l[1],c,h])}this.time=r+t/1e3},r.onDisable=function(){t.prototype.onDisable.call(this),this.time=0},r.onDestroy=function(){var t=this.renderer.texture.source;t.sourceType===exports.TextureSourceType.video&&(null==t?void 0:t.video)&&(t.video.pause(),t.video.src="",t.video.load())},r.updateGeometry=function(t){var e=this.textureSheetAnimation?[0,0,1,1,this.splits[0][4]]:this.splits[0],r=e[0],i=e[1],n=Boolean(e[4]),o=n?e[3]:e[2],a=n?e[2]:e[3],s=n?-Math.PI/2:0,u=t.getAttributeData("aUV"),c=t.getAttributeData("aPos"),h=t.getIndexData(),l=[0,0];if(u&&c&&h){for(var f=u.length/2,d=0;d<f;d++){var p=3*d,m=2*d,v=c[p],y=c[p+1];l[0]=v,l[1]=y,rh(l,l,s),u[m]=(l[0]+.5)*o+r,u[m+1]=(l[1]+.5)*a+i}this.geometry.setAttributeData("aPos",c.slice()),this.geometry.setAttributeData("aUV",u.slice()),this.geometry.setIndexData(h.slice()),this.geometry.setDrawCount(h.length)}this.geometry.subMeshes.length=0;for(var g,x=pr(t.subMeshes);!(g=x()).done;){var T=g.value;this.geometry.subMeshes.push({offset:T.offset,indexCount:T.indexCount,vertexCount:T.vertexCount})}},r.updateGeometryFromMultiSplit=function(){for(var t=this.splits,e=this.textureSheetAnimation,r=this.defaultGeometry,i=[-.5,.5,-.5,-.5,.5,.5,.5,-.5],n=[],o=[],a=[],s=0;s<2;s++)for(var u=0;u<2;u++){var c=4*(2*u+s),h=e?[0,0,1,1,t[0][4]]:t[2*u+s],l=h[4]?[0,0,1,0,0,1,1,1]:[0,1,0,0,1,1,1,0],f=((s+s+1)/2-1)/2,d=((u+u+1)/2-1)/2,p=h[0],m=h[1],v=h[4]?h[3]:h[2],y=h[4]?h[2]:h[3],g=[i[0]/2+f,i[1]/2+d,i[2]/2+f,i[3]/2+d,i[4]/2+f,i[5]/2+d,i[6]/2+f,i[7]/2+d];n.push(l[0]*v+p,l[1]*y+m,l[2]*v+p,l[3]*y+m,l[4]*v+p,l[5]*y+m,l[6]*v+p,l[7]*y+m),a.push(1*g[0],1*g[1],0,1*g[2],1*g[3],0,1*g[4],1*g[5],0,1*g[6],1*g[7],0),o.push(c,1+c,2+c,2+c,1+c,3+c)}r.setAttributeData("aPos",new Float32Array(a)),r.setIndexData(new Uint16Array(o)),r.setAttributeData("aUV",new Float32Array(n)),r.setDrawCount(o.length)},r.fromData=function(e){var r;t.prototype.fromData.call(this,e);var i=null!=(r=e.splits)?r:ml,n=e.textureSheetAnimation;this.splits=i,this.textureSheetAnimation=n;var o=e.geometry?this.engine.findObject(e.geometry):this.defaultGeometry;1===i.length?this.updateGeometry(o):this.updateGeometryFromMultiSplit(),this.interaction=e.interaction;var a,s,u=e.options.startColor||[1,1,1,1];this.material.setColor("_Color",(new Br).setFromArray(u)),this.duration=null!=(a=e.duration)?a:this.item.duration,this.loop=null==(s=e.loop)||s},e}(Ds),exports.SpriteComponent=yr([In(xn.SpriteComponent)],exports.SpriteComponent),exports.maxSpriteMeshItemCount=8;var bl=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Xi),Al=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Xi),Sl=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e}var e=t.prototype;return e.clone=function(){return new t(this.x,this.y)},e.copyFrom=function(t){return this.set(t.x,t.y),this},e.copyTo=function(t){return t.set(this.x,this.y),t},e.equals=function(t){return t.x===this.x&&t.y===this.y},e.set=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this},Io(t,null,[{key:"shared",get:function(){return Rl.x=0,Rl.y=0,Rl}}]),t}(),Rl=new Sl,Cl=1e-4,Ml=1e-4;function Ol(t,e,r,i,n,o,a,s){var u,c;a?(u=i,c=-r):(u=-i,c=r);var h=t-r*n+u,l=e-i*n+c,f=t+r*o+u,d=e+i*o+c;return s.push(h,l),s.push(f,d),2}function Pl(t,e,r,i,n,o,a,s){var u=r-t,c=i-e,h=Math.atan2(u,c),l=Math.atan2(n-t,o-e);s&&h<l?h+=2*Math.PI:!s&&h>l&&(l+=2*Math.PI);var f=h,d=l-h,p=Math.abs(d),m=Math.sqrt(u*u+c*c),v=1+(15*p*Math.sqrt(m)/Math.PI|0),y=d/v;if(f+=y,s){a.push(t,e),a.push(r,i);for(var g=1,x=f;g<v;g++,x+=y)a.push(t,e),a.push(t+Math.sin(x)*m,e+Math.cos(x)*m);a.push(t,e),a.push(n,o)}else{a.push(r,i),a.push(t,e);for(var T=1,_=f;T<v;T++,_+=y)a.push(t+Math.sin(_)*m,e+Math.cos(_)*m),a.push(t,e);a.push(n,o),a.push(t,e)}return 2*v}function Il(t,e,r,i,n,o,a,s,u){var c=Cl;if(0!==t.length){var h=e,l=h.alignment;if(.5!==e.alignment){var f=function(t){var e=t.length;if(e<6)return 1;for(var r=0,i=0,n=t[e-2],o=t[e-1];i<e;i+=2){var a=t[i],s=t[i+1];r+=(a-n)*(s+o),n=a,o=s}return r<0?-1:1}(t);r&&(f*=-1),l=(l-.5)*f+.5}var d=new Sl(t[0],t[1]),p=new Sl(t[t.length-2],t[t.length-1]),m=i,v=Math.abs(d.x-p.x)<c&&Math.abs(d.y-p.y)<c;if(m){t=t.slice(),v&&(t.pop(),t.pop(),p.set(t[t.length-2],t[t.length-1]));var y=.5*(d.x+p.x),g=.5*(p.y+d.y);t.unshift(y,g),t.push(y,g)}var x=n,T=t.length/2,_=t.length,E=x.length/2,b=h.width/2,A=b*b,S=h.miterLimit*h.miterLimit,R=t[0],C=t[1],M=t[2],O=t[3],P=0,I=0,w=-(C-O),N=R-M,L=0,F=0,D=Math.sqrt(w*w+N*N)+Ir;w/=D,N/=D,w*=b,N*=b;var V=2*(1-l),B=2*l;m||(h.cap===pn.Round?_+=Pl(R-w*(V-B)*.5,C-N*(V-B)*.5,R-w*V,C-N*V,R+w*B,C+N*B,x,!0)+2:h.cap===pn.Square&&(_+=Ol(R,C,w,N,V,B,!0,x))),x.push(R-w*V,C-N*V),x.push(R+w*B,C+N*B);for(var U=1;U<T-1;++U){R=t[2*(U-1)],C=t[2*(U-1)+1],M=t[2*U],O=t[2*U+1],P=t[2*(U+1)],I=t[2*(U+1)+1],w=-(C-O),N=R-M,w/=D=Math.sqrt(w*w+N*N)+Ir,N/=D,w*=b,N*=b,L=-(O-I),F=M-P,L/=D=Math.sqrt(L*L+F*F)+Ir,F/=D,L*=b,F*=b;var k=M-R,z=C-O,G=M-P,X=I-O,H=k*G+z*X,j=z*G-X*k,W=j<0;if(Math.abs(j)<.001*Math.abs(H))x.push(M-w*V,O-N*V),x.push(M+w*B,O+N*B),H>=0&&(h.join===mn.Round?_+=Pl(M,O,M-w*V,O-N*V,M-L*V,O-F*V,x,!1)+4:_+=2,x.push(M-L*B,O-F*B),x.push(M+L*V,O+F*V));else{var Y=(-w+R)*(-N+O)-(-w+M)*(-N+C),Z=(-L+P)*(-F+O)-(-L+M)*(-F+I),q=(k*Z-G*Y)/j,K=(X*Y-z*Z)/j,Q=(q-M)*(q-M)+(K-O)*(K-O),J=M+(q-M)*V,$=O+(K-O)*V,tt=M-(q-M)*B,et=O-(K-O)*B,rt=W?V:B;Q<=Math.min(k*k+z*z,G*G+X*X)+rt*rt*A?h.join===mn.Bevel||Q/A>S?(W?(x.push(J,$),x.push(M+w*B,O+N*B),x.push(J,$),x.push(M+L*B,O+F*B)):(x.push(M-w*V,O-N*V),x.push(tt,et),x.push(M-L*V,O-F*V),x.push(tt,et)),_+=2):h.join===mn.Round?W?(x.push(J,$),x.push(M+w*B,O+N*B),_+=Pl(M,O,M+w*B,O+N*B,M+L*B,O+F*B,x,!0)+4,x.push(J,$),x.push(M+L*B,O+F*B)):(x.push(M-w*V,O-N*V),x.push(tt,et),_+=Pl(M,O,M-w*V,O-N*V,M-L*V,O-F*V,x,!1)+4,x.push(M-L*V,O-F*V),x.push(tt,et)):(x.push(J,$),x.push(tt,et)):(x.push(M-w*V,O-N*V),x.push(M+w*B,O+N*B),h.join===mn.Round?_+=W?Pl(M,O,M+w*B,O+N*B,M+L*B,O+F*B,x,!0)+2:Pl(M,O,M-w*V,O-N*V,M-L*V,O-F*V,x,!1)+2:h.join===mn.Miter&&Q/A<=S&&(W?(x.push(tt,et),x.push(tt,et)):(x.push(J,$),x.push(J,$)),_+=2),x.push(M-L*V,O-F*V),x.push(M+L*B,O+F*B),_+=2)}}R=t[2*(T-2)],C=t[2*(T-2)+1],M=t[2*(T-1)],w=-(C-(O=t[2*(T-1)+1])),N=R-M,w/=D=Math.sqrt(w*w+N*N)+Ir,N/=D,w*=b,N*=b,x.push(M-w*V,O-N*V),x.push(M+w*B,O+N*B),m||(h.cap===pn.Round?_+=Pl(M-w*(V-B)*.5,O-N*(V-B)*.5,M-w*V,O-N*V,M+w*B,O+N*B,x,!1)+2:h.cap===pn.Square&&(_+=Ol(M,O,w,N,V,B,!1,x)));for(var it=Ml*Ml,nt=E;nt<_+E-2;++nt)R=x[2*nt],C=x[2*nt+1],M=x[2*(nt+1)],O=x[2*(nt+1)+1],P=x[2*(nt+2)],I=x[2*(nt+2)+1],Math.abs(R*(O-I)+M*(I-C)+P*(C-O))<it||s.push(nt,nt+1,nt+2)}}var wl=function(){},Nl="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ll={exports:{}};!function(t){var e;function r(t,e){return t.b===e.b&&t.a===e.a}function i(t,e){return t.b<e.b||t.b===e.b&&t.a<=e.a}function n(t,e,r){var i=e.b-t.b,n=r.b-e.b;return 0<i+n?i<n?e.a-t.a+i/(i+n)*(t.a-r.a):e.a-r.a+n/(i+n)*(r.a-t.a):0}function o(t,e,r){var i=e.b-t.b,n=r.b-e.b;return 0<i+n?(e.a-r.a)*i+(e.a-t.a)*n:0}function a(t,e){return t.a<e.a||t.a===e.a&&t.b<=e.b}function s(t,e,r){var i=e.a-t.a,n=r.a-e.a;return 0<i+n?i<n?e.b-t.b+i/(i+n)*(t.b-r.b):e.b-r.b+n/(i+n)*(r.b-t.b):0}function u(t,e,r){var i=e.a-t.a,n=r.a-e.a;return 0<i+n?(e.b-r.b)*i+(e.b-t.b)*n:0}function c(t){return i(t.b.a,t.a)}function h(t){return i(t.a,t.b.a)}function l(t,e,r,i){return(t=0>t?0:t)<=(r=0>r?0:r)?0===r?(e+i)/2:e+t/(t+r)*(i-e):i+r/(t+r)*(e-i)}function f(t){var e=y(t.b);return x(e,t.c),x(e.b,t.c),T(e,t.a),e}function d(t,e){var r=!1,i=!1;t!==e&&(e.a!==t.a&&(i=!0,E(e.a,t.a)),e.d!==t.d&&(r=!0,b(e.d,t.d)),g(e,t),i||(x(e,t.a),t.a.c=t),r||(T(e,t.d),t.d.a=t))}function p(t){var e=t.b,r=!1;t.d!==t.b.d&&(r=!0,b(t.d,t.b.d)),t.c===t?E(t.a,null):(t.b.d.a=$(t),t.a.c=t.c,g(t,$(t)),r||T(t,t.d)),e.c===e?(E(e.a,null),b(e.d,null)):(t.d.a=$(e),e.a.c=e.c,g(e,$(e))),_(t)}function m(t){var e=y(t),r=e.b;return g(e,t.e),e.a=t.b.a,x(r,e.a),e.d=r.d=t.d,e=e.b,g(t.b,$(t.b)),g(t.b,e),t.b.a=e.a,e.b.a.c=e.b,e.b.d=t.b.d,e.f=t.f,e.b.f=t.b.f,e}function v(t,e){var r=!1,i=y(t),n=i.b;return e.d!==t.d&&(r=!0,b(e.d,t.d)),g(i,t.e),g(n,e),i.a=t.b.a,n.a=e.a,i.d=n.d=t.d,t.d.a=n,r||T(i,t.d),i}function y(t){var e=new J,r=new J,i=t.b.h;return r.h=i,i.b.h=e,e.h=t,t.b.h=r,e.b=r,e.c=e,e.e=r,r.b=e,r.c=r,r.e=e}function g(t,e){var r=t.c,i=e.c;r.b.e=e,i.b.e=t,t.c=i,e.c=r}function x(t,e){var r=e.f,i=new et(e,r);r.e=i,e.f=i,r=i.c=t;do{r.a=i,r=r.c}while(r!==t)}function T(t,e){var r=e.d,i=new Q(e,r);r.b=i,e.d=i,i.a=t,i.c=e.c,r=t;do{r.d=i,r=r.e}while(r!==t)}function _(t){var e=t.h;t=t.b.h,e.b.h=t,t.b.h=e}function E(t,e){var r=t.c,i=r;do{i.a=e,i=i.c}while(i!==r);r=t.f,(i=t.e).f=r,r.e=i}function b(t,e){var r=t.a,i=r;do{i.d=e,i=i.e}while(i!==r);r=t.d,(i=t.b).d=r,r.b=i}function A(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e}var S=4e150;function R(t,e){t.f+=e.f,t.b.f+=e.b.f}function C(t,e,r){return t=t.a,e=e.a,r=r.a,e.b.a===t?r.b.a===t?i(e.a,r.a)?0>=o(r.b.a,e.a,r.a):0<=o(e.b.a,r.a,e.a):0>=o(r.b.a,t,r.a):r.b.a===t?0<=o(e.b.a,t,e.a):(e=n(e.b.a,t,e.a))>=(t=n(r.b.a,t,r.a))}function M(t){t.a.i=null;var e=t.e;e.a.c=e.c,e.c.a=e.a,t.e=null}function O(t,e){p(t.a),t.c=!1,t.a=e,e.i=t}function P(t){var e=t.a.a;do{t=dt(t)}while(t.a.a===e);return t.c&&(O(t,e=v(ft(t).a.b,t.a.e)),t=dt(t)),t}function I(t,e,r){var i=new lt;return i.a=r,i.e=j(t.f,e.e,i),r.i=i}function w(t,e){switch(t.s){case 100130:return!!(1&e);case 100131:return 0!==e;case 100132:return 0<e;case 100133:return 0>e;case 100134:return 2<=e||-2>=e}return!1}function N(t){var e=t.a,r=e.d;r.c=t.d,r.a=e,M(t)}function L(t,e,r){for(t=e,e=e.a;t!==r;){t.c=!1;var i=ft(t),n=i.a;if(n.a!==e.a){if(!i.c){N(t);break}O(i,n=v(e.c.b,n.b))}e.c!==n&&(d($(n),n),d(e,n)),N(t),e=i.a,t=i}return e}function F(t,e,r,i,n,o){var a=!0;do{I(t,e,r.b),r=r.c}while(r!==i);for(null===n&&(n=ft(e).a.b.c);(r=(i=ft(e)).a.b).a===n.a;)r.c!==n&&(d($(r),r),d($(n),r)),i.f=e.f-r.f,i.d=w(t,i.f),e.b=!0,!a&&U(t,e)&&(R(r,n),M(e),p(n)),a=!1,e=i,n=r;e.b=!0,o&&z(t,e)}function D(t,e,r,i,n){var o=[e.g[0],e.g[1],e.g[2]];e.d=null,e.d=t.o&&t.o(o,r,i,t.c)||null,null===e.d&&(n?t.n||(K(t,100156),t.n=!0):e.d=r[0])}function V(t,e,r){var i=[null,null,null,null];i[0]=e.a.d,i[1]=r.a.d,D(t,e.a,i,[.5,.5,0,0],!1),d(e,r)}function B(t,e,r,i,n){var o=Math.abs(e.b-t.b)+Math.abs(e.a-t.a),a=Math.abs(r.b-t.b)+Math.abs(r.a-t.a),s=n+1;i[n]=.5*a/(o+a),i[s]=.5*o/(o+a),t.g[0]+=i[n]*e.g[0]+i[s]*r.g[0],t.g[1]+=i[n]*e.g[1]+i[s]*r.g[1],t.g[2]+=i[n]*e.g[2]+i[s]*r.g[2]}function U(t,e){var n=ft(e),a=e.a,s=n.a;if(i(a.a,s.a)){if(0<o(s.b.a,a.a,s.a))return!1;if(r(a.a,s.a)){if(a.a!==s.a){n=t.e;var u=a.a.h;if(0<=u){var c=(n=n.b).d,h=n.e,l=n.c,f=l[u];c[f]=c[n.a],l[c[f]]=f,f<=--n.a&&(1>=f||i(h[c[f>>1]],h[c[f]])?ct(n,f):ht(n,f)),h[u]=null,l[u]=n.b,n.b=u}else for(n.c[-(u+1)]=null;0<n.a&&null===n.c[n.d[n.a-1]];)--n.a;V(t,$(s),a)}}else m(s.b),d(a,$(s)),e.b=n.b=!0}else{if(0>o(a.b.a,s.a,a.a))return!1;dt(e).b=e.b=!0,m(a.b),d($(s),a)}return!0}function k(t,e){var c=ft(e),h=e.a,f=c.a,p=h.a,v=f.a,y=h.b.a,g=f.b.a,x=new et;if(o(y,t.a,p),o(g,t.a,v),p===v||Math.min(p.a,y.a)>Math.max(v.a,g.a))return!1;if(i(p,v)){if(0<o(g,p,v))return!1}else if(0>o(y,v,p))return!1;var T,_,E=y,b=p,A=g,S=v;if(i(E,b)||(T=E,E=b,b=T),i(A,S)||(T=A,A=S,S=T),i(E,A)||(T=E,E=A,A=T,T=b,b=S,S=T),i(A,b)?i(b,S)?(0>(T=n(E,A,b))+(_=n(A,b,S))&&(T=-T,_=-_),x.b=l(T,A.b,_,b.b)):(0>(T=o(E,A,b))+(_=-o(E,S,b))&&(T=-T,_=-_),x.b=l(T,A.b,_,S.b)):x.b=(A.b+b.b)/2,a(E,b)||(T=E,E=b,b=T),a(A,S)||(T=A,A=S,S=T),a(E,A)||(T=E,E=A,A=T,T=b,b=S,S=T),a(A,b)?a(b,S)?(0>(T=s(E,A,b))+(_=s(A,b,S))&&(T=-T,_=-_),x.a=l(T,A.a,_,b.a)):(0>(T=u(E,A,b))+(_=-u(E,S,b))&&(T=-T,_=-_),x.a=l(T,A.a,_,S.a)):x.a=(A.a+b.a)/2,i(x,t.a)&&(x.b=t.a.b,x.a=t.a.a),E=i(p,v)?p:v,i(E,x)&&(x.b=E.b,x.a=E.a),r(x,p)||r(x,v))return U(t,e),!1;if(!r(y,t.a)&&0<=o(y,t.a,x)||!r(g,t.a)&&0>=o(g,t.a,x)){if(g===t.a)return m(h.b),d(f.b,h),h=ft(e=P(e)).a,L(t,ft(e),c),F(t,e,$(h),h,h,!0),!0;if(y===t.a){m(f.b),d(h.e,$(f)),v=(p=c=e).a.b.a;do{p=dt(p)}while(p.a.b.a===v);return p=ft(e=p).a.b.c,c.a=$(f),F(t,e,(f=L(t,c,null)).c,h.b.c,p,!0),!0}return 0<=o(y,t.a,x)&&(dt(e).b=e.b=!0,m(h.b),h.a.b=t.a.b,h.a.a=t.a.a),0>=o(g,t.a,x)&&(e.b=c.b=!0,m(f.b),f.a.b=t.a.b,f.a.a=t.a.a),!1}return m(h.b),m(f.b),d($(f),h),h.a.b=x.b,h.a.a=x.a,h.a.h=it(t.e,h.a),h=h.a,f=[0,0,0,0],x=[p.d,y.d,v.d,g.d],h.g[0]=h.g[1]=h.g[2]=0,B(h,p,y,f,0),B(h,v,g,f,2),D(t,h,x,f,!0),dt(e).b=e.b=c.b=!0,!1}function z(t,e){for(var r=ft(e);;){for(;r.b;)e=r,r=ft(r);if(!e.b&&(r=e,null===(e=dt(e))||!e.b))break;e.b=!1;var n,a=e.a,s=r.a;if(n=a.b.a!==s.b.a)t:{var u=ft(n=e),c=n.a,h=u.a,l=void 0;if(i(c.b.a,h.b.a)){if(0>o(c.b.a,h.b.a,c.a)){n=!1;break t}dt(n).b=n.b=!0,l=m(c),d(h.b,l),l.d.c=n.d}else{if(0<o(h.b.a,c.b.a,h.a)){n=!1;break t}n.b=u.b=!0,l=m(h),d(c.e,h.b),l.b.d.c=n.d}n=!0}if(n&&(r.c?(M(r),p(s),s=(r=ft(e)).a):e.c&&(M(e),p(a),a=(e=dt(r)).a)),a.a!==s.a)if(a.b.a===s.b.a||e.c||r.c||a.b.a!==t.a&&s.b.a!==t.a)U(t,e);else if(k(t,e))break;a.a===s.a&&a.b.a===s.b.a&&(R(s,a),M(e),p(a),e=dt(r))}}function G(t,e){t.a=e;for(var n=e.c;null===n.i;)if((n=n.c)===e.c){n=t;var a=e;(c=new lt).a=a.c.b;var s=(l=n.f).a;do{s=s.a}while(null!==s.b&&!l.c(l.b,c,s.b));var u=ft(l=s.b),c=l.a;if(s=u.a,0===o(c.b.a,a,c.a))r((c=l.a).a,a)||r(c.b.a,a)||(m(c.b),l.c&&(p(c.c),l.c=!1),d(a.c,c),G(n,a));else{var h=i(s.b.a,c.b.a)?l:u;u=void 0,l.d||h.c?(u=h===l?v(a.c.b,c.e):v(s.b.c.b,a.c).b,h.c?O(h,u):(c=n,(l=I(n,l,u)).f=dt(l).f+l.a.f,l.d=w(c,l.f)),G(n,a)):F(n,l,a.c,a.c,null,!0)}return}if(l=(c=ft(n=P(n.i))).a,(c=L(t,c,null)).c===l){c=(l=c).c,s=ft(n),u=n.a,h=s.a;var l,f=!1;u.b.a!==h.b.a&&k(t,n),r(u.a,t.a)&&(d($(c),u),c=ft(n=P(n)).a,L(t,ft(n),s),f=!0),r(h.a,t.a)&&(d(l,$(h)),l=L(t,s,null),f=!0),f?F(t,n,l.c,c,c,!0):(a=i(h.a,u.a)?$(h):u,F(t,n,a=v(l.c.b,a),a.c,a.c,!1),a.b.i.c=!0,z(t,n))}else F(t,n,c.c,l,l,!0)}function X(t,e){var r=new lt,i=f(t.b);i.a.b=S,i.a.a=e,i.b.a.b=-S,i.b.a.a=e,t.a=i.b.a,r.a=i,r.f=0,r.d=!1,r.c=!1,r.h=!0,r.b=!1,i=j(i=t.f,i.a,r),r.e=i}function H(t){this.a=new W,this.b=t,this.c=C}function j(t,e,r){do{e=e.c}while(null!==e.b&&!t.c(t.b,e.b,r));return t=new W(r,e.a,e),e.a.c=t,e.a=t}function W(t,e,r){this.b=t||null,this.a=e||this,this.c=r||this}function Y(){this.d=Z,this.p=this.b=this.q=null,this.j=[0,0,0],this.s=100130,this.n=!1,this.o=this.a=this.e=this.f=null,this.m=!1,this.c=this.r=this.i=this.k=this.l=this.h=null}var Z=0;function q(t,e){if(t.d!==e)for(;t.d!==e;)if(t.d<e)switch(t.d){case Z:K(t,100151),t.u(null);break;case 1:K(t,100152),t.t()}else switch(t.d){case 2:K(t,100154),t.v();break;case 1:K(t,100153),t.w()}}function K(t,e){t.p&&t.p(e,t.c)}function Q(t,e){this.b=t||this,this.d=e||this,this.a=null,this.c=!1}function J(){this.h=this,this.i=this.d=this.a=this.e=this.c=this.b=null,this.f=0}function $(t){return t.b.e}function tt(){this.c=new et,this.a=new Q,this.b=new J,this.d=new J,this.b.b=this.d,this.d.b=this.b}function et(t,e){this.e=t||this,this.f=e||this,this.d=this.c=null,this.g=[0,0,0],this.h=this.a=this.b=0}function rt(){this.c=[],this.d=null,this.a=0,this.e=!1,this.b=new ot}function it(t,e){if(t.e){var r,i=t.b,n=++i.a;return 2*n>i.f&&(i.f*=2,i.c=at(i.c,i.f+1)),0===i.b?r=n:(r=i.b,i.b=i.c[i.b]),i.e[r]=e,i.c[r]=n,i.d[n]=r,i.h&&ht(i,n),r}return i=t.a++,t.c[i]=e,-(i+1)}function nt(t){if(0===t.a)return ut(t.b);var e=t.c[t.d[t.a-1]];if(0!==t.b.a&&i(st(t.b),e))return ut(t.b);do{--t.a}while(0<t.a&&null===t.c[t.d[t.a-1]]);return e}function ot(){this.d=at([0],33),this.e=[null,null],this.c=[0,0],this.a=0,this.f=32,this.b=0,this.h=!1,this.d[1]=1}function at(t,e){for(var r=Array(e),i=0;i<t.length;i++)r[i]=t[i];for(;i<e;i++)r[i]=0;return r}function st(t){return t.e[t.d[1]]}function ut(t){var e=t.d,r=t.e,i=t.c,n=e[1],o=r[n];return 0<t.a&&(e[1]=e[t.a],i[e[1]]=1,r[n]=null,i[n]=t.b,t.b=n,0<--t.a&&ct(t,1)),o}function ct(t,e){for(var r=t.d,n=t.e,o=t.c,a=e,s=r[a];;){var u=a<<1;u<t.a&&i(n[r[u+1]],n[r[u]])&&(u+=1);var c=r[u];if(u>t.a||i(n[s],n[c])){r[a]=s,o[s]=a;break}r[a]=c,o[c]=a,a=u}}function ht(t,e){for(var r=t.d,n=t.e,o=t.c,a=e,s=r[a];;){var u=a>>1,c=r[u];if(0===u||i(n[c],n[s])){r[a]=s,o[s]=a;break}r[a]=c,o[c]=a,a=u}}function lt(){this.e=this.a=null,this.f=0,this.c=this.b=this.h=this.d=!1}function ft(t){return t.e.c.b}function dt(t){return t.e.a.b}(e=Y.prototype).x=function(){q(this,Z)},e.B=function(t,e){switch(t){case 100142:return;case 100140:switch(e){case 100130:case 100131:case 100132:case 100133:case 100134:return void(this.s=e)}break;case 100141:return void(this.m=!!e);default:return void K(this,100900)}K(this,100901)},e.y=function(t){switch(t){case 100142:return 0;case 100140:return this.s;case 100141:return this.m;default:K(this,100900)}return!1},e.A=function(t,e,r){this.j[0]=t,this.j[1]=e,this.j[2]=r},e.z=function(t,e){var r=e||null;switch(t){case 100100:case 100106:this.h=r;break;case 100104:case 100110:this.l=r;break;case 100101:case 100107:this.k=r;break;case 100102:case 100108:this.i=r;break;case 100103:case 100109:this.p=r;break;case 100105:case 100111:this.o=r;break;case 100112:this.r=r;break;default:K(this,100900)}},e.C=function(t,e){var r=!1,i=[0,0,0];q(this,2);for(var n=0;3>n;++n){var o=t[n];-1e150>o&&(o=-1e150,r=!0),1e150<o&&(o=1e150,r=!0),i[n]=o}r&&K(this,100155),null===(r=this.q)?d(r=f(this.b),r.b):(m(r),r=r.e),r.a.d=e,r.a.g[0]=i[0],r.a.g[1]=i[1],r.a.g[2]=i[2],r.f=1,r.b.f=-1,this.q=r},e.u=function(t){q(this,Z),this.d=1,this.b=new tt,this.c=t},e.t=function(){q(this,1),this.d=2,this.q=null},e.v=function(){q(this,2),this.d=1},e.w=function(){q(this,1),this.d=Z;var t=!1,e=[l=this.j[0],n=this.j[1],s=this.j[2]];if(0===l&&0===n&&0===s){for(var n=[-2e150,-2e150,-2e150],a=[2e150,2e150,2e150],s=[],u=[],l=(t=this.b.c).e;l!==t;l=l.e)for(var f=0;3>f;++f){var d=l.g[f];d<a[f]&&(a[f]=d,u[f]=l),d>n[f]&&(n[f]=d,s[f]=l)}if(l=0,n[1]-a[1]>n[0]-a[0]&&(l=1),n[2]-a[2]>n[l]-a[l]&&(l=2),a[l]>=n[l])e[0]=0,e[1]=0,e[2]=1;else{for(n=0,a=u[l],s=s[l],u=[0,0,0],a=[a.g[0]-s.g[0],a.g[1]-s.g[1],a.g[2]-s.g[2]],f=[0,0,0],l=t.e;l!==t;l=l.e)f[0]=l.g[0]-s.g[0],f[1]=l.g[1]-s.g[1],f[2]=l.g[2]-s.g[2],u[0]=a[1]*f[2]-a[2]*f[1],u[1]=a[2]*f[0]-a[0]*f[2],u[2]=a[0]*f[1]-a[1]*f[0],(d=u[0]*u[0]+u[1]*u[1]+u[2]*u[2])>n&&(n=d,e[0]=u[0],e[1]=u[1],e[2]=u[2]);0>=n&&(e[0]=e[1]=e[2]=0,e[A(a)]=1)}t=!0}for(u=A(e),l=this.b.c,n=(u+1)%3,s=(u+2)%3,u=0<e[u]?1:-1,e=l.e;e!==l;e=e.e)e.b=e.g[n],e.a=u*e.g[s];if(t){for(e=0,l=(t=this.b.a).b;l!==t;l=l.b)if(!(0>=(n=l.a).f))do{e+=(n.a.b-n.b.a.b)*(n.a.a+n.b.a.a),n=n.e}while(n!==l.a);if(0>e)for(t=(e=this.b.c).e;t!==e;t=t.e)t.a=-t.a}for(this.n=!1,l=(e=this.b.b).h;l!==e;l=t)t=l.h,n=l.e,r(l.a,l.b.a)&&l.e.e!==l&&(V(this,n,l),p(l),n=(l=n).e),n.e===l&&(n!==l&&(n!==t&&n!==t.b||(t=t.h),p(n)),l!==t&&l!==t.b||(t=t.h),p(l));for(this.e=e=new rt,l=(t=this.b.c).e;l!==t;l=l.e)l.h=it(e,l);for(function(t){t.d=[];for(var e=0;e<t.a;e++)t.d[e]=e;t.d.sort(function(t){return function(e,r){return i(t[e],t[r])?1:-1}}(t.c)),t.e=!0,function(t){for(var e=t.a;1<=e;--e)ct(t,e);t.h=!0}(t.b)}(e),this.f=new H(this),X(this,-S),X(this,S);null!==(e=nt(this.e));){for(;;){t:if(l=this.e,0===l.a)t=st(l.b);else if(t=l.c[l.d[l.a-1]],0!==l.b.a&&(l=st(l.b),i(l,t))){t=l;break t}if(null===t||!r(t,e))break;t=nt(this.e),V(this,e.c,t.c)}G(this,e)}for(this.a=this.f.a.a.b.a.a,e=0;null!==(t=this.f.a.a.b);)t.h||++e,M(t);for(this.f=null,(e=this.e).b=null,e.d=null,this.e=e.c=null,l=(e=this.b).a.b;l!==e.a;l=t)t=l.b,(l=l.a).e.e===l&&(R(l.c,l),p(l));if(!this.n){if(e=this.b,this.m)for(l=e.b.h;l!==e.b;l=t)t=l.h,l.b.d.c!==l.d.c?l.f=l.d.c?1:-1:p(l);else for(l=e.a.b;l!==e.a;l=t)if(t=l.b,l.c){for(l=l.a;i(l.b.a,l.a);l=l.c.b);for(;i(l.a,l.b.a);l=l.e);for(n=l.c.b,s=void 0;l.e!==n;)if(i(l.b.a,n.a)){for(;n.e!==l&&(c(n.e)||0>=o(n.a,n.b.a,n.e.b.a));)n=(s=v(n.e,n)).b;n=n.c.b}else{for(;n.e!==l&&(h(l.c.b)||0<=o(l.b.a,l.a,l.c.b.a));)l=(s=v(l,l.c.b)).b;l=l.e}for(;n.e.e!==l;)n=(s=v(n.e,n)).b}if(this.h||this.i||this.k||this.l)if(this.m){for(t=(e=this.b).a.b;t!==e.a;t=t.b)if(t.c){this.h&&this.h(2,this.c),l=t.a;do{this.k&&this.k(l.a.d,this.c),l=l.e}while(l!==t.a);this.i&&this.i(this.c)}}else{for(e=this.b,t=!!this.l,l=!1,n=-1,s=e.a.d;s!==e.a;s=s.d)if(s.c){l||(this.h&&this.h(4,this.c),l=!0),u=s.a;do{t&&n!==(a=u.b.d.c?0:1)&&(n=a,this.l&&this.l(!!n,this.c)),this.k&&this.k(u.a.d,this.c),u=u.e}while(u!==s.a)}l&&this.i&&this.i(this.c)}if(this.r){for(l=(e=this.b).a.b;l!==e.a;l=t)if(t=l.b,!l.c){s=(n=l.a).e,u=void 0;do{s=(u=s).e,u.d=null,null===u.b.d&&(u.c===u?E(u.a,null):(u.a.c=u.c,g(u,$(u))),(a=u.b).c===a?E(a.a,null):(a.a.c=a.c,g(a,$(a))),_(u))}while(u!==n);n=l.d,(l=l.b).d=n,n.b=l}return this.r(this.b),void(this.c=this.b=null)}}this.b=this.c=null},Nl.libtess={GluTesselator:Y,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901,GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111}},Y.prototype.gluDeleteTess=Y.prototype.x,Y.prototype.gluTessProperty=Y.prototype.B,Y.prototype.gluGetTessProperty=Y.prototype.y,Y.prototype.gluTessNormal=Y.prototype.A,Y.prototype.gluTessCallback=Y.prototype.z,Y.prototype.gluTessVertex=Y.prototype.C,Y.prototype.gluTessBeginPolygon=Y.prototype.u,Y.prototype.gluTessBeginContour=Y.prototype.t,Y.prototype.gluTessEndContour=Y.prototype.v,Y.prototype.gluTessEndPolygon=Y.prototype.w,t.exports=Nl.libtess}(Ll);var Fl=function(){var t=new Ll.exports.GluTesselator;return t.gluTessCallback(Ll.exports.gluEnum.GLU_TESS_VERTEX_DATA,(function(t,e){e[e.length]=t[0],e[e.length]=t[1]})),t.gluTessCallback(Ll.exports.gluEnum.GLU_TESS_BEGIN,(function(t){t!==Ll.exports.primitiveType.GL_TRIANGLES&&console.info("expected TRIANGLES but got type: "+t)})),t.gluTessCallback(Ll.exports.gluEnum.GLU_TESS_ERROR,(function(t){console.error("error callback, error number: "+t)})),t.gluTessCallback(Ll.exports.gluEnum.GLU_TESS_COMBINE,(function(t,e,r){return[t[0],t[1],t[2]]})),t.gluTessCallback(Ll.exports.gluEnum.GLU_TESS_EDGE_FLAG,(function(t){})),t}();function Dl(t){Fl.gluTessNormal(0,0,1);var e=[];Fl.gluTessBeginPolygon(e);for(var r=0;r<t.length;r++){Fl.gluTessBeginContour();for(var i=t[r],n=0;n<i.length;n+=2){var o=[i[n],i[n+1],0];Fl.gluTessVertex(o,o)}Fl.gluTessEndContour()}return Fl.gluTessEndPolygon(),e}var Vl=function(t){function e(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var n;(n=t.call(this)||this).points=[],n.closePath=!1;var o=Array.isArray(r[0])?r[0]:r;if("number"!=typeof o[0]){for(var a=[],s=0,u=o.length;s<u;s++)a.push(o[s].x,o[s].y);o=a}return n.points=o,n.closePath=!0,n}ji(e,t);var r=e.prototype;return r.clone=function(){var t=new e(this.points.slice());return t.closePath=this.closePath,t},r.contains=function(t,e){for(var r=!1,i=this.points.length/2,n=0,o=i-1;n<i;o=n++){var a=this.points[2*n],s=this.points[2*n+1],u=this.points[2*o],c=this.points[2*o+1];s>e!=c>e&&t<(e-s)/(c-s)*(u-a)+a&&(r=!r)}return r},r.copyFrom=function(t){return this.points=t.points.slice(),this.closePath=t.closePath,this},r.copyTo=function(t){return t.copyFrom(this),t},r.getX=function(){return this.points[this.points.length-2]},r.getY=function(){return this.points[this.points.length-1]},r.build=function(t){for(var e=0;e<this.points.length;e++)t[e]=this.points[e]},r.triangulate=function(t,e,r,i,n){var o=Dl([t]),a=e.length/2;0===o.length&&this.getLineEndPointsTriangle(t,o);for(var s=0;s<o.length;s++)e[2*r+s]=o[s];for(var u=o.length/2,c=0;c<u;c++)i[n+c]=a+c},r.getLineEndPointsTriangle=function(t,e){if(!t||t.length<2||t.length%2!=0)throw new Error("Invalid points array");if(2!==t.length){var r=t[2]-t[0],i=t[3]-t[1],n=t[0],o=t[1],a=t[0],s=t[1];if(Math.abs(r)>=Math.abs(i))for(var u=0;u<t.length;u+=2){var c=t[u],h=t[u+1];c<n&&(n=c,o=h),c>a&&(a=c,s=h)}else for(var l=0;l<t.length;l+=2){var f=t[l],d=t[l+1];d<o&&(n=f,o=d),d>s&&(a=f,s=d)}e.push(n,o,a,s,a,s)}else e.push(t[0],t[1],t[0],t[1],t[0],t[1])},Io(e,[{key:"lastX",get:function(){return this.points[this.points.length-2]}},{key:"lastY",get:function(){return this.points[this.points.length-1]}}]),e}(wl),Bl=1.1920929e-7;function Ul(t,e,r,i,n,o,a,s,u,c){var h=(1-Math.min(.99,Math.max(0,null!=c?c:.5)))/5;return function(t,e,r,i,n,o,a,s,u,c){kl(t,e,r,i,n,o,a,s,u,c,0),u.push(a,s)}(e,r,i,n,o,a,s,u,t,h*=h),t}function kl(t,e,r,i,n,o,a,s,u,c,h){if(!(h>8)){var l=(t+r)/2,f=(e+i)/2,d=(r+n)/2,p=(i+o)/2,m=(n+a)/2,v=(o+s)/2,y=(l+d)/2,g=(f+p)/2,x=(d+m)/2,T=(p+v)/2,_=(y+x)/2,E=(g+T)/2;if(h>0){var b=a-t,A=s-e,S=Math.abs((r-a)*A-(i-s)*b),R=Math.abs((n-a)*A-(o-s)*b);if(S>Bl&&R>Bl){if((S+R)*(S+R)<=c*(b*b+A*A))return void u.push(_,E)}else if(S>Bl){if(S*S<=c*(b*b+A*A))return void u.push(_,E)}else if(R>Bl){if(R*R<=c*(b*b+A*A))return void u.push(_,E)}else if((b=_-(t+a)/2)*b+(A=E-(e+s)/2)*A<=c)return void u.push(_,E)}kl(t,e,l,f,y,g,_,E,u,c,h+1),kl(_,E,x,T,m,v,a,s,u,c,h+1)}}exports.StarType=void 0;var zl=function(t){function e(e,r,i,n){var o;return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),(o=t.call(this)||this).type="ellipse",o.x=e,o.y=r,o.halfWidth=i,o.halfHeight=n,o}ji(e,t);var r=e.prototype;return r.clone=function(){return new e(this.x,this.y,this.halfWidth,this.halfHeight)},r.contains=function(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;var r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return(r*=r)+(i*=i)<=1},r.strokeContains=function(t,e,r){var i=this.halfWidth,n=this.halfHeight;if(i<=0||n<=0)return!1;var o=r/2,a=i-o,s=n-o,u=i+o,c=n+o,h=t-this.x,l=e-this.y;return h*h/(a*a)+l*l/(s*s)>1&&h*h/(u*u)+l*l/(c*c)<=1},r.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this},r.copyTo=function(t){return t.copyFrom(this),t},r.getX=function(){return this.x},r.getY=function(){return this.y},r.build=function(t){var e=this.x,r=this.y,i=this.halfWidth,n=this.halfHeight;if(!(i>=0&&n>=0))return t;var o=Math.ceil(5*Math.sqrt(i+n)),a=8*o+0+0;if(0===a)return t;if(0===o)return t[0]=t[6]=e+0,t[1]=t[3]=r+0,t[2]=t[4]=e-0,t[5]=t[7]=r-0,t;var s=0,u=4*o+0+2,c=u,h=a,l=0+i,f=0,d=e+l,p=e-l,m=r+f;t[s++]=d,t[s++]=m,t[--u]=m,t[--u]=p;for(var v=1;v<o;v++){var y=Math.PI/2*(v/o),g=0+Math.cos(y)*i,x=0+Math.sin(y)*n,T=e+g,_=e-g,E=r+x,b=r-x;t[s++]=T,t[s++]=E,t[--u]=E,t[--u]=_,t[c++]=_,t[c++]=b,t[--h]=b,t[--h]=T}d=e+(l=0),p=e-l,m=r+(f=0+n);var A=r-f;return t[s++]=d,t[s++]=m,t[--h]=A,t[--h]=d,t},r.triangulate=function(t,e,r,i,n){if(0!==t.length){for(var o=0,a=0,s=0;s<t.length;s+=2)o+=t[s],a+=t[s+1];o/=t.length/2,a/=t.length/2;var u=r;e[2*u]=o,e[2*u+1]=a;for(var c=u++,h=0;h<t.length;h+=2)e[2*u]=t[h],e[2*u+1]=t[h+1],h>0&&(i[n++]=u,i[n++]=c,i[n++]=u-1),u++;i[n++]=c+1,i[n++]=c,i[n++]=u-1}},e}(wl);!function(t){t[t.Star=0]="Star",t[t.Polygon=1]="Polygon"}(exports.StarType||(exports.StarType={}));var Gl=function(t){function e(e,r,i,n,o,a){var s;return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=0),(s=t.call(this)||this).pointCount=e,s.outerRadius=r,s.innerRadius=i,s.outerRoundness=n,s.innerRoundness=o,s.starType=a,s.v=[],s.in=[],s.out=[],s}ji(e,t);var r=e.prototype;return r.clone=function(){return new e(this.pointCount,this.outerRadius,this.innerRadius,this.outerRoundness,this.innerRoundness,this.starType)},r.copyFrom=function(t){this.pointCount=t.pointCount,this.outerRadius=t.outerRadius,this.innerRadius=t.innerRadius,this.outerRoundness=t.outerRoundness,this.innerRoundness=t.innerRoundness,this.starType=t.starType},r.copyTo=function(t){t.copyFrom(this)},r.build=function(t){switch(this.starType){case 0:this.buildStarPath();break;case 1:this.buildPolygonPath()}for(var e=0;e<this.v.length-2;e+=2)Ul(t,this.v[e],this.v[e+1],this.out[e],this.out[e+1],this.in[e+2],this.in[e+3],this.v[e+2],this.v[e+3],1);var r=this.v.length-1;Ul(t,this.v[r-1],this.v[r],this.out[r-1],this.out[r],this.in[0],this.in[1],this.v[0],this.v[1],1)},r.triangulate=function(t,e,r,i,n){for(var o=Dl([t]),a=e.length/2,s=0;s<o.length;s++)e[2*r+s]=o[s];for(var u=o.length/2,c=0;c<u;c++)i[n+c]=a+c},r.buildStarPath=function(){this.v=[],this.in=[],this.out=[];var t,e,r,i,n=2*Math.floor(this.pointCount),o=2*Math.PI/n,a=!0,s=this.outerRadius,u=this.innerRadius,c=this.outerRoundness/100,h=this.innerRoundness/100,l=2*Math.PI*s/(2*n),f=2*Math.PI*u/(2*n),d=-Math.PI/2;for(t=0;t<n;t++){r=a?c:h,i=a?l:f;var p=(e=a?s:u)*Math.cos(d),m=e*Math.sin(d),v=0===p&&0===m?0:m/Math.sqrt(p*p+m*m),y=0===p&&0===m?0:-p/Math.sqrt(p*p+m*m),g=2*t;this.v[g]=p,this.v[g+1]=m,this.in[g]=p+v*i*r*1,this.in[g+1]=m+y*i*r*1,this.out[g]=p-v*i*r*1,this.out[g+1]=m-y*i*r*1,a=!a,d+=1*o}},r.buildPolygonPath=function(){this.v=[],this.in=[],this.out=[];var t,e=Math.floor(this.pointCount),r=2*Math.PI/e,i=this.outerRadius,n=this.outerRoundness/100,o=2*Math.PI*i/(4*e),a=.5*-Math.PI;for(t=0;t<e;t++){var s=i*Math.cos(a),u=i*Math.sin(a),c=0===s&&0===u?0:u/Math.sqrt(s*s+u*u),h=0===s&&0===u?0:-s/Math.sqrt(s*s+u*u),l=2*t;this.v[l]=s,this.v[l+1]=u,this.in[l]=s+c*o*n*1,this.in[l+1]=u+h*o*n*1,this.out[l]=s-c*o*n*1,this.out[l+1]=u-h*o*n*1,a+=1*r}},e}(wl),Xl=function(t){function e(e,r,i,n,o){var a;return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=20),(a=t.call(this)||this).x=e,a.y=r,a.width=i,a.height=n,a.roundness=o,a}ji(e,t);var r=e.prototype;return r.getBounds=function(t){return(t=t||new e).x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},r.clone=function(){return new e(this.x,this.y,this.width,this.height,this.roundness)},r.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.roundness=t.roundness,this},r.copyTo=function(t){return t.copyFrom(this),t},r.build=function(t){var e,r=this.width/2,i=this.height/2,n=this.x+r,o=this.y+i,a=e=Math.max(0,Math.min(this.roundness/100,1)*Math.min(r,i)),s=r-a,u=i-e;if(a>=0&&e>=0&&s>=0&&u>=0){var c=5*Math.ceil(2.3*Math.sqrt(a+e)),h=8*c+(s?4:0)+(u?4:0);if(0!==h){if(0===c)return t[0]=t[6]=n+s,t[1]=t[3]=o+u,t[2]=t[4]=n-s,void(t[5]=t[7]=o-u);var l=0,f=4*c+(s?2:0)+2,d=f,p=h,m=s+a,v=u,y=n+m,g=n-m,x=o+v;if(t[l++]=y,t[l++]=x,t[--f]=x,t[--f]=g,u){var T=o-v;t[d++]=g,t[d++]=T,t[--p]=T,t[--p]=y}for(var _=1;_<c;_++){var E=Math.PI/2*(_/c),b=s+Math.cos(E)*a,A=u+Math.sin(E)*e,S=n+b,R=n-b,C=o+A,M=o-A;t[l++]=S,t[l++]=C,t[--f]=C,t[--f]=R,t[d++]=R,t[d++]=M,t[--p]=M,t[--p]=S}y=n+(m=s),g=n-m,x=o+(v=u+e);var O=o-v;t[l++]=y,t[l++]=x,t[--p]=O,t[--p]=y,s&&(t[l++]=g,t[l++]=x,t[--p]=O,t[--p]=g)}}},r.triangulate=function(t,e,r,i,n){if(0!==t.length){for(var o=0,a=0,s=0;s<t.length;s+=2)o+=t[s],a+=t[s+1];o/=t.length/2,a/=t.length/2;var u=r;e[2*u]=o,e[2*u+1]=a;for(var c=u++,h=0;h<t.length;h+=2)e[2*u]=t[h],e[2*u+1]=t[h+1],h>0&&(i[n++]=u,i[n++]=c,i[n++]=u-1),u++;i[n++]=c+1,i[n++]=c,i[n++]=u-1}},e}(wl),Hl=function(){function t(t){this.graphicsPath=t,this.currentPoly=null,this.shapePrimitives=[]}var e=t.prototype;return e.buildPath=function(){this.currentPoly=null,this.shapePrimitives.length=0;for(var t,e=pr(this.graphicsPath.instructions);!(t=e()).done;){var r=t.value,i=r.action,n=r.data;switch(i){case"bezierCurveTo":this.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case"moveTo":this.moveTo(n[0],n[1]);break;case"ellipse":this.ellipse(n[0],n[1],n[2],n[3],n[4]);break;case"polyStar":this.polyStar(n[0],n[1],n[2],n[3],n[4],n[5],n[6]);break;case"rect":this.rect(n[0],n[1],n[2],n[3],n[4]);break;case"closePath":this.closePath()}}this.endPoly()},e.bezierCurveTo=function(t,e,r,i,n,o,a){this.ensurePoly();var s=this.currentPoly;return Ul(s.points,s.lastX,s.lastY,t,e,r,i,n,o,a),this},e.moveTo=function(t,e){return this.startPoly(t,e),this},e.closePath=function(){return this.endPoly(!0),this},e.ellipse=function(t,e,r,i,n){return this.drawShape(new zl(t,e,r,i),n),this},e.polyStar=function(t,e,r,i,n,o,a){return this.drawShape(new Gl(t,e,r,i,n,o),a),this},e.rect=function(t,e,r,i,n,o){return this.drawShape(new Xl(t,e,r,i,n),o),this},e.drawShape=function(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this},e.startPoly=function(t,e){var r=this.currentPoly;return r&&this.endPoly(),(r=new Vl).points.push(t,e),this.currentPoly=r,this},e.endPoly=function(t){void 0===t&&(t=!1);var e=this.currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this.currentPoly=null,this},e.ensurePoly=function(t){this.currentPoly||(this.currentPoly=new Vl,this.currentPoly.points.push(0,0))},t}(),jl=function(){function t(){this.instructions=[],this.dirty=!1}var e=t.prototype;return e.bezierCurveTo=function(t,e,r,i,n,o,a){return this.instructions.push({action:"bezierCurveTo",data:[t,e,r,i,n,o,a]}),this.dirty=!0,this},e.moveTo=function(t,e){return this.instructions.push({action:"moveTo",data:[t,e]}),this.dirty=!0,this},e.closePath=function(){return this.instructions.push({action:"closePath",data:[]}),this.dirty=!0,this},e.ellipse=function(t,e,r,i,n){return this.instructions.push({action:"ellipse",data:[t,e,r,i,n]}),this.dirty=!0,this},e.rect=function(t,e,r,i,n,o){return this.instructions.push({action:"rect",data:[t,e,r,i,n,o]}),this.dirty=!0,this},e.polyStar=function(t,e,r,i,n,o,a){return this.instructions.push({action:"polyStar",data:[t,e,r,i,n,o,a]}),this.dirty=!0,this},e.clear=function(){return this.instructions.length=0,this.dirty=!0,this},Io(t,[{key:"shapePath",get:function(){return this._shapePath||(this._shapePath=new Hl(this)),this.dirty&&(this.dirty=!1,this._shapePath.buildPath()),this._shapePath}}]),t}();function Wl(t,e){return!e||"object"!==vr(e)&&"function"!=typeof e?ac(t):e}var Yl=new(function(){function t(){this.elements=[]}var e=t.prototype;return e.dispose=function(){this.elements.forEach((function(t){return t.remove()})),this.elements.length=0},e.getCanvas=function(){if(0!==this.elements.length){var t=this.elements.shift();return oi(t),t}if(hh(uh))return r.window._createOffscreenCanvas(10,10);var e=r.document.createElement("canvas");return e.getContext("2d",{willReadFrequently:!0}),e},e.saveCanvas=function(t){t.width=1,t.height=1,this.elements.length<3?Sr(this.elements,t):t.remove()},t}()),Zl=function(){function t(t){this.width=0,this.height=0;var e=t.fontSize,r=t.textHeight,i=void 0===r?100:r,n=t.textWidth,o=void 0===n?100:n,a=t.textOverflow,s=void 0===a?on.clip:a,u=t.textBaseline,c=void 0===u?sn.top:u,h=t.textAlign,l=void 0===h?un.left:h,f=t.text,d=void 0===f?" ":f,p=t.letterSpace,m=void 0===p?0:p,v=t.lineGap,y=void 0===v?.571:v,g=t.autoWidth,x=void 0!==g&&g,T=t.lineHeight,_=void 0===T?e:T,E=t.useLegacyRichText,b=void 0!==E&&E,A=e+m;this.autoWidth=x,this.maxTextWidth=d.length*A,this.width=o,this.height=i,this.letterSpace=m,this.lineGap=y,this.useLegacyRichText=b,this.overflow=s,this.textBaseline=c,this.textAlign=l,this.lineHeight=_}var e=t.prototype;return e.getOffsetY=function(t,e,r,i){var n=t.outlineWidth,o=t.fontScale,a=(r-i)/3,s=i+n*o,u=r*(e-1),c=0;switch(this.textBaseline){case sn.top:c=s+a;break;case sn.middle:c=(this.height*o-u+s)/2;break;case sn.bottom:c=this.height*o-u-a}return c},e.getOffsetX=function(t,e){var r=0;switch(this.textAlign){case un.left:r=t.outlineWidth*t.fontScale;break;case un.middle:r=(this.width*t.fontScale-e)/2;break;case un.right:r=this.width*t.fontScale-e}return r},e.getOffsetYRich=function(t,e,r){var i=t.outlineWidth,n=t.fontScale,o=e.reduce((function(t,e){return t+e}),0),a=(e[0]-r)/3,s=r+i*n,u=o-e[0],c=0;switch(this.textBaseline){case sn.top:c=s+a;break;case sn.middle:c=(this.height*n-o+this.lineGap*n)/2+s;break;case sn.bottom:c=this.height*n-u-a}return c},e.setSize=function(t,e){this.width=t,this.height=e},t}(),ql=function(t){this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineWidth=0,this.hasShadow=!1,this.fontDesc="",this.fontScale=2,this.fontOffset=0;var e,r,i,n,o,a,s=t.textColor,u=void 0===s?[1,1,1,1]:s,c=t.fontSize,h=void 0===c?40:c,l=t.outline,f=t.shadow,d=t.fontWeight,p=void 0===d?"normal":d,m=t.fontStyle,v=void 0===m?"normal":m,y=t.fontFamily,g=void 0===y?"sans-serif":y;this.textColor=u,this.textWeight=p,this.fontStyle=v,this.fontFamily=g,this.fontSize=h,l&&(this.isOutlined=!0,this.outlineColor=null!=(e=l.outlineColor)?e:[1,1,1,1],this.outlineWidth=null!=(r=l.outlineWidth)?r:1),f&&(this.hasShadow=!0,this.shadowBlur=null!=(i=f.shadowBlur)?i:2,this.shadowColor=null!=(n=f.shadowColor)?n:[0,0,0,1],this.shadowOffsetX=null!=(o=f.shadowOffsetX)?o:0,this.shadowOffsetY=null!=(a=f.shadowOffsetY)?a:0),this.fontStyle!==hn.normal&&(this.fontOffset+=this.fontSize*Math.tan(.20943951))},Kl=["serif","sans-serif","monospace","courier"],Ql=0;exports.TextComponent=function(t){function e(e,r){var i;if((i=t.call(this,e)||this).isDirty=!0,i.lineCount=0,i.maxLineWidth=0,i.SCALE_FACTOR=.1,i.ALPHA_FIX_VALUE=1/255,i.name="MText"+Ql++,r&&i.fromData(r),i.canvas=Yl.getCanvas(),Yl.saveCanvas(i.canvas),i.context=i.canvas.getContext("2d",{willReadFrequently:!0}),!r)return Wl(i);var n=r.options;return i.updateWithOptions(n),i.updateTexture(),i}ji(e,t);var r=e.prototype;return r.onUpdate=function(e){t.prototype.onUpdate.call(this,e),this.updateTexture()},r.onDestroy=function(){t.prototype.onDestroy.call(this),this.disposeTextTexture()},r.fromData=function(e){t.prototype.fromData.call(this,e);var r=e.interaction,i=e.options;this.interaction=r,this.updateWithOptions(i),this.renderText(i),this.material.setColor("_Color",new Br(1,1,1,1))},r.updateWithOptions=function(t){},r.updateTexture=function(t){},e}(Ds),exports.TextComponent=yr([In(xn.TextComponent)],exports.TextComponent);var Jl=function(){function t(){}var e=t.prototype;return e.renderText=function(t){this.updateTexture()},e.updateWithOptions=function(t){this.textStyle=new ql(t),this.textLayout=new Zl(t),this.text=t.text.toString(),this.lineCount=this.getLineCount(t.text,!0)},e.getLineCount=function(t,e){var r=this.context,i=this.textLayout,n=i.letterSpace,o=i.overflow;this.maxLineWidth=0;var a=this.textLayout.width+this.textStyle.fontOffset,s=1,u=0;r&&(r.font=this.getFontDesc(this.textStyle.fontSize));for(var c=0;c<t.length;c++){var h,l,f=t[c],d=null!=(l=null==r||null==(h=r.measureText(f))?void 0:h.width)?l:0;u+=n,o===on.display?"\n"===f?(s++,u=0):(u+=d,this.maxLineWidth=Math.max(this.maxLineWidth,u)):((u+d>a&&c>0||"\n"===f)&&(s++,this.maxLineWidth=Math.max(this.maxLineWidth,u),u=0),"\n"!==f&&(u+=d))}return s},e.setFontSize=function(t){if(this.textStyle.fontSize!==t){var e=this.textStyle.fontSize-t;this.textLayout.lineHeight+=e,this.textStyle.fontSize=t,this.isDirty=!0}},e.setFontWeight=function(t){this.textStyle.textWeight!==t&&(this.textStyle.textWeight=t,this.isDirty=!0)},e.setFontStyle=function(t){this.textStyle.fontStyle!==t&&(this.textStyle.fontStyle=t,this.isDirty=!0)},e.setText=function(t){this.text!==t&&(this.text=t.toString(),this.lineCount=this.getLineCount(t,!1),this.isDirty=!0)},e.setTextAlign=function(t){this.textLayout.textAlign!==t&&(this.textLayout.textAlign=t,this.isDirty=!0)},e.setTextBaseline=function(t){this.textLayout.textBaseline!==t&&(this.textLayout.textBaseline=t,this.isDirty=!0)},e.setTextColor=function(t){this.textStyle.textColor!==t&&(this.textStyle.textColor=t,this.isDirty=!0)},e.setFontFamily=function(t){this.textStyle.fontFamily!==t||ai(t)?(this.textStyle.fontFamily=t,this.isDirty=!0):console.warn("The font is either the current font or an risky font family.")},e.setOutlineColor=function(t){this.textStyle.outlineColor!==t&&(this.textStyle.outlineColor=t,this.isDirty=!0)},e.setOutlineWidth=function(t){this.textStyle.outlineWidth!==t&&(this.textStyle.outlineWidth=t,this.isDirty=!0)},e.setShadowBlur=function(t){this.textStyle.shadowBlur!==t&&(this.textStyle.shadowBlur=t,this.isDirty=!0)},e.setOverflow=function(t){this.textLayout.overflow=t,this.isDirty=!0},e.setShadowColor=function(t){this.textStyle.shadowColor!==t&&(this.textStyle.shadowColor=t,this.isDirty=!0)},e.setShadowOffsetX=function(t){this.textStyle.shadowOffsetX!==t&&(this.textStyle.shadowOffsetX=t,this.isDirty=!0)},e.setShadowOffsetY=function(t){this.textStyle.shadowOffsetY!==t&&(this.textStyle.shadowOffsetY=t,this.isDirty=!0)},e.setFontScale=function(t){this.textStyle.fontScale!==t&&(this.textStyle.fontScale=t,this.isDirty=!0)},e.setAutoWidth=function(t){this.textLayout.autoWidth!==t&&(this.textLayout.autoWidth=t,this.isDirty=!0)},e.updateTexture=function(t){if(void 0===t&&(t=!0),this.isDirty&&this.context&&this.canvas){var e=this.context,r=this.textStyle,i=this.textLayout,n=r.fontScale,o=(i.width+r.fontOffset)*n,a=i.lineHeight*this.lineCount,s=r.fontSize*n,u=i.lineHeight*n;r.fontDesc=this.getFontDesc(s),this.char=(this.text||"").split(""),this.canvas.width=o,i.autoWidth?(this.canvas.height=a*n,this.item.transform.size.set(1,a/i.height)):this.canvas.height=i.height*n;var c=this.canvas.height;e.fillStyle="rgba(255, 255, 255, 0.0039)",t||(e.translate(0,c),e.scale(1,-1)),this.maxLineWidth>o&&i.overflow===on.display?e.font=this.getFontDesc(s*o/this.maxLineWidth):e.font=r.fontDesc,e.clearRect(0,0,o,c),r.hasShadow&&this.setupShadow(),r.isOutlined&&this.setupOutline(),e.fillStyle="rgba("+r.textColor[0]+", "+r.textColor[1]+", "+r.textColor[2]+", "+r.textColor[3]+")";for(var h=[],l=0,f=i.getOffsetY(r,this.lineCount,u,s),d=[],p=[],m=0;m<this.char.length;m++){var v=this.char[m],y=e.measureText(v);((l+=i.letterSpace*n)+y.width>o&&m>0||"\n"===v)&&(h.push({y:f,width:l,chars:d,charOffsetX:p}),l=0,f+=u,d=[],p=[]),"\n"!==v&&(d.push(v),p.push(l),l+=y.width)}h.push({y:f,width:l,chars:d,charOffsetX:p}),h.forEach((function(t){var n=i.getOffsetX(r,t.width);t.chars.forEach((function(i,o){r.isOutlined&&e.strokeText(i,n+t.charOffsetX[o],t.y),e.fillText(i,n+t.charOffsetX[o],t.y)}))})),r.hasShadow&&(e.shadowColor="transparent");var g=e.getImageData(0,0,this.canvas.width,this.canvas.height),x=ya.createWithData(this.engine,{data:new Uint8Array(g.data),width:g.width,height:g.height},{flipY:t,magFilter:ko.LINEAR,minFilter:ko.LINEAR,wrapS:ko.CLAMP_TO_EDGE,wrapT:ko.CLAMP_TO_EDGE});this.disposeTextTexture(),this.renderer.texture=x,this.material.setTexture("_MainTex",x),this.isDirty=!1}},e.disposeTextTexture=function(){var t=this.renderer.texture;t&&t!==this.engine.whiteTexture&&t.dispose()},e.getFontDesc=function(t){var e=this.textStyle,r=e.fontSize,i=e.fontScale,n=e.fontFamily,o=e.textWeight,a=e.fontStyle,s=(t||r*i).toString()+"px ";return Kl.includes(n)?s+=n:s+='"'+n+'"',o!==cn.normal&&(s=o+" "+s),a!==hn.normal&&(s=a+" "+s),s},e.setupOutline=function(){var t=this.context,e=this.textStyle,r=e.outlineColor,i=e.outlineWidth,n=r[0],o=r[1],a=r[2],s=r[3];t&&(t.strokeStyle="rgba("+255*n+", "+255*o+", "+255*a+", "+s+")",t.lineWidth=2*i)},e.setupShadow=function(){var t=this.context,e=this.textStyle,r=e.outlineColor,i=e.shadowBlur,n=e.shadowOffsetX,o=e.shadowOffsetY,a=r[0],s=r[1],u=r[2],c=r[3];t&&(t.shadowColor="rgba("+255*a+", "+255*s+", "+255*u+", "+c+")",t.shadowBlur=i,t.shadowOffsetX=n,t.shadowOffsetY=-o)},t}();_i(exports.TextComponent,[Jl]);var $l=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Xi),tf=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Ln);exports.BinaryAsset=function(t){function e(){return t.apply(this,arguments)}return ji(e,t),e}(Ln),yr([wn()],exports.BinaryAsset.prototype,"buffer",void 0),exports.BinaryAsset=yr([In(xn.BinaryAsset)],exports.BinaryAsset);var ef=function(){function t(){}return t.serialize=function(e,r){e.toData(),r||(r={});var i=Nn(e);if(i)for(var n,o=pr(Object.keys(i));!(n=o()).done;){var a=n.value,s=e[a];"number"==typeof s||"string"==typeof s||"boolean"==typeof s||t.checkTypedArray(s)?r[a]=s:fi(s)?(r[a]||(r[a]=[]),t.serializeArrayProperty(s,r[a],0)):Ln.is(s)?r[a]={id:s.getInstanceId()}:pi(s)&&(r[a]||(r[a]={}),t.serializeObjectProperty(s,r[a],0))}for(var u,c=pr(Object.keys(e.defination));!(u=c()).done;){var h=u.value,l=e.defination[h];"number"==typeof l||"string"==typeof l||"boolean"==typeof l||t.checkTypedArray(l)?r[h]=l:fi(l)?(r[h]||(r[h]=[]),t.serializeArrayProperty(l,r[h],0)):Ln.is(l)?r[h]={id:l.getInstanceId()}:pi(l)&&(r[h]||(r[h]={}),t.serializeObjectProperty(l,r[h],0))}return r},t.deserialize=function(e,r){r.defination=e;var i=Nn(r),n=r.engine;if(i)for(var o,a=pr(Object.keys(i));!(o=a()).done;){var s=o.value,u=e[s];if(void 0!==u){var c=i[s].type;r[s]=t.deserializeProperty(u,n,0,c)}}r.fromData(r.defination)},t.checkTypedArray=function(t){return mr(t,Int8Array)||mr(t,Uint8Array)||mr(t,Uint8ClampedArray)||mr(t,Int16Array)||mr(t,Uint16Array)||mr(t,Int32Array)||mr(t,Uint32Array)||mr(t,Float32Array)||mr(t,Float64Array)||mr(t,ArrayBuffer)},t.checkDataPath=function(t){return!!(pi(t)&&1===Object.keys(t).length&&"id"in t&&li(t.id))},t.checkGLTFNode=function(t){return pi(t)&&void 0!==t.nodeIndex&&void 0!==t.isJoint},t.checkImageSource=function(t){return vi(t)||mr(t,r.HTMLImageElement)},t.deserializeProperty=function(e,r,i,n,o){if(void 0===o&&(o=!0),!(i>14)){if(fi(e)){for(var a,s=[],u=pr(e);!(a=u()).done;){var c=a.value;s.push(t.deserializeProperty(c,r,i+1,n,o))}return s}if(t.checkDataPath(e)){var h=r.findObject(e);return o?h:e}if(mi(e)){var l;l=n?new n:{};for(var f,d=pr(Object.keys(e));!(f=d()).done;){var p=f.value;l[p]=t.deserializeProperty(e[p],r,i+1,void 0,o)}return l}return e}console.error("The nested object layers of the serialized data exceed the maximum limit.")},t.serializeObjectProperty=function(e,r,i){if(i>14)console.error("The nested object layers of the serialized data exceed the maximum limit.");else{r||(r={});for(var n,o=pr(Object.keys(e));!(n=o()).done;){var a=n.value,s=e[a];"number"==typeof s||"string"==typeof s||"boolean"==typeof s||t.checkTypedArray(e)?r[a]=s:fi(s)?(r[a]||(r[a]=[]),t.serializeArrayProperty(s,r[a],i+1)):Ln.is(s)?r[a]={id:s.getInstanceId()}:pi(s)&&(r[a]||(r[a]={}),t.serializeObjectProperty(s,r[a],i+1))}}},t.serializeArrayProperty=function(e,r,i){if(i>14)console.error("The nested object layers of the serialized data exceed the maximum limit.");else{r||(r=[]);for(var n=0;n<e.length;n++){var o=e[n];"number"==typeof o||"string"==typeof o||"boolean"==typeof o||t.checkTypedArray(e)?r[n]=o:fi(o)?(r[n]||(r[n]=[]),t.serializeArrayProperty(o,r[n],i+1)):Ln.is(o)?r[n]={id:o.getInstanceId()}:pi(o)&&(r[n]||(r[n]={}),t.serializeObjectProperty(o,r[n],i+1))}}},t}(),rf=function(){function t(t){this.engine=t}var e=t.prototype;return e.loadGUID=function(t){if(!t)return null;var e,r=t.id,i=this.findData(r);if(i){switch(i.dataType){case xn.Material:e=Pa.create(this.engine);break;case xn.Geometry:e=ja.create(this.engine);break;case xn.Texture:e=ya.create(this.engine);break;default:var n=Pn(i.dataType);n&&(e=new n(this.engine))}if(e)return e.setInstanceId(i.id),this.engine.addInstance(e),ef.deserialize(i,e),e;console.error("Constructor for DataType: "+i.dataType+" not found.")}else console.error("Object data with uuid: "+r+" not found.")},e.findData=function(t){return this.engine.jsonSceneData[t]},t}(),nf=function(){function t(){}return t.prototype.loadGUID=function(t){return fr((function(){return gr(this,(function(t){return[2,void 0]}))}))()},t}();function of(t,e){if(!t.includes(e))return t.push(e),!0}function af(t){if(Number.isFinite(t))return[Yi.CONSTANT,t];if(t){var e=t[0],r=t[1];if(Array.isArray(e))return;if("static"===e||e===Yi.CONSTANT)return[Yi.CONSTANT,t[1]];if("lines"===e)return[Yi.LINE,t[1]];if(e===Yi.LINE){var i=r.map((function(t){return[Zi.LINE,t]}));return[Yi.BEZIER_CURVE,i]}return"curve"===e||e===Yi.CURVE?[Yi.BEZIER_CURVE,Cf(r)]:t}}function sf(t,e){return Array.isArray(t)&&"random"===t[0]?[Yi.CONSTANT,t[1][e]]:af(t)}function uf(t){return t&&"color"===t[0]?ff(t[1],!0):[1,1,1,1]}function cf(t,e){if(t)return"colors"===t[0]?[Yi.COLORS,t[1].map((function(t){return ff(t,e)}))]:"gradient"===t[0]?lf(t[1],e):"color"===t[0]?[Yi.RGBA_COLOR,ff(t[1],e)]:t}function hf(t){return t&&"random"===t[0]?[Yi.RANDOM,t[1]]:af(t)}function lf(t,e){if(t){var r=[];return Object.getOwnPropertyNames(t).forEach((function(i){var n=function(t){var e=/^(-)?([\d+.]+)%$/.exec(t);return e?+e[2]/100*(e[1]?-1:1):+t}(i),o=ff(t[i],e);r.push([n,o[0],o[1],o[2],o[3]])})),r=r.sort((function(t,e){return t[0]-e[0]})),[Yi.GRADIENT_COLOR,r]}}function ff(t,e){var r;if("string"==typeof t){t=t.replace(/[\s\t\r\n]/g,"");var i=/rgba?\(([.\d]+),([.\d]+),([.\d]+),?([.\d]+)?\)/.exec(t);if(i){var n=+i[4];r=[+i[1],+i[2],+i[3],isNaN(n)?255:Math.round(255*n)]}else/^#[a-f\d]{3}$/i.test(t)?r=[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),255]:(i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))&&(r=[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),255])}else mr(t,Array)&&(r=[t[0],t[1],t[2],isNaN(t[3])?255:Math.round(255*t[3])]);return e&&(r=df(r)),r}function df(t){if(Array.isArray(t))return t.map((function(t){return Number.isFinite(t/255)?Number((t/255).toFixed(6)):0}))}function pf(t,e){return Array.isArray(t)?t[0]===Yi.GRADIENT_COLOR?t:("gradient"===t[0]||"color"===t[0])&&lf(t[1],e):lf(t,e)}function mf(t){if(t){if(3===t.length)return[Yi.CONSTANT_VEC3,t];var e=t[0];if("path"===e||"bezier"===e||e===Yi.BEZIER_PATH||e===Yi.LINEAR_PATH){var r=t[1],i=r[0],n=r[1],o=r[2],a=Cf(i);if(!o){o=[];for(var s=0;s<n.length;s++){var u=n[s].slice();0===s?o.push(u):s<n.length-1?(o.push(u),o.push(u)):o.push(u)}}return[Yi.BEZIER_CURVE_PATH,[a,n,o]]}return t}}function vf(t){for(var e,r=pr(Object.keys(t));!(e=r()).done;){var i=e.value;t[i]=Number(t[i])}return t}function yf(t){for(var e,r=pr(Object.keys(t));!(e=r()).done;){var i=e.value;void 0===t[i]&&delete t[i]}return t}var gf,xf=Math.cos,Tf=Math.sin,_f=Math.PI/180,Ef=180/Math.PI;function bf(t,e){return t?[t[0]-.5,.5-t[1]]:e?Sf[e]:[0,0]}var Af,Sf=((gf={})[ki.PARTICLE_ORIGIN_CENTER]=[0,0],gf[ki.PARTICLE_ORIGIN_CENTER_BOTTOM]=[0,-.5],gf[ki.PARTICLE_ORIGIN_CENTER_TOP]=[0,.5],gf[ki.PARTICLE_ORIGIN_LEFT_TOP]=[-.5,.5],gf[ki.PARTICLE_ORIGIN_LEFT_CENTER]=[-.5,0],gf[ki.PARTICLE_ORIGIN_LEFT_BOTTOM]=[-.5,-.5],gf[ki.PARTICLE_ORIGIN_RIGHT_CENTER]=[.5,0],gf[ki.PARTICLE_ORIGIN_RIGHT_BOTTOM]=[.5,-.5],gf[ki.PARTICLE_ORIGIN_RIGHT_TOP]=[.5,.5],gf);function Rf(t,e,r,i){var n=r[0],o=r[1],a=i[0],s=a-n;return[[n+(a-n)/3,o+(t*=s)/3],[a-(a-n)/3,i[1]-(e*=s)/3]]}function Cf(t){for(var e=-1e6,r=1e6,i=0;i<t.length;i++)e=Math.max(e,t[i][1]),r=Math.min(r,t[i][1]);for(var n=[[t[0][0],t[0][1]]],o=0;o<t.length-1;o++){var a=t[o][3]*(e-r),s=t[o+1][2]*(e-r),u=[t[o][0],t[o][1]],c=[t[o+1][0],t[o+1][1]];if(u[0]!=c[0]){var h=Rf(a,s,u,c),l=h[0],f=h[1];n[n.length-1].push(l[0]),n[n.length-1].push(l[1]),n.push([f[0],f[1],c[0],c[1]])}else n[n.length-1].push(c[0]),n[n.length-1].push(c[1])}return n.map((function(t,e){return 0===e?[Zi.EASE_OUT,t]:e===n.length-1?[Zi.EASE_IN,t]:[Zi.EASE,t]}))}function Mf(t){return t.compositions.forEach((function(t){t.items.forEach((function(t){t.type===Bi.null&&t.endBehavior===qi.destroy&&(t.endBehavior=qi.freeze)}))})),t.version=Oi["2_1"],t}var Of=new Map,Pf=new Map;function If(t){for(var e,r=pr(t.components);!(e=r()).done;){var i=e.value;if(i.dataType===xn.ShapeComponent){var n=i;if(n.type===dn.Custom){var o,a=n;(null==(o=a.shapes)?void 0:o.length)>0&&a.shapes[0].fill&&(a.fill=a.shapes[0].fill);for(var s,u=new Array(a.easingIns.length),c=new Array(a.easingOuts.length).fill(!1),h=pr(a.shapes);!(s=h()).done;)for(var l,f=pr(s.value.indexes);!(l=f()).done;){var d=l.value,p=a.points[d.point],m=a.easingIns[d.easingIn],v=a.easingOuts[d.easingOut];u[d.easingIn]||(m.x-=p.x,m.y-=p.y,u[d.easingIn]=!0),c[d.easingOut]||(v.x-=p.x,v.y-=p.y,c[d.easingOut]=!0)}}}}return t.version=Oi["3_2"],t}function wf(t){Of.clear(),Pf.clear();for(var e,r=t.compositions,i=t.items,n=pr(t.components);!(e=n()).done;){var o=e.value;Of.set(o.id,o)}for(var a,s=pr(i);!(a=s()).done;){var u=a.value;Pf.set(u.id,u)}for(var c,h=pr(r);!(c=h()).done;)Vf(c.value);return t.version=Oi["3_3"],t}function Nf(t){var e;null==(e=t.plugins)||e.forEach((function(e,r){"richtext"===e&&(t.plugins[r]="rich-text")}));for(var r,i=pr(t.items);!(r=i()).done;){var n=r.value;if(n.type===Bi.sprite){var o=Of.get(n.components[0].id);if(o){var a,s=o.renderer.shape,u=void 0;u=Number.isInteger(s)?null==(a=t.shapes)?void 0:a[s]:s,o.renderer.shape=u}}}for(var c,h=t.compositionId,l={},f=pr(t.compositions);!(c=f()).done;){var d=c.value,p=xi();l[d.id]=p,d.id===h&&(t.compositionId=p),d.id=p;var m={id:xi(),dataType:"CompositionComponent",items:d.items,timelineAsset:d.timelineAsset,sceneBindings:d.sceneBindings,item:{id:d.id}};d.timelineAsset=void 0,d.sceneBindings=void 0,d.components=[{id:m.id}],t.components.push(m)}for(var v,y=pr(t.items);!(v=y()).done;){var g=v.value;if(g.content){var x=g.content.options;x&&void 0!==x.refId&&(x.refId=l[x.refId])}}return t.version=Oi["3_4"],t}function Lf(t){for(var e,r={},i=pr(t.components);!(e=i()).done;){var n=e.value;r[n.id]=n}for(var o,a=pr(t.compositions);!(o=a()).done;)for(var s,u=o.value,c=pr(u.components);!(s=c()).done;)r[s.value.id].item.id=u.id;for(var h,l=pr(t.components);!(h=l()).done;){var f=h.value;if(f.dataType===xn.SpriteComponent){var d=f,p=d.renderer.shape;if(!(null==p||"aPoint"in p&&"index"in p)){var m=Df(p);d.geometry={id:m.id},t.geometries.push(m)}}if(f.dataType===xn.ShapeComponent){var v=f;if(v.fills=[],v.fill){var y={type:ln.Solid,color:v.fill.color};v.fills.push(y)}if(delete v.fill,v.strokes=[],v.stroke){var g={type:ln.Solid,color:v.stroke.color};v.strokes.push(g),v.strokeWidth=v.stroke.width,v.strokeCap=v.stroke.cap,v.strokeJoin=v.stroke.join,delete v.stroke}}}return t.version="3.5",t}function Ff(t){if(t.components)for(var e,r=pr(t.components);!(e=r()).done;){var i=e.value;if(i.dataType===xn.RichTextComponent){var n=i;n.options&&void 0===n.options.useLegacyRichText&&(void 0===n.options.lineGap?n.options.useLegacyRichText=!0:n.options.useLegacyRichText=!1)}}return t.version="3.6",t}function Df(t,e){void 0===e&&(e="");for(var r=eh(t),i=r.index,n=void 0===i?[]:i,o=r.aPoint,a=void 0===o?[]:o,s=new Float32Array(a),u=[],c=[],h=0;h<s.length;h+=6)c.push(a[h+2],a[h+3]),u.push(s[h],s[h+1],0);var l=u.length/3,f=n.length,d=4*u.length,p=d+4*c.length,m=2*n.length,v={mode:Tn.TRIANGLES,vertexData:{vertexCount:l,channels:[]},name:e,indexFormat:En.UInt16,indexOffset:p,buffer:"",id:xi(),dataType:xn.Geometry,subMeshes:[]};v.vertexData.channels.push({semantic:bn.Position,offset:0,format:_n.Float32,dimension:3}),v.vertexData.channels.push({semantic:bn.Uv,offset:d,format:_n.Float32,dimension:2}),v.subMeshes.push({offset:0,indexCount:f,vertexCount:l});var y=new ArrayBuffer(p+m+(m%4==0?0:2)),g=new Float32Array(y);g.set(u,0),g.set(c,u.length),new Uint16Array(y,p).set(n,0);var x=new Uint8Array(y).slice(0,p+m);return v.binaryData=x,v}function Vf(t){for(var e,r=pr(t.items);!(e=r()).done;){var i=e.value,n=Pf.get(i.id);if(!n)return;if(n.type===Bi.sprite||n.type===Bi.particle||n.type===Bi.spine||n.type===Bi.text||n.type===Bi.richtext||n.type===Bi.video||n.type===Bi.shape){var o=Of.get(n.components[0].id);o&&Bf(o)}}}function Bf(t){var e=t.renderer,r=null==e?void 0:e.maskMode;r&&r!==exports.MaskMode.NONE&&(r===exports.MaskMode.MASK?(t.mask={isMask:!0},Af=t.id):r!==Ni.OBSCURED&&r!==Ni.REVERSE_OBSCURED||(t.mask={inverted:r===Ni.REVERSE_OBSCURED,reference:{id:Af}}))}function Uf(t){for(var e,r,i,n=function(){var t=u.value;3!==t.endBehavior&&1!==t.endBehavior||(t.endBehavior=qi.freeze),t.items=t.items.filter((function(t){return"8"!==t.type})),t.items.forEach((function(t){t.type===Bi.particle&&t.content.filter&&delete t.content.filter}));for(var e,r=pr(t.items);!(e=r()).done;){var i=e.value;c[i.id]=xi(),i.oldId=i.id,i.id=c[i.id],h[i.id]=i}t.items.forEach((function(e,r){if(e.parentId)if(e.parentId.includes("^")){var i=e.parentId.split("^")[0],n=e.parentId.split("^")[1];e.parentId=c[i]+"^"+n}else e.parentId=c[e.parentId];o.items.push(e),t.items[r]={id:e.id}}));var n=qn({},t,{timelineAsset:{id:""},sceneBindings:[]});o.compositions.push(n),function(t,e,r){for(var i,n=[],o=[],a=[],s={tracks:[],id:xi(),dataType:"TimelineAsset"},u=pr(t.items);!(i=u()).done;){var c=e[i.value.id],h=[],l={id:xi(),dataType:"ActivationPlayableAsset"};a.push(l);var f={id:xi(),dataType:"ActivationTrack",children:[],clips:[{start:c.delay,duration:c.duration,endBehavior:c.endBehavior,asset:{id:l.id}}]};if(h.push({id:f.id}),o.push(f),c.type!==Bi.particle){var d={id:xi(),dataType:"TransformPlayableAsset",sizeOverLifetime:c.content.sizeOverLifetime,rotationOverLifetime:c.content.rotationOverLifetime,positionOverLifetime:c.content.positionOverLifetime};a.push(d);var p={id:xi(),dataType:"TransformTrack",children:[],clips:[{start:c.delay,duration:c.duration,endBehavior:c.endBehavior,asset:{id:d.id}}]};h.push({id:p.id}),o.push(p)}if(c.type===Bi.sprite||c.type===Bi.text){var m={id:xi(),dataType:"SpriteColorPlayableAsset",colorOverLifetime:c.content.colorOverLifetime};a.push(m);var v={id:xi(),dataType:"SpriteColorTrack",children:[],clips:[{start:c.delay,duration:c.duration,endBehavior:c.endBehavior,asset:{id:m.id}}]};h.push({id:v.id}),o.push(v)}if(c.type===Bi.composition){var y={id:xi(),dataType:"SubCompositionPlayableAsset"};a.push(y);var g={id:xi(),dataType:"SubCompositionTrack",children:[],clips:[{start:c.delay,duration:c.duration,endBehavior:c.endBehavior,asset:{id:y.id}}]};h.push({id:g.id}),o.push(g)}var x={id:xi(),dataType:"ObjectBindingTrack",children:h,clips:[]};o.push(x),s.tracks.push({id:x.id}),n.push({key:{id:x.id},value:{id:c.id}})}for(var T,_=[],E=pr(o);!(T=E()).done;){var b=T.value;_.push({id:b.id})}t.timelineAsset={id:s.id},t.sceneBindings=n,r.miscs.push(s);for(var A,S=pr(o);!(A=S()).done;){var R=A.value;r.miscs.push(R)}for(var C,M=pr(a);!(C=M()).done;){var O=C.value;r.miscs.push(O)}}(n,h,o)},o=qn({},t,{items:[],compositions:[],components:[],materials:[],shaders:[],geometries:[],animations:[],miscs:[]}),a=pr(o.images);!(r=a()).done;)r.value.id=xi();if(null!=(e=o).textures||(e.textures=[]),o.textures.forEach((function(t){var e;t.id=xi(),t.dataType=xn.Texture,t.source={id:null==(e=o.images[t.source])?void 0:e.id}})),o.textures.length<o.images.length)for(var s=o.textures.length;s<o.images.length;s++)o.textures.push({id:xi(),dataType:xn.Texture,source:{id:o.images[s].id},flipY:!0});t.bins&&(i=t.bins,o.bins=i.map((function(t){return{url:t.url,dataType:"BinaryAsset",id:xi()}})));for(var u,c={},h={},l=pr(t.compositions);!(u=l()).done;)n();for(var f,d=pr(o.items);!(f=d()).done;){var p=f.value;if(p.content){if(p.content.renderer&&void 0!==p.content.renderer.texture){var m=p.content.renderer.texture;p.content.renderer.texture={id:o.textures[m].id}}if(p.content.trails&&void 0!==p.content.trails.texture){var v=p.content.trails.texture;p.content.trails.texture={id:o.textures[v].id}}}if(p.transform){var y,g,x,T=[].concat(null!=(y=p.transform.position)?y:[0,0,0]),_=[].concat(null!=(g=p.transform.rotation)?g:[0,0,0]),E=[].concat(null!=(x=p.transform.scale)?x:[1,1,1]);if(Object.assign(p,{transform:{position:{x:T[0],y:T[1],z:T[2]},eulerHint:{x:_[0],y:_[1],z:_[2]},scale:{x:E[0],y:E[1],z:E[0]}}}),p.type===Bi.sprite&&(p.transform.size={x:E[0],y:E[1]},p.transform.scale={x:1,y:1,z:1}),p.type===Bi.sprite){var b=p.content;b.renderer||(b.renderer={});var A,S,R,C,M=b.renderer,O=bf(M.anchor,M.particleOrigin),P=p.transform.size;M.anchor||void 0===M.particleOrigin||(p.transform.position.x+=-O[0]*(null!=(A=null==P?void 0:P.x)?A:1),p.transform.position.y+=-O[1]*(null!=(S=null==P?void 0:P.y)?S:1)),p.transform.anchor={x:O[0]*(null!=(R=null==P?void 0:P.x)?R:1),y:O[1]*(null!=(C=null==P?void 0:P.y)?C:1)}}}if(p.type===Bi.particle){var I=p.content;I.renderer||(I.renderer={});var w=I.renderer;I.renderer.anchor=bf(w.anchor,w.particleOrigin)}if(p.type===Bi.camera&&p.content.positionOverLifetime&&0!==Object.keys(p.content.positionOverLifetime).length&&(p.content.positionOverLifetime.asMovement=!0),void 0!==p.pn){var N=p.pn,L=t.plugins,F=void 0===L?[]:L;void 0!==N&&Number.isInteger(N)&&(p.pluginName=F[N])}switch("editor-gizmo"===p.pluginName&&(p.type="editor-gizmo"),"orientation-transformer"===p.pluginName&&(p.type="orientation-transformer"),p.content.options.target&&"editor-gizmo"===p.pluginName&&(p.content.options.target=c[p.content.options.target]),p.type===Bi.spine&&t.spines&&0!==t.spines.length&&zf(t.spines[p.content.options.spine],p.content,o),p.type!==Bi.sprite&&p.type!==Bi.particle&&p.type!==Bi.mesh&&p.type!==Bi.skybox&&p.type!==Bi.light&&"camera"!==p.type&&p.type!==Bi.tree&&p.type!==Bi.interact&&p.type!==Bi.camera&&p.type!==Bi.text&&p.type!==Bi.spine&&"editor-gizmo"!==p.type&&"orientation-transformer"!==p.type||(p.components=[],o.components.push(p.content),p.content.id=xi(),p.content.item={id:p.id},p.dataType=xn.VFXItemData,p.components.push({id:p.content.id})),p.type!==Bi.null&&p.type!==Bi.composition||(p.components=[],p.dataType=xn.VFXItemData),p.type){case Bi.sprite:p.content.dataType=xn.SpriteComponent;break;case Bi.particle:p.content.dataType=xn.ParticleSystem;break;case Bi.mesh:p.content.dataType=xn.MeshComponent;break;case Bi.skybox:p.content.dataType=xn.SkyboxComponent;break;case Bi.light:p.content.dataType=xn.LightComponent;break;case"camera":p.content.dataType=xn.CameraComponent;break;case"editor-gizmo":p.content.dataType="GizmoComponent";break;case"orientation-transformer":p.content.dataType="OrientationComponent";break;case Bi.tree:p.content.dataType=xn.TreeComponent;break;case Bi.interact:p.content.dataType=xn.InteractComponent;break;case Bi.camera:p.content.dataType=xn.CameraController;break;case Bi.text:p.content.dataType=xn.TextComponent;break;case Bi.spine:p.content.dataType=xn.SpineComponent}}return o.version=Oi["3_0"],o}function kf(t){if(t)for(var e,r=pr(Object.keys(t));!(e=r()).done;){var i=e.value,n=t[i],o=Array.isArray(n);o&&2===n.length&&Array.isArray(n[1])?t[i]="path"===i?mf(n):af(n):o||"object"!=typeof n||kf(n)}}function zf(t,e,r){e.resource={atlas:{bins:{id:r.bins[t.atlas[1][0]].id},source:t.atlas[1].slice(1)},skeleton:{bins:{id:r.bins[t.skeleton[1][0]].id},source:t.skeleton[1].slice(1)},skeletonType:t.skeletonType,images:t.images.map((function(t){return{id:r.textures[t].id}}))}}function Gf(t,e){var r,i=t.options,n=t.velocityOverLifetime||{},o={path:mf(null==(r=t.transform)?void 0:r.path),gravity:i.gravity,gravityOverLifetime:af(i.gravityModifier),direction:i.direction,startSpeed:i.startSpeed,asMovement:n.asMovement,linearX:af(n.linearX),linearY:af(n.linearY),linearZ:af(n.linearZ),asRotation:n.asRotation,orbCenter:n.orbCenter,orbitalX:af(n.orbitalX),orbitalY:af(n.orbitalY),orbitalZ:af(n.orbitalZ),speedOverLifetime:af(n.speedOverLifetime)};yf(o);var a={options:{startColor:uf(i.startColor)},positionOverLifetime:o};i.startSize&&(e.scale=[i.startSize,i.startSize/(i.sizeAspect||1),1]),i.startRotation&&(e.rotation?e.rotation[2]+=i.startRotation:e.rotation=[0,0,i.startRotation]);var s=t.rotationOverLifetime;if(s){var u=a.rotationOverLifetime={separateAxes:s.separateAxes,asRotation:s.asRotation};u.separateAxes?(u.x=af(s.x),u.y=af(s.y),u.z=af(s.z)):u.z=af(s.angularVelocity)}var c=t.colorOverLifetime;if(c){var h=a.colorOverLifetime={opacity:af(c.opacity)};c.color&&(h.color=pf(c.color))}var l=t.sizeOverLifetime;return l&&(a.sizeOverLifetime={separateAxes:l.separateAxes,size:af(l.size),x:af(l.x),y:af(l.y),z:af(l.z)}),a}var Xf="2.7.2",Hf=/^(\d+)\.(\d+)\.(\d+)(-(\w+)\.\d+)?$/,jf=/^(\d+)\.(\d+)$/,Wf=!1;function Yf(t){if(!t||"object"!=typeof t)throw new Error("Invalid input: Expected a JSON object.");var e,r;if(function(t){var e=(t.playerVersion||{}).web,r=void 0===e?"":e;if(r){var i,n,o=null!=(i=Hf.exec(r))?i:[],a=null!=(n=Hf.exec(Xf))?n:[],s=o[1],u=o[2],c=a[1],h=a[2];return Number(c)<Number(s)||Number(c)===Number(s)&&Number(h)<Number(u)}return!1}(t)&&console.warn("The JSON need higher than "+(null==(e=t.playerVersion)?void 0:e.web)+" runtime version(current: "+Xf+"). Some features may not work as expected."),function(t){var e,r=null==(e=t.version)?void 0:e.split(".");!r||Number(r[0])>2||2===Number(r[0])&&Number(r[1])>=2||t.compositions.forEach((function(t){t.items.forEach((function(t){t.type!==Bi.mesh&&t.type!==Bi.light||(t.endBehavior=1===t.endBehavior?qi.destroy:t.endBehavior)}))}))}(t),Hf.test(t.version))return Wf="0"===(null==(r=/^(\d+)/.exec(t.version))?void 0:r[0]),Ff(Lf(Nf(wf(If(Uf(Mf(function(t){var e;Zf=Oi["1_0"];var r=t.plugins||[];(null==(e=t.bins)?void 0:e.length)&&(Zf=Oi["1_3"]);var i,n=(t.requires||[]).slice(),o=t.images.map((function(e,r){return qf(e,r,t.imageTags||[])})),a=t.textures||o.map((function(t,e){return{source:e,flipY:!0}})),s={plugins:r,shapes:t.shapes||[],type:"ge",version:Zf,playerVersion:null!=(i=t.playerVersion)?i:{web:"",native:""},compositionId:t.compositionId+"",compositions:t.compositions.map((function(t){return Kf(t,{plugins:r,requires:n})})),images:o,imgUsage:t._imgs,binUsage:t.binUsage,spines:t.spines,requires:t.requires,textures:a,bins:(t.bins||[]).slice()};return t._textures&&(s._textures=t._textures),s}(t))))))));Wf=!1;var i=jf.exec(t.version)||[],n=Number(i[1]),o=Number(i[2]);if(n)return(n<2||2===n&&o<4)&&(t=function(t){return t.compositions.map((function(t){for(var e,r=pr(t.items);!(e=r()).done;)kf(e.value.content)})),t}(t)),n<3&&(t=Uf(Mf(t))),i=jf.exec(t.version)||[],n=Number(i[1]),o=Number(i[2]),n<4&&(o<2&&(t=If(t)),o<3&&(t=wf(t)),o<4&&(t=Nf(t)),o<5&&(t=Lf(t)),o<6&&(t=Ff(t))),t;throw new Error("Invalid JSON version: "+t.version+".")}var Zf=Oi["1_0"];function qf(t,e,r){var i=r[e];if("string"==typeof t)return{id:xi(),renderLevel:i,url:t};if(t.template)return{id:xi(),url:t.url,template:t.template,webp:t.webp,renderLevel:i};if(t.compressed)return{id:xi(),url:t.url,compressed:{astc:t.compressed.android,pvrtc:t.compressed.iOS},webp:t.webp,renderLevel:i};if(t.url)return{id:xi(),url:t.url,webp:t.webp,renderLevel:i};if(t&&t.sourceType)return t;throw new Error("Invalid image type.")}function Kf(t,e){var r;void 0===e&&(e={});var i={id:t.id+"",camera:qn({clipMode:0},t.camera),duration:t.duration,endBehavior:t.endBehavior,items:t.items.map((function(t){return td(t,e)})),name:t.name},n=t.startTime||t.st;n&&(i.startTime=n);var o=null==(r=t.meta)?void 0:r.previewSize;return o&&o[0]===o[1]&&0===o[0]&&(o=void 0),o&&(i.previewSize=o),i}var Qf,Jf=[0,0,0,1],$f=.5;function td(t,e){var r;void 0===e&&(e={});var i,n,o,a,s,u,c=Bi.base,h=t.endBehavior,l=NaN;if(t.content?(c=t.type||Bi.plugin,u=t.pn,s=t.pluginName,o=t.content,n=t.content,isNaN(u)&&!s&&(s=o.options.type),t.duration&&(l=t.duration),i=t.transform||y(n.transform)):t.particle?(c=Bi.particle,i=y((n=t.particle).transform,Wf,!0),o=function(t){var e=t.options,r=t.transform,i={type:Li.NONE};if(t.shape){var n,o=null==(n=t.shape.shape)?void 0:n.replace(/([A-Z])/g,"_$1").toUpperCase().replace(/^_/,"");if(i=qn({},t.shape,{type:Li[o]}),t.shape.upDirection){var a=t.shape.upDirection,s=a[0],u=a[1],c=a[2];0===s&&0===u&&0===c&&delete i.upDirection}}e.startTurbulence&&(i.turbulenceX=hf(e.turbulenceX),i.turbulenceY=hf(e.turbulenceY),i.turbulenceZ=hf(e.turbulenceZ));var h=t.emission;h.bursts&&h.bursts.length>0&&(h.bursts=h.bursts.map((function(t){return vf(t)}))),h.burstOffsets&&h.burstOffsets.length>0&&(h.burstOffsets=h.burstOffsets.map((function(t){return vf(t)}))),h.rateOverTime&&(h.rateOverTime=hf(h.rateOverTime));var l={renderer:t.renderer,shape:i,splits:t.splits,emission:h,options:{startLifetime:hf(e.startLifetime),start3DSize:!!e.start3DSize,startSize:hf(e.startSize),startSizeX:hf(e.startSizeX),startSizeY:hf(e.startSizeY),sizeAspect:hf(e.sizeAspect),maxCount:e.maxCount,startDelay:hf(e.startDelay),startColor:cf(e.startColor,!0),startRotationZ:hf(e.startRotation||e.startRotationZ),particleFollowParent:e.particleFollowParent}};e.start3DRotation&&(l.options.startRotationX=hf(e.startRotationX),l.options.startRotationY=hf(e.startRotationY)),r&&r.path&&(l.emitterTransform={path:mf(r.path)});var f=t.sizeOverLifetime;f&&(f.separateAxes?l.sizeOverLifetime={separateAxes:!0,x:hf(f.x),y:hf(f.y)}:l.sizeOverLifetime={size:hf(f.size)});var d=t.velocityOverLifetime||{},p=d.speedOverLifetime;p=p?af(p):void 0,l.positionOverLifetime={gravity:e.gravity,gravityOverLifetime:af(e.gravityModifier),startSpeed:hf(e.startSpeed),speedOverLifetime:p,asMovement:d.asMovement,linearX:hf(d.linearX),linearY:hf(d.linearY),linearZ:hf(d.linearZ),asRotation:d.asRotation,orbCenter:d.orbCenter,orbitalX:hf(d.orbitalX),orbitalY:hf(d.orbitalY),orbitalZ:hf(d.orbitalZ),forceTarget:d.forceTarget,target:d.target,forceCurve:af(d.forceCurve)},yf(l.positionOverLifetime);var m=t.rotationOverLifetime;m&&(l.rotationOverLifetime={separateAxes:m.separateAxes,asRotation:m.asRotation,z:hf(m.separateAxes?m.z:m.angularVelocity)},m.separateAxes&&(l.rotationOverLifetime.y=af(m.y),l.rotationOverLifetime.x=af(m.x)));var v=t.colorOverLifetime;if(v){var y=l.colorOverLifetime={opacity:af(v.opacity)};v.color&&(y.color=pf(v.color))}var g=t.textureSheetAnimation;g&&(l.textureSheetAnimation={row:g.row,col:g.col,total:g.total,animate:g.animate,cycles:af(g.cycles),animationDelay:sf(g.animationDelay,0),animationDuration:sf(g.animationDuration,0)});var x=t.trails;x&&(l.trails={lifetime:hf(x.lifetime),dieWithParticles:x.dieWithParticles,maxPointPerTrail:x.maxPointPerTrail,minimumVertexDistance:x.minimumVertexDistance,widthOverTrail:af(x.widthOverTrail),colorOverTrail:x.colorOverTrail&&pf(x.colorOverTrail,!1),blending:x.blending,colorOverLifetime:x.colorOverLifetime&&pf(x.colorOverLifetime,!1),inheritParticleColor:x.inheritParticleColor,occlusion:x.occlusion,transparentOcclusion:x.transparentOcclusion,orderOffset:x.orderOffset,sizeAffectsLifetime:x.sizeAffectsLifetime,sizeAffectsWidth:x.sizeAffectsWidth,texture:x.texture,parentAffectsPosition:x.parentAffectsPosition,opacityOverLifetime:hf(x.opacityOverLifetime)}),l.trails&&yf(l.trails);var T=t.interaction;return T&&(l.interaction={behavior:T.behavior,radius:T.radius,multiple:T.multiple}),l}(n)):t.sprite?(c=Bi.sprite,o=function(t,e){var r=Gf(t,e),i=t.textureSheetAnimation;return i&&(r.textureSheetAnimation={row:i.row,col:i.col,total:i.total||void 0,animate:i.animate}),r.renderer=t.renderer,t.splits&&(r.splits=t.splits),t.interaction&&(r.interaction=t.interaction),r}(n=t.sprite,i=y(n.transform,!1,!0))):t.cal?(c=Bi.null,o=Gf(n=t.cal,i=y(n.transform,!1,!0))):t.ui?(c=Bi.interact,i=y((n=t.ui).transform),o=function(t){var e,r=t.options;switch(r.type){case"click":e={type:Di.CLICK,showPreview:r.showPreview,previewColor:r.previewColor&&uf(r.previewColor),behavior:r.behavior||Vi.NOTIFY};break;case"drag":e={type:Di.DRAG,enableInEditor:!!r.enableInEditor,dxRange:r.dxRange,dyRange:r.dyRange,target:r.target};break;case"message":e={type:Di.MESSAGE}}return{options:e}}(n),i.scale=[n.options.width||1,n.options.height||1,1]):t.model&&(n=t.model,1===t.model.options.type&&(c=Bi.camera,i=y(n.transform),o=function(t){var e,r=t.options,i={options:{fov:r.fov,far:r.far,near:r.near,clipMode:r.clipMode}},n=t.velocityOverLifetime;if(n||(null==(e=t.transform)?void 0:e.path)){var o,a={path:mf(null==(o=t.transform)?void 0:o.path),linearX:af(null==n?void 0:n.translateX),linearY:af(null==n?void 0:n.translateY),linearZ:af(null==n?void 0:n.translateZ)};yf(a),i.positionOverLifetime=a}var s=t.rotationOverLifetime;if(s){var u={separateAxes:s.separateAxes,x:af(null==s?void 0:s.rotateX),y:af(null==s?void 0:s.rotateY),z:s.separateAxes?af(null==s?void 0:s.rotateZ):af(s.rotation)};yf(u),i.rotationOverLifetime=u}return i}(n))),null==(r=o.renderer)?void 0:r.anchor){var f=new Float32Array(o.renderer.anchor);f[0]==$f&&f[1]==$f?delete o.renderer.anchor:e.requires&&of(e.requires,"anchor")}if(n){var d,p,m=null==(d=n.options)?void 0:d.looping;h=m?Array.isArray(m)?m[1]?qi.restart:qi.destroy:qi.restart:h||(null==n||null==(p=n.options)?void 0:p.endBehavior)||qi.destroy,n.options.renderLevel&&(a=n.options.renderLevel),isNaN(l)&&(l=n.options.duration)}var v={type:c,name:t.name,delay:t.delay,duration:l,id:t.id+"",transform:i,endBehavior:h,renderLevel:a,content:o};return s?e.plugins?(of(e.plugins,s),v.pn=e.plugins.indexOf(s)):v.pluginName=s:Number.isInteger(u)&&(v.pn=u),t.parentId&&(v.parentId=t.parentId+""),v;function y(t,e,r){if(t){var i={},n=t.rotation;if(n&&(i.rotation=e?[-n[0],-n[1],-n[2]]:[n[0],n[1],n[2]],r)){var o=(a=Jf,s=i.rotation[0],u=i.rotation[1],c=i.rotation[2],h=xf(s*_f/2),l=xf(u*_f/2),f=xf(c*_f/2),d=Tf(s*_f/2),p=Tf(u*_f/2),m=Tf(c*_f/2),a[0]=d*l*f+h*p*m,a[1]=h*p*f-d*l*m,a[2]=h*l*m+d*p*f,a[3]=h*l*f-d*p*m,a);i.rotation=function(t,e){var r,i=e[0],n=e[1],o=e[2],a=e[3],s=i+i,u=n+n,c=o+o,h=i*s,l=n*s,f=n*u,d=o*c,p=a*c,m=1-f-d,v=l-p,y=l+p,g=1-h-d,x=o*s-a*u,T=o*u+a*s,_=1-h-f;return t[1]=Math.asin((r=-x)>1?1:r<-1?-1:r)*Ef,Math.abs(x)<.9999999?(t[0]=Math.atan2(T,_)*Ef,t[2]=Math.atan2(y,m)*Ef):(t[0]=0,t[2]=Math.atan2(-v,g)*Ef),t}([],o)}return t.position&&(i.position=t.position),Array.isArray(t.scale)&&(i.scale=[t.scale[0]||1,t.scale[1]||1,t.scale[2]||1]),i}var a,s,u,c,h,l,f,d,p,m;return{}}}exports.Scene=void 0;var ed=((Qf={})[Pi.S]=[Pi.S,Pi.BPlus,Pi.APlus],Qf[Pi.A]=[Pi.A,Pi.BPlus,Pi.APlus],Qf[Pi.B]=[Pi.B,Pi.BPlus],Qf);function rd(t,e){if(!t||!e)return!0;var r=ed[e];return!!r&&r.includes(t)}function id(t,e){var r,i,n=null!=(i=null==t?void 0:t.background)?i:{},o=n.name,a=n.url;return o&&(e&&e[o]?r=e[o]:a&&(r=a)),r}function nd(t,e,r){return od.apply(this,arguments)}function od(){return(od=fr((function(t,e,i){var n,o;return gr(this,(function(a){switch(a.label){case 0:return"string"!=typeof t?[3,2]:[4,ia(t)];case 1:return n=a.sent(),[3,3];case 2:n=t,a.label=3;case 3:if(!n)throw new Error("Image not provided.");if(!e)return[2,n];if(o=id(e,i)){if(li(o)&&o!==n.src)return[2,ia(o)];if(mr(o,r.HTMLImageElement))return[2,o]}return[2,n]}}))}))).apply(this,arguments)}!function(t){t.isJSONObject=function(t){return pi(t)&&"jsonScene"in t},t.isURL=function(t){return pi(t)&&"url"in t},t.isWithOptions=function(t){return pi(t)&&"options"in t}}(exports.Scene||(exports.Scene={}));var ad=1,sd=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e=new Ko),this.options=t,this.downloader=e,this.assets={},this.sourceFrom={},this.id=ad++,this.timers=[],this.updateOptions(t)}var e=t.prototype;return e.updateOptions=function(t){void 0===t&&(t={}),this.options=t,t.pluginData||(t.pluginData={});var e=t.timeout,r=void 0===e?10:e;this.timeout=r},e.loadScene=function(t,e,i){var n=this;return fr((function(){var o,a,s,u,c,h,l,f,d,p,m,v,y;return gr(this,(function(g){return a=li(t)?t:n.id,s=r.performance.now(),u=[],c=null==e?void 0:e.engine.gpuCapability,l=null!=(h=null==c?void 0:c.detail.compressedTexture)?h:exports.COMPRESSED_TEXTURE.NONE,f={},p=!1,m=new Promise((function(t,e){d=r.window.setTimeout((function(){p=!0,n.removeTimer(d);var t=r.performance.now()-s;e(new Error("Load time out: totalTime: "+t.toFixed(4)+"ms "+u.join(" ")+", url: "+a+"."))}),1e3*n.timeout),n.timers.push(d)})),v=fr((function(t,e){var i,n,o,a;return gr(this,(function(s){switch(s.label){case 0:if(p)return[3,4];i=r.performance.now(),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e()];case 2:return n=s.sent(),o=r.performance.now()-i,u.push("["+t+": "+o.toFixed(2)+"]"),f[t]=o,[2,n];case 3:throw a=s.sent(),new Error("Load error in "+t+", "+a+".");case 4:throw new Error("Load canceled.")}}))})),y=fr((function(){var e,c,h,p,m,y,g,x,T,_,E,b,A,S;return gr(this,(function(R){switch(R.label){case 0:return li(t)?(c=new r.URL(t,r.location.href).href,n.baseUrl=c,[4,v("loadJSON",(function(){return n.loadJSON(c)}))]):[3,2];case 1:return li(o=R.sent())&&(o=JSON.parse(o)),[3,3];case 2:o=t,n.baseUrl=r.location.href,R.label=3;case 3:return exports.Scene.isJSONObject(o)?(e=qn({},o),[3,9]):[3,4];case 4:return[4,v("processJSON",(function(){return n.processJSON(o)}))];case 5:return h=R.sent(),p=h.jsonScene,m=h.pluginSystem,y=p.bins,g=void 0===y?[]:y,x=p.images,T=p.fonts,[4,Promise.all([v("processBins",(function(){return n.processBins(g)})),v("processImages",(function(){return n.processImages(x,l)})),v("plugin:processAssets",(function(){return n.processPluginAssets(p,m,i)})),v("processFontURL",(function(){return n.processFontURL(T)}))])];case 6:return _=R.sent(),E=_[0],b=_[1],[4,v("processTextures",(function(){return n.processTextures(b,E,p)}))];case 7:return A=R.sent(),e={timeInfos:f,url:t,renderLevel:n.options.renderLevel,storage:{},pluginSystem:m,jsonScene:p,bins:E,textureOptions:A,textures:[],images:b,assets:n.assets},[4,v("plugin:prepareResource",(function(){return m.loadResources(e,n.options)}))];case 8:R.sent(),R.label=9;case 9:return S=r.performance.now()-s,ci.info("Load asset: totalTime: "+S.toFixed(4)+"ms "+u.join(" ")+", url: "+a+"."),r.window.clearTimeout(d),n.removeTimer(d),e.totalTime=S,e.startTime=s,e.timeInfos=f,[2,e]}}))})),[2,Promise.race([m,y()])]}))}))()},e.getAssets=function(){return this.assets},e.processJSON=function(t){var e=this;return fr((function(){var r,i,n;return gr(this,(function(o){switch(o.label){case 0:return r=Yf(t),i=r.plugins,[4,(n=new Ri(void 0===i?[]:i)).processRawJSON(r,e.options)];case 1:return o.sent(),[2,{jsonScene:r,pluginSystem:n}]}}))}))()},e.processBins=function(t){var e=this;return fr((function(){var i,n,o;return gr(this,(function(a){return i=e.options.renderLevel,n=e.baseUrl,o=t.map((function(o){if(mr(o,ArrayBuffer))return o;if(rd(o.renderLevel,i))return e.loadBins(new r.URL(o.url,n).href);throw new Error("Invalid bins source: "+JSON.stringify(t)+".")})),[2,Promise.all(o)]}))}))()},e.processFontURL=function(e){var r=this;return fr((function(){return gr(this,(function(i){return[2,t.loadFontFamily(e,r.baseUrl)]}))}))()},e.processImages=function(t,e){void 0===e&&(e=0);var i=this;return fr((function(){var n,o,a,s,u,c,h,l;return gr(this,(function(f){switch(f.label){case 0:return n=i.options,o=n.useCompressedTexture,a=n.variables,s=n.disableWebP,u=n.disableAVIF,c=i.baseUrl,h=t.map(fr((function(t,n){var h,l,f,d,p,m,v,y,g,x,T,_,E,b,A,S,R,C,M,O,P;return gr(this,(function(n){switch(n.label){case 0:if(h=t.url,l=t.webp,f=t.avif,d=new r.URL(h,c).href,p=!s&&l?new r.URL(l,c).href:void 0,m=!u&&f?new r.URL(f,c).href:void 0,v=t.id,!("template"in t))return[3,8];if(y=t.template,!(g=y.background))return[3,7];x=id(y,a),T=g.type===yn.video,_=g&&T?ua:ia,n.label=1;case 1:return n.trys.push([1,6,,7]),[4,ha(x,_)];case 2:return mr(E=n.sent(),r.HTMLVideoElement)?(i.sourceFrom[v]={url:E.src,type:exports.TextureSourceType.video},[2,E]):[3,3];case 3:return g&&Array.isArray(x)&&a&&(a[g.name]=E.src),i.sourceFrom[v]={url:E.src,type:exports.TextureSourceType.image},[4,nd(E,y,a)];case 4:return[2,n.sent()];case 5:return[3,7];case 6:throw b=n.sent(),new Error("Failed to load. Check the template or if the URL is "+(T?"video":"image")+" type, URL: "+x+", Error: "+(b.message||b)+".");case 7:return[3,9];case 8:if("compressed"in t&&o&&e){if(A=t.compressed,e===exports.COMPRESSED_TEXTURE.ASTC?S=A.astc:e===exports.COMPRESSED_TEXTURE.PVRTC&&(S=A.pvrtc),S)return R=new r.URL(S,c).href,i.sourceFrom[v]={url:R,type:exports.TextureSourceType.compressed},[2,i.loadBins(R)]}else if(mr(t,r.HTMLImageElement)||mr(t,r.HTMLCanvasElement)||mr(t,r.HTMLVideoElement)||mr(t,ya))return[2,t];n.label=9;case 9:return m?[4,ea(d,m)]:[3,11];case 10:return P=n.sent(),[3,13];case 11:return[4,$o(d,p)];case 12:P=n.sent(),n.label=13;case 13:return M=(C=P).url,O=C.image,i.sourceFrom[v]={url:M,type:exports.TextureSourceType.image},[2,O]}}))}))),[4,Promise.all(h)];case 1:return l=f.sent(),i.assignImagesToAssets(t,l),[2,l]}}))}))()},e.processPluginAssets=function(t,e,r){var i=this;return fr((function(){var n,o,a,s,u;return gr(this,(function(c){switch(c.label){case 0:return[4,e.processAssets(t,r)];case 1:for(n=c.sent(),o=n.reduce((function(t,e){return t.assets=t.assets.concat(e.assets),t.loadedAssets=t.loadedAssets.concat(e.loadedAssets),t}),{assets:[],loadedAssets:[]}),a=o.assets,s=o.loadedAssets,u=0;u<a.length;u++)i.assets[a[u].id]=s[u];return[2]}}))}))()},e.processTextures=function(t,e,i){var n=this;return fr((function(){var o,a,s;return gr(this,(function(u){return a=null!=(o=i.textures)?o:t.map((function(t,e){return{source:e}})),s=a.map(fr((function(t,o){var a,s,u,c,h,l;return gr(this,(function(f){switch(f.label){case 0:if(mr(t,ya))return[2,t];if(!("mipmaps"in t))return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,fa(t,e,n.assets,i.bins)];case 2:return[2,f.sent()];case 3:throw a=f.sent(),new Error("Load texture "+o+" fails, error message: "+a+".");case 4:return s=t.source,u=t.id,h="",pi(s)?(c=n.assets[s.id],h=s.id,[3,7]):[3,5];case 5:return"string"!=typeof s?[3,7]:[4,ia(Ti(s))];case 6:c=f.sent(),f.label=7;case 7:if(c)return l=function(t,e,i){var n={id:i,dataType:xn.Texture};if(mr(t,ya))return qn({},t.source,n);if(mr(t,r.HTMLImageElement)||vi(t))return qn({image:t,sourceType:exports.TextureSourceType.image,sourceFrom:e,keepImageSource:!0,minFilter:ko.LINEAR,magFilter:ko.LINEAR},n);if(mr(t,r.HTMLVideoElement))return qn({sourceType:exports.TextureSourceType.video,video:t,minFilter:ko.LINEAR,magFilter:ko.LINEAR},n);if(mr(t,ArrayBuffer))return qn({},ba(t),{sourceFrom:e},n);if("width"in t&&"height"in t&&"data"in t)return qn({sourceType:exports.TextureSourceType.data,data:t,wrapS:ko.CLAMP_TO_EDGE,wrapT:ko.CLAMP_TO_EDGE,minFilter:ko.NEAREST,magFilter:ko.NEAREST},n);throw new Error("Invalid texture options.")}(c,n.sourceFrom[h],u),[2,l.sourceType===exports.TextureSourceType.compressed?l:qn({},l,t)];throw new Error("Invalid texture source: "+s+".")}}))}))),[2,Promise.all(s)]}))}))()},e.loadJSON=function(t){var e=this;return fr((function(){return gr(this,(function(r){return[2,new Promise((function(r,i){e.downloader.downloadJSON(t,r,(function(e,r){i("Couldn't load JSON "+JSON.stringify(t)+": status "+e+", "+r)}))}))]}))}))()},e.loadBins=function(t){var e=this;return fr((function(){return gr(this,(function(r){return[2,new Promise((function(r,i){e.downloader.downloadBinary(t,r,(function(e,r){i("Couldn't load bins "+JSON.stringify(t)+": status "+e+", "+r)}))}))]}))}))()},e.assignImagesToAssets=function(t,e){for(var r=0;r<t.length;r++)this.assets[t[r].id]=e[r]},e.removeTimer=function(t){var e=this.timers.indexOf(t);-1!==e&&this.timers.splice(e,1)},e.dispose=function(){this.timers.length&&this.timers.map((function(t){return r.window.clearTimeout(t)})),this.assets={},this.sourceFrom={},this.timers=[]},t.loadFontFamily=function(e,i){return void 0===i&&(i=r.location.href),fr((function(){var n;return gr(this,(function(o){return e?(n=e.map(fr((function(e){var n,o,a;return gr(this,(function(s){switch(s.label){case 0:if(!e.fontURL||t.fontCache.has(e.fontFamily))return[3,4];ai(e.fontFamily)||console.warn("Risky font family: "+e.fontFamily+"."),s.label=1;case 1:return s.trys.push([1,3,,4]),n=new r.URL(e.fontURL,i).href,[4,(a=new FontFace(null!=(o=e.fontFamily)?o:"","url("+n+")")).load()];case 2:return s.sent(),r.document.fonts.add(a),t.fontCache.add(e.fontFamily),[3,4];case 3:return s.sent(),ci.warn("Invalid font family or font source: "+JSON.stringify(e.fontURL)+"."),[3,4];case 4:return[2]}}))}))),[2,Promise.all(n)]):[2]}))}))()},t}();sd.fontCache=new Set;var ud,cd=function(){function t(t){this.engine=t,this.builtinObjects=[],this.builtinObjects.push(t.whiteTexture)}var e=t.prototype;return e.assembleSceneLoadOptions=function(t,e){void 0===e&&(e={});var r=t;return exports.Scene.isURL(t)&&(exports.Scene.isJSONObject(t)||(r=t.url),exports.Scene.isWithOptions(t)&&(e=qn({},e,t.options))),{source:r,options:e}},e.updateTextVariables=function(t,e){var r=this;void 0===e&&(e={}),t.jsonScene.items.forEach((function(t){if(t.type===Bi.text||t.type===Bi.richtext){var i=e[t.name];if(!i)return;t.components.forEach((function(t){var e=t.id,n=r.engine.findEffectsObjectData(e);(null==n?void 0:n.dataType)!==xn.TextComponent&&(null==n?void 0:n.dataType)!==xn.RichTextComponent||(n.options.text=i)}))}}))},e.initializeTexture=function(t){for(var e=0;e<t.textureOptions.length;e++)t.textures[e]=this.engine.findObject({id:t.textureOptions[e].id}),t.textures[e].initialize()},e.prepareAssets=function(t,e){this.engine.clearResources();for(var r,i=pr(Object.keys(e));!(r=i()).done;){var n=r.value,o=e[n],a=new tf(this.engine);a.data=o,a.setInstanceId(n)}this.engine.addPackageDatas(t);for(var s,u=pr(this.builtinObjects);!(s=u()).done;){var c=s.value;this.engine.addInstance(c)}},e.createShaderVariant=function(){for(var t,e=pr(Object.keys(this.engine.objectInstance));!(t=e()).done;){var r=t.value,i=this.engine.objectInstance[r];mr(i,Pa)&&i.createShaderVariant()}},e.destroyBuiltinObjects=function(){for(var t,e=pr(this.builtinObjects);!(t=e()).done;)t.value.dispose();this.builtinObjects.length=0},e.dispose=function(){this.destroyBuiltinObjects()},t}(),hd=new Int32Array(2),ld=new Float32Array(hd.buffer),fd=new Float64Array(hd.buffer),dd=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];!function(t){t[t.UTF8_BYTES=1]="UTF8_BYTES",t[t.UTF16_STRING=2]="UTF16_STRING"}(ud||(ud={}));var pd,md=function(){function t(t){this.bytes_=t,this.position_=0,this.text_decoder_=new r.TextDecoder}var e=t.prototype;return e.clear=function(){this.position_=0},e.bytes=function(){return this.bytes_},e.position=function(){return this.position_},e.setPosition=function(t){this.position_=t},e.capacity=function(){return this.bytes_.length},e.readInt8=function(t){return this.readUint8(t)<<24>>24},e.readUint8=function(t){return this.bytes_[t]},e.readInt16=function(t){return this.readUint16(t)<<16>>16},e.readUint16=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8},e.readInt32=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24},e.readUint32=function(t){return this.readInt32(t)>>>0},e.readInt64=function(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))},e.readUint64=function(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))},e.readFloat32=function(t){return hd[0]=this.readInt32(t),ld[0]},e.readFloat64=function(t){return hd[dd?0:1]=this.readInt32(t),hd[dd?1:0]=this.readInt32(t+4),fd[0]},e.writeInt8=function(t,e){this.bytes_[t]=e},e.writeUint8=function(t,e){this.bytes_[t]=e},e.writeInt16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},e.writeUint16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},e.writeInt32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},e.writeUint32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},e.writeInt64=function(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))},e.writeUint64=function(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))},e.writeFloat32=function(t,e){ld[0]=e,this.writeInt32(t,hd[0])},e.writeFloat64=function(t,e){fd[0]=e,this.writeInt32(t,hd[dd?0:1]),this.writeInt32(t+4,hd[dd?1:0])},e.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var t="",e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t},e.__offset=function(t,e){var r=t-this.readInt32(t);return e<this.readInt16(r)?this.readInt16(r+e):0},e.__union=function(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t},e.__string=function(t,e){t+=this.readInt32(t);var r=this.readInt32(t);t+=4;var i=this.bytes_.subarray(t,t+r);return e===ud.UTF8_BYTES?i:this.text_decoder_.decode(i)},e.__union_with_string=function(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)},e.__indirect=function(t){return t+this.readInt32(t)},e.__vector=function(t){return t+this.readInt32(t)+4},e.__vector_len=function(t){return this.readInt32(t+this.readInt32(t))},e.__has_identifier=function(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(var e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0},e.createScalarList=function(t,e){for(var r=[],i=0;i<e;++i){var n=t(i);null!==n&&r.push(n)}return r},e.createObjList=function(t,e){for(var r=[],i=0;i<e;++i){var n=t(i);null!==n&&r.push(n.unpack())}return r},t.allocate=function(e){return new t(new Uint8Array(e))},t}(),vd=function(){function t(t){var e;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,e=t||1024,this.bb=md.allocate(e),this.space=e}var e=t.prototype;return e.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null},e.forceDefaults=function(t){this.force_defaults=t},e.dataBuffer=function(){return this.bb},e.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},e.prep=function(e,r){e>this.minalign&&(this.minalign=e);for(var i=1+~(this.bb.capacity()-this.space+r)&e-1;this.space<i+e+r;){var n=this.bb.capacity();this.bb=t.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(i)},e.pad=function(t){for(var e=0;e<t;e++)this.bb.writeInt8(--this.space,0)},e.writeInt8=function(t){this.bb.writeInt8(this.space-=1,t)},e.writeInt16=function(t){this.bb.writeInt16(this.space-=2,t)},e.writeInt32=function(t){this.bb.writeInt32(this.space-=4,t)},e.writeInt64=function(t){this.bb.writeInt64(this.space-=8,t)},e.writeFloat32=function(t){this.bb.writeFloat32(this.space-=4,t)},e.writeFloat64=function(t){this.bb.writeFloat64(this.space-=8,t)},e.addInt8=function(t){this.prep(1,0),this.writeInt8(t)},e.addInt16=function(t){this.prep(2,0),this.writeInt16(t)},e.addInt32=function(t){this.prep(4,0),this.writeInt32(t)},e.addInt64=function(t){this.prep(8,0),this.writeInt64(t)},e.addFloat32=function(t){this.prep(4,0),this.writeFloat32(t)},e.addFloat64=function(t){this.prep(8,0),this.writeFloat64(t)},e.addFieldInt8=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt8(e),this.slot(t))},e.addFieldInt16=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt16(e),this.slot(t))},e.addFieldInt32=function(t,e,r){(this.force_defaults||e!=r)&&(this.addInt32(e),this.slot(t))},e.addFieldInt64=function(t,e,r){(this.force_defaults||e!==r)&&(this.addInt64(e),this.slot(t))},e.addFieldFloat32=function(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat32(e),this.slot(t))},e.addFieldFloat64=function(t,e,r){(this.force_defaults||e!=r)&&(this.addFloat64(e),this.slot(t))},e.addFieldOffset=function(t,e,r){(this.force_defaults||e!=r)&&(this.addOffset(e),this.slot(t))},e.addFieldStruct=function(t,e,r){e!=r&&(this.nested(e),this.slot(t))},e.nested=function(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")},e.notNested=function(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")},e.slot=function(t){null!==this.vtable&&(this.vtable[t]=this.offset())},e.offset=function(){return this.bb.capacity()-this.space},e.addOffset=function(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)},e.startObject=function(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(var e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()},e.endObject=function(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var t=this.offset(),e=this.vtable_in_use-1;e>=0&&0==this.vtable[e];e--);for(var r=e+1;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);var i=2*(r+2);this.addInt16(i);var n=0,o=this.space;t:for(e=0;e<this.vtables.length;e++){var a=this.bb.capacity()-this.vtables[e];if(i==this.bb.readInt16(a)){for(var s=2;s<i;s+=2)if(this.bb.readInt16(o+s)!=this.bb.readInt16(a+s))continue t;n=this.vtables[e];break}}return n?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,n-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t},e.finish=function(t,e,r){var i=r?4:0;if(e){var n=e;if(this.prep(this.minalign,8+i),4!=n.length)throw new TypeError("FlatBuffers: file identifier must be length 4");for(var o=3;o>=0;o--)this.writeInt8(n.charCodeAt(o))}this.prep(this.minalign,4+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},e.finishSizePrefixed=function(t,e){this.finish(t,e,!0)},e.requiredField=function(t,e){var r=this.bb.capacity()-t,i=r-this.bb.readInt32(r);if(!(e<this.bb.readInt16(i)&&0!=this.bb.readInt16(i+e)))throw new TypeError("FlatBuffers: field "+e+" must be set")},e.startVector=function(t,e,r){this.notNested(),this.vector_num_elems=e,this.prep(4,t*e),this.prep(r,t*e)},e.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},e.createSharedString=function(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);var e=this.createString(t);return this.string_maps.set(t,e),e},e.createString=function(t){return null==t?0:(e=mr(t,Uint8Array)?t:this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector());var e},e.createByteVector=function(t){return null==t?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())},e.createObjectOffset=function(t){return null===t?0:"string"==typeof t?this.createString(t):t.pack(this)},e.createObjectOffsetList=function(t){for(var e=[],r=0;r<t.length;++r){var i=t[r];if(null===i)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");e.push(this.createObjectOffset(i))}return e},e.createStructOffsetList=function(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()},t.growByteBuffer=function(t){var e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var r=e<<1,i=md.allocate(r);return i.setPosition(r-e),i.bytes().set(t.bytes(),r-e),i},t}(),yd=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.dataType=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},e.data=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},e.dataLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.dataArray=function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},e.unpack=function(){return new gd(this.dataType(),this.bb.createScalarList(this.data.bind(this),this.dataLength()))},e.unpackTo=function(t){t.dataType=this.dataType(),t.data=this.bb.createScalarList(this.data.bind(this),this.dataLength())},t.getRootAsFBEffectsObjectData=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBEffectsObjectData=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBEffectsObjectData=function(t){t.startObject(2)},t.addDataType=function(t,e){t.addFieldOffset(0,e,0)},t.addData=function(t,e){t.addFieldOffset(1,e,0)},t.createDataVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()},t.startDataVector=function(t,e){t.startVector(1,e,1)},t.endFBEffectsObjectData=function(t){return t.endObject()},t.createFBEffectsObjectData=function(e,r,i){return t.startFBEffectsObjectData(e),t.addDataType(e,r),t.addData(e,i),t.endFBEffectsObjectData(e)},t}(),gd=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=[]),this.dataType=t,this.data=e}return t.prototype.pack=function(t){var e=null!==this.dataType?t.createString(this.dataType):0,r=yd.createDataVector(t,this.data);return yd.createFBEffectsObjectData(t,e,r)},t}(),xd=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.exportObjects=function(t,e){var r=this.bb.__offset(this.bb_pos,4);return r?(e||new yd).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null},e.exportObjectsLength=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0},e.unpack=function(){return new Td(this.bb.createObjList(this.exportObjects.bind(this),this.exportObjectsLength()))},e.unpackTo=function(t){t.exportObjects=this.bb.createObjList(this.exportObjects.bind(this),this.exportObjectsLength())},t.getRootAsFBEffectsPackageData=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBEffectsPackageData=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBEffectsPackageData=function(t){t.startObject(1)},t.addExportObjects=function(t,e){t.addFieldOffset(0,e,0)},t.createExportObjectsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},t.startExportObjectsVector=function(t,e){t.startVector(4,e,4)},t.endFBEffectsPackageData=function(t){return t.endObject()},t.finishFBEffectsPackageDataBuffer=function(t,e){t.finish(e)},t.finishSizePrefixedFBEffectsPackageDataBuffer=function(t,e){t.finish(e,void 0,!0)},t.createFBEffectsPackageData=function(e,r){return t.startFBEffectsPackageData(e),t.addExportObjects(e,r),t.endFBEffectsPackageData(e)},t}(),Td=function(){function t(t){void 0===t&&(t=[]),this.exportObjects=t}return t.prototype.pack=function(t){var e=xd.createExportObjectsVector(t,t.createObjectOffsetList(this.exportObjects));return xd.createFBEffectsPackageData(t,e)},t}(),_d=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.offset=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0},e.indexCount=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},e.vertexCount=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):0},e.unpack=function(){return new Ed(this.offset(),this.indexCount(),this.vertexCount())},e.unpackTo=function(t){t.offset=this.offset(),t.indexCount=this.indexCount(),t.vertexCount=this.vertexCount()},t.getRootAsFBSubMesh=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBSubMesh=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBSubMesh=function(t){t.startObject(3)},t.addOffset=function(t,e){t.addFieldInt32(0,e,0)},t.addIndexCount=function(t,e){t.addFieldInt32(1,e,0)},t.addVertexCount=function(t,e){t.addFieldInt32(2,e,0)},t.endFBSubMesh=function(t){return t.endObject()},t.createFBSubMesh=function(e,r,i,n){return t.startFBSubMesh(e),t.addOffset(e,r),t.addIndexCount(e,i),t.addVertexCount(e,n),t.endFBSubMesh(e)},t}(),Ed=function(){function t(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.offset=t,this.indexCount=e,this.vertexCount=r}return t.prototype.pack=function(t){return _d.createFBSubMesh(t,this.offset,this.indexCount,this.vertexCount)},t}(),bd=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.semantic=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},e.offset=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},e.format=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):0},e.dimension=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):0},e.normalize=function(){var t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},e.unpack=function(){return new Ad(this.semantic(),this.offset(),this.format(),this.dimension(),this.normalize())},e.unpackTo=function(t){t.semantic=this.semantic(),t.offset=this.offset(),t.format=this.format(),t.dimension=this.dimension(),t.normalize=this.normalize()},t.getRootAsFBVertexChannel=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBVertexChannel=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBVertexChannel=function(t){t.startObject(5)},t.addSemantic=function(t,e){t.addFieldOffset(0,e,0)},t.addOffset=function(t,e){t.addFieldInt32(1,e,0)},t.addFormat=function(t,e){t.addFieldInt32(2,e,0)},t.addDimension=function(t,e){t.addFieldInt32(3,e,0)},t.addNormalize=function(t,e){t.addFieldInt8(4,+e,0)},t.endFBVertexChannel=function(t){return t.endObject()},t.createFBVertexChannel=function(e,r,i,n,o,a){return t.startFBVertexChannel(e),t.addSemantic(e,r),t.addOffset(e,i),t.addFormat(e,n),t.addDimension(e,o),t.addNormalize(e,a),t.endFBVertexChannel(e)},t}(),Ad=function(){function t(t,e,r,i,n){void 0===t&&(t=null),void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=!1),this.semantic=t,this.offset=e,this.format=r,this.dimension=i,this.normalize=n}return t.prototype.pack=function(t){var e=null!==this.semantic?t.createString(this.semantic):0;return bd.createFBVertexChannel(t,e,this.offset,this.format,this.dimension,this.normalize)},t}(),Sd=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.vertexCount=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0},e.channels=function(t,e){var r=this.bb.__offset(this.bb_pos,6);return r?(e||new bd).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null},e.channelsLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},e.unpack=function(){return new Rd(this.vertexCount(),this.bb.createObjList(this.channels.bind(this),this.channelsLength()))},e.unpackTo=function(t){t.vertexCount=this.vertexCount(),t.channels=this.bb.createObjList(this.channels.bind(this),this.channelsLength())},t.getRootAsFBVertexData=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBVertexData=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBVertexData=function(t){t.startObject(2)},t.addVertexCount=function(t,e){t.addFieldInt32(0,e,0)},t.addChannels=function(t,e){t.addFieldOffset(1,e,0)},t.createChannelsVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},t.startChannelsVector=function(t,e){t.startVector(4,e,4)},t.endFBVertexData=function(t){return t.endObject()},t.createFBVertexData=function(e,r,i){return t.startFBVertexData(e),t.addVertexCount(e,r),t.addChannels(e,i),t.endFBVertexData(e)},t}(),Rd=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=[]),this.vertexCount=t,this.channels=e}return t.prototype.pack=function(t){var e=Sd.createChannelsVector(t,t.createObjectOffsetList(this.channels));return Sd.createFBVertexData(t,this.vertexCount,e)},t}(),Cd=function(){function t(){this.bb=null,this.bb_pos=0}var e=t.prototype;return e.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},e.id=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},e.name=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null},e.vertexData=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?(t||new Sd).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null},e.indexFormat=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt32(this.bb_pos+t):0},e.indexOffset=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):0},e.subMeshes=function(t,e){var r=this.bb.__offset(this.bb_pos,14);return r?(e||new _d).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*t),this.bb):null},e.subMeshesLength=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0},e.mode=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):0},e.buffer=function(t){var e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__string(this.bb_pos+e,t):null},e.binaryData=function(t){var e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},e.binaryDataLength=function(){var t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0},e.binaryDataArray=function(){var t=this.bb.__offset(this.bb_pos,20);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},e.boneNames=function(t,e){var r=this.bb.__offset(this.bb_pos,22);return r?this.bb.__string(this.bb.__vector(this.bb_pos+r)+4*t,e):null},e.boneNamesLength=function(){var t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0},e.rootBoneName=function(t){var e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null},e.inverseBindMatrices=function(t){var e=this.bb.__offset(this.bb_pos,26);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0},e.inverseBindMatricesLength=function(){var t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__vector_len(this.bb_pos+t):0},e.inverseBindMatricesArray=function(){var t=this.bb.__offset(this.bb_pos,26);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},e.unpack=function(){return new Md(this.id(),this.name(),null!==this.vertexData()?this.vertexData().unpack():null,this.indexFormat(),this.indexOffset(),this.bb.createObjList(this.subMeshes.bind(this),this.subMeshesLength()),this.mode(),this.buffer(),this.bb.createScalarList(this.binaryData.bind(this),this.binaryDataLength()),this.bb.createScalarList(this.boneNames.bind(this),this.boneNamesLength()),this.rootBoneName(),this.bb.createScalarList(this.inverseBindMatrices.bind(this),this.inverseBindMatricesLength()))},e.unpackTo=function(t){t.id=this.id(),t.name=this.name(),t.vertexData=null!==this.vertexData()?this.vertexData().unpack():null,t.indexFormat=this.indexFormat(),t.indexOffset=this.indexOffset(),t.subMeshes=this.bb.createObjList(this.subMeshes.bind(this),this.subMeshesLength()),t.mode=this.mode(),t.buffer=this.buffer(),t.binaryData=this.bb.createScalarList(this.binaryData.bind(this),this.binaryDataLength()),t.boneNames=this.bb.createScalarList(this.boneNames.bind(this),this.boneNamesLength()),t.rootBoneName=this.rootBoneName(),t.inverseBindMatrices=this.bb.createScalarList(this.inverseBindMatrices.bind(this),this.inverseBindMatricesLength())},t.getRootAsFBGeometryData=function(e,r){return(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRootAsFBGeometryData=function(e,r){return e.setPosition(e.position()+4),(r||new t).__init(e.readInt32(e.position())+e.position(),e)},t.startFBGeometryData=function(t){t.startObject(12)},t.addId=function(t,e){t.addFieldOffset(0,e,0)},t.addName=function(t,e){t.addFieldOffset(1,e,0)},t.addVertexData=function(t,e){t.addFieldOffset(2,e,0)},t.addIndexFormat=function(t,e){t.addFieldInt32(3,e,0)},t.addIndexOffset=function(t,e){t.addFieldInt32(4,e,0)},t.addSubMeshes=function(t,e){t.addFieldOffset(5,e,0)},t.createSubMeshesVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},t.startSubMeshesVector=function(t,e){t.startVector(4,e,4)},t.addMode=function(t,e){t.addFieldInt32(6,e,0)},t.addBuffer=function(t,e){t.addFieldOffset(7,e,0)},t.addBinaryData=function(t,e){t.addFieldOffset(8,e,0)},t.createBinaryDataVector=function(t,e){t.startVector(1,e.length,1);for(var r=e.length-1;r>=0;r--)t.addInt8(e[r]);return t.endVector()},t.startBinaryDataVector=function(t,e){t.startVector(1,e,1)},t.addBoneNames=function(t,e){t.addFieldOffset(9,e,0)},t.createBoneNamesVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addOffset(e[r]);return t.endVector()},t.startBoneNamesVector=function(t,e){t.startVector(4,e,4)},t.addRootBoneName=function(t,e){t.addFieldOffset(10,e,0)},t.addInverseBindMatrices=function(t,e){t.addFieldOffset(11,e,0)},t.createInverseBindMatricesVector=function(t,e){t.startVector(4,e.length,4);for(var r=e.length-1;r>=0;r--)t.addFloat32(e[r]);return t.endVector()},t.startInverseBindMatricesVector=function(t,e){t.startVector(4,e,4)},t.endFBGeometryData=function(t){return t.endObject()},t}(),Md=function(){function t(t,e,r,i,n,o,a,s,u,c,h,l){void 0===t&&(t=null),void 0===e&&(e=null),void 0===r&&(r=null),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=[]),void 0===a&&(a=0),void 0===s&&(s=null),void 0===u&&(u=[]),void 0===c&&(c=[]),void 0===h&&(h=null),void 0===l&&(l=[]),this.id=t,this.name=e,this.vertexData=r,this.indexFormat=i,this.indexOffset=n,this.subMeshes=o,this.mode=a,this.buffer=s,this.binaryData=u,this.boneNames=c,this.rootBoneName=h,this.inverseBindMatrices=l}return t.prototype.pack=function(t){var e=null!==this.id?t.createString(this.id):0,r=null!==this.name?t.createString(this.name):0,i=null!==this.vertexData?this.vertexData.pack(t):0,n=Cd.createSubMeshesVector(t,t.createObjectOffsetList(this.subMeshes)),o=null!==this.buffer?t.createString(this.buffer):0,a=Cd.createBinaryDataVector(t,this.binaryData),s=Cd.createBoneNamesVector(t,t.createObjectOffsetList(this.boneNames)),u=null!==this.rootBoneName?t.createString(this.rootBoneName):0,c=Cd.createInverseBindMatricesVector(t,this.inverseBindMatrices);return Cd.startFBGeometryData(t),Cd.addId(t,e),Cd.addName(t,r),Cd.addVertexData(t,i),Cd.addIndexFormat(t,this.indexFormat),Cd.addIndexOffset(t,this.indexOffset),Cd.addSubMeshes(t,n),Cd.addMode(t,this.mode),Cd.addBuffer(t,o),Cd.addBinaryData(t,a),Cd.addBoneNames(t,s),Cd.addRootBoneName(t,u),Cd.addInverseBindMatrices(t,c),Cd.endFBGeometryData(t)},t}(),Od=function(){function t(){this.exportObjectDatas=[]}var e=t.prototype;return e.addData=function(t){this.exportObjectDatas.push(t)},e.serializeToBinary=function(){for(var t,e=new vd(1),r=new Td,i=[],n=pr(this.exportObjectDatas);!(t=n()).done;){var o=t.value,a=void 0;o.dataType===xn.Geometry&&(a=new gd("Geometry",this.geometryDataToBinary(o))),a&&i.push(a)}return r.exportObjects=i,xd.finishFBEffectsPackageDataBuffer(e,r.pack(e)),e.asUint8Array()},e.deserializeFromBinary=function(t){for(var e=new md(t),r=xd.getRootAsFBEffectsPackageData(e),i=0;i<r.exportObjectsLength();i++){var n=r.exportObjects(i);if(n){var o=n.dataArray(),a=n.dataType();if(o){var s=void 0;a===xn.Geometry&&(s=this.binaryToGeometryData(o)),s&&this.exportObjectDatas.push(s)}}}},e.geometryDataToBinary=function(t){var e=new vd(1),r=new Md,i=t.indexFormat,n=t.indexOffset,o=t.mode,a=t.id,s=t.vertexData,u=t.boneNames,c=void 0===u?[]:u,h=t.rootBoneName,l=void 0===h?"":h,f=t.inverseBindMatrices,d=void 0===f?[]:f,p=t.binaryData,m=void 0===p?[]:p;r.indexFormat=i,r.indexOffset=n,r.mode=o,r.id=a,r.boneNames=c,r.rootBoneName=l,r.inverseBindMatrices=d,r.binaryData=m;var v=new Rd;v.vertexCount=s.vertexCount,v.channels=[];for(var y,g=pr(s.channels);!(y=g()).done;){var x=y.value,T=x.semantic,_=x.offset,E=x.format,b=x.dimension,A=x.normalize,S=new Ad(T,_,E,b,A);v.channels.push(S)}r.vertexData=v;for(var R,C=[],M=pr(t.subMeshes);!(R=M()).done;){var O=R.value,P=O.offset,I=O.indexCount,w=O.vertexCount,N=new Ed(P,I,w);C.push(N)}return r.subMeshes=C,xd.finishFBEffectsPackageDataBuffer(e,r.pack(e)),e.asUint8Array()},e.binaryToGeometryData=function(t){var e=new md(t),r=Cd.getRootAsFBGeometryData(e),i={vertexCount:0,channels:[]},n=r.vertexData();if(n){i.vertexCount=n.vertexCount();for(var o=0;o<n.channelsLength();o++){var a=n.channels(o);if(a){var s,u={semantic:null!=(s=a.semantic())?s:"",offset:a.offset(),format:a.format(),dimension:a.dimension(),normalize:a.normalize()};i.channels.push(u)}}}for(var c=[],h=0;h<r.subMeshesLength();h++){var l=r.subMeshes(h);if(l){var f={offset:l.offset(),vertexCount:l.vertexCount(),indexCount:l.indexCount()};c.push(f)}}for(var d=[],p=0;p<r.boneNamesLength();p++){var m=r.boneNames(p);d.push(m)}var v,y,g,x,T=r.inverseBindMatricesArray();return{vertexData:i,indexFormat:r.indexFormat(),indexOffset:r.indexOffset(),subMeshes:c,mode:r.mode(),buffer:null!=(v=r.buffer())?v:"",boneNames:d,rootBoneName:null!=(y=r.rootBoneName())?y:"",inverseBindMatrices:T?Array.from(T):void 0,binaryData:null!=(g=r.binaryDataArray())?g:void 0,id:null!=(x=r.id())?x:"",dataType:xn.Geometry}},t}(),Pd=function(){function t(){this.renderErrors=new Set,this.destroyed=!1,this.textures=[],this.materials=[],this.geometries=[],this.meshes=[],this.renderPasses=[],this.jsonSceneData={},this.objectInstance={},this.assetLoader=new rf(this),this.whiteTexture=Ta(this),this.transparentTexture=_a(this)}var e=t.prototype;return e.clearResources=function(){this.jsonSceneData={},this.objectInstance={}},e.addEffectsObjectData=function(t){this.jsonSceneData[t.id]=t},e.findEffectsObjectData=function(t){return this.jsonSceneData[t]},e.addInstance=function(t){this.objectInstance[t.getInstanceId()]=t},e.findObject=function(t){return mi(t)?this.objectInstance[t.id]?this.objectInstance[t.id]:this.assetLoader.loadGUID(t):t},e.removeInstance=function(t){delete this.objectInstance[t]},e.addPackageDatas=function(t){for(var e,r=t.jsonScene,i=t.textureOptions,n=void 0===i?[]:i,o=r.items,a=void 0===o?[]:o,s=r.materials,u=void 0===s?[]:s,c=r.shaders,h=void 0===c?[]:c,l=r.geometries,f=void 0===l?[]:l,d=r.components,p=void 0===d?[]:d,m=r.animations,v=void 0===m?[]:m,y=r.bins,g=void 0===y?[]:y,x=r.miscs,T=void 0===x?[]:x,_=pr(r.compositions);!(e=_()).done;){var E=e.value;this.addEffectsObjectData(E)}for(var b,A=pr(a);!(b=A()).done;){var S=b.value;rd(S.renderLevel,t.renderLevel)||(S.components=[],S.type=Bi.null),this.addEffectsObjectData(S)}for(var R,C=pr(u);!(R=C()).done;){var M=R.value;this.addEffectsObjectData(M)}for(var O,P=pr(h);!(O=P()).done;){var I=O.value;this.addEffectsObjectData(I)}for(var w,N=pr(f);!(w=N()).done;){var L=w.value;this.addEffectsObjectData(L)}for(var F,D=pr(p);!(F=D()).done;){var V=F.value;this.addEffectsObjectData(V)}for(var B,U=pr(v);!(B=U()).done;){var k=B.value;this.addEffectsObjectData(k)}for(var z,G=pr(T);!(z=G()).done;){var X=z.value;this.addEffectsObjectData(X)}for(var H=0;H<g.length;H++){var j=g[H],W=t.bins[H];if(j.dataType===xn.BinaryAsset)j.buffer=W,j.id&&this.addEffectsObjectData(j);else{var Y=new Od;Y.deserializeFromBinary(new Uint8Array(W));for(var Z,q=pr(Y.exportObjectDatas);!(Z=q()).done;){var K=Z.value;this.addEffectsObjectData(K)}}}for(var Q,J=pr(n);!(Q=J()).done;){var $=Q.value;this.addEffectsObjectData($)}},e.createVFXItems=function(t){var e=this;return fr((function(){var r,i,n,o,a;return gr(this,(function(s){for(r=t.jsonScene,i=pr(r.items);!(n=i()).done;)o=n.value,"ECS"!==(a=o.type)&&"camera"!==a&&a!==Bi.sprite&&a!==Bi.particle&&a!==Bi.mesh&&a!==Bi.skybox&&a!==Bi.light&&a!==Bi.tree&&a!==Bi.interact&&a!==Bi.camera||e.database&&e.assetLoader.loadGUID(o);return[2]}))}))()},e.addTexture=function(t){this.destroyed||Sr(this.textures,t)},e.removeTexture=function(t){this.destroyed||Rr(this.textures,t)},e.addMaterial=function(t){this.destroyed||Sr(this.materials,t)},e.removeMaterial=function(t){this.destroyed||Rr(this.materials,t)},e.addGeometry=function(t){this.destroyed||Sr(this.geometries,t)},e.removeGeometry=function(t){this.destroyed||Rr(this.geometries,t)},e.addMesh=function(t){this.destroyed||Sr(this.meshes,t)},e.removeMesh=function(t){this.destroyed||Rr(this.meshes,t)},e.addRenderPass=function(t){this.destroyed||Sr(this.renderPasses,t)},e.removeRenderPass=function(t){this.destroyed||Rr(this.renderPasses,t)},e.getShaderLibrary=function(){return this.renderer.getShaderLibrary()},e.dispose=function(){if(!this.destroyed){this.destroyed=!0;var t=[];this.renderPasses.length>0&&t.push("Pass "+this.renderPasses.length),this.meshes.length>0&&t.push("Mesh "+this.meshes.length),this.geometries.length>0&&t.push("Geom "+this.geometries.length),this.textures.length>0&&t.push("Tex "+this.textures.length),t.length>0&&ci.warn("Release GPU memory: "+t.join(", ")+"."),this.renderPasses.forEach((function(t){return t.dispose()})),this.meshes.forEach((function(t){return t.dispose()})),this.geometries.forEach((function(t){return t.dispose()})),this.materials.forEach((function(t){return t.dispose()})),this.textures.forEach((function(t){return t.dispose()})),this.textures=[],this.materials=[],this.geometries=[],this.meshes=[],this.renderPasses=[],this.renderer=null}},Io(t,[{key:"isDestroyed",get:function(){return this.destroyed}}]),t}(),Id=function(){function t(t){void 0===t&&(t=60),this.paused=!0,this.lastTime=0,this.dt=0,this.setFPS(t),this.tickers=[]}var e=t.prototype;return e.getFPS=function(){return this.targetFPS},e.setFPS=function(t){this.targetFPS=Lr(t,1,120),this.interval=Math.floor(1e3/t)-2},e.getPaused=function(){return this.paused},e.start=function(){var t=this;if(this.paused=!1,this.dt=0,!this.intervalId){this.lastTime=r.performance.now();var e=r.requestAnimationFrame||function(t){return r.window.setTimeout(t,16.7)},i=function(){t.intervalId=e(i),t.paused||t.tick()};i()}},e.stop=function(){(r.cancelAnimationFrame||r.window.clearTimeout)(this.intervalId),this.intervalId=0,this.lastTime=0,this.paused=!0,this.dt=0,this.tickers=[]},e.pause=function(){this.paused=!0,this.dt=0},e.resume=function(){this.paused=!1,this.dt=0},e.tick=function(){if(!this.paused){var t=r.performance.now();if(this.dt=t-this.lastTime,this.dt>=this.interval){this.lastTime=t,this.resetTickers&&(this.tickers=this.tickers.filter((function(t){return t})),this.resetTickers=!1);for(var e=0,i=this.tickers.length;e<i;e++){(0,this.tickers[e])(this.dt)}}}},e.add=function(t){if("function"!=typeof t)throw new Error("The tick object must implement the tick method.");this.tickers.push(t)},Io(t,[{key:"deltaTime",get:function(){return this.dt}}]),t}();Si("camera",Hu,exports.VFXItem),Si("text",$l,exports.VFXItem),Si("sprite",rc,exports.VFXItem),Si("particle",bl,exports.VFXItem),Si("cal",Al,exports.VFXItem),Si("interact",Qu,exports.VFXItem),ci.info("Core version: 2.7.2.");var wd,Nd=((pd={})[ko.RGBA]=34842,pd[ko.RGB]=34843,pd[ko.ALPHA]=33325,pd[ko.RED]=33325,pd[ko.LUMINANCE_ALPHA]=33327,pd[ko.LUMINANCE]=33325,pd),Ld=((wd={})[ko.RGBA]=34836,wd[ko.RGB]=34837,wd[ko.ALPHA]=33326,wd[ko.RED]=33326,wd[ko.LUMINANCE_ALPHA]=33328,wd[ko.LUMINANCE]=33326,wd),Fd=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).initialized=!1,r&&i.fromData(r),i}ji(e,t);var r=e.prototype;return r.bind=function(t){this.engine.bindTexture(this.target,this.textureBuffer,t)},r.initialize=function(){if(!this.initialized){this.engine.addTexture(this);var t=this.engine.gl,e=this.source,r=e.target,i=void 0===r?t.TEXTURE_2D:r,n=e.name;this.textureBuffer=t.createTexture(),kd(this.textureBuffer,n),this.target=i,this.update(this.source),this.release(),this.initialized=!0}},r.clone=function(){var t=new e(this.engine,this.source);return t.sourceFrom=this.sourceFrom,t.sourceType=this.sourceType,t.width=this.width,t.height=this.height,t},r.release=function(){switch(this.source.sourceType){case exports.TextureSourceType.image:delete this.source.image,delete this.source.cube;break;case exports.TextureSourceType.data:delete this.source.data;break;case exports.TextureSourceType.compressed:case exports.TextureSourceType.mipmaps:delete this.source.mipmaps}},r.update=function(t){var e=this;if(!this.engine||!this.textureBuffer)return this.width=0,void(this.height=0);var r,i,n=this.target,o=this.source,a=this.engine.gl,s=this.engine.gpuCapability.detail,u=o.sourceType,c=o.data,h=o.cube,l=o.image,f=o.video,d=o.mipmaps,p=o.mipmaps,m=t.data,v=t.cube,y=t.generateMipmap,g=t.mipmaps,x=o.format,T=o.type,_=o.internalFormat,E=0,b=0;if(this.bind(u===exports.TextureSourceType.video),T===ko.HALF_FLOAT?((T=s.halfFloatTexture)||ci.error("Half float texture is not support."),Xo(a)&&_===x&&(x===ko.LUMINANCE&&(x=ko.RED),_=Nd[x]),s.halfFloatLinear||(o.minFilter=o.magFilter=a.NEAREST,ci.warn("Half float linear not support, change to NEAREST."))):T===a.FLOAT&&((T=s.floatTexture)||ci.error("Float texture is not support."),Xo(a)&&_===x&&(x===ko.LUMINANCE&&(x=ko.RED),_=Ld[x]),s.floatLinear||(o.minFilter=a.NEAREST,o.magFilter=a.NEAREST,ci.warn("Float linear not support, change to NEAREST."))),void 0===o.premultiplyAlpha&&(o.premultiplyAlpha=!1),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),void 0===o.flipY&&(o.flipY=!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,o.flipY),u===exports.TextureSourceType.framebuffer)m&&(E=null!=(r=m.width)?r:0,b=null!=(i=m.height)?i:0,E&&b&&(this.width!==E||this.height!==b)&&a.texImage2D(n,0,_,E,b,0,x,T,null));else if(u===exports.TextureSourceType.data){var A;n===a.TEXTURE_CUBE_MAP?v.forEach((function(t,r){var i=e.texImage2DData(a,a.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,_,x,T,t),n=i[0],o=i[1];E=Math.max(n,E),b=Math.max(o,b)})):(A=this.texImage2DData(a,n,0,_,x,T,c),E=A[0],b=A[1])}else if(u===exports.TextureSourceType.image||u===exports.TextureSourceType.video){if(n===a.TEXTURE_CUBE_MAP)h.forEach((function(t,r){var i=e.texImage2D(a,a.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,_,x,T,t),n=i[0],o=i[1];E=Math.max(n,E),b=Math.max(o,b)}));else if(n===a.TEXTURE_2D){var S,R=null!=l?l:f;S=this.texImage2D(a,n,0,_,x,T,R),E=S[0],b=S[1]}y&&(Dd(E)&&Dd(b)||Xo(a))&&a.generateMipmap(n)}else if(u===exports.TextureSourceType.mipmaps){var C;n===a.TEXTURE_2D?d.forEach((function(t,r){var i;C="data"in t?e.texImage2DData(a,n,r,_,x,T,t):e.texImage2D(a,n,r,_,x,T,t),0===r&&(E=(i=C)[0],b=i[1])})):n===a.TEXTURE_CUBE_MAP&&p.forEach((function(t,r){t.forEach((function(t,i){var n;C="data"in t?e.texImage2DData(a,a.TEXTURE_CUBE_MAP_POSITIVE_X+i,r,_,x,T,t):e.texImage2D(a,a.TEXTURE_CUBE_MAP_POSITIVE_X+i,r,_,x,T,t),0===r&&(E=(n=C)[0],b=n[1])}))}))}else u===exports.TextureSourceType.compressed&&g&&0!==g.length&&(E=g[0].width,b=g[0].height,g.forEach((function(t,e){a.compressedTexImage2D(n,e,_,t.width,t.height,0,t.data)})));this.width=E,this.height=b,this.setTextureFilters(a,n,o)},r.setTextureFilters=function(t,e,r){var i=r.anisotropic,n=void 0===i?4:i,o=r.wrapS,a=void 0===o?t.CLAMP_TO_EDGE:o,s=r.wrapT,u=void 0===s?t.CLAMP_TO_EDGE:s,c=this.engine.gpuCapability;this.target===t.TEXTURE_2D&&c.setTextureAnisotropic(t,this.target,n);var h=Xo(t)||Dd(this.width)&&Dd(this.height),l=r.magFilter?r.magFilter:t.NEAREST,f=r.minFilter?r.minFilter:t.NEAREST;h||f!==t.LINEAR_MIPMAP_LINEAR&&f!==t.LINEAR_MIPMAP_NEAREST&&f!==t.NEAREST_MIPMAP_LINEAR&&f!==t.NEAREST_MIPMAP_NEAREST||(f=t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,f),t.texParameteri(e,t.TEXTURE_MAG_FILTER,l),t.texParameteri(e,t.TEXTURE_WRAP_S,h?a:t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,h?u:t.CLAMP_TO_EDGE)},r.fromData=function(e){t.prototype.fromData.call(this,e);var r=e,i=this.assembleOptions(r),n=i.sourceType,o=i.sourceFrom,a=i.name,s=void 0===a?"":a;this.source=i,this.sourceType=n,this.sourceFrom=o,this.name=s},r.texImage2D=function(t,e,r,i,n,o,a){var s,u=this,c=this.source,h=c.sourceType,l=c.minFilter,f=c.magFilter,d=c.wrapS,p=c.wrapT,m=null!=(s=this.engine.gpuCapability.detail.maxTextureSize)?s:2048,v=a;if(h!==exports.TextureSourceType.video){var y=l!==t.NEAREST||f!==t.NEAREST||d!==t.CLAMP_TO_EDGE||p!==t.CLAMP_TO_EDGE;(y=y||a.width>m||a.height>m)&&setTimeout((function(){v=u.resizeImage(a)}))}t.texImage2D(e,r,i,n,o,v);var g=[v.width,v.height];return h===exports.TextureSourceType.video?[a.videoWidth,a.videoHeight]:g},r.texImage2DData=function(t,e,r,i,n,o,a){var s=a.data,u=a.width,c=a.height,h=n===t.UNSIGNED_BYTE?new Uint8Array(s.buffer,s.byteOffset,s.byteLength/s.BYTES_PER_ELEMENT):s;return t.texImage2D(e,r,i,u,c,0,n,o,h),[u,c]},r.resizeImage=function(t,e,r){var i,n=null!=(i=this.engine.gpuCapability.detail.maxTextureSize)?i:2048;if(Xo(this.engine.gl)&&t.width<n&&t.height<n)return t;var o=function(t,e,r,i){var n=t.width,o=t.height,a=Math.min(e,r||Ys(n)),s=Math.min(e,i||Ys(o));if(s!==o||a!==n){var u=Yl.getCanvas(),c=u.getContext("2d");return u.width=a,u.height=s,null==c||c.drawImage(t,0,0,n,o,0,0,a,s),ci.warn("Image resize from "+n+"x"+o+" to "+a+"x"+s+"."),u}}(t,n,e,r);return o||t},r.reloadData=function(){var t=this;return fr((function(){return gr(this,(function(e){switch(e.label){case 0:return t.offloaded?[4,Ra().reload(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))()},r.offloadData=function(){if(this.initialized&&Ra().canOffloadTexture(this.source.sourceFrom)){var t=this.target,e=this.engine.gl;if(e&&this.textureBuffer){var r=new Uint8Array([255]);if(this.bind(),t===e.TEXTURE_2D)e.texImage2D(t,0,e.LUMINANCE,1,1,0,e.LUMINANCE,e.UNSIGNED_BYTE,r);else if(t===e.TEXTURE_CUBE_MAP)for(var i=[e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z],n=0;n<i.length;n++)e.texImage2D(i[n],0,e.LUMINANCE,1,1,0,e.LUMINANCE,e.UNSIGNED_BYTE,r);e.generateMipmap(t),this.width=1,this.height=1}this.offloaded=!0}},r.uploadCurrentVideoFrame=function(){var t=this;return fr((function(){return gr(this,(function(e){return t.source.sourceType===exports.TextureSourceType.video&&t.source.video&&t.initialized?(t.update({video:t.source.video}),[2,!0]):[2,!1]}))}))()},r.updateSource=function(t){this.source=this.assembleOptions(qn({},this.source,t)),this.sourceType=this.source.sourceType,this.sourceFrom=this.source.sourceFrom,this.update(this.source)},r.restore=function(){},r.dispose=function(){this.engine&&this.textureBuffer&&this.engine.gl.deleteTexture(this.textureBuffer),this.width=0,this.height=0,this.textureBuffer=null,this.destroyed=!0,this.update=function(){ci.error("This texture has been destroyed.")},this.initialize=gi,void 0!==this.engine&&this.engine.removeTexture(this),t.prototype.dispose.call(this)},e}(ya);function Dd(t){return!(t&t-1)&&0!==t}var Vd=function(){function t(t,e){this.ready=!1,this.disposed=!1,this.gl=t.gl,this.vaoExt=t.gpuCapability.vaoExt,this.vao=this.createVertexArray(e)}var e=t.prototype;return e.bind=function(){this.bindVertexArray(this.vao)},e.unbind=function(){this.bindVertexArray(null)},e.createVertexArray=function(t){var e=null;return Xo(this.gl)&&(e=this.gl.createVertexArray()),!e&&this.vaoExt&&(e=this.vaoExt.createVertexArrayOES()),kd(e,t),e},e.bindVertexArray=function(t){var e;Xo(this.gl)?this.gl.bindVertexArray(t):null==(e=this.vaoExt)||e.bindVertexArrayOES(t)},e.dispose=function(){var t;Xo(this.gl)?this.gl.deleteVertexArray(this.vao):null==(t=this.vaoExt)||t.deleteVertexArrayOES(this.vao)},t}(),Bd=1,Ud=function(){function t(t){this.engine=t,this.textures=[],this.renderbuffers=[],this.framebuffers=[],this.destroyed=!1;var e={width:1,height:1,data:new Uint8Array([255])},r=this.engine.gl;this.gl=r,this.emptyTexture2D=new Fd(t,{data:e,sourceType:exports.TextureSourceType.data,format:r.LUMINANCE,internalFormat:r.LUMINANCE,type:r.UNSIGNED_BYTE}),this.emptyTexture2D.initialize(),this.emptyTextureCube=new Fd(t,{target:r.TEXTURE_CUBE_MAP,cube:[e,e,e,e,e,e],sourceType:exports.TextureSourceType.data,format:r.LUMINANCE,internalFormat:r.LUMINANCE,type:r.UNSIGNED_BYTE}),this.emptyTextureCube.initialize(),this.name="GLGPURenderer"+Bd,Bd++}var e=t.prototype;return e.copy2=function(t,e){var r=this.gl;if(r){this.sourceFbo||(this.sourceFbo=r.createFramebuffer()),this.targetFbo||(this.targetFbo=r.createFramebuffer());var i=this.engine;i.bindFramebuffer(r.FRAMEBUFFER,this.sourceFbo),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t.textureBuffer,0),i.bindFramebuffer(r.FRAMEBUFFER,this.targetFbo),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.textureBuffer,0),i.bindFramebuffer(r.READ_FRAMEBUFFER,this.sourceFbo),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.targetFbo);var n=t.getWidth()===t.getHeight()&&e.getWidth()==e.getHeight()?r.NEAREST:r.LINEAR;r.blitFramebuffer(0,0,t.getWidth(),t.getHeight(),0,0,e.getWidth(),e.getHeight(),r.COLOR_BUFFER_BIT,n),i.bindFramebuffer(r.FRAMEBUFFER,null),i.bindFramebuffer(r.READ_FRAMEBUFFER,null),i.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)}},e.resetColorAttachments=function(t,e){t.bind(),t.resetColorTextures(e)},e.createGLRenderbuffer=function(t){var e=this.gl.createRenderbuffer();return e&&Sr(this.renderbuffers,t),e},e.resize=function(t,e){var r=this.gl;(r&&r.drawingBufferWidth!==t||r.drawingBufferHeight!==e)&&(r.canvas.width=t,r.canvas.height=e,r.viewport(0,0,t,e),this.framebuffers.forEach((function(r){var i=r.viewport;r.isCustomViewport||r.resize(i[0],i[1],t*r.viewportScale,e*r.viewportScale)})))},e.drawGeometry=function(t,e,r){if(this.gl){var i=t,n=e.shaderVariant.program;if(n){var o=n.setupAttributes(i),a=this.gl,s=i.indicesBuffer,u=i.drawStart,c=i.drawCount,h=i.mode,l=i.subMeshes;if(l&&l.length){var f,d=l[r];if(c<0)return;u=d.offset,c=s?null!=(f=d.indexCount)?f:0:d.vertexCount}s?a.drawElements(h,c,s.type,null!=u?u:0):a.drawArrays(h,u,c),null==o||o.unbind()}}else console.warn("GLGPURenderer has not bound a gl object, unable to render geometry.")},e.createGLFramebuffer=function(t,e){var r=this.gl.createFramebuffer();if(!r)throw new Error("Failed to create WebGL framebuffer. gl isContextLost="+this.gl.isContextLost());return Sr(this.framebuffers,t),kd(r,e,e),r},e.createVAO=function(t){return new Vd(this.engine,t)},e.deleteGLTexture=function(t){t.textureBuffer&&!this.destroyed&&(this.gl.deleteTexture(t.textureBuffer),Rr(this.textures,t),delete t.textureBuffer)},e.deleteGPUBuffer=function(t){t&&!this.destroyed&&(this.gl.deleteBuffer(t.glBuffer),delete t.glBuffer)},e.deleteGLFramebuffer=function(t){t&&!this.destroyed&&(this.gl.deleteFramebuffer(t.fbo),Rr(this.framebuffers,t),delete t.fbo)},e.deleteGLRenderbuffer=function(t){t&&!this.destroyed&&(this.gl.deleteRenderbuffer(t.buffer),Rr(this.renderbuffers,t),delete t.buffer)},e.deleteResource=function(){var t=this,e=this.gl;e&&(e.deleteFramebuffer(this.sourceFbo),e.deleteFramebuffer(this.targetFbo),this.emptyTexture2D.dispose(),this.emptyTextureCube.dispose(),this.framebuffers.forEach((function(e){return t.deleteGLFramebuffer(e)})),this.framebuffers.length=0,this.renderbuffers.forEach((function(e){return t.deleteGLRenderbuffer(e)})),this.renderbuffers.length=0,this.textures.forEach((function(e){return t.deleteGLTexture(e)})),this.textures.length=0)},e.lost=function(t){ci.error("WebGL context lost, destroying glRenderer by default to prevent memory leaks. Event target: "+t.target+"."),this.deleteResource()},e.dispose=function(){this.deleteResource(),this.emptyTexture2D=this.emptyTextureCube=this.gpu=this.gl=null,this.destroyed=!0},Io(t,[{key:"height",get:function(){var t;return null==(t=this.gl)?void 0:t.drawingBufferHeight}},{key:"width",get:function(){var t;return null==(t=this.gl)?void 0:t.drawingBufferWidth}},{key:"canvas",get:function(){return this.gl.canvas}},{key:"isDestroyed",get:function(){return this.destroyed}}]),t}();function kd(t,e,r){void 0!==e&&null!==t&&(t.__SPECTOR_Metadata={name:e},t.__SPECTOR_Object_TAG?(t.__SPECTOR_Object_TAG.displayText=e,r&&(t.__SPECTOR_Object_TAG.id=r)):t.__SPECTOR_Object_TAG={displayText:e,id:""})}var zd,Gd,Xd=function(){function t(t,e){this.engine=t,this.byteLength=0,this.destroyed=!1;var r=e.name,i=e.data,n=e.elementCount,o=e.target,a=void 0===o?ko.ARRAY_BUFFER:o,s=e.type,u=void 0===s?ko.FLOAT:s,c=e.usage,h=void 0===c?ko.STATIC_DRAW:c,l=function(t){var e,r;return null!=(r=null==(e=Hd[t])?void 0:e.BYTES_PER_ELEMENT)?r:0}(u);this.target=a,this.type=u,this.usage=h,this.glBuffer=this.createGLBuffer(r),this.bytesPerElement=l,i?this.bufferData(i):n&&this.bufferData(l*n)}var e=t.prototype;return e.createGLBuffer=function(t){var e=this.engine.gl.createBuffer();return kd(e,t),e},e.bind=function(){this.engine.gl.bindBuffer(this.target,this.glBuffer)},e.bufferData=function(t){var e="number"==typeof t?t:t.byteLength;if(this.engine){this.byteLength=e;var r=this.engine.gl,i=this.target;r.bindBuffer(i,this.glBuffer),0===e?r.bufferData(i,1,this.usage):(r.bufferData(i,e,this.usage),"number"!=typeof t&&r.bufferSubData(i,0,t))}else this.byteLength=0},e.bufferSubData=function(t,e){if(this.engine){var r=this.engine.gl,i=this.target,n=t*this.bytesPerElement,o=n+e.byteLength;r.bindBuffer(i,this.glBuffer),o>this.byteLength&&(this.byteLength=o,r.bufferData(i,o,this.usage)),r.bufferSubData(i,n,e)}else this.byteLength=0},e.dispose=function(){this.engine.gl.deleteBuffer(this.glBuffer),this.glBuffer=null,this.destroyed=!0},e.readSubData=function(t,e){return!!Xo(this.engine.gl)&&(this.engine.gl.getBufferSubData(this.target,t*this.bytesPerElement,e),!0)},Io(t,[{key:"elementCount",get:function(){return this.byteLength/this.bytesPerElement}},{key:"isDestroyed",get:function(){return this.destroyed}}]),t}(),Hd=((zd={})[ko.INT]=Int32Array,zd[ko.FLOAT]=Float32Array,zd[ko.SHORT]=Int16Array,zd[ko.BYTE]=Int8Array,zd[ko.UNSIGNED_BYTE]=Uint8Array,zd[ko.UNSIGNED_INT]=Uint32Array,zd[ko.UNSIGNED_SHORT]=Uint16Array,zd),jd=((Gd={})[Uint8Array.BYTES_PER_ELEMENT]=ko.UNSIGNED_BYTE,Gd[Uint16Array.BYTES_PER_ELEMENT]=ko.UNSIGNED_SHORT,Gd[Uint32Array.BYTES_PER_ELEMENT]=ko.UNSIGNED_INT,Gd),Wd=1,Yd=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).drawCount=0,i.buffers={},i.vaos={},i.skin={},i.initialized=!1,i.indicesReleasable=!1,i.attributesName=[],i.destroyed=!1,r&&i.processProps(r),i}ji(e,t);var i=e.prototype;return i.getOptions=function(){return qn({},this.options)},i.initialize=function(){var t=this;if(!this.initialized){var e=this.engine;oi(e),e.addGeometry(this),Object.keys(this.bufferProps).forEach((function(e){t.buffers[e]=new Xd(t.engine,t.bufferProps[e])})),this.indices&&(this.indicesBuffer=this.createIndicesBuffer(this.indices)),this.initialized=!0,this.flush(),this.options=void 0}},i.getAttributeBuffer=function(t){if(this.initialized){var e=this.attributes[t].dataSource;return this.buffers[e]}},i.setAttributeData=function(t,e){if(null!=this.bufferProps){var r=this.getAttributeBufferOption(t),i=this.attributes[t].dataSource;if(r){var n=r.usage,o=r.target;this.bufferProps[i]={data:e,usage:n,target:o,elementCount:e.length},this.dirtyFlags[i].discard=!0,this.dirtyFlags[i].dirty=!0}}},i.getAttributeData=function(t){if(null!=this.bufferProps){var e=this.getAttributeBufferOption(t);return e?e.data:void 0}},i.setAttributeSubData=function(t,e,r){if(null!=this.bufferProps){var i=this.getAttributeBufferOption(t);if(i&&null!=i.data){var n=e,o=e+r.length;if(i.data.length<o){var a=new r.constructor(o);a.set(i.data),i.data=a,this.dirtyFlags[t].discard=!0}else if(!this.dirtyFlags[t].discard){var s=this.dirtyFlags[t];void 0!==s.start&&(s.start=Math.min(s.start,n)),void 0!==s.end&&(s.end=Math.max(s.end,o-1))}i.data.set(r,n),this.dirtyFlags[t].dirty=!0}}},i.getIndexData=function(){return this.indices},i.setIndexData=function(t){(mr(t,Uint8Array)||mr(t,Uint16Array)||mr(t,Uint32Array))&&(this.indices=t,this.dirtyFlags.index.discard=!0,this.dirtyFlags.index.dirty=!0)},i.setIndexSubData=function(t,e){if(this.indices){var r,i=t,n=t+e.length;if(this.indices.length<n){var o=new e.constructor(n);o.set(this.indices),this.indices=o,this.dirtyFlags.index.discard=!0}else if(!this.dirtyFlags.index.discard){var a=this.dirtyFlags.index;void 0!==a.start&&(a.start=Math.min(a.start,i)),void 0!==a.end&&(a.end=Math.max(a.end,n-1))}null==(r=this.indices)||r.set(e,i),this.dirtyFlags.index.dirty=!0}},i.getAttributeStride=function(t){var e=this.attributes[t],r=e.stride,i=e.size,n=e.type;return r||i*Ha[n]},i.getAttributeNames=function(){return this.attributesName},i.setDrawStart=function(t){this.drawStart=t},i.getDrawStart=function(){return this.drawStart},i.setDrawCount=function(t){this.drawCount=t},i.getDrawCount=function(){return this.drawCount},i.getSkinProps=function(){return this.skin},i.getAttributeBufferOption=function(t){var e=this.attributes[t];return e?this.bufferProps[e.dataSource]:void 0},i.createIndicesBuffer=function(t){var e=jd[t.BYTES_PER_ELEMENT],r={data:t,target:ko.ELEMENT_ARRAY_BUFFER,type:e,name:this.name+"##index"};return new Xd(this.engine,r)},i.flush=function(){var t=this;if(this.initialized){var e=this.attributes,r=this.bufferProps,i=this.indices;Object.keys(this.dirtyFlags).forEach((function(n){var o,a,s=t.dirtyFlags[n];if("index"==n)o=t.indicesBuffer,a=i;else{var u=e[n].dataSource;o=t.buffers[u],a=r[u].data}if((s.dirty||s.discard)&&o&&a){if(s.discard)o.bufferData(a);else if(void 0!==s.start&&void 0!==s.end){var c=s.start*a.BYTES_PER_ELEMENT+a.byteOffset,h=s.end-s.start+1,l=new a.constructor(a.buffer,c,h);o.bufferSubData(s.start,l)}s.start=Number.POSITIVE_INFINITY,s.end=0,s.dirty=s.discard=!1}})),Object.keys(this.attributesReleasable).forEach((function(i){var n=t.attributesReleasable[i],o=e[i].dataSource;r[o]&&n&&(r[o].data=void 0)})),this.indicesReleasable}},i.processProps=function(t){var e=t,r=e.drawStart,i=void 0===r?0:r,n=e.drawCount,o=e.mode,a=e.indices,s=e.name,u=void 0===s?"effectsGeometry:"+Wd++:s,c=e.bufferUsage,h=void 0===c?ko.STATIC_DRAW:c;this.name=u;var l={},f=[],d={},p={},m={},v=h;this.drawStart=i,void 0!==n&&(this.drawCount=n),this.mode=isNaN(o)?ko.TRIANGLES:o,Object.keys(e.attributes).forEach((function(t){var r=e.attributes[t],i=r.size,n=r.stride,o=r.offset,a=r.normalize,s=r.type,u=void 0===s?ko.FLOAT:s,c=r.releasable,h=r.data;if(!u||"dataSource"in r||h||(h=Wa(u)),h){var y=mr(h,Float32Array)?ko.FLOAT:ko.INT;l[t]={data:h,usage:v,target:ko.ARRAY_BUFFER,name:t},d[t]={size:i,stride:n,offset:o,type:null!=u?u:y,normalize:!!a,dataSource:t},m[t]=null!=c&&c,p[t]={dirty:!0,discard:!0,start:Number.POSITIVE_INFINITY,end:0}}else{var g=r.dataSource;g&&(d[t]={size:i,stride:n,offset:o,type:u,dataSource:g,normalize:!!a})}f.push(t)})),p.index={dirty:!0,discard:!0,start:Number.POSITIVE_INFINITY,end:0},this.indices=null==a?void 0:a.data,this.indicesReleasable=!0===(null==a?void 0:a.releasable),this.bufferProps=l,this.attributes=d,this.attributesName=f,this.attributesReleasable=m,this.dirtyFlags=p,this.options=e,this.initialized=!1},i.fromData=function(e){var i,n=this;if(t.prototype.fromData.call(this,e),this.subMeshes=e.subMeshes,e.buffer?i=new Uint8Array(function(t){for(var e=r.atob(t),i=new Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return i.buffer}(e.buffer)):e.binaryData&&(i=e.binaryData),i){var o=e.vertexData.vertexCount;if(this.hasSemantic(e)){var a={mode:ko.TRIANGLES,attributes:{}};if(e.vertexData.channels.forEach((function(t){var e,r=null!=(e=Zd[t.semantic])?e:t.semantic,s=n.createVertexTypedArray(t,i,o);a.attributes[r]={type:jo(t.format),size:t.dimension,data:s,normalize:t.normalize}})),e.indexFormat!==En.None){var s=this.createIndexTypedArray(e.indexFormat,i,e.indexOffset);a.indices={data:s},a.drawCount=s.length}else a.drawCount=o;this.processProps(a)}else{var u=e.vertexData.channels[0],c=e.vertexData.channels[1],h=e.vertexData.channels[2],l=this.createVertexTypedArray(u,i,o),f=this.createVertexTypedArray(c,i,o),d=this.createVertexTypedArray(h,i,o),p=this.createIndexTypedArray(e.indexFormat,i,e.indexOffset),m={mode:ko.TRIANGLES,attributes:{aPos:{type:jo(u.format),size:3,data:l,normalize:u.normalize},aUV:{type:jo(c.format),size:2,data:f,normalize:c.normalize},aNormal:{type:jo(h.format),size:3,data:d,normalize:h.normalize}}};m.indices={data:p},m.drawCount=p.length,this.processProps(m)}this.skin={boneNames:e.boneNames,rootBoneName:e.rootBoneName,inverseBindMatrices:e.inverseBindMatrices}}},i.dispose=function(){var e,r=this;this.drawStart=0,this.drawCount=NaN,this.bufferProps={},this.indices=void 0,this.attributes={},this.attributesName=[],this.options=void 0,this.initialized&&(Object.keys(this.buffers).forEach((function(t){r.buffers[t].dispose()})),this.buffers={},null==(e=this.indicesBuffer)||e.dispose(),Object.keys(this.vaos).forEach((function(t){var e;null==(e=r.vaos[t])||e.dispose(),r.vaos[t]=void 0})),this.indicesBuffer=void 0,void 0!==this.engine&&this.engine.removeGeometry(this)),this.destroyed=!0,t.prototype.dispose.call(this)},i.createVertexTypedArray=function(t,e,r){var i=e.buffer;switch(t.format){case _n.Float32:return new Float32Array(i,e.byteOffset+t.offset,t.dimension*r);case _n.Int16:return new Int16Array(i,e.byteOffset+t.offset,t.dimension*r);case _n.Int8:return new Int8Array(i,e.byteOffset+t.offset,t.dimension*r);case _n.UInt16:return new Uint16Array(i,e.byteOffset+t.offset,t.dimension*r);case _n.UInt8:return new Uint8Array(i,e.byteOffset+t.offset,t.dimension*r);default:return console.error("Invalid vertex format type: "+t.format+"."),new Float32Array(i,e.byteOffset+t.offset,t.dimension*r)}},i.createIndexTypedArray=function(t,e,r){var i=e.buffer;switch(t){case En.UInt16:return new Uint16Array(i,e.byteOffset+r);case En.UInt32:return new Uint32Array(i,e.byteOffset+r);default:return console.error("Invalid index format type: "+t+"."),new Uint32Array(i,e.byteOffset+r)}},i.hasSemantic=function(t){var e=!1;return t.vertexData.channels.forEach((function(t){t.semantic&&t.semantic.length>0&&(e=!0)})),e},Io(e,[{key:"isDestroyed",get:function(){return this.destroyed}},{key:"isInitialized",get:function(){return this.initialized}}]),e}(ja),Zd={POSITION:"aPos",TEXCOORD0:"aUV",TEXCOORD_0:"aUV",TEXCOORD1:"aUV2",NORMAL:"aNormal",TANGENT:"aTangent",COLOR:"aColor",JOINTS:"aJoints",JOINTS_0:"aJoints",WEIGHTS:"aWeights",WEIGHTS_0:"aWeights",POSITION_BS0:"aTargetPosition0",POSITION_BS1:"aTargetPosition1",POSITION_BS2:"aTargetPosition2",POSITION_BS3:"aTargetPosition3",POSITION_BS4:"aTargetPosition4",POSITION_BS5:"aTargetPosition5",POSITION_BS6:"aTargetPosition6",POSITION_BS7:"aTargetPosition7",NORMAL_BS0:"aTargetNormal0",NORMAL_BS1:"aTargetNormal1",NORMAL_BS2:"aTargetNormal2",NORMAL_BS3:"aTargetNormal3",TANGENT_BS0:"aTargetTangent0",TANGENT_BS1:"aTargetTangent1",TANGENT_BS2:"aTargetTangent2",TANGENT_BS3:"aTargetTangent3"},qd=function(){function t(){this.reset()}var e=t.prototype;return e.setBlendColor=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];this.blendColor[0]===e&&this.blendColor[1]===r&&this.blendColor[2]===i&&this.blendColor[3]===n||(this.blendColor[0]=e,this.blendColor[1]=r,this.blendColor[2]=i,this.blendColor[3]=n)},e.setBlending=function(t){this.blending!==t&&(this.blending=t)},e.setBlendFunctionParameters=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];this.blendFunctionParameters[0]===e&&this.blendFunctionParameters[1]===r&&this.blendFunctionParameters[2]===i&&this.blendFunctionParameters[3]===n||(this.blendFunctionParameters[0]=e,this.blendFunctionParameters[1]=r,this.blendFunctionParameters[2]=i,this.blendFunctionParameters[3]=n)},e.setBlendEquationParameters=function(t){var e=t[0],r=t[1];this.blendEquationParameters[0]===e&&this.blendEquationParameters[1]===r||(this.blendEquationParameters[0]=e,this.blendEquationParameters[1]=r)},e.setDepthTest=function(t){this.depthTest!==t&&(this.depthTest=t)},e.setDepthMask=function(t){this.depthMask!==t&&(this.depthMask=t)},e.setDepthRange=function(t){this.depthRange[0]===t[0]&&this.depthRange[1]===t[1]||(this.depthRange[0]=t[0],this.depthRange[1]=t[1])},e.setDepthFunc=function(t){this.depthFunc!==t&&(this.depthFunc=t)},e.setPolygonOffsetFill=function(t){this.polygonOffsetFill!==t&&(this.polygonOffsetFill=t)},e.setPolygonOffset=function(t){this.polygonOffset[0]===t[0]&&this.polygonOffset[1]===t[1]||(this.polygonOffset[0]=t[0],this.polygonOffset[1]=t[1])},e.setSampleAlphaToCoverage=function(t){this.sampleAlphaToCoverage!==t&&(this.sampleAlphaToCoverage=t)},e.setColorMask=function(t){this.colorMask[0]=t,this.colorMask[1]=t,this.colorMask[2]=t,this.colorMask[3]=t},e.setStencilTest=function(t){this.stencilTest!==t&&(this.stencilTest=t)},e.setStencilMask=function(t){this.stencilMask[0]===t[0]&&this.stencilMask[1]===t[1]||(this.stencilMask[0]=t[0],this.stencilMask[1]=t[1])},e.setStencilRef=function(t){this.stencilRef[0]===t[0]&&this.stencilRef[1]===t[1]||(this.stencilRef[0]=t[0],this.stencilRef[1]=t[1])},e.setStencilFunc=function(t){this.stencilFunc[0]===t[0]&&this.stencilFunc[1]===t[1]||(this.stencilFunc[0]=t[0],this.stencilFunc[1]=t[1])},e.setStencilOpFail=function(t){this.stencilOpFail[0]===t[0]&&this.stencilOpFail[1]===t[1]||(this.stencilOpFail[0]=t[0],this.stencilOpFail[1]=t[1])},e.setStencilOpZFail=function(t){this.stencilOpZFail[0]===t[0]&&this.stencilOpZFail[1]===t[1]||(this.stencilOpZFail[0]=t[0],this.stencilOpZFail[1]=t[1])},e.setStencilOpZPass=function(t){this.stencilOpZPass[0]===t[0]&&this.stencilOpZPass[1]===t[1]||(this.stencilOpZPass[0]=t[0],this.stencilOpZPass[1]=t[1])},e.setCulling=function(t){this.culling!==t&&(this.culling=t)},e.setFrontFace=function(t){this.frontFace!==t&&(this.frontFace=t)},e.setCullFace=function(t){this.cullFace!==t&&(this.cullFace=t)},e.reset=function(){this.blending=!1,this.blendColor=[0,0,0,0],this.blendFunctionParameters=[ko.ONE,ko.ONE_MINUS_SRC_ALPHA,ko.ONE,ko.ONE_MINUS_SRC_ALPHA],this.blendEquationParameters=[ko.FUNC_ADD,ko.FUNC_ADD],this.depthTest=!0,this.depthMask=!0,this.depthRange=[0,1],this.depthFunc=ko.LESS,this.polygonOffset=[0,0],this.polygonOffsetFill=!1,this.sampleAlphaToCoverage=!1,this.colorMask=[!0,!0,!0,!0],this.stencilTest=!1,this.stencilMask=[255,255],this.stencilRef=[0,0],this.stencilFunc=[ko.ALWAYS,ko.ALWAYS],this.stencilOpFail=[ko.KEEP,ko.KEEP],this.stencilOpZFail=[ko.KEEP,ko.KEEP],this.stencilOpZPass=[ko.KEEP,ko.KEEP],this.culling=!1,this.frontFace=ko.CCW,this.cullFace=ko.FRONT},e.apply=function(t){if(t.toggle(ko.SAMPLE_ALPHA_TO_COVERAGE,this.sampleAlphaToCoverage),t.toggle(ko.BLEND,this.blending),t.toggle(ko.DEPTH_TEST,this.depthTest),t.toggle(ko.STENCIL_TEST,this.stencilTest),t.toggle(ko.CULL_FACE,this.culling),t.toggle(ko.POLYGON_OFFSET_FILL,this.polygonOffsetFill),this.stencilTest&&(t.stencilMaskSeparate(ko.BACK,this.stencilMask[1]),t.stencilMaskSeparate(ko.FRONT,this.stencilMask[0]),t.stencilFuncSeparate(ko.BACK,this.stencilFunc[0],this.stencilRef[0],this.stencilMask[0]),t.stencilFuncSeparate(ko.FRONT,this.stencilFunc[1],this.stencilRef[1],this.stencilMask[1]),t.stencilOpSeparate(ko.BACK,this.stencilOpFail[0],this.stencilOpZFail[0],this.stencilOpZPass[0]),t.stencilOpSeparate(ko.FRONT,this.stencilOpFail[1],this.stencilOpZFail[1],this.stencilOpZPass[1])),this.blending){var e=this,r=e.blendColor,i=e.blendEquationParameters,n=e.blendFunctionParameters;t.blendColor(r[0],r[1],r[2],r[3]),t.blendEquationSeparate(i[0],i[1]),t.blendFuncSeparate(n[0],n[1],n[2],n[3])}t.colorMask(this.colorMask[0],this.colorMask[1],this.colorMask[2],this.colorMask[3]),this.depthTest&&(t.depthMask(this.depthMask),t.depthFunc(this.depthFunc),t.depthRange(this.depthRange[0],this.depthRange[1])),this.culling&&(t.cullFace(this.cullFace),t.frontFace(this.frontFace)),this.polygonOffsetFill&&t.polygonOffset(this.polygonOffset[0],this.polygonOffset[1])},t}(),Kd=Vr,Qd=Do,Jd=function(t){function e(e,r){var i;return(i=t.call(this,e,r)||this).floats={},i.ints={},i.vector2s={},i.vector3s={},i.vector4s={},i.colors={},i.quaternions={},i.matrices={},i.matrice3s={},i.textures={},i.floatArrays={},i.vector4Arrays={},i.matrixArrays={},i.samplers=[],i.uniforms=[],i.uniformDirty=!0,i.macrosDirty=!0,i.glMaterialState=new qd,r&&(i.shader=new exports.Shader(e),i.shader.shaderData=qn({},r.shader,{id:xi(),dataType:xn.Shader})),i}ji(e,t);var r=e.prototype;return r.enableMacro=function(t,e){this.isMacroEnabled(t)&&this.enabledMacros[t]===e||(this.enabledMacros[t]=null==e||e,this.macrosDirty=!0)},r.disableMacro=function(t){this.isMacroEnabled(t)&&(delete this.enabledMacros[t],this.macrosDirty=!0)},r.isMacroEnabled=function(t){return void 0!==this.enabledMacros[t]},r.initialize=function(){var t=this,e=this.engine;this.createShaderVariant(),this.shaderVariant.initialize(),this.initialized||(e.addMaterial(this),Object.keys(this.textures).forEach((function(e){var r=t.textures[e];di(r.initialize)?r.initialize():ci.error("Failed to initialize texture: "+JSON.stringify(r)+". Ensure the texture conforms to the expected format.")})),this.initialized=!0)},r.createShaderVariant=function(){(this.shaderDirty||this.macrosDirty)&&(this.shaderVariant=this.shader.createVariant(this.enabledMacros),this.macrosDirty=!1,this.shaderDirty=!1,this.uniformDirty=!0)},r.setupStates=function(t){this.glMaterialState.apply(t)},r.use=function(t,e){var r=t.engine,i=this.shaderVariant;if(i.program){var n;if(i.program.bind(),this.setupStates(r),e){for(var o,a=pr(e.uniforms);!(o=a()).done;)n=o.value,this.checkUniform(n);for(var s,u=pr(e.samplers);!(s=u()).done;)n=s.value,this.samplers.includes(n)||(this.samplers.push(n),this.uniformDirty=!0)}if(this.uniformDirty&&(i.fillShaderInformation(this.uniforms,this.samplers),this.uniformDirty=!1),e){for(n in e.floats)i.setFloat(n,e.floats[n]);for(n in e.ints)i.setInt(n,e.ints[n]);for(n in e.vector4s)i.setVector4(n,e.vector4s[n]);for(n in e.vector3s)i.setVector3(n,e.vector3s[n]);for(n in e.matrices)i.setMatrix(n,e.matrices[n])}for(n in this.textures)this.textures[n].textureBuffer||this.textures[n].initialize();for(n in this.floats)i.setFloat(n,this.floats[n]);for(n in this.ints)i.setInt(n,this.ints[n]);for(n in this.floatArrays)i.setFloats(n,this.floatArrays[n]);for(n in this.textures)i.setTexture(n,this.textures[n]);for(n in this.vector2s)i.setVector2(n,this.vector2s[n]);for(n in this.vector3s)i.setVector3(n,this.vector3s[n]);for(n in this.vector4s)i.setVector4(n,this.vector4s[n]);for(n in this.colors)i.setColor(n,this.colors[n]);for(n in this.quaternions)i.setQuaternion(n,this.quaternions[n]);for(n in this.matrices)i.setMatrix(n,this.matrices[n]);for(n in this.matrice3s)i.setMatrix3(n,this.matrice3s[n]);for(n in this.vector4Arrays)i.setVector4Array(n,this.vector4Arrays[n]);for(n in this.matrixArrays)i.setMatrixArray(n,this.matrixArrays[n])}else{var c;null==(c=this.engine)||c.renderErrors.add(new Error("Shader program is not initialized."))}},r.getFloat=function(t){return this.floats[t]},r.setFloat=function(t,e){this.checkUniform(t),this.floats[t]=e},r.getInt=function(t){return this.ints[t]},r.setInt=function(t,e){this.checkUniform(t),this.ints[t]=e},r.getFloats=function(t){return this.floatArrays[t]},r.setFloats=function(t,e){this.checkUniform(t),this.floatArrays[t]=e},r.getVector2=function(t){return this.vector2s[t]},r.setVector2=function(t,e){this.checkUniform(t),this.vector2s[t]=e},r.getVector3=function(t){return this.vector3s[t]},r.setVector3=function(t,e){this.checkUniform(t),this.vector3s[t]=e},r.getVector4=function(t){return this.vector4s[t]},r.setVector4=function(t,e){this.checkUniform(t),this.vector4s[t]=e},r.getColor=function(t){return this.colors[t]},r.setColor=function(t,e){this.checkUniform(t),this.colors[t]=e},r.getQuaternion=function(t){return this.quaternions[t]},r.setQuaternion=function(t,e){this.checkUniform(t),this.quaternions[t]=e},r.getMatrix=function(t){return this.matrices[t]},r.setMatrix=function(t,e){this.checkUniform(t),this.matrices[t]=e},r.setMatrix3=function(t,e){this.checkUniform(t),this.matrice3s[t]=e},r.getVector4Array=function(t){return this.vector4Arrays[t]},r.setVector4Array=function(t,e){this.checkUniform(t),this.vector4Arrays[t]=[];for(var r,i=pr(e);!(r=i()).done;){var n=r.value;this.vector4Arrays[t].push(n.x,n.y,n.z,n.w)}},r.getMatrixArray=function(t){return this.matrixArrays[t]},r.setMatrixArray=function(t,e){this.checkUniform(t),this.matrixArrays[t]=[];for(var r,i=pr(e);!(r=i()).done;)for(var n=r.value,o=0;o<16;o++)this.matrixArrays[t].push(n.elements[o])},r.setMatrixNumberArray=function(t,e){this.checkUniform(t),this.matrixArrays[t]=e},r.getTexture=function(t){return this.textures[t]},r.setTexture=function(t,e){this.samplers.includes(t)||(this.samplers.push(t),this.uniformDirty=!0),this.textures[t]=e},r.hasUniform=function(t){return this.uniforms.includes(t)||this.samplers.includes(t)},r.clone=function(t){var r=t||this.props,i=this.engine;oi(i);var n=new e(i,r);return n.glMaterialState=Object.assign(new qd,n.glMaterialState),n.floats=this.floats,n.ints=this.ints,n.vector2s=this.vector2s,n.vector3s=this.vector3s,n.vector4s=this.vector4s,n.colors=this.colors,n.quaternions=this.quaternions,n.matrices=this.matrices,n.textures=this.textures,n.floatArrays=this.floatArrays,n.vector4Arrays=this.vector4Arrays,n.matrixArrays=this.matrixArrays,n.samplers=this.samplers,n.uniforms=this.uniforms,n.uniformDirty=!0,n},r.fromData=function(e){t.prototype.fromData.call(this,e),this.uniforms=[],this.samplers=[],this.textures={},this.floats={},this.ints={},this.floatArrays={},this.vector4s={};var r=qn({},e);void 0!==e.stringTags.RenderType&&(this.blending=e.stringTags.RenderType===zi.Transparent),void 0!==e.floats.ZTest&&(this.depthTest=0!==e.floats.ZTest),void 0!==e.floats.ZWrite&&(this.depthMask=0!==e.floats.ZWrite);var i,n,o=e.stringTags.RenderFace;for(i in o===Gi.Front?(this.culling=!0,this.cullFace=ko.BACK):o===Gi.Back?(this.culling=!0,this.cullFace=ko.FRONT):this.culling=!1,r.floats)this.setFloat(i,r.floats[i]);for(i in r.ints)this.setInt(i,r.ints[i]);for(i in r.vector4s){var a=r.vector4s[i];this.setVector4(i,new Vr(a.x,a.y,a.z,a.w))}for(i in r.colors){var s=r.colors[i];this.setColor(i,new Br(s.r,s.g,s.b,s.a))}for(i in r.textures){var u=r.textures[i],c=this.engine.findObject(u.texture);this.setTexture(i,c);var h=u.offset,l=u.scale;h&&l&&this.setVector4(i+"_ST",new Kd(l.x,l.y,h.x,h.y))}if(e.shader){var f=this.engine.findObject(e.shader);f&&(this.shader=f,this.shaderSource=f.shaderData)}this.stringTags=null!=(n=e.stringTags)?n:{},this.initialized=!1},r.toData=function(){var t=this.defination;for(var e in this.shader&&(t.shader=this.shader),t.floats={},t.ints={},t.vector4s={},t.colors={},t.textures={},t.dataType=xn.Material,t.stringTags=this.stringTags,this.floats)t.floats[e]=this.floats[e];for(var r in this.ints)t.ints[r]=this.ints[r];for(var i in this.vector4s)t.vector4s[i]=this.vector4s[i];for(var n in this.colors)t.colors[n]=this.colors[n];for(var o in this.textures){t.textures[o]||(t.textures[o]={texture:this.textures[o]});var a=t.textures[o],s=this.getVector4(o+"_ST");s&&(a.scale={x:s.x,y:s.y},a.offset={x:s.z,y:s.w},delete t.vector4s[o+"_ST"])}return t},r.cloneUniforms=function(t){var e,r=t;for(e in r.floats)this.setFloat(e,r.floats[e]);for(e in r.ints)this.setInt(e,r.ints[e]);for(e in r.floatArrays)this.setFloats(e,r.floatArrays[e]);for(e in r.textures)this.setTexture(e,r.textures[e]);for(e in r.vector2s)this.setVector2(e,r.vector2s[e]);for(e in r.vector3s)this.setVector3(e,r.vector3s[e]);for(e in r.vector4s)this.setVector4(e,r.vector4s[e]);for(e in r.colors)this.setColor(e,r.colors[e]);for(e in r.quaternions)this.setQuaternion(e,r.quaternions[e]);for(e in r.matrices)this.setMatrix(e,r.matrices[e]);for(e in r.vector4Arrays){for(var i=[],n=0;n<r.vector4Arrays[e].length;n+=4)i.push(new Kd(r.vector4Arrays[e][n],r.vector4Arrays[e][n+1],r.vector4Arrays[e][n+2],r.vector4Arrays[e][n+3]));this.setVector4Array(e,i)}for(e in r.matrixArrays){for(var o=[],a=0;a<r.matrixArrays[e].length;a+=16){for(var s=Qd.fromIdentity(),u=0;u<16;u++)s.elements[u]=r.matrixArrays[e][a+u];o.push(s)}this.setMatrixArray(e,o)}},r.checkUniform=function(t){this.uniforms.includes(t)||(this.uniforms.push(t),this.uniformDirty=!0)},r.dispose=function(){var e;this.destroyed||(null==(e=this.shaderVariant)||e.dispose(),this.textures={},this.shaderSource=null,this.floats={},this.ints={},this.vector2s={},this.vector3s={},this.vector4s={},this.quaternions={},this.matrices={},this.matrice3s={},this.textures={},this.floatArrays={},this.vector4Arrays={},this.matrixArrays={},this.samplers=[],this.uniforms=[],this.initialize=gi,this.destroyed=!0,void 0!==this.engine&&this.engine.removeMaterial(this),t.prototype.dispose.call(this))},Io(e,[{key:"blending",get:function(){return this.glMaterialState.blending},set:function(t){void 0!==t&&this.glMaterialState.setBlending(t)}},{key:"blendColor",get:function(){return this.glMaterialState.blendColor},set:function(t){t&&this.glMaterialState.setBlendColor(t)}},{key:"blendFunction",get:function(){return this.glMaterialState.blendFunctionParameters},set:function(t){t&&this.glMaterialState.setBlendFunctionParameters(t)}},{key:"blendEquation",get:function(){return this.glMaterialState.blendEquationParameters},set:function(t){t&&this.glMaterialState.setBlendEquationParameters(t)}},{key:"depthTest",get:function(){return this.glMaterialState.depthTest},set:function(t){void 0!==t&&this.glMaterialState.setDepthTest(t)}},{key:"depthMask",get:function(){return this.glMaterialState.depthMask},set:function(t){void 0!==t&&this.glMaterialState.setDepthMask(t)}},{key:"depthRange",get:function(){return this.glMaterialState.depthRange},set:function(t){t&&this.glMaterialState.setDepthRange(t)}},{key:"depthFunc",get:function(){return this.glMaterialState.depthFunc},set:function(t){void 0!==t&&this.glMaterialState.setDepthFunc(t)}},{key:"polygonOffsetFill",get:function(){return this.glMaterialState.polygonOffsetFill},set:function(t){void 0!==t&&this.glMaterialState.setPolygonOffsetFill(t)}},{key:"polygonOffset",get:function(){return this.glMaterialState.polygonOffset},set:function(t){t&&this.glMaterialState.setPolygonOffset(t)}},{key:"sampleAlphaToCoverage",get:function(){return this.glMaterialState.sampleAlphaToCoverage},set:function(t){void 0!==t&&this.glMaterialState.setSampleAlphaToCoverage(t)}},{key:"colorMask",get:function(){return this.glMaterialState.colorMask[0]},set:function(t){this.glMaterialState.setColorMask(t)}},{key:"stencilTest",get:function(){return this.glMaterialState.stencilTest},set:function(t){void 0!==t&&this.glMaterialState.setStencilTest(t)}},{key:"stencilMask",get:function(){return this.glMaterialState.stencilMask},set:function(t){t&&this.glMaterialState.setStencilMask(t)}},{key:"stencilRef",get:function(){return this.glMaterialState.stencilRef},set:function(t){t&&this.glMaterialState.setStencilRef(t)}},{key:"stencilFunc",get:function(){return this.glMaterialState.stencilFunc},set:function(t){t&&this.glMaterialState.setStencilFunc(t)}},{key:"stencilOpFail",get:function(){return this.glMaterialState.stencilOpFail},set:function(t){t&&this.glMaterialState.setStencilOpFail(t)}},{key:"stencilOpZFail",get:function(){return this.glMaterialState.stencilOpZFail},set:function(t){t&&this.glMaterialState.setStencilOpZFail(t)}},{key:"stencilOpZPass",get:function(){return this.glMaterialState.stencilOpZPass},set:function(t){t&&this.glMaterialState.setStencilOpZPass(t)}},{key:"culling",get:function(){return this.glMaterialState.culling},set:function(t){void 0!==t&&this.glMaterialState.setCulling(t)}},{key:"frontFace",get:function(){return this.glMaterialState.frontFace},set:function(t){void 0!==t&&this.glMaterialState.setFrontFace(t)}},{key:"cullFace",get:function(){return this.glMaterialState.cullFace},set:function(t){void 0!==t&&this.glMaterialState.setCullFace(t)}},{key:"isDestroyed",get:function(){return this.destroyed}}]),e}(Pa),$d=function(){function t(t){if(this.renderer=t,1===t.engine.gpuCapability.level){this.copyRenderPass=this.createCopyRenderPass().initialize(t);var e=this.copyRenderPass.meshes[0].material.shaderSource;t.engine.shaderLibrary.addShader(e)}}var e=t.prototype;return e.resetColorAttachments=function(t,e){this.renderer&&t.resetColorAttachments(e)},e.copyTexture=function(t,e){this.renderer&&(t.initialize(),e.initialize(),e.updateSource({sourceType:exports.TextureSourceType.framebuffer,data:{width:e.getWidth()||t.getWidth(),height:e.getHeight()||t.getHeight()}}),2===this.renderer.engine.gpuCapability.level?this.copy2(t,e):this.copy1(t,e))},e.copy2=function(t,e){var r=this.renderer.getFramebuffer();this.renderer.glRenderer.copy2(t,e),this.renderer.setFramebuffer(r)},e.copy1=function(t,e){var r=this.copyRenderPass;if(r){var i=this.renderer;if(i){var n=r.framebuffer;n.viewport[2]=e.getWidth()||t.getWidth(),n.viewport[3]=e.getHeight()||t.getHeight(),i.glRenderer.resetColorAttachments(n,[e]),r.meshes[0].material.setTexture("uTex",t),i.renderRenderPass(r)}}},e.createCopyRenderPass=function(){var t="mri-copy-mesh",e={texture:{format:ko.RGBA}},r=this.renderer.engine,i=new Yd(r,{name:t,mode:ko.TRIANGLE_STRIP,attributes:{aPos:{type:ko.FLOAT,size:2,data:new Float32Array([-1,1,-1,-1,1,1,1,-1])}},drawCount:4}),n=r.gpuCapability.level,o=new Jd(r,{name:t,shader:{cacheId:"$mri-internal-copy",name:t,vertex:"\nprecision highp float;\nattribute vec2 aPos;\nvarying vec2 vTex;\nvoid main(){\n  gl_Position = vec4(aPos,0.,1.0);\n  vTex = (aPos + vec2(1.))/2.;\n}",fragment:"\nprecision highp float;\nvarying vec2 vTex;\nuniform sampler2D uTex;\nvoid main(){\n  gl_FragColor = texture2D(uTex,vTex);\n}",glslVersion:2===n?exports.GLSLVersion.GLSL3:exports.GLSLVersion.GLSL1}});o.blending=!1,o.depthTest=!1,o.culling=!1;var a=new ts(r,{name:t,geometry:i,material:o,priority:0});return new tp(this.renderer,{name:"mri-copy-rp",clearAction:{colorAction:exports.TextureLoadAction.whatever},attachments:[e],meshes:[a]})},e.dispose=function(){var t;this.renderer&&(null==(t=this.copyRenderPass)||t.dispose(),this.renderer=void 0)},t}(),tp=function(t){function e(){return t.apply(this,arguments)}ji(e,t);var r=e.prototype;return r.configure=function(t){this.currentFramebuffer=t.getFramebuffer(),t.setFramebuffer(this.framebuffer)},r.execute=function(t){this.clearAction&&t.clear(this.clearAction),t.renderMeshes(this.meshes),this.storeAction&&t.clear(this.storeAction),t.setFramebuffer(this.currentFramebuffer)},e}(is),ep=function(){function t(t,e,r){var i=this;void 0===e&&(e="webgl"),void 0===r&&(r={}),this.canvas=t,this.glType=e,this.restoreHandlers=[],this.lostHandlers=[],oi(t),this.gl=Vo(t,e,r),this.contextLostListener=function(t){for(var e,r,n=pr(i.lostHandlers);!(r=n()).done;)r.value.lost(t);null==(e=i.canvas)||e.removeEventListener("webglcontextlost",i.contextLostListener)},this.contextRestoredListener=function(t){for(var e,r,n=pr(i.restoreHandlers);!(r=n()).done;)r.value.restore();null==(e=i.canvas)||e.addEventListener("webglcontextlost",i.contextLostListener)},t.addEventListener("webglcontextlost",this.contextLostListener),t.addEventListener("webglcontextrestored",this.contextRestoredListener)}var e=t.prototype;return e.dispose=function(){this.canvas&&(this.canvas.removeEventListener("webglcontextlost",this.contextLostListener),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredListener)),this.gl=null,this.canvas=null},e.addLostHandler=function(t){this.lostHandlers.push(t)},e.removeLostHandler=function(t){var e=this.lostHandlers.indexOf(t);e>-1&&this.lostHandlers.splice(e,1)},e.addRestoreHandler=function(t){this.restoreHandlers.push(t)},e.removeRestoreHandler=function(t){var e=this.restoreHandlers.indexOf(t);e>-1&&this.restoreHandlers.splice(e,1)},t}(),rp=function(){function t(t,e,r){this.engine=t,this.program=e,this.id=r,this.engine.useProgram(e),this.attribInfoMap=this.createAttribMap(),this.engine.useProgram(null)}var e=t.prototype;return e.bind=function(){this.engine.useProgram(this.program)},e.setupAttributes=function(t){var e,r,i=this,n=this.id,o=this.engine.gl;return t.vaos[n]?r=t.vaos[n]:((r=new Vd(this.engine,t.name+"-"+n))||console.error("Failed to create VAO object."),t.vaos[n]=r),r&&r.vao&&(r.bind(),r.ready)||(Object.keys(this.attribInfoMap).forEach((function(e){var r=i.attribInfoMap[e],n=t.attributes[e];if(n){var a=t.buffers[n.dataSource];if(!a)throw new Error("Failed to find a buffer named '"+(n.dataSource||e)+"'. Please ensure the buffer is correctly initialized and bound.");a.bind(),o.enableVertexAttribArray(r.loc),o.vertexAttribPointer(r.loc,n.size,n.type,n.normalize,n.stride||0,n.offset||0)}})),null==(e=t.indicesBuffer)||e.bind(),r&&(r.ready=!0)),r},e.createAttribMap=function(){for(var t=this.engine.gl,e=this.program,r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=0;n<i;n++){var o=t.getActiveAttrib(e,n);if(o){var a=o.name,s=o.type,u=o.size,c=t.getAttribLocation(e,a);r[a]={type:s,name:a,size:u,loc:c}}}return r},e.dispose=function(){this.engine&&this.engine.gl.deleteProgram(this.program)},t}(),ip=function(t){function e(e,r){var i;return(i=t.call(this,e,r)||this).initialized=!1,i.uniformLocations={},i.samplerChannels={},i}ji(e,t);var r=e.prototype;return r.initialize=function(){this.initialized||this.engine.shaderLibrary.compileShader(this)},r.setFloat=function(t,e){this.engine.setFloat(this.uniformLocations[t],e)},r.setInt=function(t,e){this.engine.setInt(this.uniformLocations[t],e)},r.setFloats=function(t,e){this.engine.setFloats(this.uniformLocations[t],e)},r.setTexture=function(t,e){this.engine.setTexture(this.uniformLocations[t],this.samplerChannels[t],e)},r.setVector2=function(t,e){this.engine.setVector2(this.uniformLocations[t],e)},r.setVector3=function(t,e){this.engine.setVector3(this.uniformLocations[t],e)},r.setVector4=function(t,e){this.engine.setVector4(this.uniformLocations[t],e)},r.setColor=function(t,e){this.engine.setColor(this.uniformLocations[t],e)},r.setQuaternion=function(t,e){this.engine.setQuaternion(this.uniformLocations[t],e)},r.setMatrix=function(t,e){this.engine.setMatrix(this.uniformLocations[t],e)},r.setMatrix3=function(t,e){this.engine.setMatrix3(this.uniformLocations[t],e)},r.setVector4Array=function(t,e){this.engine.setVector4Array(this.uniformLocations[t],e)},r.setMatrixArray=function(t,e){this.engine.setMatrixArray(this.uniformLocations[t],e)},r.fillShaderInformation=function(t,e){var r=e.slice();t=t.concat(r);for(var i,n=this.engine.getUniforms(this.program.program,t),o=0;o<t.length;o++)this.uniformLocations[t[o]]=n[o];for(i=0;i<r.length;i++)null==this.uniformLocations[r[i]]&&(r.splice(i,1),i--);for(i=0;i<r.length;i++){var a=r[i];this.samplerChannels[a]=i}},r.toData=function(){var t=this.defination;t.dataType=xn.Shader,t.id=this.guid,t.vertex=this.source.vertex,t.fragment=this.source.fragment},r.dispose=function(){var e;this.compileResult&&this.compileResult.shared||(null==(e=this.program)||e.dispose(),t.prototype.dispose.call(this))},e}(wa),np=0,op=function(){function t(t){this.engine=t,this.shaderResults={},this.programMap={},this.glVertShaderMap=new Map,this.glFragShaderMap=new Map,this.shaderAllDone=!1,this.cachedShaders={},this.glAsyncCompileExt=t.gpuCapability.glAsyncCompileExt}var e=t.prototype;return e.compileAllShaders=function(t){var e=this;if(this.shaderAllDone)t&&t([]);else{for(var r,i=[],n=pr(Object.keys(this.cachedShaders));!(r=n()).done;){var o=r.value;this.cachedShaders[o].initialized||i.push(o)}t?i.length?Promise.all(i.map((function(t){return new Promise((function(r){return e.compileShader(e.cachedShaders[t],r)}))}))).then(t).catch((function(){return 0})):t([]):i.map((function(t){return e.compileShader(e.cachedShaders[t])})),this.shaderAllDone=!0}},e.addShader=function(t,e){var r,i,n=[];t.macros&&(r=n).push.apply(r,[].concat(t.macros)),e&&(i=n).push.apply(i,[].concat(e));var o=qn({},t,{vertex:vs.genFinalShaderCode({level:this.engine.gpuCapability.level,shaderType:exports.ShaderType.vertex,shader:t.vertex,macros:n}),fragment:vs.genFinalShaderCode({level:this.engine.gpuCapability.level,shaderType:exports.ShaderType.fragment,shader:t.fragment,macros:n})}),a=this.computeShaderCacheId(o);if(this.cachedShaders[a])return a;this.shaderAllDone=!1;var s=!1;return(o.shared||o.cacheId)&&(s=!0),this.cachedShaders[a]=new ip(this.engine,qn({},o,{vertex:o.vertex,fragment:o.fragment,name:o.name||a,shared:s})),this.cachedShaders[a].id=a,a},e.createShader=function(t,e){var r=this.addShader(t,e);return this.cachedShaders[r]},e.compileShader=function(t,e){var i=this,n=t.source,o=n.shared,a=n.vertex,s=n.fragment,u=n.name,c=t.source.cacheId,h=!1;(o||c)&&(h=!0);var l=this.engine.gl,f={shared:h,status:exports.ShaderCompileResultStatus.compiling},d=this.createProgram(l,a,s,f),p=this.glAsyncCompileExt,m=r.performance.now(),v=function(e){f.status=exports.ShaderCompileResultStatus.success,f.compileTime=r.performance.now()-m,t.program=e,t.initialized=!0,void 0!==i.programMap[t.id]&&console.warn("Find duplicated shader id: "+t.id+"."),i.programMap[t.id]=e},y=function(){if(i.engine.isDestroyed)return console.warn("The player is destroyed during the loadScene process. Please check the timing of calling loadScene and dispose. A common situation is that when calling loadScene, await is not added. This will cause dispose to be called before loadScene is completed."),null==e?void 0:e(f);if(t.initialized)return null==e?void 0:e(f);var n=(!e||!p||p&&1==l.getProgramParameter(f.program,p.COMPLETION_STATUS_KHR))&&d();if(n){if(f.status!==exports.ShaderCompileResultStatus.fail){kd(n,u);var o=new rp(i.engine,n,t.id);if(l.validateProgram(n),l.getProgramParameter(n,l.VALIDATE_STATUS))v(o);else{var c=l.getProgramInfoLog(n);(null==c?void 0:c.includes("the same texture"))||(null==c?void 0:c.includes("Two textures of different types use the same sampler"))?v(o):(f.status=exports.ShaderCompileResultStatus.fail,f.error=c,console.error("compileProgramError: "+c,"\nvertex:\n",a,"\nfragment:\n",s),l.deleteProgram(n))}}null==e||e(f)}else e&&r.requestAnimationFrame(y)};t.compileResult=f,y()},e.computeShaderCacheId=function(t){var e=t.vertex,r=void 0===e?"":e,i=t.fragment,n=void 0===i?"":i,o=t.shared,a=t.cacheId;return o||a?a||"shared_"+sp(r,n):"instanced_"+np++},e.createProgram=function(t,e,r,i){var n=t.createProgram(),o=this.createGLShader(t,t.VERTEX_SHADER,e),a=this.createGLShader(t,t.FRAGMENT_SHADER,r);return n&&o&&a?(t.attachShader(n,o),t.attachShader(n,a),t.linkProgram(n),i.program=n,i.status=exports.ShaderCompileResultStatus.compiling,function(){if(i.program=void 0,!t.getProgramParameter(n,t.LINK_STATUS)){var s=t.getProgramInfoLog(n);console.error("Failed to link program: "+s+".");var u=ap(t,o,"vertex",e),c=ap(t,a,"fragment",r);return i.status=exports.ShaderCompileResultStatus.fail,u&&(i.error=u.error,i.status=u.status),c&&(i.error=c.error,i.status=c.status),n}return n}):(i.status=exports.ShaderCompileResultStatus.fail,function(){return null})},e.createGLShader=function(t,e,r){var i=e===t.VERTEX_SHADER?this.glVertShaderMap:this.glFragShaderMap,n=sp(null!=r?r:""),o=i.get(n);if(o)return o;var a=t.createShader(e);return a&&(t.shaderSource(a,r),t.compileShader(a),i.set(n,a)),a},e.deleteShader=function(t){var e=this.programMap[t];void 0!==e&&(e.dispose(),delete this.programMap[t]),void 0!==this.shaderResults[t]&&delete this.shaderResults[t]},e.restore=function(){},e.dispose=function(){var t=this;if(Object.keys(this.programMap).forEach((function(e){t.programMap[e].dispose()})),this.programMap={},this.engine){var e=this.engine.gl;this.glFragShaderMap.forEach((function(t){e.deleteShader(t)})),this.glVertShaderMap.forEach((function(t){e.deleteShader(t)})),this.glVertShaderMap=new Map,this.glFragShaderMap=new Map}},t}();function ap(t,e,r,i){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(e);return console.error("compile "+r+" error: "+n,(null!=i?i:"").split("\n").map((function(t,e){return e+1+" "+t})).join("\n")),{error:n,status:exports.ShaderCompileResultStatus.fail}}}function sp(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var i=0,n=0;n<arguments.length;n++)for(var o=e[n],a=0;a<o.length;a++)i=Math.imul(31,i)+o.charCodeAt(a)|0;return i}var up=function(t){function e(e){var r;return(r=t.call(this)||this).gl=e,r.gpuCapability=new Os(e),r.gl=e,r.shaderLibrary=new op(ac(r)),r.maxTextureCount=r.gl.TEXTURE0+r.gl.getParameter(r.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)-1,r.reset(),r}ji(e,t);var r=e.prototype;return r.dispose=function(){this.destroyed||(t.prototype.dispose.call(this),this.shaderLibrary.dispose(),this.reset())},r.getGLRenderer=function(){return this.renderer},r.getGLRendererInternal=function(){return this.getGLRenderer().glRenderer},r.reset=function(){this.glCapabilityCache={},this.activeTextureIndex=ko.TEXTURE0,this.textureUnitDict={},this.currentFramebuffer={},this.pixelStorei={},this.currentRenderbuffer={}},r.toggle=function(t,e){e?this.enable(t):this.disable(t)},r.enable=function(t){!0!==this.glCapabilityCache[t]&&(this.glCapabilityCache[t]=!0,this.gl.enable(t))},r.disable=function(t){!1!==this.glCapabilityCache[t]&&(this.glCapabilityCache[t]=!1,this.gl.disable(t))},r.bindFramebuffer=function(t,e){this.currentFramebuffer[t]!==e&&(this.currentFramebuffer[t]=e,this.gl.bindFramebuffer(t,e))},r.bindRenderbuffer=function(t,e){this.currentRenderbuffer[t]!==e&&(this.currentRenderbuffer[t]=e,this.gl.bindRenderbuffer(t,e))},r.bindSystemFramebuffer=function(){this.bindFramebuffer(this.gl.FRAMEBUFFER,null)},r.useProgram=function(t){this.set1("useProgram",t)},r.clear=function(t){this.gl.clear(t)},r.clearDepth=function(t){this.set1("clearDepth",t)},r.depthFunc=function(t){this.set1("depthFunc",t)},r.depthMask=function(t){this.set1("depthMask",t)},r.polygonOffset=function(t,e){this.set2("polygonOffset",t,e)},r.depthRange=function(t,e){this.set2("depthRange",t,e)},r.clearStencil=function(t){this.set1("clearStencil",t)},r.stencilMask=function(t){this.stencilMaskSeparate(this.gl.FRONT,t),this.stencilMaskSeparate(this.gl.BACK,t)},r.stencilFunc=function(t,e,r){this.stencilFuncSeparate(this.gl.FRONT,t,e,r),this.stencilFuncSeparate(this.gl.BACK,t,e,r)},r.stencilFuncSeparate=function(t,e,r,i){this.set4("stencilFuncSeparate",t,e,r,i)},r.stencilMaskSeparate=function(t,e){this.set2("stencilMaskSeparate",t,e)},r.stencilOp=function(t,e,r){this.stencilOpSeparate(this.gl.FRONT,t,e,r),this.stencilOpSeparate(this.gl.BACK,t,e,r)},r.stencilOpSeparate=function(t,e,r,i){this.set4("stencilOpSeparate",t,e,r,i)},r.cullFace=function(t){this.set1("cullFace",t)},r.frontFace=function(t){this.set1("frontFace",t)},r.clearColor=function(t,e,r,i){this.set4("clearColor",t,e,r,i)},r.colorMask=function(t,e,r,i){this.set4("colorMask",t,e,r,i)},r.blendColor=function(t,e,r,i){this.set4("blendColor",t,e,r,i)},r.blendFunc=function(t,e){this.blendFuncSeparate(t,e,t,e)},r.blendFuncSeparate=function(t,e,r,i){this.set4("blendFuncSeparate",t,e,r,i)},r.blendEquation=function(t){this.set1("blendEquation",t)},r.blendEquationSeparate=function(t,e){this.set2("blendEquationSeparate",t,e)},r.setPixelStorei=function(t,e){this.pixelStorei[t]!==e&&(this.pixelStorei[t]=e,this.gl.pixelStorei(t,e))},r.viewport=function(t,e,r,i){this.set4("viewport",t,e,r,i)},r.activeTexture=function(t){t=Math.min(t,this.maxTextureCount),this.activeTextureIndex!==t&&(this.activeTextureIndex=t,this.gl.activeTexture(t))},r.bindTexture=function(t,e,r){(this.currentTextureBinding!==e||r)&&(this.gl.bindTexture(t,e),this.currentTextureBinding=e),this.textureUnitDict[this.activeTextureIndex]=e},r.set1=function(t,e){this.glCapabilityCache[t]!==e&&(this.glCapabilityCache[t]=e,this.gl[t](e))},r.set2=function(t,e,r){var i=this.glCapabilityCache[t];i||(i=this.glCapabilityCache[t]={x:NaN,y:NaN}),i.x===e&&i.y===r||this.gl[t](i.x=e,i.y=r)},r.set3=function(t,e,r,i){var n=this.glCapabilityCache[t];n||(n=this.glCapabilityCache[t]={x:NaN,y:NaN,z:NaN}),n.x===e&&n.y===r&&n.z===i||this.gl[t](n.x=e,n.y=r,n.z=i)},r.set4=function(t,e,r,i,n){var o=this.glCapabilityCache[t];o||(o=this.glCapabilityCache[t]={x:NaN,y:NaN,z:NaN,w:NaN}),o.x===e&&o.y===r&&o.z===i&&o.w===n||this.gl[t](o.x=e,o.y=r,o.z=i,o.w=n)},r.get=function(t){return this.glCapabilityCache[t]},r.setFloat=function(t,e){t&&this.gl.uniform1f(t,e)},r.setInt=function(t,e){t&&this.gl.uniform1i(t,e)},r.setFloats=function(t,e){t&&this.gl.uniform1fv(t,e)},r.setVector2=function(t,e){this.setFloat2(t,e.x,e.y)},r.setVector3=function(t,e){this.setFloat3(t,e.x,e.y,e.z)},r.setVector4=function(t,e){this.setFloat4(t,e.x,e.y,e.z,e.w)},r.setColor=function(t,e){this.setFloat4(t,e.r,e.g,e.b,e.a)},r.setQuaternion=function(t,e){this.setFloat4(t,e.x,e.y,e.z,e.w)},r.setVector4Array=function(t,e){t&&e.length%4==0&&this.gl.uniform4fv(t,e)},r.setMatrix=function(t,e){t&&this.gl.uniformMatrix4fv(t,!1,e.elements)},r.setMatrix3=function(t,e){t&&this.gl.uniformMatrix3fv(t,!1,e.elements)},r.setMatrixArray=function(t,e){t&&e.length%16==0&&this.gl.uniformMatrix4fv(t,!1,e)},r.setTexture=function(t,e,r){if(t){this.gl.activeTexture(this.gl.TEXTURE0+e);var i=r.target;this.gl.bindTexture(i,r.textureBuffer),this.gl.uniform1i(t,e)}},r.getUniforms=function(t,e){for(var r=[],i=0;i<e.length;i++)r.push(this.gl.getUniformLocation(t,e[i]));return r},r.setFloat4=function(t,e,r,i,n){t&&this.gl.uniform4f(t,e,r,i,n)},r.setFloat3=function(t,e,r,i){t&&this.gl.uniform3f(t,e,r,i)},r.setFloat2=function(t,e,r){t&&this.gl.uniform2f(t,e,r)},e}(Pd),cp=function(t){function e(e,r){var i;return(i=t.call(this,e)||this).initialized=!1,void 0!==r&&i.initialize(r),i}ji(e,t);var r=e.prototype;return r.initialize=function(t){this.initialized||(this.initialized=!0,this.renderer=t,this.buffer=t.createGLRenderbuffer(this))},r.setSize=function(t,e){if(this.initialized){if(this.renderer&&(t!==this.size[0]||e!==this.size[1])){var r=this.renderer,i=r.gl;r.engine.bindRenderbuffer(i.RENDERBUFFER,this.buffer),t&&e?i.renderbufferStorage(i.RENDERBUFFER,this.format,this.size[0]=t,this.size[1]=e):ci.error("Invalid render buffer size: "+t+"x"+e+".")}}else ci.error("Can't set size for uninitialized render buffer.")},r.dispose=function(){this.renderer&&(this.renderer.deleteGLRenderbuffer(this),this.renderer=null,this.buffer=null),this.destroyed=!0,this.initialize=gi},e}(Cs),hp=1,lp=function(t){function e(e,r){var i;(i=t.call(this)||this).attachmentTextures=[];var n,o=e.depthStencilAttachment,a=e.viewport,s=e.isCustomViewport,u=e.storeAction,c=e.viewportScale,h=void 0===c?1:c,l=e.name,f=void 0===l?"GLFramebuffer"+hp++:l;return i.renderer=r,i.engine=r.engine,i.depthStencilStorageType=null!=(n=null==o?void 0:o.storageType)?n:exports.RenderPassAttachmentStorageType.none,i.viewport=a,i.isCustomViewport=!!s,i.viewportScale=h,i.name=f,i.storeAction=u,i.updateProps(e),i}ji(e,t);var r=e.prototype;return r.getDepthTexture=function(){return this.depthTexture},r.getStencilTexture=function(){return this.stencilTexture},r.getColorTextures=function(){return this.colorTextures},r.updateAttachmentTextures=function(){var t=this;this.attachmentTextures.length=0,this.colorTextures.forEach((function(e){e.initialize(),Sr(t.attachmentTextures,e.textureBuffer)})),this.stencilTexture&&Sr(this.attachmentTextures,this.stencilTexture.textureBuffer),this.depthTexture&&Sr(this.attachmentTextures,this.depthTexture.textureBuffer)},r.updateProps=function(t){var e,r,i=this.renderer,n=this.engine.gpuCapability,o=null!=(r=t.depthStencilAttachment)?r:{storageType:exports.RenderPassAttachmentStorageType.none},a=t.attachments.length>0,s=!0;if(this.externalStorage=!1,t.attachments.length>1&&!n.detail.drawBuffers)throw new Error("Multiple color attachments not support.");var u=null==(e=t.depthStencilAttachment)?void 0:e.texture,c=n.detail.readableDepthStencilTextures,h=o.storageType,l=o.storage;if(this.colorTextures=t.attachments.slice(),!a&&h!==exports.RenderPassAttachmentStorageType.none)throw new Error("Use depth stencil attachment without color attachments.");switch(a&&(this.fbo=i.glRenderer.createGLFramebuffer(this,this.name)),h){case exports.RenderPassAttachmentStorageType.depth_stencil_opaque:if(l){if(!mr(l,cp))throw new Error("Invalid depth stencil attachment storage.");this.depthStencilRenderbuffer=l,this.externalStorage=!0}else this.depthStencilRenderbuffer=new cp({format:ko.DEPTH_STENCIL,attachment:ko.DEPTH_STENCIL_ATTACHMENT,storageType:h},i.glRenderer);s=!1;break;case exports.RenderPassAttachmentStorageType.depth_16_opaque:if(l){if(!mr(l,cp))throw new Error("Invalid depth attachment storage.");this.depthStencilRenderbuffer=l,this.externalStorage=!0}else this.depthStencilRenderbuffer=new cp({attachment:ko.DEPTH_ATTACHMENT,format:ko.DEPTH_COMPONENT16,storageType:h},i.glRenderer);break;case exports.RenderPassAttachmentStorageType.stencil_8_opaque:if(l){if(!mr(l,cp))throw new Error("Invalid stencil attachment storage.");this.depthStencilRenderbuffer=l,this.externalStorage=!0}else this.depthStencilRenderbuffer=new cp({attachment:ko.STENCIL_ATTACHMENT,format:ko.STENCIL_INDEX8,storageType:h},i.glRenderer);break;case exports.RenderPassAttachmentStorageType.depth_16_texture:if(!c)throw new Error("Depth texture is not support in framebuffer.");this.depthTexture=null!=u?u:new Fd(this.engine,{sourceType:exports.TextureSourceType.framebuffer,format:ko.DEPTH_COMPONENT,internalFormat:n.internalFormatDepth16,type:ko.UNSIGNED_SHORT,name:this.name+"##depthTex"}),this.depthTexture.initialize();break;case exports.RenderPassAttachmentStorageType.depth_24_stencil_8_texture:if(!c)throw new Error("Depth stencil texture is not support in framebuffer.");this.depthTexture=this.stencilTexture=null!=u?u:new Fd(this.engine,{sourceType:exports.TextureSourceType.framebuffer,format:ko.DEPTH_STENCIL,internalFormat:n.internalFormatDepth24_stencil8,type:n.UNSIGNED_INT_24_8,name:this.name+"##dpthStclTex"}),this.depthTexture.initialize(),s=!0}this.storeInvalidAttachments=this.getStoreAttachments(this.storeAction,s),this.updateAttachmentTextures()},r.getStoreAttachments=function(t,e){var r=this.renderer.glRenderer.gl,i=this.colorTextures.length;if(t&&Xo(r)&&i>0){var n=[];if(t.depthAction===exports.TextureStoreAction.clear&&this.depthStorage&&Sr(n,e?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT),t.stencilAction===exports.TextureStoreAction.clear&&this.stencilStorage&&Sr(n,e?r.STENCIL_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT),t.colorAction===exports.TextureStoreAction.clear)for(var o=0;o<i;o++)Sr(n,r["COLOR_ATTACHMENT"+o]);return n}},r.unbind=function(){var t=this.storeInvalidAttachments;if(null==t?void 0:t.length){var e=this.renderer.glRenderer.gl;Xo(e)&&e.invalidateFramebuffer(e.FRAMEBUFFER,t)}this.renderer.engine.bindSystemFramebuffer()},r.bind=function(){var t=this;if(this.fbo){var e=this.renderer.glRenderer.gl,r=this.renderer.engine,i=this.viewport,n=i[0],o=i[1],a=i[2],s=i[3];r.bindFramebuffer(e.FRAMEBUFFER,this.fbo),r.viewport(n,o,a,s);var u=this.renderer.glRenderer.emptyTexture2D.textureBuffer;Object.keys(r.textureUnitDict).forEach((function(e){var i=r.textureUnitDict[e];i&&i!==u&&t.attachmentTextures.includes(i)&&(r.activeTexture(+e),t.renderer.glRenderer.emptyTexture2D.bind())}));for(var c=0;c<4;c++)r.activeTexture(e.TEXTURE0+c),this.renderer.glRenderer.emptyTexture2D.bind();if(!this.ready){var h=this,l=h.depthStencilRenderbuffer,f=h.depthTexture,d=h.stencilTexture;if(r.activeTexture(e.TEXTURE0),l)l.setSize(a,s),e.framebufferRenderbuffer(e.FRAMEBUFFER,l.attachment,e.RENDERBUFFER,l.buffer);else if(f){f.source.data={width:a,height:s},f.update({data:{width:a,height:s,data:new Uint16Array(0)}});var p=f&&d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.framebufferTexture2D(e.FRAMEBUFFER,p,e.TEXTURE_2D,f.textureBuffer,0)}this.resetColorTextures(this.colorTextures);var m=e.checkFramebufferStatus(e.FRAMEBUFFER);if(m!==e.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer failed. gl status="+m+", gl error="+e.getError()+", gl isContextLost="+e.isContextLost()+".");this.ready=!0}}},r.resetColorTextures=function(t){var e=t,r=this.renderer.glRenderer.gl,i=this.engine.gpuCapability,n=this.viewport,o=[];if(e){for(var a,s=pr(e);!(a=s()).done;)a.value.initialize();this.colorTextures=e.slice()}this.renderer.engine.activeTexture(r.TEXTURE0),this.colorTextures.forEach((function(t,e){var a={width:n[2],height:n[3],data:new Uint8Array(0)};t.update({data:a}),i.framebufferTexture2D(r,r.FRAMEBUFFER,e,r.TEXTURE_2D,t.textureBuffer),o.push(!0)})),i.drawBuffers(r,o),this.updateAttachmentTextures()},r.resize=function(t,e,r,i){var n=this.viewport,o=n[0],a=n[1],s=n[2],u=n[3];o===t&&a===e&&s===r&&u===i||(this.viewport=[t,e,r,i],this.ready=!1,this.bind())},r.dispose=function(t){if(this.renderer){this.renderer.glRenderer.deleteGLFramebuffer(this),delete this.fbo;var e,r,i=(null==t?void 0:t.depthStencilAttachment)?t.depthStencilAttachment:exports.RenderPassDestroyAttachmentType.force;(i===exports.RenderPassDestroyAttachmentType.force||i===exports.RenderPassDestroyAttachmentType.keepExternal&&!this.externalStorage)&&(null==(e=this.depthStencilRenderbuffer)||e.dispose(),null==(r=this.depthTexture)||r.dispose()),this.renderer=this.stencilRenderbuffer=this.depthStencilRenderbuffer=null}},Io(e,[{key:"stencilStorage",get:function(){if(this.depthStencilStorageType!==exports.RenderPassAttachmentStorageType.depth_16_opaque)return this.depthStencilRenderbuffer}},{key:"depthStorage",get:function(){if(this.depthStencilStorageType!==exports.RenderPassAttachmentStorageType.stencil_8_opaque)return this.depthStencilRenderbuffer}}]),e}(Ls),fp=function(t){function e(e,r,i){var n;(n=t.call(this)||this).canvas=e,n.temporaryRTs={};var o=qn({preserveDrawingBuffer:void 0,alpha:!0,stencil:!0,antialias:!0,depth:!0,premultipliedAlpha:!0},i);n.context=new ep(e,r,o);var a=n.context.gl;return oi(a),n.engine=new up(a),n.engine.renderer=ac(n),n.glRenderer=new Ud(n.engine),n.extension=new $d(ac(n)),n.renderingData={currentFrame:{}},n.framebuffer=new lp({storeAction:{},viewport:[0,0,n.width,n.height],attachments:[new Fd(n.engine,{sourceType:exports.TextureSourceType.framebuffer,data:{width:n.width,height:n.height}})],depthStencilAttachment:{storageType:exports.RenderPassAttachmentStorageType.none}},ac(n)),n}ji(e,t);var r=e.prototype;return r.renderRenderFrame=function(t){var e,r=t;r.resource&&r.resource.color_b.initialize();var i=r._renderPasses;if(this.isDestroyed)console.error("Renderer is destroyed, target: GLRenderer.");else{null==(e=r.renderer.getShaderLibrary())||e.compileAllShaders(),this.setFramebuffer(null),this.clear(r.clearAction);var n=r.camera;this.renderingData.currentFrame=r,this.renderingData.currentCamera=n,this.setGlobalMatrix("effects_MatrixInvV",n.getInverseViewMatrix()),this.setGlobalMatrix("effects_MatrixV",n.getViewMatrix()),this.setGlobalMatrix("effects_MatrixVP",n.getViewProjectionMatrix()),this.setGlobalMatrix("_MatrixP",n.getProjectionMatrix()),this.setGlobalVector3("effects_WorldSpaceCameraPos",n.position),ei(i);for(var o,a=pr(i);!(o=a()).done;){var s=o.value,u=s.delegate;null==u.willBeginRenderPass||u.willBeginRenderPass.call(u,s,this.renderingData),this.renderRenderPass(s),null==u.didEndRenderPass||u.didEndRenderPass.call(u,s,this.renderingData)}for(var c,h=pr(i);!(c=h()).done;)c.value.frameCleanup(this)}},r.renderRenderPass=function(t){this.renderingData.currentPass=t,t.initialize(this),t.configure(this),t.execute(this)},r.renderMeshes=function(t){for(var e,r=this.renderingData.currentPass.delegate,i=pr(t);!(e=i()).done;){var n=e.value;null==r.willRenderMesh||r.willRenderMesh.call(r,n,this.renderingData),n.render(this),null==r.didRenderMesh||r.didRenderMesh.call(r,n,this.renderingData)}},r.setGlobalFloat=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.floats[t]=e},r.setGlobalVector4=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.vector4s[t]=e},r.getGlobalVector4=function(t){return this.renderingData.currentFrame.globalUniforms.vector4s[t]},r.setGlobalInt=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.ints[t]=e},r.setGlobalMatrix=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.matrices[t]=e},r.setGlobalVector3=function(t,e){this.checkGlobalUniform(t),this.renderingData.currentFrame.globalUniforms.vector3s[t]=e},r.drawGeometry=function(t,e,r,i){if(void 0===i&&(i=0),t&&r){r.initialize(),t.initialize(),t.flush();var n=this.renderingData;r.setMatrix("effects_ObjectToWorld",e);try{r.use(this,n.currentFrame.globalUniforms)}catch(t){return void console.error(t)}this.glRenderer.drawGeometry(t,r,i)}},r.setFramebuffer=function(t){t?(this.framebuffer=t,this.framebuffer.bind(),this.setViewport(t.viewport[0],t.viewport[1],t.viewport[2],t.viewport[3])):(this.engine.bindSystemFramebuffer(),this.setViewport(0,0,this.getWidth(),this.getHeight()))},r.getFramebuffer=function(){return this.framebuffer},r.getTemporaryRT=function(t,e,r,i,n,o){if(this.temporaryRTs[t])return this.temporaryRTs[t];var a,s,u=exports.RenderPassAttachmentStorageType.none;n===exports.FilterMode.Linear?a=ko.LINEAR:n===exports.FilterMode.Nearest&&(a=ko.NEAREST),o===exports.RenderTextureFormat.RGBA32?s=ko.UNSIGNED_BYTE:o===exports.RenderTextureFormat.RGBAHalf&&(s=ko.HALF_FLOAT),0===i?u=exports.RenderPassAttachmentStorageType.none:16===i?u=exports.RenderPassAttachmentStorageType.depth_16_opaque:24===i&&(u=exports.RenderPassAttachmentStorageType.depth_24_stencil_8_texture);var c=new Fd(this.engine,{sourceType:exports.TextureSourceType.framebuffer,minFilter:a,magFilter:a,internalFormat:ko.RGBA,format:ko.RGBA,type:s}),h=new lp({name:t,storeAction:{},viewport:[0,0,e,r],viewportScale:1,isCustomViewport:!0,attachments:[c],depthStencilAttachment:{storageType:u}},this);return this.temporaryRTs[t]=h,h},r.setViewport=function(t,e,r,i){this.engine.viewport(t,e,r,i)},r.clear=function(t){var e=this.engine,r=0;if(t.colorAction===exports.TextureLoadAction.clear){var i=t.clearColor;i&&e.clearColor(i[0],i[1],i[2],i[3]),e.colorMask(!0,!0,!0,!0),r=ko.COLOR_BUFFER_BIT}if(t.stencilAction===exports.TextureLoadAction.clear&&(e.stencilMask(255),e.clearStencil(t.clearStencil||0),r|=ko.STENCIL_BUFFER_BIT),t.depthAction===exports.TextureLoadAction.clear){var n=t.clearDepth;e.depthMask(!0),e.clearDepth(Number.isFinite(n)?n:1),r|=ko.DEPTH_BUFFER_BIT}r&&e.clear(r)},r.addLostHandler=function(t){this.context.addLostHandler(t)},r.addRestoreHandler=function(t){this.context.addRestoreHandler(t)},r.getShaderLibrary=function(){return this.engine.shaderLibrary},r.getWidth=function(){return this.width},r.getHeight=function(){return this.height},r.dispose=function(){var t;this.context.dispose(),this.extension.dispose(),null==(t=this.glRenderer)||t.dispose(),this.canvas=null,this.engine.dispose()},r.lost=function(t){t.preventDefault(),this.extension.dispose(),this.glRenderer.lost(t)},r.restore=function(){var t=this.context.gl;if(!t)throw new Error("Can not restore automatically because losing gl context.");var e=this.engine;e.reset(),e.shaderLibrary=new op(e),e.gpuCapability=new Os(t),this.glRenderer=new Ud(this.engine),this.extension=new $d(this)},r.resize=function(t,e){var r=this.glRenderer;r&&(this.width===t&&this.height===e||r.resize(t,e))},r.checkGlobalUniform=function(t){var e=this.renderingData.currentFrame.globalUniforms;e.uniforms.includes(t)||e.uniforms.push(t)},Io(e,[{key:"isDestroyed",get:function(){var t=this.glRenderer;return!t||t.isDestroyed}},{key:"height",get:function(){var t,e;return null!=(e=null==(t=this.glRenderer)?void 0:t.height)?e:0}},{key:"width",get:function(){var t,e;return null!=(e=null==(t=this.glRenderer)?void 0:t.width)?e:0}}]),e}(Fs),dp=new Map;var pp=!1,mp=1,vp=function(t){function e(e){var i;(i=t.call(this)||this).compositions=[],i.displayScale=1,i.resumePending=!1,i.disposed=!1,i.assetManagers=[],i.speed=1,i.baseCompositionIndex=0,i.useExternalCanvas=!1,i.lost=function(t){var e;null==(e=i.ticker)||e.pause(),i.compositions.forEach((function(e){return e.lost(t)})),i.renderer.lost(t),i.handleEmitEvent("webglcontextlost",t)};var n=ac(i);i.restore=fr((function(){var t;return gr(this,(function(e){switch(e.label){case 0:return n.renderer.restore(),[4,Promise.all(n.compositions.map(fr((function(t){var e,r,i,o,a,s,u,c,h,l,f;return gr(this,(function(d){switch(d.label){case 0:return e=t.time,r=t.url,i=t.speed,o=t.reusable,a=t.renderOrder,s=t.transform,u=t.videoState,[4,n.loadScene(r)];case 1:(c=d.sent()).speed=i,c.reusable=o,c.renderOrder=a,c.transform.setPosition(s.position.x,s.position.y,s.position.z),c.transform.setRotation(s.rotation.x,s.rotation.y,s.rotation.z),c.transform.setScale(s.scale.x,s.scale.y,s.scale.z),h=0,d.label=2;case 2:return h<u.length?u[h]?((l=c.textures[h].source.video).currentTime=null!=(f=u[h])?f:0,[4,l.play()]):[3,4]:[3,5];case 3:d.sent(),d.label=4;case 4:return h++,[3,2];case 5:return c.isEnded=!1,c.gotoAndPlay(e),[2,c]}}))}))))];case 1:return n.compositions=e.sent(),n.emit("webglcontextrestored"),null==(t=n.ticker)||t.resume(),Yr()&&n.canvas&&(n.canvas.style.display="none",r.window.setTimeout((function(){n.canvas.style.display=""}),0)),[2]}}))})),i.handleClick=function(t){var e=t.x,r=t.y,n=[];i.compositions.forEach((function(t){for(var o,a=pr(t.hitTest(e,r));!(o=a()).done;){var s=o.value;n.push(qn({},s,{player:ac(i),composition:t}))}}));for(var o=0;o<n.length;o++){var a=n[o],s=a.behavior||Vi.NOTIFY;s===Vi.NOTIFY?(i.emit("click",qn({},a,{compositionId:a.composition.id,compositionName:a.composition.name})),a.composition.emit("click",qn({},a,{compositionId:a.composition.id,compositionName:a.composition.name}))):s===Vi.RESUME_PLAYER&&i.resume()}};var o=e.container,a=e.canvas,s=e.fps,u=e.name,c=e.pixelRatio,h=e.manualRender,l=e.reportGPUTime,f=e.renderFramework,d=e.notifyTouch,p=e.onError,m=e.interactive,v=void 0!==m&&m,y=e.renderOptions,g=void 0===y?{}:y,x=e.env,T=void 0===x?"":x,_=g.willCaptureImage,E=g.premultipliedAlpha;if(i.onError=p,pp||"debug-disable"===f)return Wl(i);var b,A=(b=/iPhone OS (\d+)_(\d+)/.exec(r.navigator.userAgent))&&("13"===b[1]||"16"===b[1]&&"5"===b[2])?"webgl":"webgl2";f&&(A="webgl"===f?"webgl":"webgl2"),i.reportGPUTime=l,i.pixelRatio=Number.isFinite(c)?c:Hr(),i.offscreenMode=!0,i.env=T,i.name=u||""+mp++;try{if(Uo.length)throw new Error("Errors before player create: "+Uo.map((function(t,e){return"\n "+(e+1)+": "+t}))+".",{cause:"webgliniterror"});a?(i.canvas=a,i.useExternalCanvas=!0):(yp(o),i.canvas=r.document.createElement("canvas"),o.appendChild(i.canvas)),i.container=i.canvas.parentElement,i.renderer=Fs.create(i.canvas,A,{preserveDrawingBuffer:_,premultipliedAlpha:E}),i.renderer.env=T,i.renderer.addLostHandler({lost:i.lost}),i.renderer.addRestoreHandler({restore:i.restore}),i.gpuCapability=i.renderer.engine.gpuCapability,i.assetService=new cd(i.renderer.engine),h||(i.ticker=new Id(s),i.ticker.add(i.tick.bind(ac(i)))),i.event=new qu(i.canvas,!!d),i.event.bindListeners(),i.event.addEventListener(ju,i.handleClick),i.interactive=v,i.resize(),El(i.gpuCapability.detail),dp.forEach((function(t){t.gpuCapability.type!==i.gpuCapability.type&&ci.warn("Create player with different WebGL version: old="+t.gpuCapability.type+", new="+i.gpuCapability.type+".\nsee https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#X0ulg.")})),dp.set(i.canvas,ac(i)),function(){for(var t,e=[],r=pr(dp.values());!(t=r()).done;){var i=t.value;i.paused||e.push(i)}e.length>1&&ci.error("Current running player count: "+e.length+", see https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#IzodZ.",e)}()}catch(t){i.canvas&&!i.useExternalCanvas&&i.canvas.remove(),i.handleThrowError(t)}return i}ji(e,t);var i=e.prototype;return i.setSpeed=function(t){isNaN(t)||(this.speed=t)},i.getSpeed=function(){return this.speed},i.getCompositionByName=function(t){return this.compositions.find((function(e){return e.name===t}))},i.getCompositions=function(){return this.compositions.sort((function(t,e){return t.getIndex()-e.getIndex()}))},i.getAssetManager=function(){return this.assetManagers},i.loadScene=function(t,e){var i=this;return fr((function(){var n,o,a,s,u,c,h,l,f,d,p,m,v,y,g,x,T,_,E,b,A,S;return gr(this,(function(R){switch(R.label){case 0:for(oi(i.renderer,"Renderer is not exist, maybe the Player has been disabled or in gl 'debug-disable' mode."),s=r.performance.now(),u=[],c=[],l=null==(h=null==e?void 0:e.autoplay)||h,f=null==(o=i.renderer.engine.gpuCapability)||null==(n=o.detail)?void 0:n.asyncShaderCompile,d=i.baseCompositionIndex,fi(t)?(p=u).push.apply(p,[].concat(t)):u.push(t),i.baseCompositionIndex+=u.length,l&&(i.autoPlaying=!0),m=pr(i.assetManagers);!(v=m()).done;)v.value.dispose();return i.assetManagers=[],y=[],[4,Promise.all(u.map(fr((function(t,r){var n,o,a,s,u,h,f,p;return gr(this,(function(m){switch(m.label){case 0:return n=i.assetService.assembleSceneLoadOptions(t,qn({autoplay:l},e)),o=n.source,a=n.options,u=null!=(s=null==a?void 0:a.autoplay)?s:l,h=new sd(a),i.assetManagers.push(h),[4,h.loadScene(o,i.renderer,{env:i.env})];case 1:return f=m.sent(),i.disposed?(c.length=0,[2]):(i.assetService.prepareAssets(f,f.assets),i.assetService.updateTextVariables(f,h.options.variables),i.assetService.initializeTexture(f),f.pluginSystem.precompile(f.jsonScene.compositions,i.renderer),(p=i.createComposition(f,a)).setIndex(d+r),c[r]=p,y[r]=u,[2])}}))}))))];case 1:return R.sent(),g=r.performance.now(),[4,new Promise((function(t){var e;null==(e=i.renderer.getShaderLibrary())||e.compileAllShaders((function(){return t(null)}))}))];case 2:for(R.sent(),x=r.performance.now()-g,T=0;T<c.length;T++)y[T]?c[T].play():c[T].pause(),i.compositions.push(c[T]);for(null==(a=i.ticker)||a.start(),c.some((function(t){return!t.getPaused()}))&&i.emit("play",{time:0}),_=c.map((function(t){return t.name})),E=r.performance.now()-s,b=pr(c);!(A=b()).done;)(S=A.value).statistic.compileTime=x,S.statistic.firstFrameTime=E;return ci.info("First frame ["+_+"]: "+E.toFixed(4)+"ms."),ci.info("Shader "+(f?"async":"sync")+" compile ["+_+"]: "+x.toFixed(4)+"ms."),[2,fi(t)?c:c[0]]}}))}))()},i.createComposition=function(t,e){var r=this;void 0===e&&(e={});var i=this.renderer,n=new fl(qn({},e,{renderer:i,width:i.getWidth(),height:i.getHeight(),event:this.event,handleItemMessage:function(t){r.emit("message",t)}}),t);return this.ticker&&e.renderLevel===Pi.B&&this.ticker.setFPS(Math.min(this.ticker.getFPS(),30)),this.env!==Fu&&this.assetService.createShaderVariant(),n},i.play=function(){var t;this.offscreenMode&&(this.resize(),this.offscreenMode=!1),this.autoPlaying=!0,this.compositions.map((function(t){t.play()})),null==(t=this.ticker)||t.start(),this.emit("play",{time:0})},i.gotoAndPlay=function(t){this.offscreenMode&&(this.resize(),this.offscreenMode=!1),this.autoPlaying=!0,this.compositions.map((function(e){e.gotoAndPlay(t)})),this.ticker?this.ticker.start():this.doTick(0,!0),this.emit("play",{time:t})},i.gotoAndStop=function(t){var e;this.offscreenMode&&(this.resize(),this.offscreenMode=!1),this.autoPlaying=!1,this.compositions.map((function(e){e.gotoAndStop(t)})),this.ticker&&!(null==(e=this.ticker)?void 0:e.getPaused())||this.doTick(0,!0),this.emit("pause")},i.playSequence=function(t){for(var e,r=function(e){t[e].on("end",(function(){t[e+1].play()}))},i=0;i<t.length-1;i++)r(i);t[0].play(),null==(e=this.ticker)||e.start()},i.pause=function(t){var e;this.paused||(null==(e=this.ticker)||e.pause(),this.emit("pause"),this.emit("update",{player:this,playing:!1}),this.compositions.map((function(t){t.pause()})),t&&t.offloadTexture&&this.offloadTexture())},i.resume=function(){var t=this;return fr((function(){var e;return gr(this,(function(r){switch(r.label){case 0:return t.resumePending?[2]:t.paused?(t.resumePending=!0,[4,Promise.all(t.compositions.map((function(t){return t.reloadTexture()})))]):[3,2];case 1:r.sent(),t.resumePending=!1,t.emit("resume"),r.label=2;case 2:return t.compositions.map((function(t){t.resume()})),null==(e=t.ticker)||e.resume(),[2]}}))}))()},i.tick=function(t){this.doTick(t,this.forceRenderNextFrame),this.forceRenderNextFrame=!1},i.doTick=function(t,e){var r,i=this,n=this.renderer.engine.renderErrors;n.size>0&&(this.handleEmitEvent("rendererror",n.values().next().value),null==(r=this.ticker)||r.pause()),t=Math.min(t,33)*this.speed;var o=this.compositions,a=!1;o.sort((function(t,e){return t.getIndex()-e.getIndex()}));for(var s,u=[],c=0;c<o.length;c++){var h=o[c];h.textureOffloaded?(a=!0,ci.error("Composition "+h.name+" texture offloaded, skip render."),u.push(h)):(!h.isDestroyed&&h.renderer&&h.update(t),h.isDestroyed||u.push(h))}if(this.compositions=u,this.baseCompositionIndex=this.compositions.length,a)return this.handleEmitEvent("rendererror",new Error("Play when texture offloaded.")),null==(s=this.ticker)?void 0:s.pause();if(!this.paused||e){var l=this.gpuCapability.level,f=this.renderer.context.gl,d=2===l&&this.reportGPUTime?Bo(f):void 0;if(null==d||d.begin(),this.compositions.length||this.compositions.length<o.length||e){this.renderer.setFramebuffer(null),this.renderer.clear({stencilAction:exports.TextureLoadAction.clear,clearStencil:0,depthAction:exports.TextureLoadAction.clear,clearDepth:1,colorAction:exports.TextureLoadAction.clear,clearColor:[0,0,0,0]});for(var p=0;p<o.length;p++)!o[p].renderFrame.isDestroyed&&this.renderer.renderRenderFrame(o[p].renderFrame)}null==d||d.end(),null==d||d.getTime().then((function(t){return null==i.reportGPUTime?void 0:i.reportGPUTime.call(i,null!=t?t:0)})).catch,this.autoPlaying&&this.emit("update",{player:this,playing:!0})}},i.resizeToAspect=function(t,e){void 0===e&&(e=1),t!==this.displayAspect&&(this.displayAspect=t),e!==this.displayScale&&(this.displayScale=e),this.resize()},i.resize=function(){var t,e,i,n,o=this,a=this.canvas.parentElement;if(a){var s=this.getTargetSize(a);t=s[0],e=s[1],i=s[2],n=s[3]}else t=i=this.canvas.width,e=n=this.canvas.height;var u=t/e;if(t&&e){var c,h=r.document.documentElement.clientWidth;i>2*h&&ci.error("DPI overflowed, width "+i+" is more than 2x document width "+h+", see https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#ulfNT.");var l=this.env?this.gpuCapability.detail.maxTextureSize:2048;(i>l||n>l)&&(ci.error("Container size overflowed "+i+"x"+n+", see https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#MvjnY."),u>1?(i=Math.round(l),n=Math.round(l/u)):(n=Math.round(l),i=Math.round(l*u))),this.renderer.resize(i,n),this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",ci.info("Resize player "+this.name+" ["+i+","+n+","+t+","+e+"]."),null==(c=this.compositions)||c.forEach((function(t){t.camera.aspect=u,t.camera.pixelHeight=o.renderer.getHeight(),t.camera.pixelWidth=o.renderer.getWidth()}))}},i.clearCanvas=function(t){t?this.renderer.clear({stencilAction:exports.TextureLoadAction.clear,clearStencil:0,depthAction:exports.TextureLoadAction.clear,clearDepth:1,colorAction:exports.TextureLoadAction.clear,clearColor:[0,0,0,0]}):this.forceRenderNextFrame=!0},i.destroyCurrentCompositions=function(){this.compositions.forEach((function(t){return t.dispose()})),this.compositions.length=0,this.baseCompositionIndex=0},i.dispose=function(t){var e,i,n;if(ci.info("Call player destroyed: "+this.name+"."),!this.disposed){dp.delete(this.canvas),this.pause(),null==(e=this.ticker)||e.stop(),this.assetManagers.forEach((function(t){return t.dispose()})),this.compositions.forEach((function(t){return t.dispose()})),this.compositions.length=0,this.renderer&&(this.renderer.context.removeLostHandler({lost:this.lost}),this.renderer.context.removeRestoreHandler({restore:this.restore}),this.renderer.dispose(!t)),null==(i=this.event)||i.dispose(),null==(n=this.assetService)||n.dispose(),mr(this.canvas,r.HTMLCanvasElement)&&!t&&this.renderer.context&&(Yl.dispose(),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.canvas.remove());var o="Never use destroyed player: "+this.name+" again, see https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#YSWQr.",a=function(){return function(t){throw new Error(t)}(o)},s=function(){return t=o,Promise.reject(t);var t};this.tick=a,this.resize=a,this.loadScene=s,this.play=s,this.gotoAndPlay=s,this.gotoAndStop=s,this.playSequence=a,this.destroyCurrentCompositions=a,this.resume=s,this.disposed=!0}},i.offloadTexture=function(){this.compositions.forEach((function(t){return t.offloadTexture()}))},i.getTargetSize=function(t){yp(t);var e,i,n=this.displayAspect,o=null==r.window.getComputedStyle?void 0:r.window.getComputedStyle.call(r.window,t),a=0,s=0;o?(a=parseInt(o.width,10),s=parseInt(o.height,10)):(a=t.clientWidth,s=t.clientHeight),n?a/s>n?e=(i=s*this.displayScale)*n:i=(e=a*this.displayScale)/n:(e=a,i=s);var u=this.pixelRatio,c=e,h=i;if(e=Math.round(e*u),(i=Math.round(i*u))<1||i<1){if(!this.offscreenMode)throw new Error("Invalid container size "+e+"x"+i+", see https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#lLlSW.");e=i=c=h=1}return[c,h,e,i]},i.handleThrowError=function(t){if(!this.onError)throw t;this.onError(t)},i.handleEmitEvent=function(t,e){this.onError?mr(e,r.Event)?this.onError(new Error(e.type,{cause:t}),e):mr(e,Error)?this.onError(new Error(e.message,{cause:t}),e):this.onError(new Error("Unknown error.",{cause:t}),e):(console.warn("["+t+"] event is deprecated, please use 'onError' instead."),this.emit(t,e))},Io(e,[{key:"compositionCount",get:function(){return this.compositions.length}},{key:"hasPlayable",get:function(){return this.compositions.length>0}},{key:"paused",get:function(){var t;return null==(t=this.ticker)?void 0:t.getPaused()}},{key:"interactive",get:function(){return this.event.enabled},set:function(t){this.event.enabled=t}}]),e}(sl);function yp(t){if(null==t)throw new Error("Container is not an HTMLElement, see https://www.galacean.com/effects/user/gasrv4ka5sacrwpg#WZaWg.")}yr([function(t,e,r){var i=r.value;return r.value=fr((function(){var e,r,n,o,a=arguments;return gr(this,(function(s){switch(s.label){case 0:for(e=a.length,r=new Array(e),n=0;n<e;n++)r[n]=a[n];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,i.apply(this,r)];case 2:return[2,s.sent()];case 3:return o=s.sent(),t.handleThrowError.call(this,o),[3,4];case 4:return[2]}}))})),r}],vp.prototype,"loadScene",null),ya.create=function(t,e){return new Fd(t,e)},ya.createWithData=function(t,e,r){void 0===e&&(e=$r("#fff")),void 0===r&&(r={});var i=r.type,n=void 0===i?ko.UNSIGNED_BYTE:i,o=r.format,a=void 0===o?ko.RGBA:o,s=r.internalFormat,u=r.wrapS,c=void 0===u?ko.MIRRORED_REPEAT:u,h=r.wrapT,l=void 0===h?ko.MIRRORED_REPEAT:h,f=r.minFilter,d=void 0===f?ko.NEAREST:f,p=r.magFilter,m=void 0===p?ko.NEAREST:p,v=r.flipY,y=void 0!==v&&v;return new Fd(t,{data:e,type:n,sourceType:exports.TextureSourceType.data,format:a,internalFormat:s||a,wrapS:c,wrapT:l,minFilter:d,magFilter:m,flipY:y})},Pa.create=function(t,e){return new Jd(t,e)},ja.create=function(t,e){return new Yd(t,e)},ts.create=function(t,e){return new ts(t,e)},Cs.create=function(t){return new cp(t)},Ls.create=function(t,e){return new lp(t,e)},Fs.create=function(t,e,r){return new fp(t,e,r)},Pd.create=function(t){return new up(t)};ci.info("Player version: 2.7.2."),exports.AbstractPlugin=Xi,exports.ActivationMixerPlayable=Vh,exports.ActivationPlayable=Bh,exports.AndNode=ho,exports.Animatable=Jn,exports.AnimationClipNode=Qn,exports.ApplyAdditiveNode=uo,exports.Asset=tf,exports.AssetLoader=rf,exports.AssetManager=sd,exports.AssetService=cd,exports.BYTES_TYPE_MAP=Ha,exports.Behaviour=No,exports.BezierCurve=Vu,exports.BezierCurvePath=Au,exports.BezierCurveQuat=Su,exports.BlendNode=co,exports.BoolValueNode=Wn,exports.COPY_FRAGMENT_SHADER=Da,exports.COPY_MESH_SHADER_ID=La,exports.COPY_VERTEX_SHADER=Fa,exports.CalculateLoader=Al,exports.Camera=lc,exports.CameraVFXItemLoader=Hu,exports.ColorCurve=Xu,exports.ColorPlayable=pl,exports.ColorPropertyMixerPlayable=zh,exports.Component=wo,exports.ComponentTimePlayable=_l,exports.ComponentTimePlayableAsset=Tl,exports.ComponentTimeTrack=yl,exports.Composition=fl,exports.ConstBoolNode=mo,exports.ConstFloatNode=po,exports.ControlParameterBoolNode=yo,exports.ControlParameterFloatNode=vo,exports.ControlParameterTriggerNode=go,exports.DEFAULT_FONTS=Kl,exports.DEFAULT_FPS=60,exports.Database=nf,exports.Deferred=function(){var t=this;this.promise=new Promise((function(e,r){t.resolve=e,t.reject=r}))},exports.Downloader=Ko,exports.EFFECTS_COPY_MESH_NAME=Na,exports.EVENT_TYPE_CLICK=ju,exports.EVENT_TYPE_TOUCH_END=Zu,exports.EVENT_TYPE_TOUCH_MOVE=Yu,exports.EVENT_TYPE_TOUCH_START=Wu,exports.EffectComponentTimeTrack=xl,exports.EffectsObject=Ln,exports.EffectsPackage=Od,exports.Ellipse=zl,exports.Engine=Pd,exports.EventEmitter=sl,exports.EventSystem=qu,exports.Float16ArrayWrapper=Bs,exports.FloatComparisonNode=bo,exports.FloatComparisonNodeData=Eo,exports.FloatPropertyMixerPlayable=Gh,exports.FloatValueNode=jn,exports.Framebuffer=Ls,exports.GLEngine=up,exports.GLGeometry=Yd,exports.GLRenderer=fp,exports.GPUCapability=Os,exports.Geometry=ja,exports.GlobalUniforms=Rs,exports.GradientValue=_u,exports.GraphInstance=Oo,exports.GraphNode=zn,exports.GraphNodeData=Gn,exports.GraphicsPath=jl,exports.HELP_LINK=Du,exports.InteractLoader=Qu,exports.InteractMesh=$u,exports.InvalidIndex=kn,exports.KTXTexture=Ea,exports.LayerBlendNode=xo,exports.LineSegments=Eu,exports.LinearValue=Tu,exports.MaskProcessor=Ia,exports.MaskableGraphic=Ds,exports.Material=Pa,exports.MaterialDataBlock=Ca,exports.Mesh=ts,exports.MeshCollider=ec,exports.NodeTransform=oo,exports.NotNode=fo,exports.OrNode=lo,exports.PLAYER_OPTIONS_ENV_EDITOR=Fu,exports.POST_PROCESS_SETTINGS="post_process_settings",exports.ParticleBehaviourPlayable=gh,exports.ParticleBehaviourPlayableAsset=xh,exports.ParticleLoader=bl,exports.ParticleMesh=_h,exports.ParticleMixerPlayable=Xh,exports.ParticleSystemRenderer=Ah,exports.ParticleTrack=nl,exports.PassTextureCache=Ga,exports.PathSegments=bu,exports.Playable=ic,exports.PlayableAsset=oc,exports.PlayableOutput=nc,exports.Player=vp,exports.PluginSystem=Ri,exports.PolyStar=Gl,exports.Polygon=Vl,exports.Pose=ao,exports.PoseNode=Xn,exports.PropertyClipPlayable=Uh,exports.PropertyTrack=il,exports.RENDER_PASS_NAME_PREFIX=_s,exports.RENDER_PREFER_LOOKUP_TEXTURE=sh,exports.RUNTIME_ENV="runtime_env",exports.RandomSetValue=yu,exports.RandomValue=gu,exports.RandomVectorValue=xu,exports.RenderFrame=bs,exports.RenderPass=is,exports.RenderPassPriorityNormal=1e3,exports.RenderPassPriorityPostprocess=3e3,exports.RenderPassPriorityPrepare=0,exports.RenderTargetHandle=es,exports.Renderbuffer=Cs,exports.Renderer=Fs,exports.RendererComponent=Lo,exports.RuntimeClip=rl,exports.SEMANTIC_MAIN_PRE_COLOR_ATTACHMENT_0="PRE_MAIN_COLOR_0",exports.SEMANTIC_MAIN_PRE_COLOR_ATTACHMENT_SIZE_0="PRE_MAIN_COLOR_SIZE_0",exports.SEMANTIC_PRE_COLOR_ATTACHMENT_0="PRE_COLOR_0",exports.SEMANTIC_PRE_COLOR_ATTACHMENT_SIZE_0="PRE_COLOR_SIZE_0",exports.SPRITE_VERTEX_STRIDE=6,exports.SemanticMap=Xa,exports.SerializationHelper=ef,exports.ShaderFactory=vs,exports.ShaderVariant=wa,exports.ShapePath=Hl,exports.SpriteColorMixerPlayable=Hh,exports.SpriteComponentTimeTrack=gl,exports.SpriteLoader=rc,exports.StateMachineNode=Ao,exports.StateNode=So,exports.StaticValue=vu,exports.SubCompositionClipPlayable=jh,exports.SubCompositionMixerPlayable=Wh,exports.TEMPLATE_USE_OFFSCREEN_CANVAS=uh,exports.TextComponentBase=Jl,exports.TextLayout=Zl,exports.TextLoader=$l,exports.TextStyle=ql,exports.Texture=ya,exports.TextureFactory=Sa,exports.Ticker=Id,exports.TimelineClip=el,exports.TimelineInstance=al,exports.TrackMixerPlayable=Dh,exports.Transform=cc,exports.TransformMixerPlayable=Yh,exports.TransformPlayable=tl,exports.TransitionNode=Co,exports.ValueGetter=mu,exports.ValueNode=Hn,exports.Vector2Curve=Lu,exports.Vector2PropertyMixerPlayable=Kh,exports.Vector3Curve=Nu,exports.Vector3PropertyMixerPlayable=qh,exports.Vector4Curve=wu,exports.Vector4PropertyMixerPlayable=Zh,exports.adapter=hr,exports.addByOrder=ri,exports.addItem=Sr,exports.addItemWithOrder=function(t,e,r,i){if(void 0===i&&(i=!1),!t.includes(e)&&(t.push(e),1!==t.length)){var n=t.length-1;if(n){var o=t[n];if(i)for(;t[n-1][r]<o[r]&&(t[n]=t[n-1],0!=--n););else for(;t[n-1][r]>o[r]&&(t[n]=t[n-1],0!=--n););t[n]=o}}},exports.applyMixins=_i,exports.assertExist=oi,exports.asserts=function(t,e){if(void 0===e&&(e="asserts failed"),!t)throw new Error(e)},exports.base64ToFile=Ti,exports.buildLine=Il,exports.calculateTranslation=Gs,exports.canUseBOM=Wr,exports.canvasPool=Yl,exports.closePointEps=Cl,exports.colorGradingFrag=hs,exports.colorStopsFromGradient=zr,exports.colorToArr=Ur,exports.combineImageTemplate=nd,exports.createCopyShader=Va,exports.createGLContext=Vo,exports.createKeyFrameMeta=function(){return{curves:[],index:0,max:0,lineSegCount:0,curveCount:0}},exports.createShape=Cc,exports.createValueGetter=Gu,exports.curveEps=Ml,exports.decimalEqual=Ks,exports.defaultPlugins=bi,exports.deserializeMipmapTexture=fa,exports.disableAllPlayer=function(t){pp=!!t},exports.earcut=Kc,exports.effectsClass=In,exports.effectsClassStore=On,exports.enlargeBuffer=Cr,exports.ensureFixedNumber=af,exports.ensureVec3=Xs,exports.findPreviousRenderPass=function(t,e){var r=t.indexOf(e);return t[r-1]},exports.gaussianDownHFrag=ls,exports.gaussianDownVFrag=fs,exports.gaussianUpFrag=ds,exports.generateEmptyTypedArray=Wa,exports.generateGUID=xi,exports.generateHalfFloatTexture=ga,exports.generateTransparentTexture=_a,exports.generateWhiteTexture=Ta,exports.getActivePlayers=function(){return Array.from(dp.values())},exports.getBackgroundImage=id,exports.getClass=Pn,exports.getColorFromGradientStops=kr,exports.getConfig=hh,exports.getDefaultTextureFactory=Ra,exports.getGeometryByShape=eh,exports.getGeometryTriangles=th,exports.getKTXTextureOptions=ba,exports.getKeyFrameMetaByRawValue=Ou,exports.getMergedStore=Nn,exports.getNodeDataClass=Bn,exports.getParticleMeshShader=function(t,e,r){var i;void 0===r&&(r="");var n,o=t.content,a=+((null==(i=o.renderer)?void 0:i.renderMode)||0),s=[["RENDER_MODE",a],["ENV_EDITOR",r===Fu]],u=e.level,c=e.detail,h={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},l={curves:[],index:0,max:0,lineSegCount:0,curveCount:0},f=c.maxVertexUniforms>0,d=(null!=(n=o.positionOverLifetime)?n:{}).speedOverLifetime,p=0,m=0;f&&s.push(["ENABLE_VERTEX_TEXTURE",!0]),d&&(s.push(["SPEED_OVER_LIFETIME",!0]),m|=2,Ou(h,d));var v=o.textureSheetAnimation;v&&v.animate&&(s.push(["USE_SPRITE",!0]),m|=4);var y=o.colorOverLifetime;y&&y.color&&(s.push(["COLOR_OVER_LIFETIME",!0]),m|=16);var g=y&&y.opacity;g&&Ou(h,g);var x,T=o.positionOverLifetime;if(["x","y","z"].forEach((function(t,e){var r=0,i="linear"+t.toUpperCase(),n="orbital"+t.toUpperCase();(null==T?void 0:T[i])&&(Ou(h,T[i]),r=1,m|=1<<7+e),s.push(["LINEAR_VEL_"+t.toUpperCase(),r]);var o=0;(null==T?void 0:T[n])&&(Ou(h,T[n]),o=1,m|=1<<10+e,x=!0),s.push(["ORB_VEL_"+t.toUpperCase(),o])})),(null==T?void 0:T.asMovement)&&(s.push(["AS_LINEAR_MOVEMENT",!0]),m|=32),x&&(null==T?void 0:T.asRotation)&&(s.push(["AS_ORBITAL_MOVEMENT",!0]),m|=64),o.sizeOverLifetime){var _=o.sizeOverLifetime;_.separateAxes?(Ou(h,_.x),s.push(["SIZE_Y_BY_LIFE",1]),m|=16384,Ou(h,_.y)):Ou(h,_.size)}if(o.rotationOverLifetime){var E=o.rotationOverLifetime;E.z&&(Ou(h,null==E?void 0:E.z),m|=32768,s.push(["ROT_Z_LIFETIME",1])),E.separateAxes&&(E.x&&(Ou(h,E.x),m|=65536,s.push(["ROT_X_LIFETIME",1])),E.y&&(Ou(h,E.y),m|=1<<17,s.push(["ROT_Y_LIFETIME",1]))),(null==E?void 0:E.asRotation)&&(s.push(["ROT_LIFETIME_AS_MOVEMENT",1]),m|=1<<18)}Ou(h,null==T?void 0:T.gravityOverLifetime),(null==T?void 0:T.forceTarget)&&(s.push(["FINAL_TARGET",!0]),m|=1<<19,Ou(h,T.forceCurve));var b=c.halfFloatTexture;b&&l.max&&(m|=1<<20);var A=c.maxVertexUniforms,S=h.max+h.curves.length-32>A;hh(sh)&&(S=!0),2===u&&(h.max=-1,l.index),S&&b&&f&&(p=1);var R=["-p:",a,m,h.index,h.max,l.index,l.max].join("+"),C={fragment:as,vertex:"#define LOOKUP_TEXTURE_CURVE "+p+"\n"+ss,shared:!0,cacheId:R,macros:s,name:"particle#"+t.name};return s.push(["VERT_CURVE_VALUE_COUNT",h.index],["FRAG_CURVE_VALUE_COUNT",l.index],["VERT_MAX_KEY_FRAME_COUNT",h.max],["FRAG_MAX_KEY_FRAME_COUNT",l.max]),{shader:C,vertex:h.index,fragment:l.index}},exports.getPixelRatio=Hr,exports.getPlayerByCanvas=function(t){return dp.get(t)},exports.getPreMultiAlpha=Wo,exports.getStandardComposition=Kf,exports.getStandardImage=qf,exports.getStandardItem=td,exports.getStandardJSON=Yf,exports.getTextureSize=As,exports.glContext=ko,exports.glType2VertexFormatType=function(t){switch(t){case r.WebGLRenderingContext.FLOAT:return _n.Float32;case r.WebGLRenderingContext.SHORT:return _n.Int16;case r.WebGLRenderingContext.BYTE:return _n.Int8;case r.WebGLRenderingContext.UNSIGNED_SHORT:return _n.UInt16;case r.WebGLRenderingContext.UNSIGNED_BYTE:return _n.UInt8;default:return _n.Float32}},exports.gpuTimer=Bo,exports.imageDataFromColor=$r,exports.imageDataFromGradient=ti,exports.initErrors=Uo,exports.initGLContext=Go,exports.integrate="float calculateMovement(float t,vec2 p1,vec2 p2,vec2 p3,vec2 p4){float movement=0.0;float h=(t-p1.x)*0.05;for(int i=0;i<=20;i++){float t=float(i)*h;float nt=binarySearchT(t,p1.x,p2.x,p3.x,p4.x);float y=cubicBezier(nt,p1.y,p2.y,p3.y,p4.y);float weight=(i==0||i==20)? 1.0 :(mod(float(i),2.)!=0.)? 4.0 : 2.0;movement+=weight*y;}movement*=h/3.;return movement;}float integrateFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i+=2){vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return ret;}vec2 p1=vec2(k0.x,k0.y);vec2 p2=vec2(k0.z,k0.w);vec2 p3=vec2(k1.z,k1.w);vec2 p4=vec2(k1.x,k1.y);if(time>=k1.x){ret+=calculateMovement(k1.x,p1,p2,p3,p4);}if(time>=k0.x&&time<k1.x){return ret+calculateMovement(time,p1,p2,p3,p4);}}return ret;}float integrateByTimeLineSeg(float t,vec2 p0,vec2 p1){float t0=p0.x;float t1=p1.x;float y0=p0.y;float y1=p1.y;vec4 tSqr=vec4(t,t,t0,t0);tSqr=tSqr*tSqr;vec4 a=vec4(2.*t,3.,-t0,3.)*tSqr;float t1y0=t1*y0;vec4 b=vec4(y0-y1,t0*y1-t1y0,2.*y0+y1,t1y0);float r=dot(a,b);return r/(t0-t1)*0.16666667;}float integrateLineSeg(float time,vec2 p0,vec2 p1){float h=time-p0.x;float y0=p0.y;return(y0+y0+(p1.y-y0)*h/(p1.x-p0.x))*h/2.;}float integrateFromLineSeg(float time,float frameStart,float frameCount){if(time==0.){return 0.;}int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i++){if(i>count){return ret;}vec4 ks=lookup_curve(i+start);vec2 k0=ks.xy;vec2 k1=ks.zw;if(time>k0.x&&time<=k1.x){return ret+integrateLineSeg(time,k0,k1);}ret+=integrateLineSeg(k1.x,k0,k1);vec2 k2=lookup_curve(i+start+1).xy;if(time>k1.x&&time<=k2.x){return ret+integrateLineSeg(time,k1,k2);}ret+=integrateLineSeg(k2.x,k1,k2);}return ret;}float integrateByTimeFromLineSeg(float time,float frameStart,float frameCount){if(time==0.){return 0.;}int start=int(frameStart);int count=int(frameCount-1.);float ret=0.;for(int i=0;i<ITR_END;i++){if(i>count){return ret;}vec4 ks=lookup_curve(i+start);vec2 k0=ks.xy;vec2 k1=ks.zw;if(time>k0.x&&time<=k1.x){return ret+integrateByTimeLineSeg(time,k0,k1);}ret+=integrateByTimeLineSeg(k1.x,k0,k1);vec2 k2=lookup_curve(i+start+1).xy;if(time>k1.x&&time<=k2.x){return ret+integrateByTimeLineSeg(time,k1,k2);}ret+=integrateByTimeLineSeg(k2.x,k1,k2);}return ret;}float getIntegrateFromTime0(float t1,vec4 value){float type=value.x;if(type==0.){return value.y*t1;}if(type==1.){vec2 p0=vec2(0.,value.y);vec2 p1=vec2(value.w,value.z);return integrateLineSeg(t1,p0,p1);}if(type==3.){return integrateFromLineSeg(t1,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed)*t1;}if(type==5.){return integrateFromBezierCurveFrames(t1,value.z,value.w);}return 0.;}float getIntegrateByTimeFromTime(float t0,float t1,vec4 value){float type=value.x;if(type==0.){return value.y*(t1*t1-t0*t0)/2.;}else if(type==1.){vec2 p0=vec2(0.,value.y);vec2 p1=vec2(value.w,value.z);return integrateByTimeLineSeg(t1,p0,p1)-integrateByTimeLineSeg(t0,p0,p1);}if(type==3.){return integrateByTimeFromLineSeg(t1,value.y,value.z)-integrateByTimeFromLineSeg(t0,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed)*(t1*t1-t0*t0)/2.;}if(type==5.){return integrateFromBezierCurveFrames(t1,value.z,value.w)-integrateFromBezierCurveFrames(t0,value.z,value.w);}return 0.;}",exports.interpolateColor=Gr,exports.isAlipayMiniApp=Qr,exports.isAndroid=Zr,exports.isArray=fi,exports.isCanvas=vi,exports.isCanvasUsedByPlayer=function(t){return dp.has(t)},exports.isFunction=di,exports.isIOS=Yr,exports.isIOSByUA=function(){var t=r.navigator.userAgent.toLowerCase().match(/cpu (iphone )?os (.*?) like mac os/);return t?parseInt(t[2],10):0},exports.isMiniProgram=function(){return Qr()||Jr()},exports.isObject=pi,exports.isOpenHarmony=qr,exports.isPlainObject=mi,exports.isSimulatorCellPhone=Kr,exports.isString=li,exports.isUniformStruct=Ma,exports.isUniformStructArray=function(t){return t&&void 0!==t.length&&Ma(t[0])},exports.isValidFontFamily=ai,exports.isWebGL2=Xo,exports.isWechatMiniApp=Jr,exports.itemFrag=os,exports.itemVert=ns,exports.loadAVIFOptional=ea,exports.loadBinary=oa,exports.loadBlob=function(t){return sa.apply(this,arguments)},exports.loadImage=ia,exports.loadMedia=ha,exports.loadVideo=ua,exports.loadWebPOptional=$o,exports.logger=ci,exports.math=Ja,exports.modifyMaxKeyframeShader=function(t,e,r){var i,n=null==(i=t.cacheId)?void 0:i.split("+");if(n[3]=e,n[5]=r,t.cacheId=n.join("+"),t.macros)for(var o=0;o<t.macros.length;o++){var a=t.macros[o];if("VERT_CURVE_VALUE_COUNT"===a[0])a[1]=e;else if("FRAG_CURVE_VALUE_COUNT"===a[0]){a[1]=r;break}}},exports.nearestPowerOfTwo=Ys,exports.nodeDataClass=Vn,exports.noop=hi,exports.normalizeColor=df,exports.numberToFix=Qs,exports.oldBezierKeyFramesToNew=Uu,exports.parsePercent=Xr,exports.particleFrag=as,exports.particleOriginTranslateMap=Ws,exports.particleUniformTypeMap=Th,exports.particleVert=ss,exports.passRenderLevel=rd,exports.pluginLoaderMap=Ei,exports.randomInRange=yi,exports.registerPlugin=Si,exports.removeItem=Rr,exports.rotateVec2=rh,exports.screenMeshVert=cs,exports.serialize=wn,exports.setBlendMode=Yo,exports.setConfig=function(t,e){return ch[t]=e},exports.setDefaultTextureFactory=function(t){Aa=t},exports.setMaskMode=qo,exports.setMaxSpriteMeshItemCount=function(t){exports.maxSpriteMeshItemCount=t},exports.setRayFromCamera=Zs,exports.setSideMode=Zo,exports.setSpriteMeshMaxItemCountByGPU=El,exports.sortByOrder=ei,exports.spec=Rn,exports.thresholdFrag=ps,exports.throwDestroyedError=gi,exports.trailVert=us,exports.translatePoint=function(t,e){for(var r=[-.5,.5,-.5,-.5,.5,.5,.5,-.5],i=0;i<8;i+=2)r[i]+=t,r[i+1]+=e;return r},exports.trianglesFromRect=qs,exports.unregisterPlugin=function(t){delete Ai[t],delete Ei[t],Rr(bi,t)},exports.valIfUndefined=function(t,e){return null==t?e:t},exports.value="#ifdef SHADER_VERTEX\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n#define CURVE_VALUE_ARRAY uVCurveValues\n#define CURVE_VALUE_COUNT VERT_CURVE_VALUE_COUNT\n#define FRAG_CURVE_VALUE_COUNT 0\n#else\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n#define CURVE_VALUE_ARRAY uFCurveValues\n#define CURVE_VALUE_COUNT FRAG_CURVE_VALUE_COUNT\n#define VERT_CURVE_VALUE_COUNT 0\n#endif\n#if CURVE_VALUE_COUNT > 0\n#if LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n#endif\n#else\n#define lookup_curve(i) vec4(0.)\n#endif\n#ifdef WEBGL2\n#define ITR_END (count + 1)\n#else\n#define ITR_END MAX_C\n#endif\n#define NONE_CONST_INDEX 1\n#ifdef SHADER_VERTEX\nattribute float aSeed;varying float vSeed;\n#endif\n#ifdef SHADER_VERTEX\n#define MAX_C VERT_MAX_KEY_FRAME_COUNT\n#else\n#define MAX_C FRAG_MAX_KEY_FRAME_COUNT\n#endif\nmat4 cubicBezierMatrix=mat4(1.0,-3.0,3.0,-1.0,0.0,3.0,-6.0,3.0,0.0,0.0,3.0,-3.0,0.0,0.0,0.0,1.0);float cubicBezier(float t,float y1,float y2,float y3,float y4){vec4 tVec=vec4(1.0,t,t*t,t*t*t);vec4 yVec=vec4(y1,y2,y3,y4);vec4 result=tVec*cubicBezierMatrix*yVec;return result.x+result.y+result.z+result.w;}float binarySearchT(float x,float x1,float x2,float x3,float x4){float left=0.0;float right=1.0;float mid=0.0;float computedX;for(int i=0;i<8;i++){mid=(left+right)*0.5;computedX=cubicBezier(mid,x1,x2,x3,x4);if(abs(computedX-x)<0.0001){break;}else if(computedX>x){right=mid;}else{left=mid;}}return mid;}float valueFromBezierCurveFrames(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);for(int i=0;i<ITR_END;i+=2){if(i>=count){break;}vec4 k0=lookup_curve(i+start);vec4 k1=lookup_curve(i+1+start);if(i==0&&time<k0.x){return k0.y;}if(i==int(frameCount-2.)&&time>=k1.x){return k1.y;}if(time>=k0.x&&time<=k1.x){float t=(time-k0.x)/(k1.x-k0.x);float nt=binarySearchT(time,k0.x,k0.z,k1.z,k1.x);return cubicBezier(nt,k0.y,k0.w,k1.w,k1.y);}}}float evaluteLineSeg(float t,vec2 p0,vec2 p1){return p0.y+(p1.y-p0.y)*(t-p0.x)/(p1.x-p0.x);}float valueFromLineSegs(float time,float frameStart,float frameCount){int start=int(frameStart);int count=int(frameCount-1.);int end=start+count;for(int i=0;i<ITR_END;i++){if(i>count){return lookup_curve(i).w;}vec4 seg=lookup_curve(i+start);vec2 p0=seg.xy;vec2 p1=seg.zw;if(time>=p0.x&&time<=p1.x){return evaluteLineSeg(time,p0,p1);}vec2 p2=lookup_curve(i+start+1).xy;if(time>p1.x&&time<=p2.x){return evaluteLineSeg(time,p1,p2);}}return lookup_curve(0).y;}float getValueFromTime(float time,vec4 value){float type=value.x;if(type==0.){return value.y;}if(type==1.){return mix(value.y,value.z,time/value.w);}if(type==3.){return valueFromLineSegs(time,value.y,value.z);}if(type==4.){return mix(value.y,value.z,aSeed);}if(type==5.){return valueFromBezierCurveFrames(time,value.z,value.w);}return 0.;}",exports.valueDefine="#ifdef SHADER_VERTEX\n#define CURVE_VALUE_TEXTURE uVCurveValueTexture\n#define CURVE_VALUE_ARRAY uVCurveValues\n#define CURVE_VALUE_COUNT VERT_CURVE_VALUE_COUNT\n#define FRAG_CURVE_VALUE_COUNT 0\n#else\n#define CURVE_VALUE_TEXTURE uFCurveValueTexture\n#define CURVE_VALUE_ARRAY uFCurveValues\n#define CURVE_VALUE_COUNT FRAG_CURVE_VALUE_COUNT\n#define VERT_CURVE_VALUE_COUNT 0\n#endif\n#if CURVE_VALUE_COUNT > 0\n#if LOOKUP_TEXTURE_CURVE\nuniform sampler2D CURVE_VALUE_TEXTURE;const float uCurveCount=1./float(CURVE_VALUE_COUNT);\n#define lookup_curve(i) texture2D(CURVE_VALUE_TEXTURE,vec2(float(i) * uCurveCount,0.))\n#else\nuniform vec4 CURVE_VALUE_ARRAY[CURVE_VALUE_COUNT];\n#define lookup_curve(i) CURVE_VALUE_ARRAY[i]\n#endif\n#else\n#define lookup_curve(i) vec4(0.)\n#endif\n#ifdef WEBGL2\n#define ITR_END (count + 1)\n#else\n#define ITR_END MAX_C\n#endif\n",exports.vecFill=Hs,exports.vecMulCombine=js,exports.version="2.7.2",exports.vertexFormatType2GLType=jo;
